<header class="article-header">
<h1 class="article-title">æœåŠ¡å¼•ç”¨ï¼ˆä¸€ï¼‰ä¹‹æœ¬åœ°å¼•ç”¨ï¼ˆInjvmï¼‰</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>Dubbo æœåŠ¡å¼•ç”¨ï¼Œ<strong>å’Œ Dubbo æœåŠ¡æš´éœ²ä¸€æ ·</strong>ï¼Œ<strong>ä¹Ÿ</strong>æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>æœ¬åœ°å¼•ç”¨ï¼ŒJVM æœ¬åœ°è°ƒç”¨ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">// æ¨è</span><br /><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">scope</span>=<span class="string">"local"</span> /&gt;</span></span><br /><span class="line">// ä¸æ¨èä½¿ç”¨ï¼Œå‡†å¤‡åºŸå¼ƒ</span><br /><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">injvm</span>=<span class="string">"true"</span> /&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>è¿œç¨‹æš´éœ²ï¼Œç½‘ç»œè¿œç¨‹é€šä¿¡ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">scope</span>=<span class="string">"remote"</span> /&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<p>æˆ‘ä»¬çŸ¥é“ Dubbo æä¾›äº†å¤šç§åè®®( Protocol )å®ç°ã€‚</p>
<ul>
<li><strong>æœ¬æ–‡</strong>ä»…åˆ†äº«æœ¬åœ°å¼•ç”¨ï¼Œè¯¥æ–¹å¼ä»…ä½¿ç”¨ Injvm åè®®å®ç°ï¼Œå…·ä½“ä»£ç åœ¨&nbsp;<code>dubbo-rpc-injvm</code>&nbsp;æ¨¡å—ä¸­ã€‚</li>
<li><strong>ä¸‹å‡ ç¯‡</strong>ä¼šåˆ†äº«è¿œç¨‹å¼•ç”¨ï¼Œè¯¥æ–¹å¼æœ‰å¤šç§åè®®å®ç°ï¼Œä¾‹å¦‚ Dubbo ( é»˜è®¤åè®® )ã€Hessian ã€Rest ç­‰ç­‰ã€‚æˆ‘ä»¬ä¼šæ¯ä¸ªåè®®å¯¹åº”ä¸€ç¯‡æ–‡ç« ï¼Œè¿›è¡Œåˆ†äº«ã€‚</li>
</ul>
<h1 id="2-createProxy">2. createProxy</h1>
<p>æœ¬åœ°å¼•ç”¨æœåŠ¡çš„é¡ºåºå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_05_01/02.png" alt="æœ¬åœ°å¼•ç”¨é¡ºåºå›¾" /></p>
<p>åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-api-3/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; API é…ç½®ï¼ˆä¸‰ï¼‰ä¹‹æœåŠ¡æ¶ˆè´¹è€…ã€‹</a>&nbsp;ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°&nbsp;<code>ReferenceConfig#init()</code>&nbsp;æ–¹æ³•ä¸­ï¼Œä¼šåœ¨é…ç½®åˆå§‹åŒ–å®Œæˆåï¼Œè°ƒç”¨é¡ºåºå›¾çš„<strong>èµ·ç‚¹</strong>&nbsp;<code>#createProxy(map)</code>&nbsp;æ–¹æ³•ï¼Œå¼€å§‹å¼•ç”¨æœåŠ¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * è‡ªé€‚åº” Protocol å®ç°å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Protocol refprotocol = ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension();</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * è‡ªé€‚åº” ProxyFactory å®ç°å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ProxyFactory proxyFactory = ExtensionLoader.getExtensionLoader(ProxyFactory.class).getAdaptiveExtension();</span><br />    <br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * ç›´è¿æœåŠ¡æä¾›è€…åœ°å€</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="comment">// url for peer-to-peer invocation</span></span><br /><span class="line"><span class="keyword">private</span> String url;</span><br /><br /><span class="line">  <span class="number">1</span>: <span class="function"><span class="keyword">private</span> T <span class="title">createProxy</span><span class="params">(Map&lt;String, String&gt; map)</span> </span>{</span><br /><span class="line">  <span class="number">2</span>:     URL tmpUrl = <span class="keyword">new</span> URL(<span class="string">"temp"</span>, <span class="string">"localhost"</span>, <span class="number">0</span>, map);</span><br /><span class="line">  <span class="number">3</span>:     <span class="comment">// æ˜¯å¦æœ¬åœ°å¼•ç”¨</span></span><br /><span class="line">  <span class="number">4</span>:     <span class="keyword">final</span> <span class="keyword">boolean</span> isJvmRefer;</span><br /><span class="line">  <span class="number">5</span>:     <span class="comment">// injvm å±æ€§ä¸ºç©ºï¼Œä¸é€šè¿‡è¯¥å±æ€§åˆ¤æ–­</span></span><br /><span class="line">  <span class="number">6</span>:     <span class="keyword">if</span> (isInjvm() == <span class="keyword">null</span>) {</span><br /><span class="line">  <span class="number">7</span>:         <span class="comment">// ç›´è¿æœåŠ¡æä¾›è€…ï¼Œå‚è§æ–‡æ¡£ã€Šç›´è¿æä¾›è€…ã€‹http://dubbo.apache.org/zh-cn/docs/user/demos/explicit-target.html</span></span><br /><span class="line">  <span class="number">8</span>:         <span class="keyword">if</span> (url != <span class="keyword">null</span> &amp;&amp; url.length() &gt; <span class="number">0</span>) { <span class="comment">// if a url is specified, don't do local reference</span></span><br /><span class="line">  <span class="number">9</span>:             isJvmRefer = <span class="keyword">false</span>;</span><br /><span class="line"> <span class="number">10</span>:         <span class="comment">// é€šè¿‡ `tmpUrl` åˆ¤æ–­ï¼Œæ˜¯å¦éœ€è¦æœ¬åœ°å¼•ç”¨</span></span><br /><span class="line"> <span class="number">11</span>:         } <span class="keyword">else</span> <span class="keyword">if</span> (InjvmProtocol.getInjvmProtocol().isInjvmRefer(tmpUrl)) {</span><br /><span class="line"> <span class="number">12</span>:             <span class="comment">// by default, reference local service if there is</span></span><br /><span class="line"> <span class="number">13</span>:             isJvmRefer = <span class="keyword">true</span>;</span><br /><span class="line"> <span class="number">14</span>:         <span class="comment">// é»˜è®¤ä¸æ˜¯</span></span><br /><span class="line"> <span class="number">15</span>:         } <span class="keyword">else</span> {</span><br /><span class="line"> <span class="number">16</span>:             isJvmRefer = <span class="keyword">false</span>;</span><br /><span class="line"> <span class="number">17</span>:         }</span><br /><span class="line"> <span class="number">18</span>:     <span class="comment">// é€šè¿‡ injvm å±æ€§ã€‚</span></span><br /><span class="line"> <span class="number">19</span>:     } <span class="keyword">else</span> {</span><br /><span class="line"> <span class="number">20</span>:         isJvmRefer = isInjvm();</span><br /><span class="line"> <span class="number">21</span>:     }</span><br /><span class="line"> <span class="number">22</span>: </span><br /><span class="line"> <span class="number">23</span>:     <span class="comment">// æœ¬åœ°å¼•ç”¨</span></span><br /><span class="line"> <span class="number">24</span>:     <span class="keyword">if</span> (isJvmRefer) {</span><br /><span class="line"> <span class="number">25</span>:         <span class="comment">// åˆ›å»ºæœåŠ¡å¼•ç”¨ URL å¯¹è±¡</span></span><br /><span class="line"> <span class="number">26</span>:         URL url = <span class="keyword">new</span> URL(Constants.LOCAL_PROTOCOL, NetUtils.LOCALHOST, <span class="number">0</span>, interfaceClass.getName()).addParameters(map);</span><br /><span class="line"> <span class="number">27</span>:         <span class="comment">// å¼•ç”¨æœåŠ¡ï¼Œè¿”å› Invoker å¯¹è±¡</span></span><br /><span class="line"> <span class="number">28</span>:         invoker = refprotocol.refer(interfaceClass, url);</span><br /><span class="line"> <span class="number">29</span>:         <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br /><span class="line"> <span class="number">30</span>:             logger.info(<span class="string">"Using injvm service "</span> + interfaceClass.getName());</span><br /><span class="line"> <span class="number">31</span>:         }</span><br /><span class="line"> <span class="number">32</span>:     <span class="comment">// æ­£å¸¸æµç¨‹ï¼Œä¸€èˆ¬ä¸ºè¿œç¨‹å¼•ç”¨</span></span><br /><span class="line"> <span class="number">33</span>:     } <span class="keyword">else</span> {</span><br /><span class="line"> <span class="number">34</span>:         <span class="comment">// ... çœç•¥æœ¬æ–‡æš‚æ—¶ä¸åˆ†äº«çš„æœåŠ¡è¿œç¨‹å¼•ç”¨ </span></span><br /><span class="line"> <span class="number">35</span>:         }</span><br /><span class="line"> <span class="number">36</span>:     }</span><br /><span class="line"> <span class="number">37</span>: </span><br /><span class="line"> <span class="number">38</span>:     <span class="comment">// å¯åŠ¨æ—¶æ£€æŸ¥</span></span><br /><span class="line"> <span class="number">39</span>:     Boolean c = check;</span><br /><span class="line"> <span class="number">40</span>:     <span class="keyword">if</span> (c == <span class="keyword">null</span> &amp;&amp; consumer != <span class="keyword">null</span>) {</span><br /><span class="line"> <span class="number">41</span>:         c = consumer.isCheck();</span><br /><span class="line"> <span class="number">42</span>:     }</span><br /><span class="line"> <span class="number">43</span>:     <span class="keyword">if</span> (c == <span class="keyword">null</span>) {</span><br /><span class="line"> <span class="number">44</span>:         c = <span class="keyword">true</span>; <span class="comment">// default true</span></span><br /><span class="line"> <span class="number">45</span>:     }</span><br /><span class="line"> <span class="number">46</span>:     <span class="keyword">if</span> (c &amp;&amp; !invoker.isAvailable()) {</span><br /><span class="line"> <span class="number">47</span>:         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Failed to check the status of the service "</span> + interfaceName + <span class="string">". No provider available for the service "</span> + (group == <span class="keyword">null</span> ? <span class="string">""</span> : group + <span class="string">"/"</span>) + interfaceName + (version == <span class="keyword">null</span> ? <span class="string">""</span> : <span class="string">":"</span> + version) + <span class="string">" from the url "</span> + invoker.getUrl() + <span class="string">" to the consumer "</span> + NetUtils.getLocalHost() + <span class="string">" use dubbo version "</span> + Version.getVersion());</span><br /><span class="line"> <span class="number">48</span>:     }</span><br /><span class="line"> <span class="number">49</span>:     <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br /><span class="line"> <span class="number">50</span>:         logger.info(<span class="string">"Refer dubbo service "</span> + interfaceClass.getName() + <span class="string">" from url "</span> + invoker.getUrl());</span><br /><span class="line"> <span class="number">51</span>:     }</span><br /><span class="line"> <span class="number">52</span>: </span><br /><span class="line"> <span class="number">53</span>:     <span class="comment">// åˆ›å»º Service ä»£ç†å¯¹è±¡</span></span><br /><span class="line"> <span class="number">54</span>:     <span class="comment">// create service proxy</span></span><br /><span class="line"> <span class="number">55</span>:     <span class="keyword">return</span> (T) proxyFactory.getProxy(invoker);</span><br /><span class="line"> <span class="number">56</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>map</code>&nbsp;æ–¹æ³•å‚æ•°ï¼ŒURL å‚æ•°é›†åˆï¼ŒåŒ…å«æœåŠ¡å¼•ç”¨é…ç½®å¯¹è±¡çš„é…ç½®é¡¹ã€‚</li>
<li>============ åˆ†å‰²çº¿ ============</li>
<li>ç¬¬ 2 è¡Œï¼šåˆ›å»º URL å¯¹è±¡ï¼Œé‡ç‚¹åœ¨<strong>ç¬¬å››ä¸ªå‚æ•°</strong>ï¼Œä¼ å…¥çš„æ˜¯&nbsp;<code>map</code>&nbsp;ï¼Œä»…ç”¨äºç¬¬ 11 è¡Œï¼Œæ˜¯å¦æœ¬åœ°å¼•ç”¨ã€‚
<ul>
<li><code>protocol = temp</code>&nbsp;çš„åŸå› æ˜¯ï¼Œåœ¨ç¬¬ 11 è¡Œï¼Œå·²ç»ç›´æ¥ä½¿ç”¨äº† InjvmProtocol ï¼Œè€Œä¸éœ€è¦é€šè¿‡è¯¥å€¼å»è·å–ã€‚</li>
</ul>
</li>
<li>ç¬¬ 4 è¡Œï¼šæ˜¯å¦æœ¬åœ°å¼•ç”¨å˜é‡&nbsp;<code>isJvmRefer</code>&nbsp;ã€‚</li>
<li>ç¬¬ 19 è¡Œ è‡³ 20 è¡Œï¼šè°ƒç”¨&nbsp;<code>#isInjvm()</code>&nbsp;æ–¹æ³•ï¼Œè¿”å›<strong>éç©º</strong>ï¼Œè¯´æ˜é…ç½®äº†&nbsp;<code>injvm</code>&nbsp;é…ç½®é¡¹ï¼Œç›´æ¥ä½¿ç”¨é…ç½®é¡¹ã€‚</li>
<li>ç¬¬ 8 è‡³ 9 è¡Œï¼šé…ç½®äº†&nbsp;<code>url</code>&nbsp;é…ç½®é¡¹ï¼Œè¯´æ˜ä½¿ç”¨ç›´è¿æœåŠ¡æä¾›è€…çš„åŠŸèƒ½ï¼Œåˆ™ä¸ä½¿ç”¨æœ¬åœ°ä½¿ç”¨ã€‚
<ul>
<li><a href="http://dubbo.apache.org/zh-cn/docs/user/demos/explicit-target.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; ç›´è¿æä¾›è€…ã€‹</a></li>
</ul>
</li>
<li>
<p>ç¬¬ 11 è‡³ 13 è¡Œï¼šè°ƒç”¨&nbsp;<code>InjvmProtocol#isInjvmRefer(url)</code>&nbsp;æ–¹æ³•ï¼Œé€šè¿‡&nbsp;<code>tmpUrl</code>&nbsp;åˆ¤æ–­ï¼Œæ˜¯å¦éœ€è¦æœ¬åœ°å¼•ç”¨ã€‚ä½¿ç”¨&nbsp;<code>tmpUrl</code>&nbsp;ï¼Œç›¸å½“äºä½¿ç”¨æœåŠ¡å¼•ç”¨é…ç½®å¯¹è±¡çš„é…ç½®é¡¹ã€‚è¯¥æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * æ˜¯å¦æœ¬åœ°å¼•ç”¨</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> url URL</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@return</span> æ˜¯å¦</span></span><br /><span class="line"><span class="comment"> 6:  */</span></span><br /><span class="line"> <span class="number">7</span>: <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInjvmRefer</span><span class="params">(URL url)</span> </span>{</span><br /><span class="line"> <span class="number">8</span>:     <span class="keyword">final</span> <span class="keyword">boolean</span> isJvmRefer;</span><br /><span class="line"> <span class="number">9</span>:     String scope = url.getParameter(Constants.SCOPE_KEY);</span><br /><span class="line"><span class="number">10</span>:     <span class="comment">// Since injvm protocol is configured explicitly, we don't need to set any extra flag, use normal refer process.</span></span><br /><span class="line"><span class="number">11</span>:     <span class="comment">// å½“ `protocol = injvm` æ—¶ï¼Œæœ¬èº«å·²ç»æ˜¯ jvm åè®®äº†ï¼Œèµ°æ­£å¸¸æµç¨‹å°±æ˜¯äº†ã€‚</span></span><br /><span class="line"><span class="number">12</span>:     <span class="keyword">if</span> (Constants.LOCAL_PROTOCOL.toString().equals(url.getProtocol())) {</span><br /><span class="line"><span class="number">13</span>:         isJvmRefer = <span class="keyword">false</span>;</span><br /><span class="line"><span class="number">14</span>:     <span class="comment">// å½“ `scope = local` æˆ–è€… `injvm = true` æ—¶ï¼Œæœ¬åœ°å¼•ç”¨</span></span><br /><span class="line"><span class="number">15</span>:     } <span class="keyword">else</span> <span class="keyword">if</span> (Constants.SCOPE_LOCAL.equals(scope) || (url.getParameter(<span class="string">"injvm"</span>, <span class="keyword">false</span>))) {</span><br /><span class="line"><span class="number">16</span>:         <span class="comment">// if it's declared as local reference</span></span><br /><span class="line"><span class="number">17</span>:         <span class="comment">// 'scope=local' is equivalent to 'injvm=true', injvm will be deprecated in the future release</span></span><br /><span class="line"><span class="number">18</span>:         isJvmRefer = <span class="keyword">true</span>;</span><br /><span class="line"><span class="number">19</span>:     <span class="comment">// å½“ `scope = remote` æ—¶ï¼Œè¿œç¨‹å¼•ç”¨</span></span><br /><span class="line"><span class="number">20</span>:     } <span class="keyword">else</span> <span class="keyword">if</span> (Constants.SCOPE_REMOTE.equals(scope)) {</span><br /><span class="line"><span class="number">21</span>:         <span class="comment">// it's declared as remote reference</span></span><br /><span class="line"><span class="number">22</span>:         isJvmRefer = <span class="keyword">false</span>;</span><br /><span class="line"><span class="number">23</span>:     <span class="comment">// å½“ `generic = true` æ—¶ï¼Œå³ä½¿ç”¨æ³›åŒ–è°ƒç”¨ï¼Œè¿œç¨‹å¼•ç”¨ã€‚</span></span><br /><span class="line"><span class="number">24</span>:     } <span class="keyword">else</span> <span class="keyword">if</span> (url.getParameter(Constants.GENERIC_KEY, <span class="keyword">false</span>)) {</span><br /><span class="line"><span class="number">25</span>:         <span class="comment">// generic invocation is not local reference</span></span><br /><span class="line"><span class="number">26</span>:         isJvmRefer = <span class="keyword">false</span>;</span><br /><span class="line"><span class="number">27</span>:     <span class="comment">// å½“æœ¬åœ°å·²ç»æœ‰è¯¥ Exporter æ—¶ï¼Œæœ¬åœ°å¼•ç”¨</span></span><br /><span class="line"><span class="number">28</span>:     } <span class="keyword">else</span> <span class="keyword">if</span> (getExporter(exporterMap, url) != <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">29</span>:         <span class="comment">// by default, go through local reference if there's the service exposed locally</span></span><br /><span class="line"><span class="number">30</span>:         isJvmRefer = <span class="keyword">true</span>;</span><br /><span class="line"><span class="number">31</span>:     <span class="comment">// é»˜è®¤ï¼Œè¿œç¨‹å¼•ç”¨</span></span><br /><span class="line"><span class="number">32</span>:     } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">33</span>:         isJvmRefer = <span class="keyword">false</span>;</span><br /><span class="line"><span class="number">34</span>:     }</span><br /><span class="line"><span class="number">35</span>:     <span class="keyword">return</span> isJvmRefer;</span><br /><span class="line"><span class="number">36</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>============ æœ¬åœ°å¼•ç”¨ ============
<ul>
<li>ç¬¬ 15 è‡³ 18 è¡Œï¼šå½“&nbsp;<code>scope = local</code>&nbsp;æˆ–&nbsp;<code>injvm = true</code>&nbsp;æ—¶ï¼Œæœ¬åœ°å¼•ç”¨ã€‚</li>
<li>ç¬¬ 27 è‡³ 30 è¡Œï¼šè°ƒç”¨&nbsp;<code>#getExporter(url)</code>&nbsp;æ–¹æ³•ï¼Œåˆ¤æ–­å½“æœ¬åœ°å·²ç»æœ‰&nbsp;<code>url</code>&nbsp;å¯¹åº”çš„ InjvmExporter æ—¶ï¼Œ<strong>ç›´æ¥</strong>å¼•ç”¨ã€‚ğŸ™‚ æœ¬åœ°å·²æœ‰çš„æœåŠ¡ï¼Œä¸å¿…è¦ä½¿ç”¨è¿œç¨‹æœåŠ¡ï¼Œå‡å°‘ç½‘ç»œå¼€é”€ï¼Œæå‡æ€§èƒ½ã€‚
<ul>
<li>ğŸ™‚ ä»£ç æ¯”è¾ƒç®€å•ï¼Œå·²ç»æ·»åŠ ä¸­æ–‡æ³¨é‡Šï¼Œèƒ–å‹ç‚¹å‡»é“¾æ¥æŸ¥çœ‹ã€‚</li>
<li><a href="https://github.com/YunaiV/dubbo/blob/6f366fae76b4fc5fc4fb0352737b6e847a3a2b0b/dubbo-rpc/dubbo-rpc-injvm/src/main/java/com/alibaba/dubbo/rpc/protocol/injvm/InjvmProtocol.java#L63-L94" target="_blank" rel="external nofollow noopener noreferrer"><code>InjvmProtocol#getExporter(url)</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/6f366fae76b4fc5fc4fb0352737b6e847a3a2b0b/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/UrlUtils.java#L462-L491" target="_blank" rel="external nofollow noopener noreferrer"><code>UrlUtils#isServiceKeyMatch(pattern, value)</code></a></li>
</ul>
</li>
<li>============ è¿œç¨‹å¼•ç”¨ ============</li>
<li>ç¬¬ 10 è‡³ 13 è¡Œï¼šå½“&nbsp;<code>protocol = injvm</code>&nbsp;æ—¶ï¼Œæœ¬èº«å·²ç»æ˜¯ Injvm åè®®äº†ï¼Œèµ°æ­£å¸¸æµç¨‹å³å¯ã€‚<strong>è¿™æ˜¯æœ€ç‰¹æ®Šçš„ï¼Œä¸‹é¢ä¼šæ›´å¥½çš„ç†è§£</strong>ã€‚å¦å¤–ï¼Œå› ä¸º&nbsp;<code>#isInjvmRefer(url)</code>&nbsp;æ–¹æ³•ï¼Œä»…æœ‰åœ¨&nbsp;<code>#createProxy(map)</code>&nbsp;æ–¹æ³•ä¸­è°ƒç”¨ï¼Œå› æ­¤å®é™…ä¹Ÿä¸ä¼šè§¦å‘è¯¥é€»è¾‘ã€‚</li>
<li>ç¬¬ 19 è‡³ 22 è¡Œï¼šå½“&nbsp;<code>scope = remote</code>&nbsp;æ—¶ï¼Œè¿œç¨‹å¼•ç”¨ã€‚</li>
<li>ç¬¬ 23 è‡³ 26 è¡Œï¼šå½“&nbsp;<code>generic = true</code>&nbsp;æ—¶ï¼Œå³ä½¿ç”¨æ³›åŒ–è°ƒç”¨ï¼Œè¿œç¨‹å¼•ç”¨ã€‚
<ul>
<li><a href="http://dubbo.apache.org/zh-cn/docs/user/demos/generic-reference.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; æ³›åŒ–è°ƒç”¨ã€‹</a></li>
</ul>
</li>
<li>ç¬¬ 31 è‡³ 34 è¡Œï¼šé»˜è®¤ï¼Œè¿œç¨‹å¼•ç”¨ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç¬¬ 23 è‡³ 31 è¡Œï¼š<strong>æœ¬åœ°å¼•ç”¨</strong>ã€‚</p>
<ul>
<li>ç¬¬ 26 è¡Œï¼šåˆ›å»ºæœ¬åœ°æœåŠ¡å¼•ç”¨ URL å¯¹è±¡ã€‚</li>
<li>ç¬¬ 28 è¡Œï¼šè°ƒç”¨&nbsp;<code>Protocol#refer(interface, url)</code>&nbsp;æ–¹æ³•ï¼Œå¼•ç”¨æœåŠ¡ï¼Œè¿”å› Invoker å¯¹è±¡ã€‚
<ul>
<li>æ­¤å¤„ Dubbo SPI&nbsp;<strong>è‡ªé€‚åº”</strong>çš„ç‰¹æ€§çš„<strong>å¥½å¤„</strong>å°±å‡ºæ¥äº†ï¼Œå¯ä»¥<strong>è‡ªåŠ¨</strong>æ ¹æ® URL å‚æ•°ï¼Œè·å¾—å¯¹åº”çš„æ‹“å±•å®ç°ã€‚ä¾‹å¦‚ï¼Œ<code>invoker</code>&nbsp;ä¼ å…¥åï¼Œæ ¹æ®&nbsp;<code>invoker.url</code>&nbsp;è‡ªåŠ¨è·å¾—å¯¹åº” Protocol æ‹“å±•å®ç°ä¸º InjvmProtocol ã€‚</li>
<li>å®é™…ä¸Šï¼ŒProtocol æœ‰ä¸¤ä¸ª Wrapper æ‹“å±•å®ç°ç±»ï¼š ProtocolFilterWrapperã€ProtocolListenerWrapper ã€‚æ‰€ä»¥ï¼Œ<code>#refer(...)</code>&nbsp;æ–¹æ³•çš„è°ƒç”¨é¡ºåºæ˜¯ï¼š<strong>Protocol$Adaptive =&gt; ProtocolFilterWrapper =&gt; ProtocolListenerWrapper =&gt; InjvmProtocol</strong>&nbsp;ã€‚</li>
<li>ğŸ™‚ è¯¦ç»†çš„è°ƒç”¨ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/reference-refer-local/">ã€Œ3. Protocolã€</a>&nbsp;åœ¨è§£æã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p>ç¬¬ 32 è‡³ 36 è¡Œï¼šæ­£å¸¸æµç¨‹ï¼Œä¸€èˆ¬ä¸º<strong>è¿œç¨‹å¼•ç”¨</strong>ã€‚ä¸ºä»€ä¹ˆæ˜¯<strong>ä¸€èˆ¬</strong>å‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬é…ç½®&nbsp;<code>protocol = injvm</code>&nbsp;ï¼Œå®é™…èµ°çš„æ˜¯<strong>æœ¬åœ°å¼•ç”¨</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">protocol</span>=<span class="string">"injvm"</span> &gt;</span></span><br /><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ğŸŒ å½“ç„¶ï¼Œç¬”è€…å»ºè®®ï¼Œå¦‚æœçœŸçš„æ˜¯éœ€è¦æœ¬åœ°åº”ç”¨ï¼Œå»ºè®®é…ç½®&nbsp;<code>scope = local</code>&nbsp;ã€‚è¿™æ ·ï¼Œä¼šæ›´åŠ æ˜ç¡®å’Œæ¸…æ™°ã€‚</li>
</ul>
</li>
<li>
<p>ç¬¬ 38 è‡³ 51 è¡Œï¼šè‹¥é…ç½®&nbsp;<code>check = true</code>&nbsp;é…ç½®é¡¹æ—¶ï¼Œè°ƒç”¨&nbsp;<code>Invoker#isAvailable()</code>&nbsp;æ–¹æ³•ï¼Œå¯åŠ¨æ—¶æ£€æŸ¥ã€‚</p>
<ul>
<li>ğŸ™‚ è¯¥æ–¹æ³•åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/reference-refer-local/">ã€Œ4.2 InjvmInvokerã€</a>&nbsp;ï¼Œè¯¦ç»†åˆ†äº«ã€‚</li>
<li>ğŸ™‚&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/preflight-check.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; å¯åŠ¨æ—¶æ£€æŸ¥ã€‹</a></li>
</ul>
</li>
<li>ç¬¬ 55 è¡Œï¼šè°ƒç”¨&nbsp;<code>ProxyFactory#getProxy(invoker)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º Service ä»£ç†å¯¹è±¡ã€‚è¯¥ Service ä»£ç†å¯¹è±¡çš„å†…éƒ¨ï¼Œä¼šè°ƒç”¨&nbsp;<code>Invoker#invoke(Invocation)</code>&nbsp;æ–¹æ³•ï¼Œè¿›è¡Œ Dubbo æœåŠ¡çš„è°ƒç”¨ã€‚
<ul>
<li>ğŸ™‚ è¯¦ç»†çš„å®ç°ï¼Œåé¢å•ç‹¬å†™æ–‡ç« åˆ†äº«ã€‚</li>
</ul>
</li>
</ul>
<h1 id="3-Protocol">3. Protocol</h1>
<p><strong>æœåŠ¡å¼•ç”¨ä¸æš´éœ²çš„ Protocol å¾ˆå¤šç±»ä¼¼ç‚¹</strong>ï¼Œæœ¬æ–‡å°±ä¸é‡å¤å™è¿°äº†ã€‚</p>
<p>å»ºè®®ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œè¯·ç‚¹å‡»&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æœåŠ¡æš´éœ²ï¼ˆä¸€ï¼‰ä¹‹æœ¬åœ°æš´éœ²ï¼ˆInjvmï¼‰ã€‹ã€Œ3. Protocolã€</a>&nbsp;æŸ¥çœ‹ã€‚</p>
<p>æœ¬æ–‡æ¶‰åŠçš„ Protocol ç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_05_01/04.png" alt="Protocol ç±»å›¾" /></p>
<h2 id="3-1-ProtocolFilterWrapper">3.1 ProtocolFilterWrapper</h2>
<h3 id="3-1-1-refer">3.1.1 refer</h3>
<p>æœ¬æ–‡æ¶‰åŠçš„&nbsp;<code>#refer(type, url)</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="number">1</span>: <span class="keyword">public</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">refer</span><span class="params">(Class&lt;T&gt; type, URL url)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"><span class="number">2</span>:     <span class="comment">// æ³¨å†Œä¸­å¿ƒ</span></span><br /><span class="line"><span class="number">3</span>:     <span class="keyword">if</span> (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) {</span><br /><span class="line"><span class="number">4</span>:         <span class="keyword">return</span> protocol.refer(type, url);</span><br /><span class="line"><span class="number">5</span>:     }</span><br /><span class="line"><span class="number">6</span>:     <span class="comment">// å¼•ç”¨æœåŠ¡ï¼Œè¿”å› Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="number">7</span>:     <span class="comment">// ç»™æ”¹ Invoker å¯¹è±¡ï¼ŒåŒ…è£…æˆå¸¦æœ‰ Filter è¿‡æ»¤é“¾çš„ Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="number">8</span>:     <span class="keyword">return</span> buildInvokerChain(protocol.refer(type, url), Constants.REFERENCE_FILTER_KEY, Constants.CONSUMER);</span><br /><span class="line"><span class="number">9</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 2 è‡³ 5 è¡Œï¼šå½“&nbsp;<code>invoker.url.protocl = registry</code>&nbsp;ï¼Œè·³è¿‡ï¼Œæœ¬åœ°å¼•ç”¨æœåŠ¡ä¸ä¼šç¬¦åˆè¿™ä¸ªåˆ¤æ–­ã€‚åœ¨è¿œç¨‹å¼•ç”¨æœåŠ¡ä¼šç¬¦åˆæš´éœ²è¯¥åˆ¤æ–­ï¼Œæ‰€ä»¥ä¸‹ä¸€ç¯‡æ–‡ç« åˆ†äº«ã€‚</li>
<li>ç¬¬ 8 è¡Œï¼šè°ƒç”¨&nbsp;<code>protocol#refer(type, url)</code>&nbsp;æ–¹æ³•ï¼Œç»§ç»­å¼•ç”¨æœåŠ¡ï¼Œæœ€ç»ˆè¿”å› Invoker ã€‚</li>
<li>ç¬¬ 8 è¡Œï¼šåœ¨å¼•ç”¨æœåŠ¡å®Œæˆåï¼Œè°ƒç”¨&nbsp;<code>#buildInvokerChain(invoker, key, group)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»ºå¸¦æœ‰ Filter è¿‡æ»¤é“¾çš„ Invoker å¯¹è±¡ã€‚</li>
</ul>
<h3 id="3-1-2-buildInvokerChain">3.1.2 buildInvokerChain</h3>
<p>å’Œ&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æœåŠ¡æš´éœ²ï¼ˆä¸€ï¼‰ä¹‹æœ¬åœ°æš´éœ²ï¼ˆInjvmï¼‰ã€‹ã€Œ3.1.3 buildInvokerChainã€</a>&nbsp;åŸºæœ¬ä¸€è‡´ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹</strong>ï¼Œè·å¾—çš„ Filter æ•°ç»„å¦‚ä¸‹ï¼š</p>
<ul>
<li>ConsumerContextFilter</li>
<li>FutureFilter</li>
<li>MonitorFilter</li>
</ul>
<p>å½“ç„¶ï¼Œå› ä¸ºä¼ å…¥çš„å‚æ•°&nbsp;<code>group</code>&nbsp;ä¸åŒï¼Œå¦‚æœèƒ–å‹è‡ªå®šä¹‰äº†<strong>è‡ªåŠ¨æ¿€æ´»</strong>çš„ Filter åªå‡ºç°åœ¨&nbsp;<code>group = consumer</code>ï¼Œé‚£ä¹ˆæœåŠ¡æ¶ˆè´¹è€…å°±ä¼šå¤šä¸€ä¸ªè¯¥ Filter å®ç°ã€‚</p>
<h2 id="3-2-ProtocolListenerWrapper">3.2 ProtocolListenerWrapper</h2>
<p>æœ¬æ–‡æ¶‰åŠçš„&nbsp;<code>#refer(type, url)</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="keyword">public</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">refer</span><span class="params">(Class&lt;T&gt; type, URL url)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"> <span class="number">2</span>:     <span class="comment">// æ³¨å†Œä¸­å¿ƒåè®®</span></span><br /><span class="line"> <span class="number">3</span>:     <span class="keyword">if</span> (Constants.REGISTRY_PROTOCOL.equals(url.getProtocol())) {</span><br /><span class="line"> <span class="number">4</span>:         <span class="keyword">return</span> protocol.refer(type, url);</span><br /><span class="line"> <span class="number">5</span>:     }</span><br /><span class="line"> <span class="number">6</span>:     <span class="comment">// å¼•ç”¨æœåŠ¡</span></span><br /><span class="line"> <span class="number">7</span>:     Invoker&lt;T&gt; invoker = protocol.refer(type, url);</span><br /><span class="line"> <span class="number">8</span>:     <span class="comment">// è·å¾— InvokerListener æ•°ç»„</span></span><br /><span class="line"> <span class="number">9</span>:     List&lt;InvokerListener&gt; listeners = Collections.unmodifiableList(ExtensionLoader.getExtensionLoader(InvokerListener.class).getActivateExtension(url, Constants.INVOKER_LISTENER_KEY));</span><br /><span class="line"><span class="number">10</span>:     <span class="comment">// åˆ›å»º ListenerInvokerWrapper å¯¹è±¡</span></span><br /><span class="line"><span class="number">11</span>:     <span class="keyword">return</span> <span class="keyword">new</span> ListenerInvokerWrapper&lt;T&gt;(invoker, listeners);</span><br /><span class="line"><span class="number">12</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 2 è‡³ 5 è¡Œï¼šå½“&nbsp;<code>invoker.url.protocl = registry</code>&nbsp;ï¼Œè·³è¿‡ï¼Œæœ¬åœ°å¼•ç”¨æœåŠ¡ä¸ä¼šç¬¦åˆè¿™ä¸ªåˆ¤æ–­ã€‚åœ¨è¿œç¨‹å¼•ç”¨æœåŠ¡ä¼šç¬¦åˆæš´éœ²è¯¥åˆ¤æ–­ï¼Œæ‰€ä»¥ä¸‹ä¸€ç¯‡æ–‡ç« åˆ†äº«ã€‚</li>
<li>ç¬¬ 7 è¡Œï¼šè°ƒç”¨&nbsp;<code>protocol#refer(type, url)</code>&nbsp;æ–¹æ³•ï¼Œç»§ç»­å¼•ç”¨æœåŠ¡ï¼Œæœ€ç»ˆè¿”å› Invoker ã€‚</li>
<li>ç¬¬ 9 è¡Œï¼šè°ƒç”¨&nbsp;<code>ExtensionLoader#getActivateExtension(url, key, group)</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—ç›‘å¬å™¨æ•°ç»„ã€‚
<ul>
<li>ğŸ™‚ ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œè¯·çœ‹&nbsp;<a href="http://svip.iocoder.cn/Dubbo/spi/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æ‹“å±•æœºåˆ¶ SPIã€‹</a>&nbsp;æ–‡ç« ã€‚</li>
<li>ç»§ç»­ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºåŸºç¡€ï¼Œ<code>listeners</code>&nbsp;ä¸º<strong>ç©º</strong>ã€‚èƒ–å‹å¯ä»¥è‡ªè¡Œå®ç° ExporterListener ï¼Œå¹¶è¿›è¡Œé…ç½®&nbsp;<code>@Activate</code>æ³¨è§£ï¼Œæˆ–è€… XML ä¸­&nbsp;<code>listener</code>&nbsp;å±æ€§ã€‚</li>
</ul>
</li>
<li>ç¬¬ 11 è¡Œï¼šåˆ›å»ºå¸¦ InvokerListener çš„ ListenerInvokerWrapper å¯¹è±¡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡Œ&nbsp;<code>ExporterListener#referred(invoker)</code>&nbsp;æ–¹æ³•ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/reference-refer-local/">ã€Œ4.3 ListenerInvokerWrapperã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
</ul>
<h2 id="3-3-InjvmProtocol">3.3 InjvmProtocol</h2>
<p>æœ¬æ–‡æ¶‰åŠçš„&nbsp;<code>#refer(type, url)</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">refer</span><span class="params">(Class&lt;T&gt; serviceType, URL url)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> InjvmInvoker&lt;T&gt;(serviceType, url, url.getServiceKey(), exporterMap);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>åˆ›å»º InjvmInvoker å¯¹è±¡ã€‚<strong>æ³¨æ„</strong>ï¼Œä¼ å…¥çš„&nbsp;<code>exporterMap</code>&nbsp;å‚æ•°ï¼ŒåŒ…å«<strong>æ‰€æœ‰çš„</strong>&nbsp;InjvmExporter å¯¹è±¡ã€‚</li>
</ul>
<h1 id="4-Invoker">4. Invoker</h1>
<p>Exporter&nbsp;<strong>æ¥å£</strong>ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/reference-refer-local/">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æ ¸å¿ƒæµç¨‹ä¸€è§ˆã€‹ã€Œ4.1 Invokerã€</a>&nbsp;æœ‰è¯¦ç»†è§£æã€‚</p>
<p>æœ¬æ–‡æ¶‰åŠçš„ Invoker ç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_05_01/05.png" alt="Invoker ç±»å›¾" /></p>
<h2 id="4-1-AbstractInvoker">4.1 AbstractInvoker</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6f366fae76b4fc5fc4fb0352737b6e847a3a2b0b/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/protocol/AbstractInvoker.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.AbstractInvoker</code></a>&nbsp;ï¼Œå®ç° Invoker æ¥å£ï¼ŒæŠ½è±¡ Invoker ç±»ï¼Œä¸»è¦æä¾›äº† Invoker çš„é€šç”¨å±æ€§å’Œ&nbsp;<code>#invoke(Invocation)</code>&nbsp;æ–¹æ³•çš„é€šç”¨å®ç°ã€‚</p>
<p>æœ¬æ–‡ä¸»è¦æ¶‰åŠåˆ°å®ƒçš„é€šç”¨å±æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æ¥å£ç±»å‹</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Class&lt;T&gt; type;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æœåŠ¡ URL</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> URL url;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * å…¬ç”¨çš„éšå¼ä¼ å‚ã€‚åœ¨ {<span class="doctag">@link</span> #invoke(Invocation)} æ–¹æ³•ä¸­ä½¿ç”¨ã€‚</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; attachment;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æ˜¯å¦å¯ç”¨</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> available = <span class="keyword">true</span>;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æ˜¯å¦é”€æ¯</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> AtomicBoolean destroyed = <span class="keyword">new</span> AtomicBoolean(<span class="keyword">false</span>);</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>psï¼š<code>#invoke(Invocation)</code>&nbsp;æ–¹æ³•ï¼Œåœ¨åç»­çš„æ–‡ç« åˆ†äº«ã€‚</p>
<h2 id="4-2-InjvmInvoker">4.2 InjvmInvoker</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6f366fae76b4fc5fc4fb0352737b6e847a3a2b0b/dubbo-rpc/dubbo-rpc-injvm/src/main/java/com/alibaba/dubbo/rpc/protocol/injvm/InjvmInvoker.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.injvm.InjvmInvoker</code></a>&nbsp;ï¼Œå®ç° AbstractInvoker æŠ½è±¡ç±»ï¼ŒInjvm Invoker å®ç°ç±»ã€‚</p>
<h3 id="4-2-1-å±æ€§">4.2.1 å±æ€§</h3>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æœåŠ¡é”®</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> String key;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Exporter é›†åˆ</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * key: æœåŠ¡é”®</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * è¯¥å€¼å®é™…å°±æ˜¯ {<span class="doctag">@link</span> com.alibaba.dubbo.rpc.protocol.AbstractProtocol#exporterMap}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Exporter&lt;?&gt;&gt; exporterMap;</span><br /><br /><span class="line">InjvmInvoker(Class&lt;T&gt; type, URL url, String key, Map&lt;String, Exporter&lt;?&gt;&gt; exporterMap) {</span><br /><span class="line">    <span class="keyword">super</span>(type, url);</span><br /><span class="line">    <span class="keyword">this</span>.key = key;</span><br /><span class="line">    <span class="keyword">this</span>.exporterMap = exporterMap;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>key</code>&nbsp;å±æ€§ï¼ŒæœåŠ¡é”®ã€‚</li>
<li><code>exporterMap</code>&nbsp;å±æ€§ï¼ŒExporter é›†åˆã€‚åœ¨&nbsp;<code>InjvmInvoker#invoke(invocation)</code>&nbsp;æ–¹æ³•ä¸­ï¼Œé€šè¿‡è¯¥ Invoker çš„&nbsp;<code>key</code>&nbsp;å±æ€§ï¼Œè·å¾—å¯¹åº”çš„ Exporter å¯¹è±¡ã€‚</li>
</ul>
<h3 id="4-2-2-isAvailable">4.2.2 isAvailable</h3>
<p><code>#isAvailable()</code>&nbsp;æ–¹æ³•ï¼Œæ˜¯å¦å¯ç”¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAvailable</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="comment">// åˆ¤æ–­æ˜¯å¦æœ‰ Exporter å¯¹è±¡</span></span><br /><span class="line">    InjvmExporter&lt;?&gt; exporter = (InjvmExporter&lt;?&gt;) exporterMap.get(key);</span><br /><span class="line">    <span class="keyword">if</span> (exporter == <span class="keyword">null</span>) {</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br /><span class="line">    } <span class="keyword">else</span> {</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.isAvailable();</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å¼€å¯&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/preflight-check.html" target="_blank" rel="external nofollow noopener noreferrer">å¯åŠ¨æ—¶æ£€æŸ¥</a>&nbsp;æ—¶ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ï¼Œåˆ¤æ–­è¯¥ Invoker å¯¹è±¡ï¼Œæ˜¯å¦æœ‰å¯¹åº”çš„ Exporter ã€‚è‹¥ä¸å­˜åœ¨ï¼Œ<strong>è¯´æ˜ä¾èµ–æœåŠ¡ä¸å­˜åœ¨</strong>ï¼Œæ£€æŸ¥ä¸é€šè¿‡ã€‚</li>
</ul>
<h2 id="4-3-ListenerInvokerWrapper">4.3 ListenerInvokerWrapper</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/listener/ListenerInvokerWrapper.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.listener.ListenerInvokerWrapper</code></a>&nbsp;ï¼Œå®ç° Invoker æ¥å£ï¼Œå…·æœ‰ç›‘å¬å™¨åŠŸèƒ½çš„ Invoker åŒ…è£…å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListenerInvokerWrapper</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Invoker</span>&lt;<span class="title">T</span>&gt; </span>{</span><br /><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ListenerInvokerWrapper.class);</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * çœŸå®çš„ Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Invoker&lt;T&gt; invoker;</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Invoker ç›‘å¬å™¨æ•°ç»„</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;InvokerListener&gt; listeners;</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ListenerInvokerWrapper</span><span class="params">(Invoker&lt;T&gt; invoker, List&lt;InvokerListener&gt; listeners)</span> </span>{</span><br /><span class="line">        <span class="keyword">if</span> (invoker == <span class="keyword">null</span>) {</span><br /><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"invoker == null"</span>);</span><br /><span class="line">        }</span><br /><span class="line">        <span class="keyword">this</span>.invoker = invoker;</span><br /><span class="line">        <span class="keyword">this</span>.listeners = listeners;</span><br /><span class="line">        <span class="comment">// æ‰§è¡Œç›‘å¬å™¨</span></span><br /><span class="line">        <span class="keyword">if</span> (listeners != <span class="keyword">null</span> &amp;&amp; !listeners.isEmpty()) {</span><br /><span class="line">            <span class="keyword">for</span> (InvokerListener listener : listeners) {</span><br /><span class="line">                <span class="keyword">if</span> (listener != <span class="keyword">null</span>) {</span><br /><span class="line">                    <span class="keyword">try</span> {</span><br /><span class="line">                        listener.referred(invoker);</span><br /><span class="line">                    } <span class="keyword">catch</span> (Throwable t) {</span><br /><span class="line">                        logger.error(t.getMessage(), t);</span><br /><span class="line">                    }</span><br /><span class="line">                }</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> Class&lt;T&gt; <span class="title">getInterface</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> invoker.getInterface();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> URL <span class="title">getUrl</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> invoker.getUrl();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAvailable</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> invoker.isAvailable();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line">        <span class="keyword">return</span> invoker.invoke(invocation);</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> getInterface() + <span class="string">" -&gt; "</span> + (getUrl() == <span class="keyword">null</span> ? <span class="string">" "</span> : getUrl().toString());</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">try</span> {</span><br /><span class="line">            invoker.destroy();</span><br /><span class="line">        } <span class="keyword">finally</span> {</span><br /><span class="line">            <span class="comment">// æ‰§è¡Œç›‘å¬å™¨</span></span><br /><span class="line">            <span class="keyword">if</span> (listeners != <span class="keyword">null</span> &amp;&amp; !listeners.isEmpty()) {</span><br /><span class="line">                <span class="keyword">for</span> (InvokerListener listener : listeners) {</span><br /><span class="line">                    <span class="keyword">if</span> (listener != <span class="keyword">null</span>) {</span><br /><span class="line">                        <span class="keyword">try</span> {</span><br /><span class="line">                            listener.destroyed(invoker);</span><br /><span class="line">                        } <span class="keyword">catch</span> (Throwable t) {</span><br /><span class="line">                            logger.error(t.getMessage(), t);</span><br /><span class="line">                        }</span><br /><span class="line">                    }</span><br /><span class="line">                }</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><strong>æ„é€ æ–¹æ³•</strong>ï¼Œå¾ªç¯&nbsp;<code>listeners</code>&nbsp;ï¼Œæ‰§è¡Œ&nbsp;<code>InvokerListener#referred(invoker)</code>&nbsp;æ–¹æ³•ã€‚ğŸ˜ˆ å’Œ ListenerExporterWrapper ä¸åŒï¼Œè‹¥æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ RuntimeException ï¼Œ<strong>ä»…</strong>æ‰“å°é”™è¯¯æ—¥å¿—ï¼Œç»§ç»­æ‰§è¡Œï¼Œæœ€ç»ˆ<strong>ä¸</strong>æŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li><code>#unexport()</code>&nbsp;æ–¹æ³•ï¼Œå¾ªç¯&nbsp;<code>listeners</code>&nbsp;ï¼Œæ‰§è¡Œ&nbsp;<code>InvokerListener#destroyed(invoker)</code>&nbsp;ã€‚ğŸ˜ˆ å’Œ ListenerExporterWrapper ä¸åŒï¼Œè‹¥æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ RuntimeException ï¼Œ<strong>ä»…</strong>æ‰“å°é”™è¯¯æ—¥å¿—ï¼Œç»§ç»­æ‰§è¡Œï¼Œæœ€ç»ˆ<strong>ä¸</strong>æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<h1 id="5-InvokerListener">5. InvokerListener</h1>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/InvokerListener.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.InvokerListener</code></a>&nbsp;ï¼ŒInvoker ç›‘å¬å™¨ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvokerListener</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The invoker referred</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡å¼•ç”¨å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Protocol#refer(Class, URL)</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">referred</span><span class="params">(Invoker&lt;?&gt; invoker)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The invoker destroyed.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡é”€æ¯å¼•ç”¨å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Invoker#destroy()</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroyed</span><span class="params">(Invoker&lt;?&gt; invoker)</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/16.png" alt="InvokerListener å­ç±»" /></p>
<h2 id="5-1-InvokerListenerAdapter">5.1 InvokerListenerAdapter</h2>
<p><code>com.alibaba.dubbo.rpc.listener.InvokerListenerAdapter</code>&nbsp;ï¼Œå®ç° InvokerListener æ¥å£ï¼ŒInvokerListener é€‚é…å™¨<strong>æŠ½è±¡ç±»</strong>ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">InvokerListenerAdapter</span> <span class="keyword">implements</span> <span class="title">InvokerListener</span> </span>{</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">referred</span><span class="params">(Invoker&lt;?&gt; invoker)</span> <span class="keyword">throws</span> RpcException </span>{ }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroyed</span><span class="params">(Invoker&lt;?&gt; invoker)</span> </span>{ }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="5-2-DeprecatedInvokerListener">5.2 DeprecatedInvokerListener</h2>
<p><code>com.alibaba.dubbo.rpc.listener.DeprecatedInvokerListener</code>&nbsp;ï¼Œå®ç° InvokerListenerAdapter&nbsp;<strong>æŠ½è±¡ç±»</strong>&nbsp;ï¼Œå¼•ç”¨åºŸå¼ƒçš„æœåŠ¡æ—¶ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—æé†’ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@Activate</span>(Constants.DEPRECATED_KEY)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeprecatedInvokerListener</span> <span class="keyword">extends</span> <span class="title">InvokerListenerAdapter</span> </span>{</span><br /><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOGGER = LoggerFactory.getLogger(DeprecatedInvokerListener.class);</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">referred</span><span class="params">(Invoker&lt;?&gt; invoker)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line">        <span class="keyword">if</span> (invoker.getUrl().getParameter(Constants.DEPRECATED_KEY, <span class="keyword">false</span>)) {</span><br /><span class="line">            LOGGER.error(<span class="string">"The service "</span> + invoker.getInterface().getName() + <span class="string">" is DEPRECATED! Declare from "</span> + invoker.getUrl());</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p><code>@Activate(Constants.DEPRECATED_KEY)</code>&nbsp;æ³¨è§£ï¼ŒåŸºäº Dubbo SPI Activate æœºåˆ¶åŠ è½½ã€‚é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.dubbo.demo.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">deprecated</span>=<span class="string">"true"</span> /&gt;</span></span><br /><span class="line">    ```  </span><br /><span class="line">    * é€šè¿‡è®¾ç½® `"deprecated"` ä¸º `true` æ¥è®¾ç½®ã€‚</span><br /><span class="line">    * è¯¥æ–¹å¼ä»…é€‚ç”¨äº**è¿œç¨‹å¼•ç”¨**æœåŠ¡ã€‚</span><br /> <br /><span class="line">* åœ¨ `#referred(invoker)` æ–¹æ³•ä¸­ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ï¼Œä¾‹å¦‚ï¼š</span><br /><br /><span class="line">    ```Java</span><br /><span class="line">    [25/03/18 07:37:56:056 CST] main ERROR listener.DeprecatedInvokerListener:  [DUBBO] The service com.alibaba.dubbo.demo.DemoService is DEPRECATED! Declare from dubbo://192.168.3.17:20880/com.alibaba.dubbo.demo.DemoService?anyhost=true&amp;application=demo-consumer&amp;check=false&amp;compiler=jdk&amp;default.delay=-1&amp;default.retries=0&amp;delay=-1&amp;deprecated=true&amp;dubbo=2.0.0&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello,bye&amp;pid=45155&amp;qos.port=33333&amp;register.ip=192.168.3.17&amp;remote.timestamp=1521977820764&amp;service.filter=demo&amp;side=consumer&amp;timestamp=1521977854685, dubbo version: 2.0.0, current host: 192.168.3.17</span><br /><span class="line">    group:consumer</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<p>å¦å¤–ï¼Œ<strong>æœ¬åœ°å¼•ç”¨</strong>æœåŠ¡çš„é…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"demoService"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.dubbo.demo.DemoService"</span> <span class="attr">protocol</span>=<span class="string">"injvm"</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">dubbo:parameter</span> <span class="attr">key</span>=<span class="string">"deprecated"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br /><span class="line"><span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å› ä¸ºï¼Œæœ¬åœ°å¼•ç”¨æœåŠ¡æ—¶ï¼Œä¸æ˜¯ä½¿ç”¨æœåŠ¡æä¾›è€…çš„ URL ï¼Œè€Œæ˜¯æœåŠ¡æ¶ˆè´¹è€…çš„ URL ã€‚</li>
</ul>
</div>