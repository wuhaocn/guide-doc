<header class="article-header">
<h1 class="article-title">å¤–éƒ¨åŒ–é…ç½®</h1>
</header>
<div class="article-entry">
<p>æœ¬æ–‡å®é™…æ˜¯ ã€ŠDubbo æºç åˆ†æ &mdash;&mdash; é›†æˆ Spring Bootã€‹æ–‡ç« ã€‚è€ƒè™‘åˆ°å’Œ Dubbo é…ç½®æ¯”è¾ƒç›¸å…³ï¼Œæ‰€ä»¥æ”¹æˆè¿™ä¸ªæ ‡é¢˜ã€‚</p>
<ul>
<li>é‡ç‚¹æ˜¯&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ4. dubbo-spring-boot-autoconfigure æºç ã€</a>&nbsp;å°èŠ‚ã€‚</li>
<li>é€‰æ‹©æ€§çœ‹&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ5. dubbo-spring-boot-actuator æºç ã€</a>&nbsp;å°èŠ‚ã€‚</li>
</ul>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>æœ¬æ–‡ï¼Œæˆ‘ä»¬æ¥åˆ†äº«&nbsp;<a href="https://github.com/apache/incubator-dubbo-spring-boot-project" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/apache/incubator-dubbo-spring-boot-project</a>&nbsp;é¡¹ç›®çš„æºç è§£æï¼Œçœ‹çœ‹ Dubbo æ˜¯å¦‚ä½•é›†æˆåˆ° Spring Boot ä¸­çš„ã€‚</p>
<p>åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå¸Œæœ›èƒ–å‹èƒ½å¤Ÿå…ˆç†Ÿè¯»&nbsp;<a href="https://github.com/apache/incubator-dubbo-spring-boot-project/blob/master/README_CN.md" target="_blank" rel="external nofollow noopener noreferrer">ä¸­æ–‡æ–‡æ¡£</a>&nbsp;ã€‚æœ€å¥½å‘¢ï¼Œå½“ç„¶ä¸å¼ºåˆ¶ï¼Œå¯ä»¥æ“ç»ƒä¸‹æ¯ä¸ª Demo ã€‚</p>
<h1 id="2-è°ƒè¯•ç¯å¢ƒæ­å»º">2. è°ƒè¯•ç¯å¢ƒæ­å»º</h1>
<p>åœ¨è¯»æºç ä¹‹å‰ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯å…ˆæŠŠè°ƒè¯•ç¯å¢ƒæ­å»ºèµ·æ¥ã€‚</p>
<h2 id="2-1-ä¾èµ–å·¥å…·">2.1 ä¾èµ–å·¥å…·</h2>
<ul>
<li>JDK ï¼š1.8+</li>
<li>Maven</li>
<li>IntelliJ IDEA</li>
</ul>
<h2 id="2-2-æºç æ‹‰å–">2.2 æºç æ‹‰å–</h2>
<p>ä»å®˜æ–¹ä»“åº“&nbsp;<a href="https://github.com/apache/incubator-dubbo-spring-boot-project" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/apache/incubator-dubbo-spring-boot-project</a>&nbsp;<code>Fork</code>&nbsp;å‡ºå±äºè‡ªå·±çš„ä»“åº“ã€‚ä¸ºä»€ä¹ˆè¦&nbsp;<code>Fork</code>&nbsp;ï¼Ÿæ—¢ç„¶å¼€å§‹é˜…è¯»ã€è°ƒè¯•æºç ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™ä¸€äº›æ³¨é‡Šï¼Œæœ‰äº†è‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥è¿›è¡Œè‡ªç”±çš„æäº¤ã€‚ğŸ˜ˆ</p>
<p>ä½¿ç”¨ IntelliJ IDEA ä» Fork å‡ºæ¥çš„ä»“åº“æ‹‰å–ä»£ç ã€‚æ‹‰å–å®Œæˆåï¼ŒMaven ä¼šä¸‹è½½ä¾èµ–åŒ…ï¼Œå¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œè€å¿ƒç­‰å¾…ä¸‹ã€‚</p>
<hr />
<p>åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ¥ç®€å•è¯´ä¸‹ï¼Œæ­å»ºè°ƒè¯•ç¯å¢ƒçš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>å¯åŠ¨ Dubbo Provider</li>
<li>å¯åŠ¨ Dubbo Consumer</li>
</ol>
<p>è€ƒè™‘åˆ°æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨&nbsp;<code>dubbo-registry-zookeeper-samples</code>&nbsp;é¡¹ç›®æä¾›çš„ç¤ºä¾‹ã€‚</p>
<p>ğŸ˜ˆ å¦å¤–ï¼Œæœ¬æ–‡ä½¿ç”¨çš„&nbsp;<code>incubator-dubbo-spring-boot-project</code>&nbsp;ç‰ˆæœ¬æ˜¯&nbsp;<code>0.2.1</code>&nbsp;ã€‚</p>
<h2 id="2-3-å¯åŠ¨-Dubbo-Provider">2.3 å¯åŠ¨ Dubbo Provider</h2>
<p>å³é”®è¿è¡Œ&nbsp;<code>dubbo-registry-zookeeper-samples</code>&nbsp;é¡¹ç›®ä¸‹çš„&nbsp;<code>provider-sample</code>&nbsp;çš„ DubboRegistryZooKeeperProviderBootstrap çš„&nbsp;<code>#main(String[] args)</code>&nbsp;æ–¹æ³•ï¼ŒProvider å°±å¯åŠ¨å®Œæˆäº†ã€‚è¾“å‡ºæ—¥å¿—å¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/01.jpg" alt="æ—¥å¿—" /></p>
<p>è¿™ä¸ªç¤ºä¾‹æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œæä¾›äº† EmbeddedZooKeeper ç±»ï¼Œç”¨äºå¯åŠ¨<strong>å†…åµŒ</strong>çš„ Zookeeper ã€‚</p>
<h2 id="2-4-å¯åŠ¨-Dubbo-Consumer">2.4 å¯åŠ¨ Dubbo Consumer</h2>
<p>å³é”®è¿è¡Œ&nbsp;<code>dubbo-registry-zookeeper-samples</code>&nbsp;é¡¹ç›®ä¸‹çš„&nbsp;<code>consumer-sample</code>&nbsp;çš„ DubboRegistryZooKeeperConsumerBootstrap çš„&nbsp;<code>#main(String[] args)</code>&nbsp;æ–¹æ³•ï¼ŒConsumer å°±å¯åŠ¨å®Œæˆäº†ã€‚è¾“å‡ºæ—¥å¿—å¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/02.jpg" alt="æ—¥å¿—" /></p>
<p>å› ä¸º DubboRegistryZooKeeperConsumerBootstrap çš„ Spring Boot å¯åŠ¨è°ƒç”¨å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboRegistryZooKeeperConsumerBootstrap.java</span></span><br /><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br /><br /><span class="line"><span class="meta">@Reference</span>(version = <span class="string">"${demo.service.version}"</span>)</span><br /><span class="line"><span class="keyword">private</span> DemoService demoService;</span><br /><br /><span class="line"><span class="meta">@Bean</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> ApplicationRunner <span class="title">runner</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> args -&gt; logger.info(demoService.sayHello(<span class="string">"mercyblitz"</span>)); <span class="comment">// å‘èµ·è°ƒç”¨</span></span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br /><span class="line">    SpringApplication.run(DubboRegistryZooKeeperConsumerBootstrap.class) <span class="comment">// å¯åŠ¨</span></span><br /><span class="line">            .close(); <span class="comment">// &lt;X&gt; å…³é—­</span></span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>&lt;X&gt;</code>&nbsp;å¤„ï¼Œæ‰€ä»¥åœ¨å‘èµ·ä¸€æ¬¡ Dubbo è°ƒç”¨ä¹‹åï¼Œä¼šç›´æ¥å…³é—­ Spring Boot åº”ç”¨ã€‚å› æ­¤ï¼ŒJVM è¿›ç¨‹å°±ç›´æ¥ç»“æŸäº†ã€‚</li>
</ul>
<h1 id="3-é¡¹ç›®ç»“æ„ä¸€è§ˆ">3. é¡¹ç›®ç»“æ„ä¸€è§ˆ</h1>
<p>æœ¬æ–‡ä¸»è¦åˆ†äº«&nbsp;<code>incubator-dubbo-spring-boot-project</code>&nbsp;çš„&nbsp;<strong>é¡¹ç›®ç»“æ„</strong>ã€‚<br />å¸Œæœ›é€šè¿‡æœ¬æ–‡èƒ½è®©èƒ–å‹å¯¹&nbsp;<code>incubator-dubbo-spring-boot-project</code>&nbsp;çš„æ•´ä½“é¡¹ç›®æœ‰ä¸ªç®€å•çš„äº†è§£ã€‚</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/03.jpg" alt="é¡¹ç›®ç»“æ„ä¸€è§ˆ" /></p>
<h2 id="3-1-ä»£ç ç»Ÿè®¡">3.1 ä»£ç ç»Ÿè®¡</h2>
<p>è¿™é‡Œå…ˆåˆ†äº«ä¸€ä¸ªå°æŠ€å·§ã€‚ç¬”è€…åœ¨å¼€å§‹æºç å­¦ä¹ æ—¶ï¼Œä¼šé¦–å…ˆäº†è§£é¡¹ç›®çš„ä»£ç é‡ã€‚</p>
<p><strong>ç¬¬ä¸€ç§æ–¹å¼</strong>ï¼Œä½¿ç”¨&nbsp;<a href="https://plugins.jetbrains.com/plugin/4509-statistic" target="_blank" rel="external nofollow noopener noreferrer">IDEA Statistic</a>&nbsp;æ’ä»¶ï¼Œç»Ÿè®¡æ•´ä½“ä»£ç é‡ã€‚</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/04.jpg" alt="Statistic ç»Ÿè®¡ä»£ç é‡" /></p>
<p>æˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„çœ‹åˆ°ï¼Œæ€»çš„ä»£ç é‡åœ¨ 2000 è¡Œã€‚è¿™å…¶ä¸­è¿˜åŒ…æ‹¬å•å…ƒæµ‹è¯•ï¼Œç¤ºä¾‹ç­‰ç­‰ä»£ç ã€‚<br />æ‰€ä»¥ï¼Œä¸æ…Œï¼Œä¸€ç‚¹ä¸æ…Œ~</p>
<p><strong>ç¬¬äºŒç§æ–¹å¼</strong>ï¼Œä½¿ç”¨&nbsp;<a href="http://blog.csdn.net/yhhwatl/article/details/52623879" target="_blank" rel="external nofollow noopener noreferrer">Shell è„šæœ¬å‘½ä»¤é€ä¸ª Maven æ¨¡å—ç»Ÿè®¡</a>&nbsp;ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¬”è€…ä½¿ç”¨&nbsp;<code>find . -name "*.java"|xargs cat|grep -v -e ^$ -e ^\s*\/\/.*$|wc -l</code>&nbsp;ã€‚è¿™ä¸ªå‘½ä»¤åªè¿‡æ»¤äº†<strong>éƒ¨åˆ†æ³¨é‡Š</strong>ï¼Œæ‰€ä»¥ç›¸æ¯”&nbsp;<a href="https://plugins.jetbrains.com/plugin/4509-statistic" target="_blank" rel="external nofollow noopener noreferrer">IDEA Statistic</a>&nbsp;ä¼š<strong>åå¤š</strong>ã€‚</p>
<p>å½“ç„¶ï¼Œè€ƒè™‘åˆ°å‡†ç¡®æ€§ï¼Œèƒ–å‹éœ€è¦æ‰‹åŠ¨&nbsp;<code>cd</code>&nbsp;åˆ°æ¯ä¸ª Maven é¡¹ç›®çš„&nbsp;<code>src/main/java</code>&nbsp;ç›®å½•ä¸‹ï¼Œä»¥è¾¾åˆ°æ’é™¤å•å…ƒæµ‹è¯•çš„ä»£ç é‡ã€‚</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/05.jpg" alt="Shell è„šæœ¬ç»Ÿè®¡ä»£ç é‡" /></p>
<p>ç»Ÿè®¡å®Œåï¼Œæ˜¯ä¸æ˜¯æ›´åŠ ä¸æ…Œäº†ã€‚å“ˆå“ˆå“ˆå“ˆã€‚</p>
<h2 id="3-2-dubbo-spring-boot-parent-æ¨¡å—">3.2 dubbo-spring-boot-parent æ¨¡å—</h2>
<p><code>dubbo-spring-boot-parent</code>&nbsp;æ¨¡å—ï¼Œæ— å…·ä½“ä»£ç ï¼Œä½œä¸ºå…¶å®ƒé¡¹ç›®çš„ Maven Parent é¡¹ç›®ï¼Œä¾‹å¦‚å®šä¹‰äº†ä¾èµ–ç‰ˆæœ¬å·ã€‚</p>
<h2 id="3-3-dubbo-spring-boot-starter-æ¨¡å—">3.3 dubbo-spring-boot-starter æ¨¡å—</h2>
<p><code>dubbo-spring-boot-starter</code>&nbsp;æ¨¡å—ï¼Œæ— å…·ä½“ä»£ç ï¼Œä½œä¸º Spring Boot Dubbo Starter æ¨¡å—ã€‚å…¶&nbsp;<code>pom.xml</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br /><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br /><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>${revision}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../dubbo-spring-boot-parent<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br /><br /><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>Dubbo Spring Boot Starter<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Dubbo Spring Boot Starter<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br /><br /><br /><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br /><span class="line">        <span class="comment">&lt;!-- Spring Boot dependencies --&gt;</span></span><br /><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br /><br /><span class="line">        <span class="comment">&lt;!-- ZK --&gt;</span></span><br /><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br /><br /><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br /><br /><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>${revision}<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br /><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br /><br /><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br /><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="3-4-dubbo-spring-boot-distribution-æ¨¡å—">3.4 dubbo-spring-boot-distribution æ¨¡å—</h2>
<p><code>dubbo-spring-boot-distribution</code>&nbsp;æ¨¡å—ï¼Œæ— å…·ä½“ä»£ç ï¼Œç”¨äº Spring Boot Dubbo ä½¿ç”¨&nbsp;<a href="https://www.jianshu.com/p/14bcb17b99e0" target="_blank" rel="external nofollow noopener noreferrer"><code>maven-assembly-plugin</code></a>&nbsp;æ’ä»¶ï¼Œæ‰“åŒ…å‡ºæˆ‘ä»¬åç»­ä½¿ç”¨çš„&nbsp;<a href="https://github.com/apache/incubator-dubbo-spring-boot-project/releases" target="_blank" rel="external nofollow noopener noreferrer">Releases</a>&nbsp;ã€‚</p>
<h2 id="3-5-dubbo-spring-boot-autoconfigure-æ¨¡å—">3.5 dubbo-spring-boot-autoconfigure æ¨¡å—</h2>
<p><code>dubbo-spring-boot-autoconfigure</code>&nbsp;æ¨¡å—ï¼Œ754 è¡Œä»£ç ï¼Œæä¾›äº† Spring Boot Dubbo çš„è‡ªåŠ¨é…ç½®ï¼ˆAutoConfigureï¼‰çš„å…·ä½“å®ç°ã€‚</p>
<h2 id="3-6-dubbo-spring-boot-actuator-æ¨¡å—">3.6 dubbo-spring-boot-actuator æ¨¡å—</h2>
<p><code>dubbo-spring-boot-actuator</code>&nbsp;æ¨¡å—ï¼Œ782 è¡Œä»£ç ï¼Œæä¾›äº† Spring Boot Dubbo çš„ Actuator çš„å…·ä½“å®ç°ã€‚</p>
<blockquote>
<p>Spring Boot Actuator çš„å…³é”®ç‰¹æ€§ï¼Œæ˜¯åœ¨åº”ç”¨ç¨‹åºé‡Œæä¾›ä¼—å¤š HTTP æ¥å£ï¼Œé€šè¿‡å®ƒä»¬äº†è§£åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„å†…éƒ¨çŠ¶å†µã€‚</p>
</blockquote>
<h2 id="3-7-dubbo-spring-boot-samples-æ¨¡å—">3.7 dubbo-spring-boot-samples æ¨¡å—</h2>
<p><code>dubbo-spring-boot-samples</code>&nbsp;æ¨¡å—ï¼Œ708 è¡Œä»£ç ï¼Œæä¾›äº†å››ä¸ªç¤ºä¾‹ã€‚æ¯”è¾ƒé‡ç‚¹å¯ä»¥çœ‹çš„æ˜¯ä¸¤ä¸ªï¼š</p>
<ul>
<li><code>dubbo-registry-zookeeper-samples</code>&nbsp;æ¨¡å—ï¼Œæä¾›åŸºäº Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ä½¿ç”¨ç¤ºä¾‹ã€‚</li>
<li><code>externalized-configuration-samples</code>&nbsp;æ¨¡å—ï¼Œæä¾›äº†å¤–éƒ¨åŒ–é…ç½®çš„ç¤ºä¾‹ã€‚</li>
</ul>
<h2 id="3-8-å°ç»“">3.8 å°ç»“</h2>
<p>è²Œä¼¼ä¹Ÿæ²¡å•¥å¥½å°ç»“çš„ã€‚æƒ³è¦å·æ‡’çš„è¯ï¼Œåªè¦çœ‹&nbsp;<code>dubbo-spring-boot-autoconfigure</code>&nbsp;æ¨¡å—ï¼Œä¸€å…±æ˜¯ 754 è¡Œä»£ç ã€‚å“ˆå“ˆå“ˆ~</p>
<p>å½“ç„¶ï¼ŒçœŸçš„è¦æ·±å…¥çš„è¯ï¼Œè¿˜æ˜¯è¦çœ‹&nbsp;<a href="https://github.com/apache/incubator-dubbo" target="_blank" rel="external nofollow noopener noreferrer">Dubbo</a>&nbsp;æœ¬èº«çš„ä»£ç çš„ã€‚</p>
<h1 id="4-dubbo-spring-boot-autoconfigure-æºç ">4.&nbsp;<code>dubbo-spring-boot-autoconfigure</code>&nbsp;æºç </h1>
<p><code>dubbo-spring-boot-autoconfigure</code>&nbsp;æ¨¡å—ï¼Œæ‰€æœ‰ç±»å¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/06.jpg" alt="&#96;dubbo-spring-boot-autoconfigure&#96; æ¨¡å—" /></p>
<blockquote>
<p>å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯&nbsp;<code>autoconfigure</code>&nbsp;åŒ…ä¸‹ã€‚</p>
</blockquote>
<h2 id="4-1-DubboAutoConfiguration">4.1 DubboAutoConfiguration</h2>
<p><code>com.alibaba.boot.dubbo.autoconfigure.DubboAutoConfiguration</code>&nbsp;ï¼ŒDubbo è‡ªåŠ¨é…ç½®ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboAutoConfiguration.java</span></span><br /><br /><span class="line"><span class="meta">@Configuration</span> <span class="comment">// é…ç½®ç±»</span></span><br /><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = DUBBO_PREFIX, name = <span class="string">"enabled"</span>, matchIfMissing = <span class="keyword">true</span>, havingValue = <span class="string">"true"</span>) <span class="comment">// è¦æ±‚é…ç½®äº† "dubbo.enabled=true" æˆ–è€…ï¼Œ"dubbo.enabled" æœªé…ç½®</span></span><br /><span class="line"><span class="meta">@ConditionalOnClass</span>(AbstractConfig.class) <span class="comment">// AbstractConfig ç±»å­˜åœ¨çš„æ—¶å€™ï¼Œå³ç”¨äºåˆ¤æ–­æœ‰ Dubbo åº“</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboAutoConfiguration</span> </span>{</span><br /><br /><span class="line">    <span class="comment">// ... çœç•¥å…¶å®ƒä»£ç </span></span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç±»ä¸Šçš„æ¯ä¸ªæ³¨è§£çš„ä½œç”¨ï¼Œè¯·çœ‹å…¶åçš„æ³¨é‡Šã€‚</li>
</ul>
<h3 id="4-1-1-serviceAnnotationBeanPostProcessor">4.1.1 serviceAnnotationBeanPostProcessor</h3>
<p><code>#serviceAnnotationBeanPostProcessor()</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º ServiceAnnotationBeanPostProcessor Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboAutoConfiguration.java</span></span><br /><br /><span class="line"><span class="meta">@ConditionalOnProperty</span>(name = BASE_PACKAGES_PROPERTY_NAME) <span class="comment">// é…ç½®äº† "dubbo.scan.base-package" å±æ€§ï¼Œå³è¦æ‰«æ Dubbo æ³¨è§£çš„åŒ…</span></span><br /><span class="line"><span class="meta">@ConditionalOnClass</span>(ConfigurationPropertySources.class) <span class="comment">// æœ‰ Spring Boot é…ç½®åŠ è½½çš„åŠŸèƒ½</span></span><br /><span class="line"><span class="meta">@Bean</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> ServiceAnnotationBeanPostProcessor <span class="title">serviceAnnotationBeanPostProcessor</span><span class="params">(Environment environment)</span> </span>{</span><br /><span class="line">    <span class="comment">// &lt;1&gt; è·å¾— "dubbo.scan.base-package" å±æ€§</span></span><br /><span class="line">    Set&lt;String&gt; packagesToScan = environment.getProperty(BASE_PACKAGES_PROPERTY_NAME, Set.class, emptySet());</span><br /><span class="line">    <span class="comment">// &lt;2&gt; åˆ›å»º ServiceAnnotationBeanPostProcessor å¯¹è±¡</span></span><br /><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ServiceAnnotationBeanPostProcessor(packagesToScan);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>&lt;1&gt;</code>&nbsp;å¤„ï¼Œè·å¾—&nbsp;<code>"dubbo.scan.base-package"</code>&nbsp;å±æ€§ï¼Œå³è¦æ‰«æ Dubbo æ³¨è§£çš„åŒ…ã€‚</li>
<li><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œåˆ›å»º ServiceAnnotationBeanPostProcessor å¯¹è±¡ã€‚åç»­ï¼ŒServiceAnnotationBeanPostProcessor ä¼šæ‰«æ&nbsp;<code>packagesToScan</code>&nbsp;åŒ…çš„ Dubbo&nbsp;<code>@Service</code>&nbsp;æ³¨è§£ï¼Œåˆ›å»ºå¯¹åº”çš„ Dubbo Service Bean å¯¹è±¡ä»¬ã€‚
<ul>
<li>ServiceAnnotationBeanPostProcessor å±äº Dubbo é¡¹ç›®æœ¬èº«ï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä¸è§£æé€»ã€‚</li>
</ul>
</li>
</ul>
<h3 id="4-1-2-referenceAnnotationBeanPostProcessor">4.1.2 referenceAnnotationBeanPostProcessor</h3>
<p><code>#referenceAnnotationBeanPostProcessor()</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º Bean åå­—ä¸º&nbsp;<code>"referenceAnnotationBeanPostProcessor"</code>&nbsp;çš„ ReferenceAnnotationBeanPostProcessor Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboAutoConfiguration.java</span></span><br /><br /><span class="line"><span class="meta">@ConditionalOnMissingBean</span> <span class="comment">// ä¸å­˜åœ¨ ReferenceAnnotationBeanPostProcessor Bean çš„æ—¶å€™</span></span><br /><span class="line"><span class="meta">@Bean</span>(name = ReferenceAnnotationBeanPostProcessor.BEAN_NAME) <span class="comment">// Bean çš„åå­—æ˜¯ referenceAnnotationBeanPostProcessor</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> ReferenceAnnotationBeanPostProcessor <span class="title">referenceAnnotationBeanPostProcessor</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ReferenceAnnotationBeanPostProcessor();</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>åç»­ï¼ŒReferenceAnnotationBeanPostProcessor ä¼šæ‰«æ Dubbo&nbsp;<code>@Reference</code>&nbsp;æ³¨è§£ï¼Œåˆ›å»ºå¯¹åº”çš„ Dubbo Service Bean å¯¹è±¡ä»¬ã€‚
<ul>
<li>ReferenceAnnotationBeanPostProcessor å±äº Dubbo é¡¹ç›®æœ¬èº«ï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä¸è§£æé€»ã€‚</li>
</ul>
</li>
</ul>
<h3 id="4-1-3-relaxedDubboConfigBinder">4.1.3 relaxedDubboConfigBinder</h3>
<p><code>#relaxedDubboConfigBinder()</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º RelaxedDubboConfigBinder Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboAutoConfiguration.java</span></span><br /><br /><span class="line"><span class="meta">@ConditionalOnClass</span>(Binder.class) <span class="comment">// å­˜åœ¨ Binder ç±»çš„æ—¶å€™</span></span><br /><span class="line"><span class="meta">@Bean</span></span><br /><span class="line"><span class="meta">@Scope</span>(scopeName = SCOPE_PROTOTYPE) <span class="comment">// å¤šä¾‹</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> RelaxedDubboConfigBinder <span class="title">relaxedDubboConfigBinder</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> RelaxedDubboConfigBinder();</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>RelaxedDubboConfigBinder ï¼Œç”¨äºå°†å…·ä½“çš„å±æ€§ï¼Œè®¾ç½®åˆ°ç›¸åº”çš„ AbstractConfig å¯¹è±¡ä¸­ã€‚</li>
<li>ä¸ºä»€ä¹ˆ&nbsp;<code>@Scope(scopeName = SCOPE_PROTOTYPE)</code>&nbsp;æ³¨è§£æ˜¯<strong>å¤šä¾‹</strong>å‘¢ï¼Ÿå› ä¸ºæœ‰å¤šä¸ª AbstractConfig å¯¹è±¡å‘€~</li>
<li>è¯¦ç»†çš„è§£æï¼Œè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ4.2 RelaxedDubboConfigBinderã€</a>&nbsp;ã€‚</li>
</ul>
<h3 id="4-1-4-XXXDubboConfigConfiguration">4.1.4 XXXDubboConfigConfiguration</h3>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboAutoConfiguration.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Single Dubbo Config Configuration</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@see</span> EnableDubboConfig</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@see</span> DubboConfigConfiguration.Single</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@EnableDubboConfig</span></span><br /><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleDubboConfigConfiguration</span> </span>{</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Multiple Dubbo Config Configuration , equals <span class="doctag">@EnableDubboConfig</span>.multiple() == &lt;code&gt;true&lt;/code&gt;</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@see</span> EnableDubboConfig</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@see</span> DubboConfigConfiguration.Multiple</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@ConditionalOnProperty</span>(name = MULTIPLE_CONFIG_PROPERTY_NAME, havingValue = <span class="string">"true"</span>) <span class="comment">// è¦æ±‚é…ç½® "dubbo.config.multiple=true" ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDubbo è‡ªå¸¦ "dubbo.config.multiple=true"</span></span><br /><span class="line"><span class="meta">@EnableDubboConfig</span>(multiple = <span class="keyword">true</span>)</span><br /><span class="line"><span class="keyword">protected</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MultipleDubboConfigConfiguration</span> </span>{</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å…³äº&nbsp;<code>@EnableDubboConfig</code>&nbsp;æ³¨è§£çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹&nbsp;<a href="https://segmentfault.com/a/1190000012661402#articleHeader4" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo æ–°ç¼–ç¨‹æ¨¡å‹ä¹‹å¤–éƒ¨åŒ–é…ç½® &mdash;&mdash;&nbsp;<code>@EnableDubboConfig</code>ã€‹</a>&nbsp;ã€‚</li>
<li>
<p>SingleDubboConfigConfiguration å¯¹åº”&nbsp;<code>@EnableDubboConfig(multiple = false)</code>&nbsp;ã€‚</p>
<ul>
<li>æ— ä»»ä½•æ¡ä»¶ï¼Œæ‰€ä»¥ä¼šåˆ›å»ºã€‚</li>
<li>
<p>å¼•å…¥äº†å•ä¸ª Dubbo é…ç½®ç»‘å®š Bean çš„é…ç½®ã€‚å³é…ç½®æ–‡ä»¶å¦‚ä¸‹å±æ€§ï¼š</p>
<figure class="highlight plain">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">dubbo.application</span><br /><span class="line">dubbo.module</span><br /><span class="line">dubbo.registry</span><br /><span class="line">dubbo.protocol</span><br /><span class="line">dubbo.monitor</span><br /><span class="line">dubbo.provider</span><br /><span class="line">dubbo.consumer</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>~</li>
</ul>
</li>
</ul>
</li>
<li>
<p>MultipleDubboConfigConfiguration å¯¹åº”&nbsp;<code>@EnableDubboConfig(multiple = true)</code>&nbsp;ã€‚</p>
<ul>
<li>è¦æ±‚é…ç½®&nbsp;<code>"dubbo.config.multiple=true"</code>&nbsp;ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDubbo è‡ªå¸¦&nbsp;<code>"dubbo.config.multiple=true"</code>&nbsp;ï¼Œæ‰€ä»¥ä¹Ÿä¼šåˆ›å»ºã€‚</li>
<li>
<p>å¼•å…¥äº†å¤šä¸ª Dubbo é…ç½®ç»‘å®š Bean çš„é…ç½®ã€‚å³é…ç½®æ–‡ä»¶å¦‚ä¸‹å±æ€§ï¼š</p>
<figure class="highlight plain">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">dubbo.applications</span><br /><span class="line">dubbo.modules</span><br /><span class="line">dubbo.registries</span><br /><span class="line">dubbo.protocols</span><br /><span class="line">dubbo.monitors</span><br /><span class="line">dubbo.providers</span><br /><span class="line">dubbo.consumers</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>~</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="4-2-RelaxedDubboConfigBinder">4.2 RelaxedDubboConfigBinder</h2>
<p><code>com.alibaba.boot.dubbo.autoconfigure.RelaxedDubboConfigBinder</code>&nbsp;ï¼Œç»§æ‰¿ AbstractDubboConfigBinder æŠ½è±¡ç±»ï¼Œè´Ÿè´£å°† Spring Boot çš„é…ç½®å±æ€§ï¼Œæ³¨å…¥åˆ° Dubbo AbstractConfig é…ç½®å¯¹è±¡ä¸­ã€‚ä»£ç  å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// RelaxedDubboConfigBinder.java</span></span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="keyword">public</span> &lt;C extends AbstractConfig&gt; <span class="function"><span class="keyword">void</span> <span class="title">bind</span><span class="params">(String prefix, C dubboConfig)</span> </span>{</span><br /><span class="line">    <span class="comment">// &lt;1.1&gt; è·å¾— PropertySource æ•°ç»„</span></span><br /><span class="line">    Iterable&lt;PropertySource&lt;?&gt;&gt; propertySources = getPropertySources();</span><br /><span class="line">    <span class="comment">// Converts ConfigurationPropertySources</span></span><br /><span class="line">    <span class="comment">// &lt;1.2&gt; è½¬æ¢æˆ ConfigurationPropertySource æ•°ç»„</span></span><br /><span class="line">    Iterable&lt;ConfigurationPropertySource&gt; configurationPropertySources = from(propertySources);</span><br /><br /><span class="line">    <span class="comment">// Wrap Bindable from DubboConfig instance</span></span><br /><span class="line">    <span class="comment">// &lt;2&gt; å°† dubboConfig åŒ…è£…æˆ Bindable å¯¹è±¡</span></span><br /><span class="line">    Bindable&lt;C&gt; bindable = Bindable.ofInstance(dubboConfig);</span><br /><br /><span class="line">    <span class="comment">// &lt;3.1&gt; åˆ›å»º Binder å¯¹è±¡</span></span><br /><span class="line">    Binder binder = <span class="keyword">new</span> Binder(configurationPropertySources, <span class="keyword">new</span> PropertySourcesPlaceholdersResolver(propertySources));</span><br /><span class="line">    <span class="comment">// Get BindHandler</span></span><br /><span class="line">    <span class="comment">// &lt;3.2&gt; è·å¾— BindHandler å¯¹è±¡</span></span><br /><span class="line">    BindHandler bindHandler = getBindHandler();</span><br /><span class="line">    <span class="comment">// Bind</span></span><br /><span class="line">    <span class="comment">// &lt;3.3&gt; æ‰§è¡Œç»‘å®šï¼Œä¼šå°† propertySources å±æ€§ï¼Œæ³¨å…¥åˆ° dubboConfig å¯¹è±¡ä¸­</span></span><br /><span class="line">    binder.bind(prefix, bindable, bindHandler);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>AbstractDubboConfigBinder å±äº Dubbo é¡¹ç›®æœ¬èº«ï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä¸è§£æé€»ã€‚</li>
<li><code>&lt;1.1&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨çˆ¶ç±»çš„&nbsp;<code>#getPropertySources()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾— PropertySource æ•°ç»„ã€‚</li>
<li><code>&lt;1.2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>ConfigurationPropertySources#from(Iterable&lt;PropertySource&lt;?&gt;&gt; sources)</code>&nbsp;æ–¹æ³•ï¼Œè½¬æ¢æˆ ConfigurationPropertySource æ•°ç»„ã€‚ä¸Šè¿°ä¸¤ä¸ªå˜é‡çš„å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/07.jpg" alt="&#96;configurationPropertySources&#96; å±æ€§" /></li>
<li><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>Bindable#ofInstance(T instance)</code>&nbsp;æ–¹æ³•ï¼Œå°†&nbsp;<code>dubboConfig</code>&nbsp;åŒ…è£…æˆ Bindable å¯¹è±¡ã€‚</li>
<li><code>&lt;3.1&gt;</code>&nbsp;å¤„ï¼Œåˆ›å»º Binder å¯¹è±¡ã€‚</li>
<li>
<p><code>&lt;3.2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#getBindHandler()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾— BindHandler å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// RelaxedDubboConfigBinder.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> BindHandler <span class="title">getBindHandler</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="comment">// è·å¾—é»˜è®¤çš„ BindHandler å¤„ç†å™¨</span></span><br /><span class="line">    BindHandler handler = BindHandler.DEFAULT;</span><br /><span class="line">    <span class="comment">// è¿›ä¸€æ­¥åŒ…è£…æˆ IgnoreErrorsBindHandler å¯¹è±¡</span></span><br /><span class="line">    <span class="keyword">if</span> (isIgnoreInvalidFields()) {</span><br /><span class="line">        handler = <span class="keyword">new</span> IgnoreErrorsBindHandler(handler);</span><br /><span class="line">    }</span><br /><span class="line">    <span class="comment">// è¿›ä¸€æ­¥åŒ…è£…æˆ NoUnboundElementsBindHandler å¯¹è±¡</span></span><br /><span class="line">    <span class="keyword">if</span> (!isIgnoreUnknownFields()) {</span><br /><span class="line">        UnboundElementsSourceFilter filter = <span class="keyword">new</span> UnboundElementsSourceFilter();</span><br /><span class="line">        handler = <span class="keyword">new</span> NoUnboundElementsBindHandler(handler, filter);</span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">return</span> handler;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p>å…³äº BindHandler ç±»ï¼Œèƒ–å‹ä¸ç”¨æ·±ç©¶ï¼Œåªè¦çŸ¥é“å¦‚ä¸‹å³å¯ã€‚</p>
<blockquote>
<p>æœ‰æ—¶å€™ï¼Œç»‘å®šæ—¶å¯èƒ½éœ€è¦å®ç°é¢å¤–çš„é€»è¾‘ï¼Œè€ŒBindHandleræ¥å£æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ æ¯ä¸ªBindHandleréƒ½å¯ä»¥å®ç°onStartï¼ŒonSuccessï¼ŒonFailureå’ŒonFinishæ–¹æ³•æ¥è¦†ç›–è¡Œä¸ºã€‚</p>
<p>Spring Bootæä¾›äº†ä¸€äº›å¤„ç†ç¨‹åºï¼Œä¸»è¦ç”¨äºæ”¯æŒç°æœ‰çš„@ConfigurationPropertiesç»‘å®šã€‚ ä¾‹å¦‚ï¼ŒValidationBindHandlerå¯ç”¨äºå¯¹ç»‘å®šå¯¹è±¡åº”ç”¨ValidatoréªŒè¯ã€‚</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p><code>&lt;3.3&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>Binder#bind(String name, Bindable&lt;T&gt; target, BindHandler handler)</code>&nbsp;æ–¹æ³•ï¼Œå°†é…ç½®ä¸­ï¼ŒæŒ‡å®šå‰ç¼€ï¼ˆ<code>prefix</code>ï¼‰çš„å±æ€§ï¼Œæ³¨å…¥åˆ° AbstractConfig é…ç½®å¯¹è±¡ä¸­ã€‚ä¾‹å¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/08.jpg" alt="&#96;dubboConfig&#96; å±æ€§" /></p>
</li>
</ul>
<blockquote>
<p>å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯&nbsp;<code>env</code>&nbsp;åŒ…ä¸‹ã€‚</p>
</blockquote>
<h2 id="4-3-DubboDefaultPropertiesEnvironmentPostProcessor">4.3 DubboDefaultPropertiesEnvironmentPostProcessor</h2>
<p><code>com.alibaba.boot.dubbo.env.DubboDefaultPropertiesEnvironmentPostProcessor</code>&nbsp;ï¼Œå®ç° EnvironmentPostProcessorã€Ordered æ¥å£ï¼Œç”Ÿæˆ Dubbo é»˜è®¤çš„é…ç½®ï¼Œæ·»åŠ åˆ°&nbsp;<code>environment</code>&nbsp;ä¸­ã€‚è€Œéœ€è¦ç”Ÿæˆçš„ Dubbo é»˜è®¤çš„é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"># ç›´æ¥å¤ç”¨ spring.application.name</span><br /><span class="line">dubbo.application.name=</span><br /><span class="line"># é»˜è®¤ä¸º true</span><br /><span class="line">dubbo.config.multiple=true</span><br /><span class="line"># é»˜è®¤ä¸º false</span><br /><span class="line">dubbo.config.qos-enable=false</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å› æ­¤ï¼Œæˆ‘ä»¬åªè¦é…ç½®äº†&nbsp;<code>"spring.application.name"</code>&nbsp;çš„å±æ€§ï¼Œ<code>"dubbo.application.name"</code>&nbsp;å°±ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚</li>
</ul>
<h3 id="4-3-1-postProcessEnvironment">4.3.1 postProcessEnvironment</h3>
<p>å®ç°&nbsp;<code>#postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application)</code>&nbsp;æ–¹æ³•ï¼Œè‡ªåŠ¨ç”Ÿæˆ Dubbo é»˜è®¤é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboDefaultPropertiesEnvironmentPostProcessor.java</span></span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessEnvironment</span><span class="params">(ConfigurableEnvironment environment, SpringApplication application)</span> </span>{</span><br /><span class="line">    MutablePropertySources propertySources = environment.getPropertySources();</span><br /><span class="line">    <span class="comment">// &lt;1&gt; ç”Ÿæˆ Dubbo é»˜è®¤é…ç½®</span></span><br /><span class="line">    Map&lt;String, Object&gt; defaultProperties = createDefaultProperties(environment);</span><br /><span class="line">    <span class="comment">// &lt;2&gt; æœ‰é»˜è®¤é…ç½®ï¼Œåˆ™æ·»åŠ åˆ° environment ä¸­</span></span><br /><span class="line">    <span class="keyword">if</span> (!CollectionUtils.isEmpty(defaultProperties)) {</span><br /><span class="line">        addOrReplace(propertySources, defaultProperties);</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p><code>&lt;1&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#createDefaultProperties(ConfigurableEnvironment environment)</code>&nbsp;æ–¹æ³•ï¼Œç”Ÿæˆ Dubbo é»˜è®¤é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboDefaultPropertiesEnvironmentPostProcessor.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The property name of Spring Application</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@see</span> ContextIdApplicationContextInitializer</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SPRING_APPLICATION_NAME_PROPERTY = <span class="string">"spring.application.name"</span>;</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The property name of {<span class="doctag">@link</span> ApplicationConfig}</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@see</span> EnableDubboConfig</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@see</span> EnableDubboConfigBinding</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUBBO_APPLICATION_NAME_PROPERTY = <span class="string">"dubbo.application.name"</span>;</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The property name of {<span class="doctag">@link</span> EnableDubboConfig#multiple() <span class="doctag">@EnableDubboConfig</span>.multiple()}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUBBO_CONFIG_MULTIPLE_PROPERTY = <span class="string">"dubbo.config.multiple"</span>;</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The property name of {<span class="doctag">@link</span> ApplicationConfig#getQosEnable() application's QOS enable}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUBBO_APPLICATION_QOS_ENABLE_PROPERTY = <span class="string">"dubbo.application.qos-enable"</span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, Object&gt; <span class="title">createDefaultProperties</span><span class="params">(ConfigurableEnvironment environment)</span> </span>{</span><br /><span class="line">    Map&lt;String, Object&gt; defaultProperties = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br /><span class="line">    <span class="comment">// "dubbo.application.name"</span></span><br /><span class="line">    setDubboApplicationNameProperty(environment, defaultProperties);</span><br /><span class="line">    <span class="comment">// "dubbo.config.multiple"</span></span><br /><span class="line">    setDubboConfigMultipleProperty(defaultProperties);</span><br /><span class="line">    <span class="comment">// "dubbo.application.qos-enable"</span></span><br /><span class="line">    setDubboApplicationQosEnableProperty(defaultProperties);</span><br /><span class="line">    <span class="keyword">return</span> defaultProperties;</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setDubboApplicationNameProperty</span><span class="params">(Environment environment, Map&lt;String, Object&gt; defaultProperties)</span> </span>{</span><br /><span class="line">    String springApplicationName = environment.getProperty(SPRING_APPLICATION_NAME_PROPERTY);</span><br /><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(springApplicationName)</span><br /><span class="line">            &amp;&amp; !environment.containsProperty(DUBBO_APPLICATION_NAME_PROPERTY)) {</span><br /><span class="line">        defaultProperties.put(DUBBO_APPLICATION_NAME_PROPERTY, springApplicationName);</span><br /><span class="line">    }</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setDubboConfigMultipleProperty</span><span class="params">(Map&lt;String, Object&gt; defaultProperties)</span> </span>{</span><br /><span class="line">    defaultProperties.put(DUBBO_CONFIG_MULTIPLE_PROPERTY, Boolean.TRUE.toString());</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setDubboApplicationQosEnableProperty</span><span class="params">(Map&lt;String, Object&gt; defaultProperties)</span> </span>{</span><br /><span class="line">    defaultProperties.put(DUBBO_APPLICATION_QOS_ENABLE_PROPERTY, Boolean.FALSE.toString());</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>è™½ç„¶æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯æ¯”è¾ƒç®€å•ã€‚</li>
</ul>
</li>
<li>
<p><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œæœ‰ Dubbo é»˜è®¤é…ç½®ï¼Œåˆ™æ·»åŠ åˆ°&nbsp;<code>environment</code>&nbsp;ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboDefaultPropertiesEnvironmentPostProcessor.java</span></span><br /><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PROPERTY_SOURCE_NAME = <span class="string">"defaultProperties"</span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addOrReplace</span><span class="params">(MutablePropertySources propertySources, Map&lt;String, Object&gt; map)</span> </span>{</span><br /><span class="line">    <span class="comment">// æƒ…å†µä¸€ï¼Œè·å¾—åˆ° "defaultProperties" å¯¹åº”çš„ PropertySource å¯¹è±¡ï¼Œåˆ™è¿›è¡Œæ›¿æ¢</span></span><br /><span class="line">    MapPropertySource target = <span class="keyword">null</span>;</span><br /><span class="line">    <span class="keyword">if</span> (propertySources.contains(PROPERTY_SOURCE_NAME)) {</span><br /><span class="line">        PropertySource&lt;?&gt; source = propertySources.get(PROPERTY_SOURCE_NAME);</span><br /><span class="line">        <span class="keyword">if</span> (source <span class="keyword">instanceof</span> MapPropertySource) { <span class="comment">// æ‰¾åˆ°</span></span><br /><span class="line">            target = (MapPropertySource) source;</span><br /><span class="line">            <span class="comment">// éå† map æ•°ç»„ï¼Œè¿›è¡Œæ›¿æ¢åˆ° "defaultProperties" ä¸­</span></span><br /><span class="line">            <span class="keyword">for</span> (String key : map.keySet()) {</span><br /><span class="line">                <span class="keyword">if</span> (!target.containsProperty(key)) {</span><br /><span class="line">                    target.getSource().put(key, map.get(key));</span><br /><span class="line">                }</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><span class="line">    <span class="comment">// æƒ…å†µäºŒï¼Œä¸å­˜åœ¨ "defaultProperties" å¯¹åº”çš„ PropertySource å¯¹è±¡ï¼Œåˆ™è¿›è¡Œæ·»åŠ </span></span><br /><span class="line">    <span class="keyword">if</span> (target == <span class="keyword">null</span>) {</span><br /><span class="line">        target = <span class="keyword">new</span> MapPropertySource(PROPERTY_SOURCE_NAME, map);</span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">if</span> (!propertySources.contains(PROPERTY_SOURCE_NAME)) {</span><br /><span class="line">        propertySources.addLast(target);</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>åˆ†æˆä¸¤ç§æƒ…å†µï¼Œä¹Ÿæ¯”è¾ƒç®€å•ã€‚èƒ–å‹è‡ªå·±ç…ç…~</li>
</ul>
</li>
</ul>
<blockquote>
<p>å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯&nbsp;<code>context.event</code>&nbsp;åŒ…ä¸‹ã€‚</p>
</blockquote>
<h2 id="4-4-WelcomeLogoApplicationListener">4.4 WelcomeLogoApplicationListener</h2>
<p><code>com.alibaba.boot.dubbo.context.event.WelcomeLogoApplicationListener</code>&nbsp;ï¼Œå®ç° ApplicationListener æ¥å£ï¼Œå¤„ç† ApplicationEnvironmentPreparedEvent äº‹ä»¶ï¼Œä»è€Œæ‰“å° Dubbo Banner æ–‡æœ¬ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// WelcomeLogoApplicationListener.java</span></span><br /><br /><span class="line"><span class="meta">@Order</span>(LoggingApplicationListener.DEFAULT_ORDER + <span class="number">1</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WelcomeLogoApplicationListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationEnvironmentPreparedEvent</span>&gt; </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * æ˜¯å¦æ‰§è¡Œè¿‡</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * é€šè¿‡è¯¥å˜é‡ï¼Œä¿è¯æœ‰ä¸”ä»…å¤„ç†ä¸€æ¬¡ ApplicationEnvironmentPreparedEvent äº‹ä»¶</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AtomicBoolean processed = <span class="keyword">new</span> AtomicBoolean(<span class="keyword">false</span>);</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEnvironmentPreparedEvent event)</span> </span>{</span><br /><span class="line">        <span class="comment">// Skip if processed before, prevent duplicated execution in Hierarchical ApplicationContext</span></span><br /><span class="line">        <span class="comment">// å¦‚æœå·²ç»å¤„ç†ï¼Œåˆ™ç›´æ¥è·³è¿‡</span></span><br /><span class="line">        <span class="keyword">if</span> (processed.get()) {</span><br /><span class="line">            <span class="keyword">return</span>;</span><br /><span class="line">        }</span><br /><br /><span class="line">        <span class="comment">// è·å¾— Logger å¯¹è±¡</span></span><br /><span class="line">        <span class="comment">/**</span></span><br /><span class="line"><span class="comment">         * Gets Logger After LoggingSystem configuration ready</span></span><br /><span class="line"><span class="comment">         * <span class="doctag">@see</span> LoggingApplicationListener</span></span><br /><span class="line"><span class="comment">         */</span></span><br /><span class="line">        <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br /><br /><span class="line">        <span class="comment">// è·å¾— Dubbo Banner æ–‡æœ¬</span></span><br /><span class="line">        String bannerText = buildBannerText();</span><br /><span class="line">        <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br /><span class="line">            logger.info(bannerText);</span><br /><span class="line">        } <span class="keyword">else</span> {</span><br /><span class="line">            System.out.print(bannerText);</span><br /><span class="line">        }</span><br /><br /><span class="line">        <span class="comment">// mark processed to be true</span></span><br /><span class="line">        <span class="comment">// æ ‡è®°å·²æ‰§è¡Œ</span></span><br /><span class="line">        processed.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>);</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function">String <span class="title">buildBannerText</span><span class="params">()</span> </span>{</span><br /><span class="line">        StringBuilder bannerTextBuilder = <span class="keyword">new</span> StringBuilder();</span><br /><span class="line">        bannerTextBuilder</span><br /><span class="line">                .append(LINE_SEPARATOR)</span><br /><span class="line">                .append(LINE_SEPARATOR)</span><br /><span class="line">                .append(<span class="string">" :: Dubbo Spring Boot (v"</span>).append(Version.getVersion(getClass(), <span class="string">"1.0.0"</span>)).append(<span class="string">") : "</span>)</span><br /><span class="line">                .append(DUBBO_SPRING_BOOT_GITHUB_URL)</span><br /><span class="line">                .append(LINE_SEPARATOR)</span><br /><span class="line">                .append(<span class="string">" :: Dubbo (v"</span>).append(Version.getVersion()).append(<span class="string">") : "</span>)</span><br /><span class="line">                .append(DUBBO_GITHUB_URL)</span><br /><span class="line">                .append(LINE_SEPARATOR)</span><br /><span class="line">                .append(<span class="string">" :: Discuss group : "</span>)</span><br /><span class="line">                .append(DUBBO_MAILING_LIST)</span><br /><span class="line">                .append(LINE_SEPARATOR);</span><br /><span class="line">        <span class="keyword">return</span> bannerTextBuilder.toString();</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç®€å•ï¼Œå°±ä¸å¤šåšè§£é‡Šäº†ã€‚</li>
</ul>
<h2 id="4-5-OverrideDubboConfigApplicationListener">4.5 OverrideDubboConfigApplicationListener</h2>
<p><code>com.alibaba.boot.dubbo.context.event.OverrideDubboConfigApplicationListener</code>&nbsp;ï¼Œå®ç° ApplicationListener æ¥å£ï¼Œä¹Ÿæ˜¯å¤„ç† ApplicationEnvironmentPreparedEvent äº‹ä»¶ï¼Œæ ¹æ®&nbsp;<code>"dubbo.config.override"</code>&nbsp;çš„å±æ€§å€¼ï¼Œè‹¥ä¸º&nbsp;<code>true</code>&nbsp;æ—¶ï¼Œåˆ™è¦†ç›–&nbsp;<code>environment</code>&nbsp;ä¸­&nbsp;<code>"dubbo."</code>&nbsp;å¼€å¤´çš„é…ç½®ï¼Œæ·»åŠ åˆ° Dubbo Properties å¯¹è±¡ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// OverrideDubboConfigApplicationListener.java</span></span><br /><br /><span class="line"><span class="meta">@Order</span> <span class="comment">// LOWEST_PRECEDENCE Make sure last execution</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OverrideDubboConfigApplicationListener</span> <span class="keyword">implements</span> <span class="title">ApplicationListener</span>&lt;<span class="title">ApplicationEnvironmentPreparedEvent</span>&gt; </span>{</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEnvironmentPreparedEvent event)</span> </span>{</span><br /><span class="line">        <span class="comment">// è·å¾— Logger å¯¹è±¡</span></span><br /><span class="line">        <span class="comment">/**</span></span><br /><span class="line"><span class="comment">         * Gets Logger After LoggingSystem configuration ready</span></span><br /><span class="line"><span class="comment">         * <span class="doctag">@see</span> LoggingApplicationListener</span></span><br /><span class="line"><span class="comment">         */</span></span><br /><span class="line">        <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br /><br /><span class="line">        <span class="comment">// &lt;1&gt; è·å¾— "dubbo.config.override" å±æ€§å¯¹åº”çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º true</span></span><br /><span class="line">        ConfigurableEnvironment environment = event.getEnvironment();</span><br /><span class="line">        <span class="keyword">boolean</span> override = environment.getProperty(OVERRIDE_CONFIG_PROPERTY_NAME, <span class="keyword">boolean</span>.class, DEFAULT_OVERRIDE_CONFIG_PROPERTY_VALUE);</span><br /><span class="line">        <span class="comment">// &lt;2&gt; å¦‚æœè¦é‡å†™ï¼Œåˆ™è¦†ç›–æ·»åŠ åˆ° Dubbo Properties ä¸­</span></span><br /><span class="line">        <span class="keyword">if</span> (override) {</span><br /><span class="line">            <span class="comment">// &lt;2.1&gt; ä» environment ä¸­ï¼Œæå– "dubbo." å¼€å¤´çš„é…ç½®</span></span><br /><span class="line">            SortedMap&lt;String, Object&gt; dubboProperties = filterDubboProperties(environment);</span><br /><span class="line">            <span class="comment">// &lt;2.2&gt; æ·»åŠ åˆ° Dubbo Properties ä¸­</span></span><br /><span class="line">            ConfigUtils.getProperties().putAll(dubboProperties);</span><br /><span class="line">            <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br /><span class="line">                logger.info(<span class="string">"Dubbo Config was overridden by externalized configuration {}"</span>, dubboProperties);</span><br /><span class="line">            }</span><br /><span class="line">        } <span class="keyword">else</span> {</span><br /><span class="line">            <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br /><span class="line">                logger.info(<span class="string">"Disable override Dubbo Config caused by property {} = {}"</span>, OVERRIDE_CONFIG_PROPERTY_NAME, override);</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p><code>&lt;1&gt;</code>&nbsp;å¤„ï¼Œè·å¾—&nbsp;<code>"dubbo.config.override"</code>&nbsp;å±æ€§å¯¹åº”çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º&nbsp;<code>true</code>&nbsp;ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboUtils.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The property name of override Dubbo config</span></span><br /><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br /><span class="line"><span class="comment"> * The default value is {<span class="doctag">@link</span> #DEFAULT_OVERRIDE_CONFIG_PROPERTY_VALUE}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String OVERRIDE_CONFIG_PROPERTY_NAME = DUBBO_CONFIG_PREFIX + PROPERTY_NAME_SEPARATOR + <span class="string">"override"</span>;</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The default property value of  override Dubbo config</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> DEFAULT_OVERRIDE_CONFIG_PROPERTY_VALUE = <span class="keyword">true</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œå¦‚æœè¦é‡å†™ï¼Œåˆ™è¦†ç›–æ·»åŠ åˆ° Dubbo Properties ä¸­ã€‚</p>
</li>
<li>
<p><code>&lt;2.1&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>DubboUtils#filterDubboProperties(ConfigurableEnvironment environment)</code>&nbsp;æ–¹æ³•ï¼Œä»&nbsp;<code>environment</code>&nbsp;ä¸­ï¼Œæå–&nbsp;<code>"dubbo."</code>&nbsp;å¼€å¤´çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboUtils.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The separator of property name</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PROPERTY_NAME_SEPARATOR = <span class="string">"."</span>;</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * The prefix of property name of Dubbo</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DUBBO_PREFIX = <span class="string">"dubbo"</span>;</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Filters Dubbo Properties from {<span class="doctag">@link</span> ConfigurableEnvironment}</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@param</span> environment {<span class="doctag">@link</span> ConfigurableEnvironment}</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@return</span> Read-only SortedMap</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SortedMap&lt;String, Object&gt; <span class="title">filterDubboProperties</span><span class="params">(ConfigurableEnvironment environment)</span> </span>{</span><br /><span class="line">    SortedMap&lt;String, Object&gt; dubboProperties = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br /><span class="line">    <span class="comment">// è·å¾—æ‰€æœ‰çš„é…ç½®</span></span><br /><span class="line">    Map&lt;String, Object&gt; properties = EnvironmentUtils.extractProperties(environment);</span><br /><span class="line">    <span class="comment">// éå†é…ç½®ï¼Œå¦‚æœä»¥ "dubbo." å¼€å¤´ï¼Œåˆ™æ·»åŠ åˆ° dubboProperties ä¸­</span></span><br /><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; entry : properties.entrySet()) {</span><br /><span class="line">        String propertyName = entry.getKey();</span><br /><span class="line">        <span class="keyword">if</span> (propertyName.startsWith(DUBBO_PREFIX + PROPERTY_NAME_SEPARATOR)</span><br /><span class="line">                &amp;&amp; entry.getValue() != <span class="keyword">null</span>) {</span><br /><span class="line">            dubboProperties.put(propertyName, entry.getValue().toString());</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><span class="line">    <span class="comment">// è¿”å› dubboProperties</span></span><br /><span class="line">    <span class="keyword">return</span> Collections.unmodifiableSortedMap(dubboProperties);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å…¶ä¸­ï¼Œ<code>EnvironmentUtils#extractProperties(ConfigurableEnvironment environment)</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰çš„é…ç½®ã€‚è€ƒè™‘åˆ°ç¯‡å¹…å°±ä¸èµ˜è¿°ï¼Œè‰¿è‰¿å·²ç»æ·»åŠ æ³¨é‡Šï¼Œç‚¹å‡»&nbsp;<a href="https://github.com/YunaiV/incubator-dubbo-spring-boot-project/blob/master/dubbo-spring-boot-autoconfigure/src/main/java/com/alibaba/boot/dubbo/util/EnvironmentUtils.java" target="_blank" rel="external nofollow noopener noreferrer">é“¾æ¥</a>&nbsp;æŸ¥çœ‹ã€‚</li>
</ul>
</li>
<li>
<p><code>&lt;2.2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨ Dubbo çš„&nbsp;<code>ConfigUtils#getProperties()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾— Dubbo Properties ã€‚ç„¶åå†å°†&nbsp;<code>dubboProperties</code>&nbsp;å˜é‡ï¼Œæ·»åŠ åˆ° Dubbo Properties ä¸­ã€‚</p>
</li>
</ul>
<h2 id="4-6-AwaitingNonWebApplicationListener">4.6 AwaitingNonWebApplicationListener</h2>
<p><code>com.alibaba.boot.dubbo.context.event.AwaitingNonWebApplicationListener</code>&nbsp;ï¼Œå®ç° SmartApplicationListener æ¥å£ï¼Œå®ç°åœ¨é Web çš„ç¯å¢ƒä¸‹ï¼Œæä¾› JVM ä¸é€€å‡ºå…³é—­çš„åŠŸèƒ½ï¼Œå³ JVM ä¸€ç›´è¿è¡Œç€ã€‚</p>
<blockquote>
<p>èƒ–å‹å¯ä»¥è¯•è¯•ï¼Œå¯åŠ¨ä¸€ä¸ªé Web ç¯å¢ƒçš„ Spring Boot åº”ç”¨ï¼Œç„¶åä¼šå‘ç°ï¼ŒJVM ä¼šåœ¨å¯åŠ¨å®Œ Spring Boot åº”ç”¨åï¼Œè‡ªåŠ¨å…³é—­ã€‚</p>
</blockquote>
<h3 id="4-6-1-supportsEventType">4.6.1 supportsEventType</h3>
<p>å®ç°&nbsp;<code>#supportsEventType(Class&lt;? extends ApplicationEvent&gt; eventType)</code>&nbsp;æ–¹æ³•ï¼Œåˆ¤æ–­æ”¯æŒçš„äº‹ä»¶ç±»å‹æ˜¯ ApplicationReadyEvent å’Œ ContextClosedEvent ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Class&lt;? extends ApplicationEvent&gt;[] SUPPORTED_APPLICATION_EVENTS =</span><br /><span class="line">        of(ApplicationReadyEvent.class, ContextClosedEvent.class);</span><br />        <br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsEventType</span><span class="params">(Class&lt;? extends ApplicationEvent&gt; eventType)</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> ObjectUtils.containsElement(SUPPORTED_APPLICATION_EVENTS, eventType);</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; T[] of(T... values) {</span><br /><span class="line">    <span class="keyword">return</span> values;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚</li>
</ul>
<h3 id="4-6-2-supportsSourceType">4.6.2 supportsSourceType</h3>
<p>å®ç°&nbsp;<code>#supportsSourceType(Class&lt;?&gt; sourceType)</code>&nbsp;æ–¹æ³•ï¼Œåˆ¤æ–­æ”¯æŒçš„äº‹ä»¶æ¥æºã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsSourceType</span><span class="params">(Class&lt;?&gt; sourceType)</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å…¨éƒ¨è¿”å›&nbsp;<code>true</code>&nbsp;ï¼Œæ„å‘³æ”¯æŒæ‰€æœ‰çš„äº‹ä»¶æ¥æºã€‚</li>
</ul>
<h3 id="4-6-3-onApplicationEvent">4.6.3 onApplicationEvent</h3>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> </span>{</span><br /><span class="line">    <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationReadyEvent) {</span><br /><span class="line">        onApplicationReadyEvent((ApplicationReadyEvent) event); <span class="comment">// &lt;1&gt;</span></span><br /><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (event <span class="keyword">instanceof</span> ContextClosedEvent) {</span><br /><span class="line">        onContextClosedEvent((ContextClosedEvent) event); <span class="comment">// &lt;2&gt;</span></span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>&lt;1&gt;</code>&nbsp;å¤„ï¼Œå½“æ˜¯ ApplicationReadyEvent äº‹ä»¶æ—¶ï¼Œè°ƒç”¨&nbsp;<code>#onApplicationReadyEvent(ApplicationReadyEvent event)</code>&nbsp;æ–¹æ³•ï¼Œå¤„ç† ApplicationReadyEvent äº‹ä»¶ã€‚è¯¦ç»†è§£æï¼Œè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ4.6.3.1 onApplicationReadyEventã€</a>&nbsp;ã€‚</li>
<li><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œå½“æ˜¯ ContextClosedEvent äº‹ä»¶æ—¶ï¼Œè°ƒç”¨&nbsp;<code>#onApplicationReadyEvent(ContextClosedEvent event)</code>&nbsp;æ–¹æ³•ï¼Œå¤„ç† ApplicationReadyEvent äº‹ä»¶ã€‚è¯¦ç»†è§£æï¼Œè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ4.6.3.2 onContextClosedEventã€</a>&nbsp;ã€‚</li>
</ul>
<h4 id="4-6-3-1-onApplicationReadyEvent">4.6.3.1 onApplicationReadyEvent</h4>
<p><code>#onApplicationReadyEvent(ApplicationReadyEvent event)</code>&nbsp;æ–¹æ³•ï¼Œå¤„ç† ApplicationReadyEvent äº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onApplicationReadyEvent</span><span class="params">(ApplicationReadyEvent event)</span> </span>{</span><br /><span class="line">    <span class="comment">// &lt;1&gt; å¦‚æœæ˜¯ Web ç¯å¢ƒï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br /><span class="line">    <span class="keyword">final</span> SpringApplication springApplication = event.getSpringApplication();</span><br /><span class="line">    <span class="keyword">if</span> (!WebApplicationType.NONE.equals(springApplication.getWebApplicationType())) {</span><br /><span class="line">        <span class="keyword">return</span>;</span><br /><span class="line">    }</span><br /><span class="line">    <span class="comment">// &lt;2&gt; å¯åŠ¨ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ï¼Œä»è€Œå®ç°ç­‰å¾…</span></span><br /><span class="line">    await();</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>&lt;1&gt;</code>&nbsp;å¤„ï¼Œå¦‚æœæ˜¯ Web ç¯å¢ƒï¼Œåˆ™ç›´æ¥è¿”å›ã€‚å› ä¸ºï¼Œå·²ç»æä¾›äº† JVM ä¸é€€å‡ºå…³é—­çš„åŠŸèƒ½ã€‚</li>
<li>
<p><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#await()</code>&nbsp;æ–¹æ³•ï¼Œå¯åŠ¨ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ï¼Œä»è€Œå®ç°ç­‰å¾…ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æ˜¯å¦å·²ç»ç­‰å¾…å®Œæˆ</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicBoolean awaited = <span class="keyword">new</span> AtomicBoolean(<span class="keyword">false</span>);</span><br /><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br /><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Condition condition = lock.newCondition();</span><br /><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService = Executors.newSingleThreadExecutor();</span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="comment">// has been waited, return immediately</span></span><br /><span class="line">    <span class="comment">// å¦‚æœå·²ç»å¤„äºé˜»å¡ç­‰å¾…ï¼Œç›´æ¥è¿”å›</span></span><br /><span class="line">    <span class="keyword">if</span> (awaited.get()) {</span><br /><span class="line">        <span class="keyword">return</span>;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="comment">// åˆ›å»ºä»»åŠ¡ï¼Œå®ç°é˜»å¡</span></span><br /><span class="line">    executorService.execute(() -&gt; executeMutually(() -&gt; {</span><br /><span class="line">        <span class="keyword">while</span> (!awaited.get()) {</span><br /><span class="line">            <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br /><span class="line">                logger.info(<span class="string">" [Dubbo] Current Spring Boot Application is await..."</span>);</span><br /><span class="line">            }</span><br /><span class="line">            <span class="keyword">try</span> {</span><br /><span class="line">                condition.await();</span><br /><span class="line">            } <span class="keyword">catch</span> (InterruptedException e) {</span><br /><span class="line">                Thread.currentThread().interrupt();</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">    }));</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">executeMutually</span><span class="params">(Runnable runnable)</span> </span>{</span><br /><span class="line">    <span class="keyword">try</span> {</span><br /><span class="line">        lock.lock();</span><br /><span class="line">        <span class="comment">// &lt;X&gt; æ‰§è¡Œ Runnable</span></span><br /><span class="line">        runnable.run();</span><br /><span class="line">    } <span class="keyword">finally</span> {</span><br /><span class="line">        lock.unlock();</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>åŸºäº Lock + Condition å®ç°ç­‰å¾…é€šçŸ¥ã€‚</li>
<li><code>#executeMutually(Runnable runnable)</code>&nbsp;æ–¹æ³•ï¼Œè¢«&nbsp;<code>executorService</code>&nbsp;åˆ›å»ºä»»åŠ¡æ‰€è°ƒç”¨ã€‚è€Œè¯¥ä»»åŠ¡å› ä¸ºè°ƒç”¨&nbsp;<code>Condition#await()</code>&nbsp;æ–¹æ³•ï¼Œé˜»å¡ç­‰å¾…ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼ŒJVM è‡³å°‘æœ‰ä¸€ä¸ªè¯¥ç”¨æˆ·çº¿ç¨‹æœªè¿è¡Œç»“æŸï¼Œé‚£ä¹ˆæ­¤æ—¶&nbsp;<a href="https://blog.csdn.net/hongxingxiaonan/article/details/50528041" target="_blank" rel="external nofollow noopener noreferrer">JVM å…³é—­çš„æ¡ä»¶</a>&nbsp;ä¸è¢«æ»¡è¶³ï¼Œæ‰€ä»¥å°±ä¸ä¼šé€€å‡ºã€‚</li>
</ul>
</li>
</ul>
<h4 id="4-6-3-2-onApplicationReadyEvent">4.6.3.2 onApplicationReadyEvent</h4>
<p><code>#onApplicationReadyEvent(ContextClosedEvent event)</code>&nbsp;æ–¹æ³•ï¼Œå¤„ç† ContextClosedEvent äº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onContextClosedEvent</span><span class="params">(ContextClosedEvent event)</span> </span>{</span><br /><span class="line">    <span class="comment">// &lt;1&gt; é‡Šæ”¾</span></span><br /><span class="line">    release();</span><br /><span class="line">    <span class="comment">// &lt;2&gt; å…³é—­çº¿ç¨‹æ± </span></span><br /><span class="line">    shutdown();</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p><code>&lt;1&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#release()</code>&nbsp;æ–¹æ³•ï¼Œè¿›è¡Œé‡Šæ”¾ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">()</span> </span>{</span><br /><span class="line">    executeMutually(() -&gt; {</span><br /><span class="line">        <span class="comment">// CAS è®¾ç½® awaited ä¸º true</span></span><br /><span class="line">        <span class="keyword">while</span> (awaited.compareAndSet(<span class="keyword">false</span>, <span class="keyword">true</span>)) {</span><br /><span class="line">            <span class="keyword">if</span> (logger.isInfoEnabled()) {</span><br /><span class="line">                logger.info(<span class="string">" [Dubbo] Current Spring Boot Application is about to shutdown..."</span>);</span><br /><span class="line">            }</span><br /><span class="line">            <span class="comment">// é€šçŸ¥ Condition</span></span><br /><span class="line">            condition.signalAll();</span><br /><span class="line">        }</span><br /><span class="line">    });</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>é€šè¿‡è°ƒç”¨&nbsp;<code>Condition#signalAll()</code>&nbsp;æ–¹æ³•ï¼Œé€šçŸ¥ Condition ã€‚ä»è€Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ4.6.3.1 onApplicationReadyEventã€</a>ä¸­ï¼Œå¯åŠ¨çš„çº¿ç¨‹çš„é˜»å¡ï¼Œè¿›è¡Œåœæ­¢ã€‚</li>
</ul>
</li>
<li>
<p><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#shutdown()</code>&nbsp;æ–¹æ³•ï¼Œå…³é—­çº¿ç¨‹æ± ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AwaitingNonWebApplicationListener.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shutdown</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">if</span> (!executorService.isShutdown()) {</span><br /><span class="line">        <span class="comment">// Shutdown executorService</span></span><br /><span class="line">        executorService.shutdown();</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<h1 id="5-dubbo-spring-boot-actuator-æºç ">5.&nbsp;<code>dubbo-spring-boot-actuator</code>&nbsp;æºç </h1>
<p><code>dubbo-spring-boot-autoconfigure</code>&nbsp;æ¨¡å—ï¼Œæ‰€æœ‰ç±»å¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/09.jpg" alt="&#96;dubbo-spring-boot-autoconfigure&#96; æ¨¡å—" /></p>
<h2 id="5-1-ä½¿ç”¨æŒ‡å—">5.1 ä½¿ç”¨æŒ‡å—</h2>
<p>ä½¿ç”¨æ—¶ï¼Œéœ€è¦å¯¼å…¥&nbsp;<code>dubbo-spring-boot-actuator</code>&nbsp;ä¾èµ–ã€‚å³å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">&lt;!-- å¯¼å…¥ WEB ç¯å¢ƒ --&gt;</span></span><br /><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br /><br /><span class="line"><span class="comment">&lt;!-- å¯¼å…¥ Spring Boot Actuator --&gt;</span></span><br /><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br /><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br /><br /><span class="line"><span class="comment">&lt;!-- å¯¼å…¥ Dubbo Spring Boot Actuator --&gt;</span></span><br /><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br /><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>è§‚çœ‹æœ¬å°èŠ‚ï¼Œèƒ–å‹éœ€è¦å¯¹ Spring Boot Actuator æœ‰ç›¸å…³çš„äº†è§£ã€‚å¦‚æœä¸çŸ¥é“ï¼Œå¯ä»¥çœ‹çœ‹&nbsp;<a href="http://www.iocoder.cn/Spring-Boot/battcn/v2-actuator-introduce/" target="_blank" rel="external nofollow noopener noreferrer">ã€Šä¸€èµ·æ¥å­¦ SpringBoot 2.x | ç¬¬åå››ç¯‡ï¼šå¼ºå¤§çš„ Actuator æœåŠ¡ç›‘æ§ä¸ç®¡ç†ã€‹</a>&nbsp;æ–‡ç« ã€‚</p>
<p>å¦å¤–ï¼Œ<a href="https://github.com/apache/incubator-dubbo-spring-boot-project/tree/master/dubbo-spring-boot-actuator" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å®˜æ–¹æ–‡æ¡£ &mdash;&mdash; Dubbo Spring Boot Production-Readyã€‹</a>&nbsp;æ–‡ç« ï¼Œä¹Ÿæ˜¯éœ€è¦å…ˆç…ç…çš„ã€‚</p>
<p>å¦‚æœèƒ–å‹ä½¿ç”¨çš„æ˜¯ Spring Boot 2ï¼Œæœ‰ä¸€ä¸ªå‘è¦æ³¨æ„ï¼Œå› ä¸º&nbsp;<a href="https://blog.csdn.net/qq_20367813/article/details/79154981" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠSpring Boot 2.0 çš„ Actuator åªæš´éœ² health å’Œ infoã€‹</a>&nbsp;ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ è¦å¼€å¯çš„ Dubbo Endpoint ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plain">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"># application.properties</span><br /><br /><span class="line">management.endpoints.web.exposure.include=health,info,dubbo,dubboconfigs</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>æ­¤æ—¶ï¼Œæˆ‘ä»¬å¤šå¼€å¯äº†&nbsp;<code>dubbo</code>&nbsp;å’Œ&nbsp;<code>dubboconfigs</code>&nbsp;è¿™ä¸¤ä¸ª EndPoint ã€‚T T å‘äº†è‡ªå·±å¥½ä¹…~</li>
</ul>
<blockquote>
<p>å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯&nbsp;<code>autoconfigure</code>&nbsp;åŒ…ä¸‹ã€‚</p>
</blockquote>
<h2 id="5-2-DubboEndpointsAutoConfiguration">5.2 DubboEndpointsAutoConfiguration</h2>
<p><code>com.alibaba.boot.dubbo.actuate.autoconfigure.DubboEndpointsAutoConfiguration</code>&nbsp;ï¼ŒDubbo Endpoint è‡ªåŠ¨é…ç½®ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboEndpointsAutoConfiguration.java</span></span><br /><br /><span class="line"><span class="meta">@Configuration</span></span><br /><span class="line"><span class="meta">@PropertySource</span>(</span><br /><span class="line">        name = <span class="string">"Dubbo Endpoints Default Properties"</span>,</span><br /><span class="line">        value = <span class="string">"classpath:/META-INF/dubbo-endpoins-default.properties"</span>) <span class="comment">// å¯¼å…¥è¯¥é…ç½®æ–‡ä»¶</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboEndpointsAutoConfiguration</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@Bean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnEnabledEndpoint</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> DubboEndpoint <span class="title">dubboEndpoint</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DubboEndpoint();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Bean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnEnabledEndpoint</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> DubboConfigsMetadataEndpoint <span class="title">dubboConfigsMetadataEndpoint</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DubboConfigsMetadataEndpoint();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Bean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnEnabledEndpoint</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> DubboPropertiesEndpoint <span class="title">dubboPropertiesEndpoint</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DubboPropertiesEndpoint();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Bean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnEnabledEndpoint</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> DubboReferencesMetadataEndpoint <span class="title">dubboReferencesMetadataEndpoint</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DubboReferencesMetadataEndpoint();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Bean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnEnabledEndpoint</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> DubboServicesMetadataEndpoint <span class="title">dubboServicesMetadataEndpoint</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DubboServicesMetadataEndpoint();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Bean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnEnabledEndpoint</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> DubboShutdownEndpoint <span class="title">dubboShutdownEndpoint</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DubboShutdownEndpoint();</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>æ¯ä¸ªæ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª Dubbo Endpint Bean ã€‚ä¸€å…±æœ‰ 6 ä¸ªã€‚</li>
<li><code>@PropertySource</code>&nbsp;æ³¨è§£ï¼Œå¯¼å…¥&nbsp;<code>"classpath:/META-INF/dubbo-endpoins-default.properties"</code>&nbsp;é…ç½®æ–‡ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š
<figure class="highlight plain">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"># dubbo-endpoins-default.properties</span><br /><br /><span class="line"># Dubbo Endpoints Default Properties is loaded by @PropertySource with low order,</span><br /><span class="line"># those values of properties can be override by higher PropertySource</span><br /><span class="line"># @see DubboEndpointsAutoConfiguration</span><br /><br /><span class="line"># Set enabled for Dubbo Endpoints è®¾ç½® Dubbo Endpoints æ˜¯å¦å¼€å¯</span><br /><span class="line">management.endpoint.dubbo.enabled = true</span><br /><span class="line">management.endpoint.dubboshutdown.enabled = false</span><br /><span class="line">management.endpoint.dubboconfigs.enabled = true</span><br /><span class="line">management.endpoint.dubboservices.enabled = false</span><br /><span class="line">management.endpoint.dubboreferences.enabled = false</span><br /><span class="line">management.endpoint.dubboproperties.enabled = true</span><br /><br /><span class="line"># "management.endpoints.web.base-path" should not be configured in this file</span><br /><br /><span class="line"># Re-defines path-mapping of Dubbo Web Endpoints é‡å‘½å Dubbo Web Endpoints è·¯å¾„</span><br /><span class="line">management.endpoints.web.path-mapping.dubboshutdown = dubbo/shutdown</span><br /><span class="line">management.endpoints.web.path-mapping.dubboconfigs = dubbo/configs</span><br /><span class="line">management.endpoints.web.path-mapping.dubboservices = dubbo/services</span><br /><span class="line">management.endpoints.web.path-mapping.dubboreferences = dubbo/references</span><br /><span class="line">management.endpoints.web.path-mapping.dubboproperties = dubbo/properties</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<h2 id="5-3-DubboHealthIndicatorAutoConfiguration">5.3 DubboHealthIndicatorAutoConfiguration</h2>
<p><code>com.alibaba.boot.dubbo.actuate.autoconfigure.DubboHealthIndicatorAutoConfiguration</code>&nbsp;ï¼ŒDubbo Health Indicator è‡ªåŠ¨é…ç½®ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboHealthIndicatorAutoConfiguration.java</span></span><br /><br /><span class="line"><span class="meta">@Configuration</span></span><br /><span class="line"><span class="meta">@ConditionalOnClass</span>({HealthIndicator.class}) <span class="comment">// å­˜åœ¨ HealthIndicator ç±»çš„æƒ…å†µ</span></span><br /><span class="line"><span class="meta">@AutoConfigureBefore</span>({EndpointAutoConfiguration.class}) <span class="comment">// åœ¨ EndpointAutoConfiguration è‡ªåŠ¨é…ç½®ç±»ä¹‹å‰åˆå§‹åŒ–</span></span><br /><span class="line"><span class="meta">@AutoConfigureAfter</span>(DubboAutoConfiguration.class) <span class="comment">// åœ¨ DubboAutoConfiguration è‡ªåŠ¨é…ç½®ç±»ä¹‹ååˆå§‹åŒ–</span></span><br /><span class="line"><span class="meta">@ConditionalOnEnabledHealthIndicator</span>(<span class="string">"dubbo"</span>)</span><br /><span class="line"><span class="meta">@EnableConfigurationProperties</span>(DubboHealthIndicatorProperties.class) <span class="comment">// è‡ªåŠ¨é…ç½® DubboHealthIndicatorProperties ç±»</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboHealthIndicatorAutoConfiguration</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@Bean</span></span><br /><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> DubboHealthIndicator <span class="title">dubboHealthIndicator</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DubboHealthIndicator();</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>æ¯ä¸ªæ³¨è§£ï¼Œçœ‹åé¢çš„ä»£ç æ³¨é‡Šã€‚</li>
<li>å”¯ä¸€çš„æ–¹æ³•ï¼Œåˆ›å»º DubboHealthIndicator Bean å¯¹è±¡ã€‚è¯¦ç»†è§£æï¼Œè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ5.5 DubboHealthIndicatorã€</a>&nbsp;ã€‚</li>
</ul>
<h2 id="5-4-DubboHealthIndicatorProperties">5.4 DubboHealthIndicatorProperties</h2>
<p><code>com.alibaba.boot.dubbo.actuate.health.DubboHealthIndicatorProperties</code>&nbsp;ï¼ŒDubbo Health Indicator Properties ç±»ã€‚ä»£ç ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboHealthIndicatorProperties.java</span></span><br /><br /><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = PREFIX, ignoreUnknownFields = <span class="keyword">false</span>) <span class="comment">// "management.health.dubbo" å¼€å¤´çš„é…ç½®</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboHealthIndicatorProperties</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The prefix of {<span class="doctag">@link</span> DubboHealthIndicatorProperties}</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX = <span class="string">"management.health.dubbo"</span>;</span><br /><br /><span class="line">    <span class="keyword">private</span> Status status = <span class="keyword">new</span> Status();</span><br /><br /><span class="line">    <span class="comment">// ... çœç•¥ setting/getting æ–¹æ³•</span></span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The nested class for {<span class="doctag">@link</span> StatusChecker}'s names</span></span><br /><span class="line"><span class="comment">     * &lt;pre&gt;</span></span><br /><span class="line"><span class="comment">     * registry=com.alibaba.dubbo.registry.status.RegistryStatusChecker</span></span><br /><span class="line"><span class="comment">     * spring=com.alibaba.dubbo.config.spring.status.SpringStatusChecker</span></span><br /><span class="line"><span class="comment">     * datasource=com.alibaba.dubbo.config.spring.status.DataSourceStatusChecker</span></span><br /><span class="line"><span class="comment">     * memory=com.alibaba.dubbo.common.status.support.MemoryStatusChecker</span></span><br /><span class="line"><span class="comment">     * load=com.alibaba.dubbo.common.status.support.LoadStatusChecker</span></span><br /><span class="line"><span class="comment">     * server=com.alibaba.dubbo.rpc.protocol.dubbo.status.ServerStatusChecker</span></span><br /><span class="line"><span class="comment">     * threadpool=com.alibaba.dubbo.rpc.protocol.dubbo.status.ThreadPoolStatusChecker</span></span><br /><span class="line"><span class="comment">     * &lt;/pre&gt;</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> StatusChecker</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Status</span> </span>{</span><br /><br /><span class="line">        <span class="comment">/**</span></span><br /><span class="line"><span class="comment">         * The defaults names of {<span class="doctag">@link</span> StatusChecker}</span></span><br /><span class="line"><span class="comment">         * &lt;p&gt;</span></span><br /><span class="line"><span class="comment">         * The defaults : "memory", "load"</span></span><br /><span class="line"><span class="comment">         */</span></span><br /><span class="line">        <span class="keyword">private</span> Set&lt;String&gt; defaults = <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(<span class="string">"memory"</span>, <span class="string">"load"</span>));</span><br /><br /><span class="line">        <span class="comment">/**</span></span><br /><span class="line"><span class="comment">         * The extra names of {<span class="doctag">@link</span> StatusChecker}</span></span><br /><span class="line"><span class="comment">         *</span></span><br /><span class="line"><span class="comment">         * é…ç½®çš„ "management.health.dubbo.extras" é›†åˆ</span></span><br /><span class="line"><span class="comment">         *</span></span><br /><span class="line"><span class="comment">         * æ¯ä¸ªå…ƒç´ ï¼Œæ˜¯ StatusChecker çš„å®ç°ç±»</span></span><br /><span class="line"><span class="comment">         */</span></span><br /><span class="line">        <span class="keyword">private</span> Set&lt;String&gt; extras = <span class="keyword">new</span> LinkedHashSet&lt;&gt;();</span><br /><br /><span class="line">        <span class="comment">// ... çœç•¥ setting/getting æ–¹æ³•</span></span><br />        <br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>è¯»å–ä»¥&nbsp;<code>"management.health.dubbo"</code>&nbsp;å¼€å¤´çš„é…ç½®ã€‚</li>
</ul>
<blockquote>
<p>å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯&nbsp;<code>health</code>&nbsp;åŒ…ä¸‹ã€‚</p>
</blockquote>
<h2 id="5-5-DubboHealthIndicator">5.5 DubboHealthIndicator</h2>
<p><code>com.alibaba.boot.dubbo.actuate.health.DubboHealthIndicator</code>&nbsp;ï¼Œç»§æ‰¿ AbstractHealthIndicator æŠ½è±¡ç±»ï¼ŒDubbo Health Indicator å®ç°ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<h3 id="5-4-1-doHealthCheck">5.4.1 doHealthCheck</h3>
<p>å®ç°&nbsp;<code>#doHealthCheck(Health.Builder builder)</code>&nbsp;æ–¹æ³•ï¼Œæ‰§è¡Œå¥åº·æ£€æŸ¥ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>åœ¨è¯·æ±‚&nbsp;<code>/actuator/health</code>&nbsp;æ¥å£æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚</p>
</blockquote>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboHealthIndicator.java</span></span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception </span>{</span><br /><span class="line">    <span class="comment">// &lt;1&gt; è·å¾— StatusChecker å¯¹åº”çš„ Dubbo ExtensionLoader å¯¹è±¡</span></span><br /><span class="line">    ExtensionLoader&lt;StatusChecker&gt; extensionLoader = getExtensionLoader(StatusChecker.class);</span><br /><span class="line">    <span class="comment">// &lt;2&gt; è§£æ StatusChecker çš„åå­—çš„ Map</span></span><br /><span class="line">    Map&lt;String, String&gt; statusCheckerNamesMap = resolveStatusCheckerNamesMap();</span><br /><br /><span class="line">    <span class="comment">// &lt;3&gt; å£°æ˜ hasErrorã€hasUnknown å˜é‡</span></span><br /><span class="line">    <span class="keyword">boolean</span> hasError = <span class="keyword">false</span>; <span class="comment">// æ˜¯å¦æœ‰é”™è¯¯çš„è¿”å›</span></span><br /><span class="line">    <span class="keyword">boolean</span> hasUnknown = <span class="keyword">false</span>; <span class="comment">// æ˜¯å¦æœ‰æœªçŸ¥çš„è¿”å›</span></span><br /><br /><span class="line">    <span class="comment">// Up first</span></span><br /><span class="line">    <span class="comment">// &lt;4&gt; å…ˆ builder æ ‡è®°çŠ¶æ€æ˜¯ UP</span></span><br /><span class="line">    builder.up();</span><br /><br /><span class="line">    <span class="comment">// &lt;5&gt; éå† statusCheckerNamesMap å…ƒç´ </span></span><br /><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : statusCheckerNamesMap.entrySet()) {</span><br /><span class="line">        <span class="comment">// &lt;6.1&gt; è·å¾— StatusChecker çš„åå­—</span></span><br /><span class="line">        String statusCheckerName = entry.getKey();</span><br /><span class="line">        <span class="comment">// &lt;6.2&gt; è·å¾— source</span></span><br /><span class="line">        String source = entry.getValue();</span><br /><span class="line">        <span class="comment">// &lt;6.3&gt; è·å¾— StatusChecker å¯¹è±¡</span></span><br /><span class="line">        StatusChecker checker = extensionLoader.getExtension(statusCheckerName);</span><br /><span class="line">        <span class="comment">// &lt;6.4&gt; æ‰§è¡Œæ ¡éªŒ</span></span><br /><span class="line">        com.alibaba.dubbo.common.status.Status status = checker.check();</span><br /><br /><span class="line">        <span class="comment">// &lt;7.1&gt; è·å¾—æ ¡éªŒç»“æœ</span></span><br /><span class="line">        com.alibaba.dubbo.common.status.Status.Level level = status.getLevel();</span><br /><span class="line">        <span class="comment">// &lt;7.2&gt; å¦‚æœæ˜¯ ERROR æ£€éªŒç»“æœï¼Œåˆ™æ ‡è®° hasError ä¸º true ï¼Œå¹¶æ ‡è®° builder çŠ¶æ€ä¸º down</span></span><br /><span class="line">        <span class="keyword">if</span> (!hasError <span class="comment">// ä¸å­˜åœ¨ hasError çš„æ—¶å€™</span></span><br /><span class="line">                &amp;&amp; level.equals(com.alibaba.dubbo.common.status.Status.Level.ERROR)) {</span><br /><span class="line">            hasError = <span class="keyword">true</span>;</span><br /><span class="line">            builder.down();</span><br /><span class="line">        }</span><br /><span class="line">        <span class="comment">// &lt;7.3&gt; å¦‚æœæ˜¯ UNKNOWN æ£€éªŒç»“æœï¼Œåˆ™æ ‡è®° hasUnknown ä¸º true ï¼Œå¹¶æ ‡è®° builder çŠ¶æ€ä¸º unknown</span></span><br /><span class="line">        <span class="keyword">if</span> (!hasError &amp;&amp; !hasUnknown <span class="comment">// ä¸å­˜åœ¨ hasError ä¸”ä¸å­˜åœ¨ hasUnknown</span></span><br /><span class="line">                &amp;&amp; level.equals(com.alibaba.dubbo.common.status.Status.Level.UNKNOWN)) {</span><br /><span class="line">            hasUnknown = <span class="keyword">true</span>;</span><br /><span class="line">            builder.unknown();</span><br /><span class="line">        }</span><br /><br /><span class="line">        <span class="comment">// &lt;8.1&gt; åˆ›å»º detail Map</span></span><br /><span class="line">        Map&lt;String, Object&gt; detail = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">        <span class="comment">// &lt;8.2&gt; è®¾ç½® detail å±æ€§å€¼</span></span><br /><span class="line">        detail.put(<span class="string">"source"</span>, source);</span><br /><span class="line">        detail.put(<span class="string">"status"</span>, status); <span class="comment">// æ ¡éªŒç»“æœ</span></span><br /><span class="line">        <span class="comment">// &lt;8.3&gt; æ·»åŠ åˆ° builder ä¸­</span></span><br /><span class="line">        builder.withDetail(statusCheckerName, detail);</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å¤§ä½“æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹é¡ºç€æ³¨é‡Šæ¥ç…ç…å³å¯ã€‚</li>
<li><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#resolveStatusCheckerNamesMap()</code>&nbsp;æ–¹æ³•ï¼Œè§£æ StatusChecker çš„åå­—çš„ Map ã€‚å› ä¸ºè¿™ä¸ªå¯¹åç»­é€»è¾‘éå¸¸å…³é”®ï¼Œæ‰€ä»¥èƒ–å‹å…ˆè·³åˆ°&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-Externalized/">ã€Œ5.4.2 resolveStatusCheckerNamesMapã€</a>&nbsp;ä¸­ã€‚çœ‹å®Œä¹‹åï¼Œåœ¨å›åˆ°æ­¤å¤„ã€‚</li>
<li>æœ€ç»ˆè¿”å›&nbsp;<code>builder</code>&nbsp;çš„ç»“æœï¼Œå¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/11.jpg" alt="&#96;builder&#96; ç»“æœ" /></li>
</ul>
<h3 id="5-4-2-resolveStatusCheckerNamesMap">5.4.2 resolveStatusCheckerNamesMap</h3>
<p><code>#resolveStatusCheckerNamesMap()</code>&nbsp;æ–¹æ³•ï¼Œè§£æ StatusChecker çš„åå­—çš„ Mapã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboHealthIndicator.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Resolves the map of {<span class="doctag">@link</span> StatusChecker}'s name and its' source.</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * è§£æ StatusChecker çš„åå­—çš„ Map</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * KEYï¼šStatusChecker çš„åå­—</span></span><br /><span class="line"><span class="comment"> * VALUEï¼šé…ç½®çš„æ¥æº</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@return</span> non-null {<span class="doctag">@link</span> Map}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="function"><span class="keyword">protected</span> Map&lt;String, String&gt; <span class="title">resolveStatusCheckerNamesMap</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">    Map&lt;String, String&gt; statusCheckerNamesMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">    <span class="comment">// &lt;1&gt; ä» DubboHealthIndicatorProperties ä¸­è·å–</span></span><br /><span class="line">    statusCheckerNamesMap.putAll(resolveStatusCheckerNamesMapFromDubboHealthIndicatorProperties());</span><br /><span class="line">    <span class="comment">// &lt;2&gt; ä» ProtocolConfig ä¸­è·å–</span></span><br /><span class="line">    statusCheckerNamesMap.putAll(resolveStatusCheckerNamesMapFromProtocolConfigs());</span><br /><span class="line">    <span class="comment">// &lt;3&gt; ä» ProviderConfig ä¸­è·å–</span></span><br /><span class="line">    statusCheckerNamesMap.putAll(resolveStatusCheckerNamesMapFromProviderConfig());</span><br /><span class="line">    <span class="keyword">return</span> statusCheckerNamesMap;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>&lt;1&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#resolveStatusCheckerNamesMapFromDubboHealthIndicatorProperties()</code>&nbsp;æ–¹æ³•ï¼Œä» DubboHealthIndicatorProperties ä¸­è·å–ã€‚ä»£ç å¦‚ä¸‹ï¼š
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboHealthIndicator.java</span></span><br /><br /><span class="line"><span class="meta">@Autowired</span></span><br /><span class="line"><span class="keyword">private</span> DubboHealthIndicatorProperties dubboHealthIndicatorProperties;</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, String&gt; <span class="title">resolveStatusCheckerNamesMapFromDubboHealthIndicatorProperties</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="comment">// è·å¾— DubboHealthIndicatorProperties.Status</span></span><br /><span class="line">    DubboHealthIndicatorProperties.Status status = dubboHealthIndicatorProperties.getStatus();</span><br /><span class="line">    <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">    Map&lt;String, String&gt; statusCheckerNamesMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">    <span class="comment">// 1. è¯»å– defaults å±æ€§</span></span><br /><span class="line">    <span class="keyword">for</span> (String statusName : status.getDefaults()) {</span><br /><span class="line">        statusCheckerNamesMap.put(statusName, PREFIX + <span class="string">".status.defaults"</span>);</span><br /><span class="line">    }</span><br /><span class="line">    <span class="comment">// 2. è¯»å– extras å±æ€§</span></span><br /><span class="line">    <span class="keyword">for</span> (String statusName : status.getExtras()) {</span><br /><span class="line">        statusCheckerNamesMap.put(statusName, PREFIX + <span class="string">".status.extras"</span>);</span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">return</span> statusCheckerNamesMap;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<ul>
<li><code>&lt;2&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#resolveStatusCheckerNamesMapFromProtocolConfigs()</code>&nbsp;æ–¹æ³•ï¼Œä» ProtocolConfig ä¸­è·å–ã€‚ä»£ç å¦‚ä¸‹ï¼š
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboHealthIndicator.java</span></span><br /><br /><span class="line"><span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</span><br /><span class="line"><span class="keyword">private</span> Map&lt;String, ProtocolConfig&gt; protocolConfigs = Collections.emptyMap();</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, String&gt; <span class="title">resolveStatusCheckerNamesMapFromProtocolConfigs</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">    Map&lt;String, String&gt; statusCheckerNamesMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">    <span class="comment">// éå† protocolConfigs</span></span><br /><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, ProtocolConfig&gt; entry : protocolConfigs.entrySet()) {</span><br /><span class="line">        <span class="comment">// è·å¾— Bean çš„åå­—</span></span><br /><span class="line">        String beanName = entry.getKey();</span><br /><span class="line">        <span class="comment">// è·å¾— ProtocolConfig å¯¹è±¡</span></span><br /><span class="line">        ProtocolConfig protocolConfig = entry.getValue();</span><br /><span class="line">        <span class="comment">// è·å¾— ProtocolConfig çš„ StatusChecker çš„åå­—çš„é›†åˆ</span></span><br /><span class="line">        Set&lt;String&gt; statusCheckerNames = getStatusCheckerNames(protocolConfig);</span><br /><span class="line">        <span class="comment">// éå† statusCheckerNames æ•°ç»„</span></span><br /><span class="line">        <span class="keyword">for</span> (String statusCheckerName : statusCheckerNames) {</span><br /><span class="line">            <span class="comment">// æ„å»º source å±æ€§</span></span><br /><span class="line">            String source = buildSource(beanName, protocolConfig);</span><br /><span class="line">            <span class="comment">// æ·»åŠ åˆ° statusCheckerNamesMap ä¸­</span></span><br /><span class="line">            statusCheckerNamesMap.put(statusCheckerName, source);</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">return</span> statusCheckerNamesMap;</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> Set&lt;String&gt; <span class="title">getStatusCheckerNames</span><span class="params">(ProtocolConfig protocolConfig)</span> </span>{</span><br /><span class="line">    String status = protocolConfig.getStatus();</span><br /><span class="line">    <span class="keyword">return</span> StringUtils.commaDelimitedListToSet(status);</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> Set&lt;String&gt; <span class="title">getStatusCheckerNames</span><span class="params">(ProviderConfig providerConfig)</span> </span>{</span><br /><span class="line">    String status = providerConfig.getStatus();</span><br /><span class="line">    <span class="keyword">return</span> StringUtils.commaDelimitedListToSet(status);</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">buildSource</span><span class="params">(String beanName, Object bean)</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> beanName + <span class="string">"@"</span> + bean.getClass().getSimpleName() + <span class="string">".getStatus()"</span>;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<ul>
<li><code>&lt;3&gt;</code>&nbsp;å¤„ï¼Œè°ƒç”¨&nbsp;<code>#resolveStatusCheckerNamesMapFromProviderConfig()</code>&nbsp;æ–¹æ³•ï¼Œä» ProviderConfig ä¸­è·å–ã€‚ä»£ç å¦‚ä¸‹ï¼š
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboHealthIndicator.java</span></span><br /><br /><span class="line"><span class="meta">@Autowired</span>(required = <span class="keyword">false</span>)</span><br /><span class="line"><span class="keyword">private</span> Map&lt;String, ProviderConfig&gt; providerConfigs = Collections.emptyMap();</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> Map&lt;String, String&gt; <span class="title">resolveStatusCheckerNamesMapFromProviderConfig</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">    Map&lt;String, String&gt; statusCheckerNamesMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">    <span class="comment">// éå† providerConfigs</span></span><br /><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, ProviderConfig&gt; entry : providerConfigs.entrySet()) {</span><br /><span class="line">        <span class="comment">// è·å¾— Bean çš„åå­—</span></span><br /><span class="line">        String beanName = entry.getKey();</span><br /><span class="line">        <span class="comment">// è·å¾— ProviderConfig å¯¹è±¡</span></span><br /><span class="line">        ProviderConfig providerConfig = entry.getValue();</span><br /><span class="line">        <span class="comment">// è·å¾— ProtocolConfig çš„ StatusChecker çš„åå­—çš„é›†åˆ</span></span><br /><span class="line">        Set&lt;String&gt; statusCheckerNames = getStatusCheckerNames(providerConfig);</span><br /><span class="line">        <span class="comment">// éå† statusCheckerNames æ•°ç»„</span></span><br /><span class="line">        <span class="keyword">for</span> (String statusCheckerName : statusCheckerNames) {</span><br /><span class="line">            <span class="comment">// æ„å»º source å±æ€§</span></span><br /><span class="line">            String source = buildSource(beanName, providerConfig);</span><br /><span class="line">            <span class="comment">// æ·»åŠ åˆ° statusCheckerNamesMap ä¸­</span></span><br /><span class="line">            statusCheckerNamesMap.put(statusCheckerName, source);</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">return</span> statusCheckerNamesMap;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<ul>
<li>æœ€ç»ˆçš„ç»“æœï¼Œç¤ºä¾‹å¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/10.jpg" alt="&#96;statusCheckerNamesMap&#96; å±æ€§" /></li>
</ul>
<blockquote>
<p>å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯&nbsp;<code>endpoint</code>&nbsp;åŒ…ä¸‹ã€‚</p>
</blockquote>
<h2 id="5-6-AbstractDubboEndpoint">5.6 AbstractDubboEndpoint</h2>
<p><code>com.alibaba.boot.dubbo.actuate.endpoint.AbstractDubboEndpoint</code>&nbsp;ï¼Œå®ç° ApplicationContextAwareã€EnvironmentAware æ¥å£ï¼ŒDubbo Endpoint æŠ½è±¡ç±»ï¼Œæä¾›ç»™å­ç±»å·¥å…·æ–¹æ³•ã€‚</p>
<h3 id="5-6-1-åŸºæœ¬å±æ€§">5.6.1 åŸºæœ¬å±æ€§</h3>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AbstractDubboEndpoint.java</span></span><br /><br /><span class="line"><span class="keyword">protected</span> ApplicationContext applicationContext;</span><br /><br /><span class="line"><span class="keyword">protected</span> ConfigurableEnvironment environment;</span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>{</span><br /><span class="line">    <span class="keyword">this</span>.applicationContext = applicationContext;</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnvironment</span><span class="params">(Environment environment)</span> </span>{</span><br /><span class="line">    <span class="keyword">if</span> (environment <span class="keyword">instanceof</span> ConfigurableEnvironment) {</span><br /><span class="line">        <span class="keyword">this</span>.environment = (ConfigurableEnvironment) environment;</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h3 id="5-6-2-resolveBeanMetadata">5.6.2 resolveBeanMetadata</h3>
<p><code>#resolveBeanMetadata(Object bean)</code>&nbsp;æ–¹æ³•ï¼Œè·å¾— Bean çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AbstractDubboEndpoint.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> Map&lt;String, Object&gt; <span class="title">resolveBeanMetadata</span><span class="params">(<span class="keyword">final</span> Object bean)</span> </span>{</span><br /><span class="line">    <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">    <span class="keyword">final</span> Map&lt;String, Object&gt; beanMetadata = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">    <span class="keyword">try</span> {</span><br /><span class="line">        <span class="comment">// è·å¾— BeanInfo å¯¹è±¡</span></span><br /><span class="line">        BeanInfo beanInfo = Introspector.getBeanInfo(bean.getClass());</span><br /><span class="line">        <span class="comment">// è·å¾— PropertyDescriptor æ•°ç»„</span></span><br /><span class="line">        PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();</span><br /><span class="line">        <span class="comment">// éå† PropertyDescriptor æ•°ç»„</span></span><br /><span class="line">        <span class="keyword">for</span> (PropertyDescriptor propertyDescriptor : propertyDescriptors) {</span><br /><span class="line">            <span class="comment">// è·å¾— Method å¯¹è±¡</span></span><br /><span class="line">            Method readMethod = propertyDescriptor.getReadMethod();</span><br /><span class="line">            <span class="comment">// è¯»å–å±æ€§ï¼Œæ·»åŠ åˆ° beanMetadata ä¸­</span></span><br /><span class="line">            <span class="keyword">if</span> (readMethod != <span class="keyword">null</span> &amp;&amp; isSimpleType(propertyDescriptor.getPropertyType())) {</span><br /><span class="line">                String name = Introspector.decapitalize(propertyDescriptor.getName());</span><br /><span class="line">                Object value = readMethod.invoke(bean);</span><br /><span class="line">                beanMetadata.put(name, value);</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">    } <span class="keyword">catch</span> (Exception e) {</span><br /><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">return</span> beanMetadata;</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isSimpleType</span><span class="params">(Class&lt;?&gt; type)</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> isPrimitiveOrWrapper(type) <span class="comment">// åŸºæœ¬ç±»å‹ or åŒ…è£…ç±»å‹</span></span><br /><span class="line">            || type == String.class</span><br /><span class="line">            || type == BigDecimal.class</span><br /><span class="line">            || type == BigInteger.class</span><br /><span class="line">            || type == Date.class</span><br /><span class="line">            || type == URL.class</span><br /><span class="line">            || type == Class.class</span><br /><span class="line">            ;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç›®çš„æ˜¯è¯»å– Bean çš„åŸºæœ¬å±æ€§ã€‚ç¤ºä¾‹å¦‚ä¸‹å›¾ï¼š<img src="http://static2.iocoder.cn/images/Dubbo/2019_02_11/12.jpg" alt="&#96;beanMetadata&#96; ç»“æœ" /></li>
</ul>
<h3 id="5-6-3-getServiceBeansMap">5.6.3 getServiceBeansMap</h3>
<p><code>#getServiceBeansMap()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰ ServiceBean ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AbstractDubboEndpoint.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> Map&lt;String, ServiceBean&gt; <span class="title">getServiceBeansMap</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, ServiceBean.class);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h3 id="5-6-4-getProtocolConfigsBeanMap">5.6.4 getProtocolConfigsBeanMap</h3>
<p><code>#getProtocolConfigsBeanMap()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰ ProtocolConfig ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AbstractDubboEndpoint.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> Map&lt;String, ProtocolConfig&gt; <span class="title">getProtocolConfigsBeanMap</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, ProtocolConfig.class);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h3 id="5-6-5-getReferenceAnnotationBeanPostProcessor">5.6.5 getReferenceAnnotationBeanPostProcessor</h3>
<p><code>#getReferenceAnnotationBeanPostProcessor()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾— ReferenceAnnotationBeanPostProcessor Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// AbstractDubboEndpoint.java</span></span><br /><br /><span class="line"><span class="function"><span class="keyword">protected</span> ReferenceAnnotationBeanPostProcessor <span class="title">getReferenceAnnotationBeanPostProcessor</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> applicationContext.getBean(ReferenceAnnotationBeanPostProcessor.BEAN_NAME, ReferenceAnnotationBeanPostProcessor.class);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="5-7-DubboEndpoint">5.7 DubboEndpoint</h2>
<p><code>com.alibaba.boot.dubbo.actuate.endpoint.DubboEndpoint</code>&nbsp;ï¼ŒDubbo Endpoint ï¼Œè·å¾— Dubbo Meta Dataï¼ˆå…ƒæ•°æ®ï¼‰ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboEndpoint.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Actuator {<span class="doctag">@link</span> Endpoint} to expose Dubbo Meta Data</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Endpoint</span>(id = <span class="string">"dubbo"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboEndpoint</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@ReadOperation</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">invoke</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">        Map&lt;String, Object&gt; metaData = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><br /><span class="line">        <span class="comment">// timestamp</span></span><br /><span class="line">        metaData.put(<span class="string">"timestamp"</span>, System.currentTimeMillis());</span><br /><br /><span class="line">        <span class="comment">// versions</span></span><br /><span class="line">        Map&lt;String, String&gt; versions = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">        versions.put(<span class="string">"dubbo-spring-boot"</span>, Version.getVersion(DubboUtils.class, <span class="string">"1.0.0"</span>));</span><br /><span class="line">        versions.put(<span class="string">"dubbo"</span>, Version.getVersion());</span><br /><br /><span class="line">        <span class="comment">// urls</span></span><br /><span class="line">        Map&lt;String, String&gt; urls = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">        urls.put(<span class="string">"dubbo"</span>, DUBBO_GITHUB_URL);</span><br /><span class="line">        urls.put(<span class="string">"mailing-list"</span>, DUBBO_MAILING_LIST);</span><br /><span class="line">        urls.put(<span class="string">"github"</span>, DUBBO_SPRING_BOOT_GITHUB_URL);</span><br /><span class="line">        urls.put(<span class="string">"issues"</span>, DUBBO_SPRING_BOOT_ISSUES_URL);</span><br /><span class="line">        urls.put(<span class="string">"git"</span>, DUBBO_SPRING_BOOT_GIT_URL);</span><br /><br /><span class="line">        metaData.put(<span class="string">"versions"</span>, versions);</span><br /><span class="line">        metaData.put(<span class="string">"urls"</span>, urls);</span><br /><span class="line">        <span class="keyword">return</span> metaData;</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="5-8-DubboConfigsMetadataEndpoint">5.8 DubboConfigsMetadataEndpoint</h2>
<p><code>com.alibaba.boot.dubbo.actuate.endpoint.DubboConfigsMetadataEndpoint</code>&nbsp;ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾— æ‰€æœ‰çš„ Dubbo é…ç½®ç±»çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboConfigsMetadataEndpoint.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Dubbo Configs Metadata {<span class="doctag">@link</span> Endpoint}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Endpoint</span>(id = <span class="string">"dubboconfigs"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboConfigsMetadataEndpoint</span> <span class="keyword">extends</span> <span class="title">AbstractDubboEndpoint</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@ReadOperation</span></span><br /><span class="line">    <span class="keyword">public</span> Map&lt;String, Map&lt;String, Map&lt;String, Object&gt;&gt;&gt; configs() {</span><br /><span class="line">        <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">        <span class="comment">// KEYï¼šè·å¾—ç±»çš„ç®€ç§°ã€‚ä¾‹å¦‚ï¼šApplicationConfigã€ConsumerConfig</span></span><br /><span class="line">        <span class="comment">// KEY2ï¼šBean çš„åç§°</span></span><br /><span class="line">        <span class="comment">// VALUEï¼šBean çš„å…ƒæ•°æ®</span></span><br /><span class="line">        Map&lt;String, Map&lt;String, Map&lt;String, Object&gt;&gt;&gt; configsMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><br /><span class="line">        <span class="comment">// éå†æ¯ä¸ªé…ç½®ç±»ï¼Œæ·»åŠ å…¶çš„ Bean ä»¬ï¼Œåˆ° configsMap ä¸­</span></span><br /><span class="line">        addDubboConfigBeans(ApplicationConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(ConsumerConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(MethodConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(ModuleConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(MonitorConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(ProtocolConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(ProviderConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(ReferenceConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(RegistryConfig.class, configsMap);</span><br /><span class="line">        addDubboConfigBeans(ServiceConfig.class, configsMap);</span><br /><span class="line">        <span class="keyword">return</span> configsMap;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">addDubboConfigBeans</span><span class="params">(Class&lt;? extends AbstractConfig&gt; dubboConfigClass, Map&lt;String, Map&lt;String, Map&lt;String, Object&gt;&gt;&gt; configsMap)</span> </span>{</span><br /><span class="line">        <span class="comment">// è·å¾—æŒ‡å®šç±» dubboConfigClass çš„ Map</span></span><br /><span class="line">        Map&lt;String, ? extends AbstractConfig&gt; dubboConfigBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, dubboConfigClass);</span><br /><span class="line">        <span class="comment">// è·å¾—ç±»çš„ç®€ç§°ã€‚ä¾‹å¦‚ï¼šApplicationConfigã€ConsumerConfig</span></span><br /><span class="line">        String name = dubboConfigClass.getSimpleName();</span><br /><span class="line">        <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">        Map&lt;String, Map&lt;String, Object&gt;&gt; beansMetadata = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br /><span class="line">        <span class="comment">// éå† dubboConfigBeans æ•°ç»„</span></span><br /><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, ? extends AbstractConfig&gt; entry : dubboConfigBeans.entrySet()) {</span><br /><span class="line">            <span class="comment">// è·å¾— Bean çš„åå­—</span></span><br /><span class="line">            String beanName = entry.getKey();</span><br /><span class="line">            <span class="comment">// è·å¾— Bean çš„å…ƒæ•°æ®</span></span><br /><span class="line">            AbstractConfig configBean = entry.getValue();</span><br /><span class="line">            Map&lt;String, Object&gt; configBeanMeta = <span class="keyword">super</span>.resolveBeanMetadata(configBean);</span><br /><span class="line">            <span class="comment">// æ·»åŠ åˆ° beansMetadata ä¸­</span></span><br /><span class="line">            beansMetadata.put(beanName, configBeanMeta);</span><br /><span class="line">        }</span><br /><span class="line">        <span class="comment">// æ·»åŠ åˆ° configsMap ä¸­</span></span><br /><span class="line">        configsMap.put(name, beansMetadata);</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="5-7-DubboPropertiesEndpoint">5.7 DubboPropertiesEndpoint</h2>
<p><code>com.alibaba.boot.dubbo.actuate.endpoint.DubboPropertiesEndpoint</code>&nbsp;ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾— Dubbo Properties ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboPropertiesEndpoint.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Dubbo Properties {<span class="doctag">@link</span> Endpoint}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Endpoint</span>(id = <span class="string">"dubboproperties"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboPropertiesEndpoint</span> <span class="keyword">extends</span> <span class="title">AbstractDubboEndpoint</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@ReadOperation</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> SortedMap&lt;String, Object&gt; <span class="title">properties</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> DubboUtils.filterDubboProperties(environment);</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="5-8-DubboReferencesMetadataEndpoint">5.8 DubboReferencesMetadataEndpoint</h2>
<p><code>com.alibaba.boot.dubbo.actuate.endpoint.DubboReferencesMetadataEndpoint</code>&nbsp;ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾—æ‰€æœ‰çš„ Dubbo&nbsp;<code>@Reference</code>&nbsp;Bean çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboReferencesMetadataEndpoint.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Dubbo {<span class="doctag">@link</span> Reference} Metadata {<span class="doctag">@link</span> Endpoint}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Endpoint</span>(id = <span class="string">"dubboreferences"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboReferencesMetadataEndpoint</span> <span class="keyword">extends</span> <span class="title">AbstractDubboEndpoint</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@ReadOperation</span></span><br /><span class="line">    <span class="keyword">public</span> Map&lt;String, Map&lt;String, Object&gt;&gt; references() {</span><br /><span class="line">        <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">        <span class="comment">// KEYï¼šBean çš„åå­—</span></span><br /><span class="line">        <span class="comment">// VALUEï¼šBean çš„å…ƒæ•°æ®</span></span><br /><span class="line">        Map&lt;String, Map&lt;String, Object&gt;&gt; referencesMetadata = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><br /><span class="line">        <span class="comment">// è·å¾— ReferenceAnnotationBeanPostProcessor Bean å¯¹è±¡</span></span><br /><span class="line">        ReferenceAnnotationBeanPostProcessor beanPostProcessor = <span class="keyword">super</span>.getReferenceAnnotationBeanPostProcessor();</span><br /><br /><span class="line">        <span class="comment">// injected Field ReferenceBean Cache</span></span><br /><span class="line">        referencesMetadata.putAll(buildReferencesMetadata(beanPostProcessor.getInjectedFieldReferenceBeanMap()));</span><br /><span class="line">        <span class="comment">// injected Method ReferenceBean Cache</span></span><br /><span class="line">        referencesMetadata.putAll(buildReferencesMetadata(beanPostProcessor.getInjectedMethodReferenceBeanMap()));</span><br /><span class="line">        <span class="keyword">return</span> referencesMetadata;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="keyword">private</span> Map&lt;String, Map&lt;String, Object&gt;&gt; buildReferencesMetadata(Map&lt;InjectionMetadata.InjectedElement, ReferenceBean&lt;?&gt;&gt; injectedElementReferenceBeanMap) {</span><br /><span class="line">        <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">        <span class="comment">// KEYï¼šBean çš„åå­—</span></span><br /><span class="line">        <span class="comment">// VALUEï¼šBean çš„å…ƒæ•°æ®</span></span><br /><span class="line">        Map&lt;String, Map&lt;String, Object&gt;&gt; referencesMetadata = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><span class="line">        <span class="comment">// éå† injectedElementReferenceBeanMap å…ƒç´ </span></span><br /><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;InjectionMetadata.InjectedElement, ReferenceBean&lt;?&gt;&gt; entry : injectedElementReferenceBeanMap.entrySet()) {</span><br /><span class="line">            InjectionMetadata.InjectedElement injectedElement = entry.getKey();</span><br /><span class="line">            <span class="comment">// è·å¾— ReferenceBean å¯¹è±¡</span></span><br /><span class="line">            ReferenceBean&lt;?&gt; referenceBean = entry.getValue();</span><br /><span class="line">            <span class="comment">// è·å¾— Bean å…ƒæ•°æ®</span></span><br /><span class="line">            Map&lt;String, Object&gt; beanMetadata = <span class="keyword">super</span>.resolveBeanMetadata(referenceBean);</span><br /><span class="line">            <span class="comment">// è·å¾— invoker å±æ€§</span></span><br /><span class="line">            beanMetadata.put(<span class="string">"invoker"</span>, <span class="keyword">super</span>.resolveBeanMetadata(referenceBean.get()));</span><br /><span class="line">            <span class="comment">// æ·»åŠ åˆ° referencesMetadata ä¸­</span></span><br /><span class="line">            referencesMetadata.put(String.valueOf(injectedElement.getMember()), beanMetadata);</span><br /><span class="line">        }</span><br /><span class="line">        <span class="keyword">return</span> referencesMetadata;</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="5-9-DubboServicesMetadataEndpoint">5.9 DubboServicesMetadataEndpoint</h2>
<p><code>com.alibaba.boot.dubbo.actuate.endpoint.DubboServicesMetadataEndpoint</code>&nbsp;ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾—æ‰€æœ‰çš„ Dubbo&nbsp;<code>@Service</code>&nbsp;Bean çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboServicesMetadataEndpoint.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Dubbo {<span class="doctag">@link</span> Service} Metadata {<span class="doctag">@link</span> Endpoint}</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Endpoint</span>(id = <span class="string">"dubboservices"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboServicesMetadataEndpoint</span> <span class="keyword">extends</span> <span class="title">AbstractDubboEndpoint</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@ReadOperation</span></span><br /><span class="line">    <span class="keyword">public</span> Map&lt;String, Map&lt;String, Object&gt;&gt; services() {</span><br /><span class="line">        <span class="comment">// è·å¾—æ‰€æœ‰çš„ ServiceBean</span></span><br /><span class="line">        Map&lt;String, ServiceBean&gt; serviceBeansMap = <span class="keyword">super</span>.getServiceBeansMap();</span><br /><span class="line">        <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">        <span class="comment">// KEYï¼šBean çš„åå­—</span></span><br /><span class="line">        <span class="comment">// VALUEï¼šBean çš„å…ƒæ•°æ®</span></span><br /><span class="line">        Map&lt;String, Map&lt;String, Object&gt;&gt; servicesMetadata = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(serviceBeansMap.size());</span><br /><br /><span class="line">        <span class="comment">// éå† serviceBeansMap å…ƒç´ </span></span><br /><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, ServiceBean&gt; entry : serviceBeansMap.entrySet()) {</span><br /><span class="line">            <span class="comment">// è·å¾— Bean çš„åå­—</span></span><br /><span class="line">            String serviceBeanName = entry.getKey();</span><br /><span class="line">            <span class="comment">// è·å¾— ServiceBean å¯¹è±¡</span></span><br /><span class="line">            ServiceBean serviceBean = entry.getValue();</span><br /><span class="line">            <span class="comment">// è·å¾— Bean çš„å…ƒæ•°æ®</span></span><br /><span class="line">            Map&lt;String, Object&gt; serviceBeanMetadata = <span class="keyword">super</span>.resolveBeanMetadata(serviceBean);</span><br /><span class="line">            <span class="comment">// è·å¾— Service å¯¹è±¡ã€‚è‹¥è·å¾—åˆ°ï¼Œåˆ™æ·»åŠ åˆ° serviceBeanMetadata ä¸­</span></span><br /><span class="line">            Object service = resolveServiceBean(serviceBeanName, serviceBean);</span><br /><span class="line">            <span class="keyword">if</span> (service != <span class="keyword">null</span>) {</span><br /><span class="line">                <span class="comment">// Add Service implementation class</span></span><br /><span class="line">                serviceBeanMetadata.put(<span class="string">"serviceClass"</span>, service.getClass().getName());</span><br /><span class="line">            }</span><br /><span class="line">            <span class="comment">// æ·»åŠ åˆ° servicesMetadata ä¸­</span></span><br /><span class="line">            servicesMetadata.put(serviceBeanName, serviceBeanMetadata);</span><br /><span class="line">        }</span><br /><span class="line">        <span class="keyword">return</span> servicesMetadata;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">resolveServiceBean</span><span class="params">(String serviceBeanName, ServiceBean serviceBean)</span> </span>{</span><br /><span class="line">        <span class="keyword">int</span> index = serviceBeanName.indexOf(<span class="string">"#"</span>);</span><br /><span class="line">        <span class="keyword">if</span> (index &gt; -<span class="number">1</span>) {</span><br /><span class="line">            Class&lt;?&gt; interfaceClass = serviceBean.getInterfaceClass();</span><br /><span class="line">            String serviceName = serviceBeanName.substring(index + <span class="number">1</span>);</span><br /><span class="line">            <span class="keyword">if</span> (applicationContext.containsBean(serviceName)) {</span><br /><span class="line">                <span class="keyword">return</span> applicationContext.getBean(serviceName, interfaceClass);</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="5-10-DubboShutdownEndpoint">5.10 DubboShutdownEndpoint</h2>
<p><code>com.alibaba.boot.dubbo.actuate.endpoint.DubboShutdownEndpoint</code>&nbsp;ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œå…³é—­ Dubbo ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// DubboShutdownEndpoint.java</span></span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Dubbo Shutdown</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Endpoint</span>(id = <span class="string">"dubboshutdown"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DubboShutdownEndpoint</span> <span class="keyword">extends</span> <span class="title">AbstractDubboEndpoint</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@WriteOperation</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">shutdown</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>{</span><br /><span class="line">        <span class="comment">// åˆ›å»º Map</span></span><br /><span class="line">        Map&lt;String, Object&gt; shutdownCountData = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br /><br /><span class="line">        <span class="comment">// registries</span></span><br /><span class="line">        <span class="comment">// è·å¾—æ³¨å†Œçš„æ•°é‡</span></span><br /><span class="line">        <span class="keyword">int</span> registriesCount = AbstractRegistryFactory.getRegistries().size();</span><br /><span class="line">        <span class="comment">// protocols</span></span><br /><span class="line">        <span class="comment">// è·å¾— Protocol çš„æ•°é‡</span></span><br /><span class="line">        <span class="keyword">int</span> protocolsCount = <span class="keyword">super</span>.getProtocolConfigsBeanMap().size();</span><br /><span class="line">        <span class="comment">// é”€æ¯ ProtocolConfig</span></span><br /><span class="line">        ProtocolConfig.destroyAll();</span><br /><span class="line">        <span class="comment">// æ·»åŠ åˆ° shutdownCountData ä¸­</span></span><br /><span class="line">        shutdownCountData.put(<span class="string">"registries"</span>, registriesCount);</span><br /><span class="line">        shutdownCountData.put(<span class="string">"protocols"</span>, protocolsCount);</span><br /><br /><span class="line">        <span class="comment">// Service Beans</span></span><br /><span class="line">        <span class="comment">// è·å¾—æ‰€æœ‰ ServiceBean ï¼Œç„¶åé€ä¸ªé”€æ¯</span></span><br /><span class="line">        Map&lt;String, ServiceBean&gt; serviceBeansMap = <span class="keyword">super</span>.getServiceBeansMap();</span><br /><span class="line">        <span class="keyword">if</span> (!serviceBeansMap.isEmpty()) {</span><br /><span class="line">            <span class="keyword">for</span> (ServiceBean serviceBean : serviceBeansMap.values()) {</span><br /><span class="line">                serviceBean.destroy();</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">        <span class="comment">// æ·»åŠ åˆ° shutdownCountData ä¸­</span></span><br /><span class="line">        shutdownCountData.put(<span class="string">"services"</span>, serviceBeansMap.size());</span><br /><br /><span class="line">        <span class="comment">// Reference Beans</span></span><br /><span class="line">        <span class="comment">// è·å¾— ReferenceAnnotationBeanPostProcessor å¯¹è±¡</span></span><br /><span class="line">        ReferenceAnnotationBeanPostProcessor beanPostProcessor = <span class="keyword">super</span>.getReferenceAnnotationBeanPostProcessor();</span><br /><span class="line">        <span class="comment">// è·å¾— Reference Bean çš„æ•°é‡</span></span><br /><span class="line">        <span class="keyword">int</span> referencesCount = beanPostProcessor.getReferenceBeans().size();</span><br /><span class="line">        <span class="comment">// é”€æ¯æ‰€æœ‰ Reference Bean</span></span><br /><span class="line">        beanPostProcessor.destroy();</span><br /><span class="line">        <span class="comment">// æ·»åŠ åˆ° shutdownCountData ä¸­</span></span><br /><span class="line">        shutdownCountData.put(<span class="string">"references"</span>, referencesCount);</span><br /><br /><span class="line">        <span class="comment">// Set Result to complete</span></span><br /><span class="line">        Map&lt;String, Object&gt; shutdownData = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br /><span class="line">        shutdownData.put(<span class="string">"shutdown.count"</span>, shutdownCountData);</span><br /><span class="line">        <span class="keyword">return</span> shutdownData;</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>é€šè¿‡è°ƒç”¨è¯¥æ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿œç¨‹å…³é—­ Dubbo æœåŠ¡ã€‚</li>
</ul>
</div>