<header class="article-header">
<h1 class="article-title">XML é…ç½®</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<blockquote>
<p>å‹æƒ…æç¤ºï¼Œã€<strong>é…ç½®</strong>ã€‘è¿™å—çš„å†…å®¹ï¼Œä¼šç›¸å¯¹æ¯”è¾ƒæ¯ç‡¥ã€‚æ‰€ä»¥ï¼Œå¦‚æœçœ‹åˆ°ä¸€äº›å¾ˆéš¾æ‡‚çš„åœ°æ–¹ï¼Œå»ºè®®å…ˆè·³è¿‡ã€‚</p>
<p>å¯¹äº Dubbo ï¼Œé‡ç‚¹æ˜¯è¦å»ç†è§£ï¼Œå¤šåè®®ã€RPCã€å®¹é”™ç­‰ç­‰æ¨¡å—ï¼Œè€Œä¸æ˜¯ã€<strong>é…ç½®</strong>ã€‘ã€‚</p>
<p>ğŸ˜ˆ ä¼°è®¡å¥½å¤šèƒ–å‹è¢«ã€<strong>é…ç½®</strong>ã€‘è¿™ç« åŠé€€äº†æŠŠï¼Ÿï¼Ÿï¼Ÿ</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>åœ¨ Dubbo æä¾›çš„å‡ ç§æ–¹å¼ä¸­ï¼Œ<strong>XML é…ç½®</strong>è‚¯å®šæ˜¯å¤§å®¶æœ€ç†Ÿæ‚‰çš„æ–¹å¼ã€‚</p>
<p>å¦‚æœèƒ–å‹ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥æŸ¥çœ‹å¦‚ä¸‹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="http://dubbo.apache.org/zh-cn/docs/user/configuration/xml.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; XML é…ç½®ã€‹</a></li>
<li><a href="http://dubbo.apache.org/zh-cn/docs/user/references/xml/introduction.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; schema é…ç½®å‚è€ƒæ‰‹å†Œã€‹</a></li>
</ul>
<p>XML é…ç½®ï¼Œè‡ªå®šä¹‰&nbsp;<code>&lt;dubbo: /&gt;</code>&nbsp;æ ‡ç­¾ï¼ŒåŸºäº&nbsp;<strong>Spring XML</strong>&nbsp;è¿›è¡Œè§£æã€‚å¦‚æœä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥æŸ¥çœ‹å¦‚ä¸‹æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://gavinzhang1.gitbooks.io/spring/content/xmlwen_jian_mo_ren_biao_qian_de_jie_xi.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠSpring æºç é˜…è¯» &mdash;&mdash; XML æ–‡ä»¶é»˜è®¤æ ‡ç­¾çš„è§£æã€‹</a></li>
<li><a href="https://gavinzhang1.gitbooks.io/spring/content/xmlzi_ding_yi_biao_qian_de_jie_xi.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠSpring æºç é˜…è¯» &mdash;&mdash; XML è‡ªå®šä¹‰æ ‡ç­¾çš„è§£æã€‹</a></li>
</ul>
<h1 id="2-å®šä¹‰">2. å®šä¹‰</h1>
<h2 id="2-1-sprng-schemas">2.1 sprng.schemas</h2>
<p>Dubbo åœ¨&nbsp;<code>dubbo-spring-config</code>&nbsp;çš„&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/05dd4fe091e37d08e01d4e243e3fc24dbfdc61ff/dubbo-config/dubbo-config-spring/src/main/resources/META-INF/spring.schemas" target="_blank" rel="external nofollow noopener noreferrer"><code>META-INF/spring.schemas</code></a>&nbsp;å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">http\://code.alibabatech.com/schema/dubbo/dubbo.xsd=META-INF/dubbo.xsd</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>xmlns</code>&nbsp;ä¸º&nbsp;<code>http://code.alibabatech.com/schema/dubbo</code></li>
<li><code>xsd</code>&nbsp;ä¸º&nbsp;<code>META-INF/dubbo.xsd</code></li>
</ul>
<h2 id="2-2-dubbo-xsd">2.2 dubbo.xsd</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/05dd4fe091e37d08e01d4e243e3fc24dbfdc61ff/dubbo-config/dubbo-config-spring/src/main/resources/META-INF/dubbo.xsd" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo.xsd</code></a>&nbsp;å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_01_19/01.png" alt="dubbo.xsd" /></p>
<ul>
<li><code>&lt;xsd:element name="" /&gt;</code>&nbsp;ï¼Œå®šä¹‰äº†<strong>å…ƒç´ çš„åç§°</strong>ã€‚ä¾‹å¦‚ï¼Œ<code>&lt;xsd:element name="application" /&gt;</code>&nbsp;å¯¹åº”&nbsp;<code>&lt;dubbo:application /&gt;</code>&nbsp;ã€‚</li>
<li><code>&lt;xsd:element type="" /&gt;</code>&nbsp;ï¼Œå®šä¹‰äº†<strong>å†…å»ºæ•°æ®ç±»å‹çš„åç§°</strong>ã€‚ä¾‹å¦‚ï¼Œ<code>&lt;xsd:element type="applicationType" /&gt;</code>&nbsp;å¯¹åº”&nbsp;<code>&lt;xsd:complexType name="applicationType" /&gt;</code>&nbsp;ã€‚</li>
<li><code>&lt;xsd:complexType name=""&gt;</code>&nbsp;ï¼Œå®šä¹‰äº†<strong>å¤æ‚ç±»å‹</strong>ã€‚ä¾‹å¦‚&nbsp;<code>&lt;xsd:complexType name="applicationType" /&gt;</code>&nbsp;å¦‚ä¸‹ï¼š</li>
</ul>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_01_19/02.png" alt="applicationType" /></p>
<h2 id="2-3-spring-handlers">2.3 spring.handlers</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/05dd4fe091e37d08e01d4e243e3fc24dbfdc61ff/dubbo-config/dubbo-config-spring/src/main/resources/META-INF/spring.handlers" target="_blank" rel="external nofollow noopener noreferrer"><code>spring.handlers</code></a>&nbsp;å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">http\://code.alibabatech.com/schema/dubbo=com.alibaba.dubbo.config.spring.schema.DubboNamespaceHandler</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å®šä¹‰äº† Dubbo çš„ XML Namespace çš„å¤„ç†å™¨ DubboNamespaceHandler ã€‚</li>
</ul>
<h2 id="2-4-DubboNamespaceHandler">2.4 DubboNamespaceHandler</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/025ac8b49c7608b0a76ea7bd8c2de6c72138b5ef/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboNamespaceHandler.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.config.spring.schema.DubboNamespaceHandler</code></a>&nbsp;ï¼Œå®ç°&nbsp;<code>org.springframework.beans.factory.xml.NamespaceHandlerSupport</code>&nbsp;<strong>æŠ½è±¡ç±»</strong>ï¼ŒDubbo çš„ XML Namespace çš„å¤„ç†å™¨ã€‚</p>
<p>åœ¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/6cd9a5b53ca8f86de7eac4e978c1f2d13c439845/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboNamespaceHandler.java#L36-L49" target="_blank" rel="external nofollow noopener noreferrer"><code>#init()</code></a>&nbsp;æ–¹æ³•ï¼Œå®šä¹‰äº†æ¯ä¸ª&nbsp;<code>&lt;xsd:element /&gt;</code>&nbsp;å¯¹åº”çš„&nbsp;<code>org.springframework.beans.factory.xml.BeanDefinitionParser</code>&nbsp;ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>{</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"application"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ApplicationConfig.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"module"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ModuleConfig.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"registry"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(RegistryConfig.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"monitor"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(MonitorConfig.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"provider"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ProviderConfig.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"consumer"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ConsumerConfig.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"protocol"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ProtocolConfig.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"service"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ServiceBean.class, <span class="keyword">true</span>));</span><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"reference"</span>, <span class="keyword">new</span> DubboBeanDefinitionParser(ReferenceBean.class, <span class="keyword">false</span>));</span><br /><br /><span class="line">    registerBeanDefinitionParser(<span class="string">"annotation"</span>, <span class="keyword">new</span> AnnotationBeanDefinitionParser()); <span class="comment">// åºŸå¼ƒ</span></span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç»†å¿ƒçš„èƒ–å‹ï¼Œä¼šçœ‹åˆ°&nbsp;<code>service</code>&nbsp;æ ‡ç­¾ä½¿ç”¨çš„æ˜¯ ServiceBean ï¼Œè€Œä¸æ˜¯ ServiceConfig ï¼Œ<code>reference</code>&nbsp;è¡¨ç¤ºç”¨çš„æ˜¯ ReferenceBean ï¼Œå› ä¸ºæ— è®ºæ˜¯ ServiceConfig è¿˜æ˜¯ ReferenceBean ï¼Œåœ¨è§£æå®Œå…·ä½“é…ç½®åï¼Œéœ€è¦è°ƒç”¨å®ƒä»¬å¯¹åº”çš„æ–¹æ³•è¿›è¡Œ<strong>åˆå§‹åŒ–</strong>ã€‚ğŸ™‚ è€ƒè™‘åˆ°ç¯‡å¹…ï¼Œæˆ‘ä»¬åœ¨åç»­æ–‡ç« åˆ†äº«ã€‚è¿™ç¯‡æˆ‘ä»¬é‡ç‚¹æ”¾åœ¨<strong>è§£æ</strong>ã€‚</li>
</ul>
<h1 id="3-è§£æ">3. è§£æ</h1>
<p><a href="http://svip.iocoder.cn/Dubbo/configuration-xml/DubboBeanDefinitionParser"><code>com.alibaba.dubbo.config.spring.schema.DubboBeanDefinitionParser</code></a>&nbsp;ï¼Œå®ç°&nbsp;<code>org.springframework.beans.factory.xml.BeanDefinitionParser</code>&nbsp;<strong>æ¥å£</strong>ï¼ŒDubbo Bean å®šä¹‰è§£æå™¨ã€‚</p>
<h2 id="3-1-æ„é€ æ–¹æ³•">3.1 æ„é€ æ–¹æ³•</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L62-L74" target="_blank" rel="external nofollow noopener noreferrer">æ„é€ æ–¹æ³•</a>&nbsp;ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Bean å¯¹è±¡çš„ç±»</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; beanClass;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æ˜¯å¦éœ€è¦ Bean çš„ `id` å±æ€§</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> required;</span><br /><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">DubboBeanDefinitionParser</span><span class="params">(Class&lt;?&gt; beanClass, <span class="keyword">boolean</span> required)</span> </span>{</span><br /><span class="line">    <span class="keyword">this</span>.beanClass = beanClass;</span><br /><span class="line">    <span class="keyword">this</span>.required = required;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>beanClass</code>&nbsp;ï¼ŒBean å¯¹è±¡çš„<strong>ç±»</strong>ã€‚</li>
<li><code>required</code>&nbsp;ï¼Œæ˜¯å¦éœ€è¦åœ¨ Bean å¯¹è±¡çš„ç¼–å·(&nbsp;<code>id</code>&nbsp;) ä¸å­˜åœ¨æ—¶ï¼Œ<strong>è‡ªåŠ¨ç”Ÿæˆç¼–å·</strong>ã€‚æ— éœ€è¢«å…¶ä»–åº”ç”¨å¼•ç”¨çš„é…ç½®å¯¹è±¡ï¼Œæ— éœ€è‡ªåŠ¨ç”Ÿæˆç¼–å·ã€‚ä¾‹å¦‚æœ‰&nbsp;<code>&lt;dubbo:reference /&gt;</code>&nbsp;ã€‚</li>
</ul>
<h2 id="3-2-è§£ææ–¹æ³•ã€ä¸»æµç¨‹ã€‘">3.2 è§£ææ–¹æ³•ã€ä¸»æµç¨‹ã€‘</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L516-L518" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ XML å…ƒç´ ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">public</span> BeanDefinition <span class="title">parse</span><span class="params">(Element element, ParserContext parserContext)</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> parse(element, parserContext, beanClass, required);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>è°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L76-L292" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;æ–¹æ³•ï¼Œ<strong>çœŸæ­£</strong>è§£æ XML å…ƒç´ ã€‚è¯¥æ–¹æ³•ååˆ†å†—é•¿ï¼Œè¿‘ 200+ è¡Œã€‚å¦å¤–ç®—ä¸Šå†…éƒ¨ä¼šè°ƒç”¨å…¶ä»–æ–¹æ³•ï¼Œæ•´ä½“ 500+ è¡Œå·¦å³ã€‚ğŸ™‚ ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥å°†æ–¹æ³•åˆ‡æ¢ç†è§£ã€‚</li>
</ul>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå»ºè®®èƒ–å‹ï¼Œèƒ½å¤Ÿè¾¹çœ‹è¾¹è°ƒè¯•ã€‚</p>
</blockquote>
<h3 id="3-2-1-åˆ›å»º-RootBeanDefinition">3.2.1 åˆ›å»º RootBeanDefinition</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L76-L292" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 78 è‡³ 80 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">RootBeanDefinition beanDefinition = <span class="keyword">new</span> RootBeanDefinition();</span><br /><span class="line">beanDefinition.setBeanClass(beanClass);</span><br /><span class="line">beanDefinition.setLazyInit(<span class="keyword">false</span>);</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p>é»˜è®¤&nbsp;<code>lazyInit = false</code>&nbsp;ã€‚</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/configuration/xml.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; XML é…ç½®ã€‹</a><br />å¼•ç”¨ç¼ºçœæ˜¯å»¶è¿Ÿåˆå§‹åŒ–çš„ï¼Œåªæœ‰å¼•ç”¨è¢«æ³¨å…¥åˆ°å…¶å®ƒ Beanï¼Œæˆ–è¢« getBean() è·å–ï¼Œæ‰ä¼šåˆå§‹åŒ–ã€‚å¦‚æœéœ€è¦é¥¥é¥¿åŠ è½½ï¼Œå³æ²¡æœ‰äººå¼•ç”¨ä¹Ÿç«‹å³ç”ŸæˆåŠ¨æ€ä»£ç†ï¼Œå¯ä»¥é…ç½®ï¼š<code>&lt;dubbo:reference ... init="true" /&gt;</code></p>
</blockquote>
</li>
</ul>
<h3 id="3-2-2-å¤„ç†-Bean-çš„ç¼–å·">3.2.2 å¤„ç† Bean çš„ç¼–å·</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L81-L111" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 81 è‡³ 111 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">81</span>: <span class="comment">// è§£æé…ç½®å¯¹è±¡çš„ id ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œç”Ÿæˆã€‚</span></span><br /><span class="line"> <span class="number">82</span>: String id = element.getAttribute(<span class="string">"id"</span>);</span><br /><span class="line"> <span class="number">83</span>: <span class="keyword">if</span> ((id == <span class="keyword">null</span> || id.length() == <span class="number">0</span>) &amp;&amp; required) {</span><br /><span class="line"> <span class="number">84</span>:     <span class="comment">// ç”Ÿæˆ id ã€‚ä¸åŒçš„é…ç½®å¯¹è±¡ï¼Œä¼šå­˜åœ¨ä¸åŒã€‚</span></span><br /><span class="line"> <span class="number">85</span>:     String generatedBeanName = element.getAttribute(<span class="string">"name"</span>);</span><br /><span class="line"> <span class="number">86</span>:     <span class="keyword">if</span> (generatedBeanName == <span class="keyword">null</span> || generatedBeanName.length() == <span class="number">0</span>) {</span><br /><span class="line"> <span class="number">87</span>:         <span class="keyword">if</span> (ProtocolConfig.class.equals(beanClass)) {</span><br /><span class="line"> <span class="number">88</span>:             generatedBeanName = <span class="string">"dubbo"</span>;</span><br /><span class="line"> <span class="number">89</span>:         } <span class="keyword">else</span> {</span><br /><span class="line"> <span class="number">90</span>:             generatedBeanName = element.getAttribute(<span class="string">"interface"</span>);</span><br /><span class="line"> <span class="number">91</span>:         }</span><br /><span class="line"> <span class="number">92</span>:     }</span><br /><span class="line"> <span class="number">93</span>:     <span class="keyword">if</span> (generatedBeanName == <span class="keyword">null</span> || generatedBeanName.length() == <span class="number">0</span>) {</span><br /><span class="line"> <span class="number">94</span>:         generatedBeanName = beanClass.getName();</span><br /><span class="line"> <span class="number">95</span>:     }</span><br /><span class="line"> <span class="number">96</span>:     id = generatedBeanName;</span><br /><span class="line"> <span class="number">97</span>:     <span class="comment">// è‹¥ id å·²å­˜åœ¨ï¼Œé€šè¿‡è‡ªå¢åºåˆ—ï¼Œè§£å†³é‡å¤ã€‚</span></span><br /><span class="line"> <span class="number">98</span>:     <span class="keyword">int</span> counter = <span class="number">2</span>;</span><br /><span class="line"> <span class="number">99</span>:     <span class="keyword">while</span> (parserContext.getRegistry().containsBeanDefinition(id)) {</span><br /><span class="line"><span class="number">100</span>:         id = generatedBeanName + (counter++);</span><br /><span class="line"><span class="number">101</span>:     }</span><br /><span class="line"><span class="number">102</span>: }</span><br /><span class="line"><span class="number">103</span>: <span class="keyword">if</span> (id != <span class="keyword">null</span> &amp;&amp; id.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">104</span>:     <span class="keyword">if</span> (parserContext.getRegistry().containsBeanDefinition(id)) {</span><br /><span class="line"><span class="number">105</span>:         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Duplicate spring bean id "</span> + id);</span><br /><span class="line"><span class="number">106</span>:     }</span><br /><span class="line"><span class="number">107</span>:     <span class="comment">// æ·»åŠ åˆ° Spring çš„æ³¨å†Œè¡¨</span></span><br /><span class="line"><span class="number">108</span>:     parserContext.getRegistry().registerBeanDefinition(id, beanDefinition);</span><br /><span class="line"><span class="number">109</span>:     <span class="comment">// è®¾ç½® Bean çš„ `id` å±æ€§å€¼</span></span><br /><span class="line"><span class="number">110</span>:     beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"id"</span>, id);</span><br /><span class="line"><span class="number">111</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 82 è‡³ 102 è¡Œï¼šè§£æ Bean çš„&nbsp;<code>id</code>&nbsp;ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨è¿›è¡Œç”Ÿæˆã€‚
<ul>
<li>ç¬¬ 85 è‡³ 96 è¡Œï¼šç”Ÿæˆ&nbsp;<code>id</code>&nbsp;ã€‚è§„åˆ™ä¸º&nbsp;<code>name</code>&nbsp;&gt; ç‰¹æ®Šè§„åˆ™ &gt;&nbsp;<code>className</code>&nbsp;ã€‚</li>
<li>ç¬¬ 97 è‡³ 101 è¡Œï¼šè‹¥&nbsp;<code>id</code>&nbsp;åœ¨ Spring æ³¨å†Œè¡¨å·²ç»å­˜åœ¨ï¼Œé€šè¿‡æ·»åŠ <strong>è‡ªå¢åºåˆ—</strong>ä½œä¸ºåç¼€ï¼Œé¿å…å†²çªã€‚</li>
</ul>
</li>
<li>ç¬¬ 108 è¡Œï¼šæ·»åŠ  Bean åˆ° Spring æ³¨å†Œè¡¨ã€‚</li>
<li>ç¬¬ 110 è¡Œï¼šè®¾ç½® Bean çš„&nbsp;<code>id</code>&nbsp;ã€‚</li>
</ul>
<h3 id="3-2-3-å¤„ç†-lt-dubbo-protocol-gt-ç‰¹æ®Šæƒ…å†µ">3.2.3 å¤„ç†&nbsp;<code>&lt;dubbo:protocol/&gt;</code>&nbsp;ç‰¹æ®Šæƒ…å†µ</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L113-L128" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 113 è‡³ 128 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="number">113</span>: <span class="comment">// å¤„ç† `&lt;dubbo:protocol` /&gt; çš„ç‰¹æ®Šæƒ…å†µ</span></span><br /><span class="line"><span class="number">114</span>: <span class="keyword">if</span> (ProtocolConfig.class.equals(beanClass)) {</span><br /><span class="line"><span class="number">115</span>:     <span class="comment">// éœ€è¦æ»¡è¶³ç¬¬ 220 è‡³ 233 è¡Œã€‚</span></span><br /><span class="line"><span class="number">116</span>:     <span class="comment">// ä¾‹å¦‚ï¼šã€é¡ºåºè¦è¿™æ ·ã€‘</span></span><br /><span class="line"><span class="number">117</span>:     <span class="comment">// &lt;dubbo:service interface="com.alibaba.dubbo.demo.DemoService" protocol="dubbo" ref="demoService"/&gt;</span></span><br /><span class="line"><span class="number">118</span>:     <span class="comment">// &lt;dubbo:protocol id="dubbo" name="dubbo" port="20880"/&gt;</span></span><br /><span class="line"><span class="number">119</span>:     <span class="keyword">for</span> (String name : parserContext.getRegistry().getBeanDefinitionNames()) {</span><br /><span class="line"><span class="number">120</span>:         BeanDefinition definition = parserContext.getRegistry().getBeanDefinition(name);</span><br /><span class="line"><span class="number">121</span>:         PropertyValue property = definition.getPropertyValues().getPropertyValue(<span class="string">"protocol"</span>);</span><br /><span class="line"><span class="number">122</span>:         <span class="keyword">if</span> (property != <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">123</span>:             Object value = property.getValue();</span><br /><span class="line"><span class="number">124</span>:             <span class="keyword">if</span> (value <span class="keyword">instanceof</span> ProtocolConfig &amp;&amp; id.equals(((ProtocolConfig) value).getName())) {</span><br /><span class="line"><span class="number">125</span>:                 definition.getPropertyValues().addPropertyValue(<span class="string">"protocol"</span>, <span class="keyword">new</span> RuntimeBeanReference(id));</span><br /><span class="line"><span class="number">126</span>:             }</span><br /><span class="line"><span class="number">127</span>:         }</span><br /><span class="line"><span class="number">128</span>:     }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.2.7 å¾ªç¯ Bean å¯¹è±¡çš„ setting æ–¹æ³•ï¼Œå°†å±æ€§èµ‹å€¼åˆ° Bean å¯¹è±¡ã€</a>&nbsp;ç»Ÿä¸€è§£æã€‚</p>
<h3 id="3-2-4-å¤„ç†-lt-dubbo-service-gt-çš„-class-å±æ€§">3.2.4 å¤„ç†&nbsp;<code>&lt;dubbo:service /&gt;</code>&nbsp;çš„&nbsp;<code>class</code>&nbsp;å±æ€§</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L129-L142" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 129 è‡³ 142 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="number">113</span>: <span class="comment">// å¤„ç† `&lt;dubbo:service /&gt;` çš„å±æ€§ `class`</span></span><br /><span class="line"><span class="number">114</span>: } <span class="keyword">else</span> <span class="keyword">if</span> (ServiceBean.class.equals(beanClass)) {</span><br /><span class="line"><span class="number">115</span>:     <span class="comment">// å¤„ç† `class` å±æ€§ã€‚ä¾‹å¦‚  &lt;dubbo:service id="sa" interface="com.alibaba.dubbo.demo.DemoService" class="com.alibaba.dubbo.demo.provider.DemoServiceImpl" &gt;</span></span><br /><span class="line"><span class="number">116</span>:     String className = element.getAttribute(<span class="string">"class"</span>);</span><br /><span class="line"><span class="number">117</span>:     <span class="keyword">if</span> (className != <span class="keyword">null</span> &amp;&amp; className.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">118</span>:         <span class="comment">// åˆ›å»º Service çš„ RootBeanDefinition å¯¹è±¡ã€‚ç›¸å½“äºå†…åµŒäº† &lt;bean class="com.alibaba.dubbo.demo.provider.DemoServiceImpl" /&gt;</span></span><br /><span class="line"><span class="number">119</span>:         RootBeanDefinition classDefinition = <span class="keyword">new</span> RootBeanDefinition();</span><br /><span class="line"><span class="number">120</span>:         classDefinition.setBeanClass(ReflectUtils.forName(className));</span><br /><span class="line"><span class="number">121</span>:         classDefinition.setLazyInit(<span class="keyword">false</span>);</span><br /><span class="line"><span class="number">122</span>:         <span class="comment">// è§£æ Service Bean å¯¹è±¡çš„å±æ€§</span></span><br /><span class="line"><span class="number">123</span>:         parseProperties(element.getChildNodes(), classDefinition);</span><br /><span class="line"><span class="number">124</span>:         <span class="comment">// è®¾ç½® `&lt;dubbo:service ref="" /&gt;` å±æ€§</span></span><br /><span class="line"><span class="number">125</span>:         beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"ref"</span>, <span class="keyword">new</span> BeanDefinitionHolder(classDefinition, id + <span class="string">"Impl"</span>));</span><br /><span class="line"><span class="number">126</span>:     }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p>å¤„ç†&nbsp;<code>&lt;dubbo:service class="" /&gt;</code>&nbsp;åœºæ™¯ä¸‹çš„å¤„ç†ï¼Œ<strong>å¤§å¤šæ•°</strong>æƒ…å†µä¸‹æˆ‘ä»¬ä¸è¿™ä¹ˆä½¿ç”¨ï¼ŒåŒ…æ‹¬å®˜æ–¹æ–‡æ¡£ä¹Ÿæ²¡æä¾›è¿™ç§æ–¹å¼çš„è¯´æ˜ã€‚å½“é…ç½®&nbsp;<code>class</code>&nbsp;å±æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»º Service Bean å¯¹è±¡ï¼Œè€Œæ— éœ€å†é…ç½®&nbsp;<code>ref</code>&nbsp;å±æ€§ï¼ŒæŒ‡å‘ Service Bean å¯¹è±¡ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"demoDAO"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.dubbo.demo.provider.DemoDAO"</span> /&gt;</span></span><br /><br /><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">id</span>=<span class="string">"sa"</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.dubbo.demo.DemoService"</span>  <span class="attr">class</span>=<span class="string">"com.alibaba.dubbo.demo.provider.DemoServiceImpl"</span>&gt;</span></span><br /><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"demoDAO"</span> <span class="attr">ref</span>=<span class="string">"demoDAO"</span> /&gt;</span></span><br /><span class="line"><span class="tag">&lt;/<span class="name">dubbo:service</span>&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ä½¿ç”¨&nbsp;<code>&lt;property /&gt;</code>&nbsp;æ ‡ç­¾ï¼Œè®¾ç½® Service Bean çš„å±æ€§ã€‚</li>
</ul>
</li>
<li>
<p>ç¬¬ 118 è‡³ 121 è¡Œï¼šåˆ›å»º Service çš„ Bean å¯¹è±¡ã€‚</p>
</li>
<li>ç¬¬ 123 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L368-L399" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseProperties(NodeList, RootBeanDefinition)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ Service Bean å¯¹è±¡çš„å±æ€§ä»¬ã€‚è¯¦ç»†è§£æè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.3.1 parsePropertiesã€</a>&nbsp;æ–¹æ³•ã€‚</li>
</ul>
<h3 id="3-2-5-è§£æ-lt-dubbo-provider-gt-çš„å†…åµŒå­å…ƒç´ -lt-dubbo-service-gt">3.2.5 è§£æ&nbsp;<code>&lt;dubbo:provider /&gt;</code>&nbsp;çš„å†…åµŒå­å…ƒç´ &nbsp;<code>&lt;dubbo:service /&gt;</code></h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L143-L145" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 143 è‡³ 145 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// è§£æ `&lt;dubbo:provider /&gt;` çš„å†…åµŒå­å…ƒç´  `&lt;dubbo:service /&gt;`</span></span><br /><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (ProviderConfig.class.equals(beanClass)) {</span><br /><span class="line">    parseNested(element, parserContext, ServiceBean.class, <span class="keyword">true</span>, <span class="string">"service"</span>, <span class="string">"provider"</span>, id, beanDefinition);</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>è°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L326-L366" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseNested(...)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æå†…åµŒçš„æŒ‡å‘çš„å­ XML å…ƒç´ ã€‚è¯¦ç»†è§£æè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.3.2 parseNestedã€</a>&nbsp;æ–¹æ³•ã€‚</li>
</ul>
<h3 id="3-2-6-è§£æ-lt-dubbo-consumer-gt-çš„å†…åµŒå­å…ƒç´ -lt-dubbo-reference-gt">3.2.6 è§£æ&nbsp;<code>&lt;dubbo:consumer /&gt;</code>&nbsp;çš„å†…åµŒå­å…ƒç´ &nbsp;<code>&lt;dubbo:reference /&gt;</code></h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L146-L149" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 146 è‡³ 149 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// è§£æ `&lt;dubbo:consumer /&gt;` çš„å†…åµŒå­å…ƒç´  `&lt;dubbo:reference /&gt;`</span></span><br /><span class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (ConsumerConfig.class.equals(beanClass)) {</span><br /><span class="line">    parseNested(element, parserContext, ReferenceBean.class, <span class="keyword">false</span>, <span class="string">"reference"</span>, <span class="string">"consumer"</span>, id, beanDefinition);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>è°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L326-L366" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseNested(...)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æå†…åµŒçš„æŒ‡å‘çš„å­ XML å…ƒç´ ã€‚</li>
</ul>
<h3 id="3-2-7-å¾ªç¯-Bean-å¯¹è±¡çš„-setting-æ–¹æ³•ï¼Œå°†å±æ€§èµ‹å€¼åˆ°-Bean-å¯¹è±¡">3.2.7 å¾ªç¯ Bean å¯¹è±¡çš„ setting æ–¹æ³•ï¼Œå°†å±æ€§èµ‹å€¼åˆ° Bean å¯¹è±¡</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L150-L273" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 150 è‡³ 273 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="number">150</span>: Set&lt;String&gt; props = <span class="keyword">new</span> HashSet&lt;String&gt;(); <span class="comment">// å·²è§£æçš„å±æ€§é›†åˆ</span></span><br /><span class="line"><span class="number">151</span>: ManagedMap parameters = <span class="keyword">null</span>; <span class="comment">//</span></span><br /><span class="line"><span class="number">152</span>: <span class="comment">// å¾ªç¯ Bean å¯¹è±¡çš„ setting æ–¹æ³•ï¼Œå°†å±æ€§æ·»åŠ åˆ° Bean å¯¹è±¡çš„å±æ€§èµ‹å€¼</span></span><br /><span class="line"><span class="number">153</span>: <span class="keyword">for</span> (Method setter : beanClass.getMethods()) {</span><br /><span class="line"><span class="number">154</span>:     String name = setter.getName();</span><br /><span class="line"><span class="number">155</span>:     <span class="keyword">if</span> (name.length() &gt; <span class="number">3</span> &amp;&amp; name.startsWith(<span class="string">"set"</span>)</span><br /><span class="line"><span class="number">156</span>:             &amp;&amp; Modifier.isPublic(setter.getModifiers())</span><br /><span class="line"><span class="number">157</span>:             &amp;&amp; setter.getParameterTypes().length == <span class="number">1</span>) { <span class="comment">// setting &amp;&amp; public &amp;&amp; å”¯ä¸€å‚æ•°</span></span><br /><span class="line"><span class="number">158</span>:         Class&lt;?&gt; type = setter.getParameterTypes()[<span class="number">0</span>];</span><br /><span class="line"><span class="number">159</span>:         <span class="comment">// æ·»åŠ  `props`</span></span><br /><span class="line"><span class="number">160</span>:         String property = StringUtils.camelToSplitName(name.substring(<span class="number">3</span>, <span class="number">4</span>).toLowerCase() + name.substring(<span class="number">4</span>), <span class="string">"-"</span>);</span><br /><span class="line"><span class="number">161</span>:         props.add(property);</span><br /><span class="line"><span class="number">162</span>:         <span class="comment">// getting &amp;&amp; public &amp;&amp; å±æ€§å€¼ç±»å‹ç»Ÿä¸€</span></span><br /><span class="line"><span class="number">163</span>:         Method getter = <span class="keyword">null</span>;</span><br /><span class="line"><span class="number">164</span>:         <span class="keyword">try</span> {</span><br /><span class="line"><span class="number">165</span>:             getter = beanClass.getMethod(<span class="string">"get"</span> + name.substring(<span class="number">3</span>), <span class="keyword">new</span> Class&lt;?&gt;[<span class="number">0</span>]);</span><br /><span class="line"><span class="number">166</span>:         } <span class="keyword">catch</span> (NoSuchMethodException e) {</span><br /><span class="line"><span class="number">167</span>:             <span class="keyword">try</span> {</span><br /><span class="line"><span class="number">168</span>:                 getter = beanClass.getMethod(<span class="string">"is"</span> + name.substring(<span class="number">3</span>), <span class="keyword">new</span> Class&lt;?&gt;[<span class="number">0</span>]);</span><br /><span class="line"><span class="number">169</span>:             } <span class="keyword">catch</span> (NoSuchMethodException e2) {</span><br /><span class="line"><span class="number">170</span>:             }</span><br /><span class="line"><span class="number">171</span>:         }</span><br /><span class="line"><span class="number">172</span>:         <span class="keyword">if</span> (getter == <span class="keyword">null</span></span><br /><span class="line"><span class="number">173</span>:                 || !Modifier.isPublic(getter.getModifiers())</span><br /><span class="line"><span class="number">174</span>:                 || !type.equals(getter.getReturnType())) {</span><br /><span class="line"><span class="number">175</span>:             <span class="keyword">continue</span>;</span><br /><span class="line"><span class="number">176</span>:         }</span><br /><span class="line"><span class="number">177</span>:         <span class="comment">// è§£æ `&lt;dubbo:parameters /&gt;`</span></span><br /><span class="line"><span class="number">178</span>:         <span class="keyword">if</span> (<span class="string">"parameters"</span>.equals(property)) {</span><br /><span class="line"><span class="number">179</span>:             parameters = parseParameters(element.getChildNodes(), beanDefinition);</span><br /><span class="line"><span class="number">180</span>:         <span class="comment">// è§£æ `&lt;dubbo:method /&gt;`</span></span><br /><span class="line"><span class="number">181</span>:         } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"methods"</span>.equals(property)) {</span><br /><span class="line"><span class="number">182</span>:             parseMethods(id, element.getChildNodes(), beanDefinition, parserContext);</span><br /><span class="line"><span class="number">183</span>:         <span class="comment">// è§£æ `&lt;dubbo:argument /&gt;`</span></span><br /><span class="line"><span class="number">184</span>:         } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"arguments"</span>.equals(property)) {</span><br /><span class="line"><span class="number">185</span>:             parseArguments(id, element.getChildNodes(), beanDefinition, parserContext);</span><br /><span class="line"><span class="number">186</span>:         } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">187</span>:             String value = element.getAttribute(property);</span><br /><span class="line"><span class="number">188</span>:             <span class="keyword">if</span> (value != <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">189</span>:                 value = value.trim();</span><br /><span class="line"><span class="number">190</span>:                 <span class="keyword">if</span> (value.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">191</span>:                     <span class="comment">// ä¸æƒ³æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„æƒ…å†µï¼Œå³ `registry=N/A` ã€‚</span></span><br /><span class="line"><span class="number">192</span>:                     <span class="keyword">if</span> (<span class="string">"registry"</span>.equals(property) &amp;&amp; RegistryConfig.NO_AVAILABLE.equalsIgnoreCase(value)) {</span><br /><span class="line"><span class="number">193</span>:                         RegistryConfig registryConfig = <span class="keyword">new</span> RegistryConfig();</span><br /><span class="line"><span class="number">194</span>:                         registryConfig.setAddress(RegistryConfig.NO_AVAILABLE);</span><br /><span class="line"><span class="number">195</span>:                         beanDefinition.getPropertyValues().addPropertyValue(property, registryConfig);</span><br /><span class="line"><span class="number">196</span>:                     <span class="comment">// å¤šæ³¨å†Œä¸­å¿ƒçš„æƒ…å†µ</span></span><br /><span class="line"><span class="number">197</span>:                     } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"registry"</span>.equals(property) &amp;&amp; value.indexOf(<span class="string">','</span>) != -<span class="number">1</span>) {</span><br /><span class="line"><span class="number">198</span>:                         parseMultiRef(<span class="string">"registries"</span>, value, beanDefinition, parserContext);</span><br /><span class="line"><span class="number">199</span>:                     <span class="comment">// å¤šæœåŠ¡æä¾›è€…çš„æƒ…å†µ</span></span><br /><span class="line"><span class="number">200</span>:                     } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"provider"</span>.equals(property) &amp;&amp; value.indexOf(<span class="string">','</span>) != -<span class="number">1</span>) {</span><br /><span class="line"><span class="number">201</span>:                         parseMultiRef(<span class="string">"providers"</span>, value, beanDefinition, parserContext);</span><br /><span class="line"><span class="number">202</span>:                     <span class="comment">// å¤šåè®®çš„æƒ…å†µ</span></span><br /><span class="line"><span class="number">203</span>:                     } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"protocol"</span>.equals(property) &amp;&amp; value.indexOf(<span class="string">','</span>) != -<span class="number">1</span>) {</span><br /><span class="line"><span class="number">204</span>:                         parseMultiRef(<span class="string">"protocols"</span>, value, beanDefinition, parserContext);</span><br /><span class="line"><span class="number">205</span>:                     } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">206</span>:                         Object reference;</span><br /><span class="line"><span class="number">207</span>:                         <span class="comment">// å¤„ç†å±æ€§ç±»å‹ä¸ºåŸºæœ¬å±æ€§çš„æƒ…å†µ</span></span><br /><span class="line"><span class="number">208</span>:                         <span class="keyword">if</span> (isPrimitive(type)) {</span><br /><span class="line"><span class="number">209</span>:                             <span class="comment">// å…¼å®¹æ€§å¤„ç†</span></span><br /><span class="line"><span class="number">210</span>:                             <span class="keyword">if</span> (<span class="string">"async"</span>.equals(property) &amp;&amp; <span class="string">"false"</span>.equals(value)</span><br /><span class="line"><span class="number">211</span>:                                     || <span class="string">"timeout"</span>.equals(property) &amp;&amp; <span class="string">"0"</span>.equals(value)</span><br /><span class="line"><span class="number">212</span>:                                     || <span class="string">"delay"</span>.equals(property) &amp;&amp; <span class="string">"0"</span>.equals(value)</span><br /><span class="line"><span class="number">213</span>:                                     || <span class="string">"version"</span>.equals(property) &amp;&amp; <span class="string">"0.0.0"</span>.equals(value)</span><br /><span class="line"><span class="number">214</span>:                                     || <span class="string">"stat"</span>.equals(property) &amp;&amp; <span class="string">"-1"</span>.equals(value)</span><br /><span class="line"><span class="number">215</span>:                                     || <span class="string">"reliable"</span>.equals(property) &amp;&amp; <span class="string">"false"</span>.equals(value)) {</span><br /><span class="line"><span class="number">216</span>:                                 <span class="comment">// backward compatibility for the default value in old version's xsd</span></span><br /><span class="line"><span class="number">217</span>:                                 value = <span class="keyword">null</span>;</span><br /><span class="line"><span class="number">218</span>:                             }</span><br /><span class="line"><span class="number">219</span>:                             reference = value;</span><br /><span class="line"><span class="number">220</span>:                         <span class="comment">// å¤„ç†åœ¨ `&lt;dubbo:provider /&gt;` æˆ–è€… `&lt;dubbo:service /&gt;` ä¸Šå®šä¹‰äº† `protocol` å±æ€§çš„ å…¼å®¹æ€§ã€‚</span></span><br /><span class="line"><span class="number">221</span>:                         } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"protocol"</span>.equals(property)</span><br /><span class="line"><span class="number">222</span>:                                 &amp;&amp; ExtensionLoader.getExtensionLoader(Protocol.class).hasExtension(value) <span class="comment">// å­˜åœ¨è¯¥æ³¨å†Œåè®®çš„å®ç°</span></span><br /><span class="line"><span class="number">223</span>:                                 &amp;&amp; (!parserContext.getRegistry().containsBeanDefinition(value) <span class="comment">// Spring æ³¨å†Œè¡¨ä¸­ä¸å­˜åœ¨è¯¥ `&lt;dubbo:provider /&gt;` çš„å®šä¹‰</span></span><br /><span class="line"><span class="number">224</span>:                                     || !ProtocolConfig.class.getName().equals(parserContext.getRegistry().getBeanDefinition(value).getBeanClassName())) <span class="comment">// Spring æ³¨å†Œè¡¨ä¸­å­˜åœ¨è¯¥ç¼–å·ï¼Œä½†æ˜¯ç±»å‹ä¸ä¸º ProtocolConfig ã€‚</span></span><br /><span class="line"><span class="number">225</span>:                                 ) {</span><br /><span class="line"><span class="number">226</span>:                             <span class="comment">// ç›®å‰ï¼Œ`&lt;dubbo:provider protocol="" /&gt;` æ¨èç‹¬ç«‹æˆ `&lt;dubbo:protocol /&gt;`</span></span><br /><span class="line"><span class="number">227</span>:                             <span class="keyword">if</span> (<span class="string">"dubbo:provider"</span>.equals(element.getTagName())) {</span><br /><span class="line"><span class="number">228</span>:                                 logger.warn(<span class="string">"Recommended replace &lt;dubbo:provider protocol=\""</span> + value + <span class="string">"\" ... /&gt; to &lt;dubbo:protocol name=\""</span> + value + <span class="string">"\" ... /&gt;"</span>);</span><br /><span class="line"><span class="number">229</span>:                             }</span><br /><span class="line"><span class="number">230</span>:                             <span class="comment">// backward compatibility</span></span><br /><span class="line"><span class="number">231</span>:                             ProtocolConfig protocol = <span class="keyword">new</span> ProtocolConfig();</span><br /><span class="line"><span class="number">232</span>:                             protocol.setName(value);</span><br /><span class="line"><span class="number">233</span>:                             reference = protocol;</span><br /><span class="line"><span class="number">234</span>:                         <span class="comment">// å¤„ç† `onreturn` å±æ€§</span></span><br /><span class="line"><span class="number">235</span>:                         } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"onreturn"</span>.equals(property)) {</span><br /><span class="line"><span class="number">236</span>:                             <span class="comment">// æŒ‰ç…§ `.` æ‹†åˆ†</span></span><br /><span class="line"><span class="number">237</span>:                             <span class="keyword">int</span> index = value.lastIndexOf(<span class="string">"."</span>);</span><br /><span class="line"><span class="number">238</span>:                             String returnRef = value.substring(<span class="number">0</span>, index);</span><br /><span class="line"><span class="number">239</span>:                             String returnMethod = value.substring(index + <span class="number">1</span>);</span><br /><span class="line"><span class="number">240</span>:                             <span class="comment">// åˆ›å»º RuntimeBeanReference ï¼ŒæŒ‡å‘å›è°ƒçš„å¯¹è±¡</span></span><br /><span class="line"><span class="number">241</span>:                             reference = <span class="keyword">new</span> RuntimeBeanReference(returnRef);</span><br /><span class="line"><span class="number">242</span>:                             <span class="comment">// è®¾ç½® `onreturnMethod` åˆ° BeanDefinition çš„å±æ€§å€¼</span></span><br /><span class="line"><span class="number">243</span>:                             beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"onreturnMethod"</span>, returnMethod);</span><br /><span class="line"><span class="number">244</span>:                             <span class="comment">// å¤„ç† `onthrow` å±æ€§</span></span><br /><span class="line"><span class="number">245</span>:                         } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"onthrow"</span>.equals(property)) {</span><br /><span class="line"><span class="number">246</span>:                             <span class="comment">// æŒ‰ç…§ `.` æ‹†åˆ†</span></span><br /><span class="line"><span class="number">247</span>:                             <span class="keyword">int</span> index = value.lastIndexOf(<span class="string">"."</span>);</span><br /><span class="line"><span class="number">248</span>:                             String throwRef = value.substring(<span class="number">0</span>, index);</span><br /><span class="line"><span class="number">249</span>:                             String throwMethod = value.substring(index + <span class="number">1</span>);</span><br /><span class="line"><span class="number">250</span>:                             <span class="comment">// åˆ›å»º RuntimeBeanReference ï¼ŒæŒ‡å‘å›è°ƒçš„å¯¹è±¡</span></span><br /><span class="line"><span class="number">251</span>:                             reference = <span class="keyword">new</span> RuntimeBeanReference(throwRef);</span><br /><span class="line"><span class="number">252</span>:                             <span class="comment">// è®¾ç½® `onthrowMethod` åˆ° BeanDefinition çš„å±æ€§å€¼</span></span><br /><span class="line"><span class="number">253</span>:                             beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"onthrowMethod"</span>, throwMethod);</span><br /><span class="line"><span class="number">254</span>:                         <span class="comment">// é€šç”¨è§£æ</span></span><br /><span class="line"><span class="number">255</span>:                         } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">256</span>:                             <span class="comment">// æŒ‡å‘çš„ Service çš„ Bean å¯¹è±¡ï¼Œå¿…é¡»æ˜¯å•ä¾‹</span></span><br /><span class="line"><span class="number">257</span>:                             <span class="keyword">if</span> (<span class="string">"ref"</span>.equals(property) &amp;&amp; parserContext.getRegistry().containsBeanDefinition(value)) {</span><br /><span class="line"><span class="number">258</span>:                                 BeanDefinition refBean = parserContext.getRegistry().getBeanDefinition(value);</span><br /><span class="line"><span class="number">259</span>:                                 <span class="keyword">if</span> (!refBean.isSingleton()) {</span><br /><span class="line"><span class="number">260</span>:                                     <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"The exported service ref "</span> + value + <span class="string">" must be singleton! Please set the "</span> + value + <span class="string">" bean scope to singleton, eg: &lt;bean id=\""</span> + value + <span class="string">"\" scope=\"singleton\" ...&gt;"</span>);</span><br /><span class="line"><span class="number">261</span>:                                 }</span><br /><span class="line"><span class="number">262</span>:                             }</span><br /><span class="line"><span class="number">263</span>:                             <span class="comment">// åˆ›å»º RuntimeBeanReference ï¼ŒæŒ‡å‘ Service çš„ Bean å¯¹è±¡</span></span><br /><span class="line"><span class="number">264</span>:                             reference = <span class="keyword">new</span> RuntimeBeanReference(value);</span><br /><span class="line"><span class="number">265</span>:                         }</span><br /><span class="line"><span class="number">266</span>:                         <span class="comment">// è®¾ç½® BeanDefinition çš„å±æ€§å€¼</span></span><br /><span class="line"><span class="number">267</span>:                         beanDefinition.getPropertyValues().addPropertyValue(property, reference);</span><br /><span class="line"><span class="number">268</span>:                     }</span><br /><span class="line"><span class="number">269</span>:                 }</span><br /><span class="line"><span class="number">270</span>:             }</span><br /><span class="line"><span class="number">271</span>:         }</span><br /><span class="line"><span class="number">272</span>:     }</span><br /><span class="line"><span class="number">273</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 150 è¡Œï¼šå·²è§£æçš„å±æ€§é›†åˆ&nbsp;<code>props</code>&nbsp;ã€‚è¯¥å±æ€§åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.2.8 å°† XML å…ƒç´ æœªéå†åˆ°çš„å±æ€§ï¼Œæ·»åŠ åˆ°&nbsp;<code>parameters</code>&nbsp;é›†åˆä¸­ã€</a>&nbsp;ä¼šä½¿ç”¨åˆ°ã€‚</li>
<li>ç¬¬ 151 è¡Œï¼šè§£æçš„å‚æ•°é›†åˆ&nbsp;<code>parameters</code>&nbsp;ã€‚</li>
<li>ç¬¬ 153 è¡Œï¼šå¾ªç¯ Bean å¯¹è±¡çš„ setting æ–¹æ³•ï¼Œå°†å±æ€§æ·»åŠ åˆ° Bean å¯¹è±¡çš„å±æ€§èµ‹å€¼ã€‚</li>
<li>ç¬¬ 154 è‡³ 157 è¡Œï¼šåˆ¤æ–­æ–¹æ³•ç¬¦åˆ setting &amp;&amp;&nbsp;<code>public</code>&nbsp;&amp;&amp; å”¯ä¸€å‚æ•°çš„æ¡ä»¶ã€‚</li>
<li>ç¬¬ 159 è‡³ 161 è¡Œï¼šæ·»åŠ <strong>å±æ€§å</strong>åˆ°&nbsp;<code>props</code>&nbsp;ã€‚</li>
<li>ç¬¬ 162 è‡³ 176 è¡Œï¼šåˆ¤æ–­æ–¹æ³•ç¬¦åˆ getting &amp;&amp;&nbsp;<code>public</code>&nbsp;&amp;&amp; è¿”å›ç±»å‹ä¸ setting å‚æ•°ç±»å‹<strong>ä¸€è‡´</strong>çš„æ¡ä»¶ã€‚</li>
<li>ç¬¬ 177 è‡³ 179 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L436-L476" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseParameters(id, nodeList, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ&nbsp;<code>&lt;dubbo:argument /&gt;</code>&nbsp;æ ‡ç­¾ã€‚è¯¦ç»†è§£æè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.3.6 parseParametersã€</a>&nbsp;æ–¹æ³•ã€‚</li>
<li>ç¬¬ 180 è‡³ 182 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L436-L476" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseMethods(id, nodeList, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ&nbsp;<code>&lt;dubbo:method /&gt;</code>&nbsp;æ ‡ç­¾ã€‚è¯¦ç»†è§£æè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.3.4 parseMethodsã€</a>&nbsp;æ–¹æ³•ã€‚</li>
<li>ç¬¬ 183 è‡³ 185 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L436-L476" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseArguments(id, nodeList, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ&nbsp;<code>&lt;dubbo:argument /&gt;</code>&nbsp;æ ‡ç­¾ã€‚è¯¦ç»†è§£æè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.3.5 parseArgumentsã€</a>&nbsp;æ–¹æ³•ã€‚</li>
<li>ç¬¬ 191 è‡³ 195 è¡Œï¼šå¤„ç†&nbsp;<code>"registry"</code>&nbsp;å±æ€§ï¼Œä¸æƒ³æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒçš„æƒ…å†µï¼Œå³&nbsp;<code>registry=N/A</code>&nbsp;ã€‚</li>
<li>ç¬¬ 196 è‡³ 204 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L301-L324" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseMultiRef(property, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œå¤„ç†å¤šæ³¨å†Œä¸­å¿ƒã€å¤šæœåŠ¡æä¾›è€…ã€å¤šåè®®çš„æƒ…å†µä¸‹ã€‚è¯¦ç»†è§£æè§&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.3. parseMultiRefã€</a>&nbsp;æ–¹æ³•ã€‚</li>
<li>ç¬¬ 207 è‡³ 219 è¡Œï¼šå¤„ç†å±æ€§ç±»å‹ä¸º<strong>åŸºç¡€å±æ€§</strong>(&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L294-L299" target="_blank" rel="external nofollow noopener noreferrer"><code>#isPrimitive(Class&lt;?&gt;)</code></a>&nbsp;)çš„æƒ…å†µã€‚</li>
<li>ç¬¬ 220 è‡³ 233 è¡Œï¼šè¿™å—æ¯”è¾ƒ<strong>å¤æ‚</strong>ã€‚<code>"protocol"</code>&nbsp;å±æ€§ï¼Œåœ¨å¤šä¸ªæ ‡ç­¾ä¸­ä¼šä½¿ç”¨ï¼Œä¾‹å¦‚&nbsp;<code>&lt;dubbo:service /&gt;</code>&nbsp;æˆ–è€…&nbsp;<code>&lt;dubbo:provider /&gt;</code>&nbsp;ç­‰ç­‰ã€‚æ ¹æ®&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/references/xml/introduction.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo æ–‡æ¡£ &mdash;&mdash; schema é…ç½®å‚è€ƒæ‰‹å†Œã€‹</a>&nbsp;çš„è¯´æ˜ï¼Œ<code>"protocol"</code>&nbsp;ä»£è¡¨çš„æ˜¯æŒ‡å‘çš„&nbsp;<code>&lt;dubbo:protocol /&gt;</code>&nbsp;çš„ç¼–å·(&nbsp;<code>id</code>&nbsp;)ã€‚
<ul>
<li>ã€æ­¤å¤„æ˜¯çŒœæµ‹ã€‘ä½†æ˜¯ï¼Œæ—©æœŸçš„ç‰ˆæœ¬ï¼Œ<code>"protocol"</code>&nbsp;å±æ€§ï¼Œä»£è¡¨çš„æ˜¯<strong>åè®®å</strong>ã€‚è¿™å°±éº»çƒ¦äº†ï¼Œå’Œç°æœ‰çš„é€»è¾‘æœ‰å†²çªå•Šï¼</li>
<li>é‚£æ€ä¹ˆè§£å†³å‘¢ï¼Ÿä¼˜å…ˆä»¥æŒ‡å‘çš„&nbsp;<code>&lt;dubbo:protocol /&gt;</code>&nbsp;çš„<strong>ç¼–å·</strong>(&nbsp;<code>id</code>&nbsp;) ä¸ºå‡†å¤‡ï¼Œå¦åˆ™è®¤ä¸ºæ˜¯<strong>åè®®å</strong>ã€‚</li>
<li>é‚£å®é™…åœ¨è§£æ Bean å¯¹è±¡æ—¶ï¼Œå¸¦æœ‰&nbsp;<code>"protocol"</code>&nbsp;å±æ€§çš„æ ‡ç­¾ï¼Œæ— æ³•ä¿è¯ä¸€å®šåœ¨&nbsp;<code>&lt;dubbo:protocol /&gt;</code>&nbsp;<strong>ä¹‹å</strong>è§£æã€‚é‚£å’‹æ•´å‘¢ï¼Ÿ
<ul>
<li>å¦‚æœå¸¦æœ‰&nbsp;<code>"protocol"</code>&nbsp;å±æ€§çš„æ ‡ç­¾<strong>å…ˆ</strong>è§£æï¼Œå…ˆã€ç¬¬ 221 è‡³ 223 è¡Œã€‘<strong>ç›´æ¥</strong>åˆ›å»º ProtocolConfig å¯¹è±¡å¹¶è®¾ç½®åˆ°&nbsp;<code>"protocol"</code>&nbsp;å±æ€§ï¼Œå†ã€ç¬¬ 119 è‡³ 127 è¡Œã€‘åœ¨&nbsp;<code>&lt;dubbo:protocol /&gt;</code>&nbsp;è§£æåï¼Œè¿›è¡Œ<strong>è¦†ç›–</strong>ã€‚è¿™æ ·ï¼Œå¦‚æœä¸å­˜åœ¨&nbsp;<code>&lt;dubbo:protocol /&gt;</code>&nbsp;çš„æƒ…å†µï¼Œæœ€å¤šä¸è¿›è¡Œè¦†ç›–å‘¢ã€‚</li>
<li>å¦‚æœå¸¦æœ‰&nbsp;<code>"protocol"</code>&nbsp;å±æ€§çš„æ ‡ç­¾<strong>å</strong>è§£æï¼Œæ— éœ€èµ°ä¸Šè¿°æµç¨‹ï¼Œèµ°ã€ç¬¬ 257 è‡³ 264 è¡Œã€‘å³å¯ã€‚</li>
<li>ğŸ™‚ å¦‚æœè¿™æ®µæ— æ³•ç†è§£ï¼Œå¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæœ‰ç‚¹ç»•ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>ç¬¬ 234 è‡³ 243 è¡Œ&nbsp;<strong>||</strong>&nbsp;ç¬¬ 244 è‡³ 253 è¡Œï¼šå¤„ç†&nbsp;<code>"onreturn"</code>&nbsp;å’Œ&nbsp;<code>"onthrow"</code>&nbsp;å±æ€§ã€‚è¯¥å±æ€§ç”¨äº&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/events-notify.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; äº‹ä»¶é€šçŸ¥ã€‹</a>&nbsp;åŠŸèƒ½ã€‚</li>
<li>ç¬¬ 254 è‡³ 264 è¡Œï¼šå‰©ä½™æƒ…å†µï¼Œé€šç”¨è§£æï¼Œåˆ›å»º RuntimeBeanReference å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œ<code>&lt;dubbo:service /&gt;</code>&nbsp;çš„&nbsp;<code>"ref"</code>&nbsp;å±æ€§ã€‚</li>
<li>ç¬¬ 267 è¡Œï¼šè®¾ç½® Bean çš„å±æ€§å€¼ã€‚<strong>è¯¥å±æ€§å€¼æ¥è‡ªç¬¬ 206 è‡³ 265 è¡Œä»£ç çš„é€»è¾‘</strong>ã€‚</li>
</ul>
<h3 id="3-2-8-å°†-XML-å…ƒç´ æœªéå†åˆ°çš„å±æ€§ï¼Œæ·»åŠ åˆ°-parameters-é›†åˆä¸­">3.2.8 å°† XML å…ƒç´ æœªéå†åˆ°çš„å±æ€§ï¼Œæ·»åŠ åˆ°&nbsp;<code>parameters</code>&nbsp;é›†åˆä¸­</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L274-L290" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext, beanClass, required)</code></a>&nbsp;çš„ç¬¬ 274 è‡³ 290 è¡Œï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="number">274</span>: <span class="comment">// å°† XML å…ƒç´ ï¼Œæœªåœ¨ä¸Šé¢éå†åˆ°çš„å±æ€§ï¼Œæ·»åŠ åˆ° `parameters` é›†åˆä¸­ã€‚ç›®å‰æµ‹è¯•ä¸‹æ¥ï¼Œä¸å­˜åœ¨è¿™æ ·çš„æƒ…å†µã€‚</span></span><br /><span class="line"><span class="number">275</span>: NamedNodeMap attributes = element.getAttributes();</span><br /><span class="line"><span class="number">276</span>: <span class="keyword">int</span> len = attributes.getLength();</span><br /><span class="line"><span class="number">277</span>: <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) {</span><br /><span class="line"><span class="number">278</span>:     Node node = attributes.item(i);</span><br /><span class="line"><span class="number">279</span>:     String name = node.getLocalName();</span><br /><span class="line"><span class="number">280</span>:     <span class="keyword">if</span> (!props.contains(name)) {</span><br /><span class="line"><span class="number">281</span>:         <span class="keyword">if</span> (parameters == <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">282</span>:             parameters = <span class="keyword">new</span> ManagedMap();</span><br /><span class="line"><span class="number">283</span>:         }</span><br /><span class="line"><span class="number">284</span>:         String value = node.getNodeValue();</span><br /><span class="line"><span class="number">285</span>:         parameters.put(name, <span class="keyword">new</span> TypedStringValue(value, String.class));</span><br /><span class="line"><span class="number">286</span>:     }</span><br /><span class="line"><span class="number">287</span>: }</span><br /><span class="line"><span class="number">288</span>: <span class="keyword">if</span> (parameters != <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">289</span>:     beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"parameters"</span>, parameters);</span><br /><span class="line"><span class="number">290</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 275 è‡³ 287 è¡Œï¼šå°† XML å…ƒç´ ï¼Œ<strong>æœªåœ¨ä¸Šé¢éå†åˆ°çš„å±æ€§</strong>ï¼Œæ·»åŠ åˆ°&nbsp;<code>parameters</code>&nbsp;é›†åˆä¸­ã€‚ç›®å‰æµ‹è¯•ä¸‹æ¥ï¼Œä¸å­˜åœ¨è¿™æ ·çš„æƒ…å†µã€‚</li>
<li>ç¬¬ 288 è‡³ 290 è¡Œï¼šè®¾ç½® Bean çš„&nbsp;<code>parameters</code>&nbsp;ã€‚</li>
</ul>
<h2 id="3-3-è§£ææ–¹æ³•ã€è¾…æµç¨‹ã€‘">3.3 è§£ææ–¹æ³•ã€è¾…æµç¨‹ã€‘</h2>
<h3 id="3-3-1-parseProperties">3.3.1 parseProperties</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L368-L399" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseProperties(NodeList, RootBeanDefinition)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ Service Bean å¯¹è±¡çš„å±æ€§ä»¬ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * è§£æ &lt;dubbo:service class="" /&gt; æƒ…å†µä¸‹ï¼Œå†…æ¶µçš„ `&lt;property /&gt;` çš„èµ‹å€¼ã€‚</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> nodeList å­å…ƒç´ æ•°ç»„</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@param</span> beanDefinition Bean å®šä¹‰å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 6:  */</span></span><br /><span class="line"> <span class="number">7</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseProperties</span><span class="params">(NodeList nodeList, RootBeanDefinition beanDefinition)</span> </span>{</span><br /><span class="line"> <span class="number">8</span>:     <span class="keyword">if</span> (nodeList != <span class="keyword">null</span> &amp;&amp; nodeList.getLength() &gt; <span class="number">0</span>) {</span><br /><span class="line"> <span class="number">9</span>:         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++) {</span><br /><span class="line"><span class="number">10</span>:             Node node = nodeList.item(i);</span><br /><span class="line"><span class="number">11</span>:             <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) {</span><br /><span class="line"><span class="number">12</span>:                 <span class="keyword">if</span> (<span class="string">"property"</span>.equals(node.getNodeName())</span><br /><span class="line"><span class="number">13</span>:                         || <span class="string">"property"</span>.equals(node.getLocalName())) {</span><br /><span class="line"><span class="number">14</span>:                     String name = ((Element) node).getAttribute(<span class="string">"name"</span>);</span><br /><span class="line"><span class="number">15</span>:                     <span class="keyword">if</span> (name != <span class="keyword">null</span> &amp;&amp; name.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">16</span>:                         String value = ((Element) node).getAttribute(<span class="string">"value"</span>);</span><br /><span class="line"><span class="number">17</span>:                         String ref = ((Element) node).getAttribute(<span class="string">"ref"</span>);</span><br /><span class="line"><span class="number">18</span>:                         <span class="comment">// value</span></span><br /><span class="line"><span class="number">19</span>:                         <span class="keyword">if</span> (value != <span class="keyword">null</span> &amp;&amp; value.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">20</span>:                             beanDefinition.getPropertyValues().addPropertyValue(name, value);</span><br /><span class="line"><span class="number">21</span>:                         <span class="comment">// ref</span></span><br /><span class="line"><span class="number">22</span>:                         } <span class="keyword">else</span> <span class="keyword">if</span> (ref != <span class="keyword">null</span> &amp;&amp; ref.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">23</span>:                             beanDefinition.getPropertyValues().addPropertyValue(name, <span class="keyword">new</span> RuntimeBeanReference(ref));</span><br /><span class="line"><span class="number">24</span>:                         } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">25</span>:                             <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"Unsupported &lt;property name=\""</span> + name + <span class="string">"\"&gt; sub tag, Only supported &lt;property name=\""</span> + name + <span class="string">"\" ref=\"...\" /&gt; or &lt;property name=\""</span> + name + <span class="string">"\" value=\"...\" /&gt;"</span>);</span><br /><span class="line"><span class="number">26</span>:                         }</span><br /><span class="line"><span class="number">27</span>:                     }</span><br /><span class="line"><span class="number">28</span>:                 }</span><br /><span class="line"><span class="number">29</span>:             }</span><br /><span class="line"><span class="number">30</span>:         }</span><br /><span class="line"><span class="number">31</span>:     }</span><br /><span class="line"><span class="number">32</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 11 è‡³ 13 è¡Œï¼š<strong>åª</strong>è§£æ&nbsp;<code>&lt;property /&gt;</code>&nbsp;æ ‡ç­¾ã€‚</li>
<li>ç¬¬ 18 è‡³ 20 è¡Œï¼šä¼˜å…ˆä½¿ç”¨&nbsp;<code>"value"</code>&nbsp;å±æ€§ã€‚</li>
<li>ç¬¬ 21 è‡³ 23 è¡Œï¼šå…¶æ¬¡ä½¿ç”¨&nbsp;<code>"ref"</code>&nbsp;å±æ€§ã€‚</li>
<li>ç¬¬ 24 è‡³ 27 è¡Œï¼šå±æ€§è¡¥å…¨ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<h3 id="3-3-2-parseNested">3.3.2 parseNested</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L326-L366" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseNested(...)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æå†…åµŒçš„æŒ‡å‘çš„å­ XML å…ƒç´ ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * è§£æå†…åµŒçš„æŒ‡å‘çš„å­ XML å…ƒç´ </span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> element çˆ¶ XML å…ƒç´ </span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@param</span> parserContext Spring è§£æä¸Šä¸‹æ–‡</span></span><br /><span class="line"><span class="comment"> 6:  * <span class="doctag">@param</span> beanClass å†…åµŒè§£æå­å…ƒç´ çš„ Bean çš„ç±»</span></span><br /><span class="line"><span class="comment"> 7:  * <span class="doctag">@param</span> required æ˜¯å¦éœ€è¦ Bean çš„ `id` å±æ€§</span></span><br /><span class="line"><span class="comment"> 8:  * <span class="doctag">@param</span> tag æ ‡ç­¾</span></span><br /><span class="line"><span class="comment"> 9:  * <span class="doctag">@param</span> property çˆ¶ Bean å¯¹è±¡åœ¨å­å…ƒç´ ä¸­çš„å±æ€§å</span></span><br /><span class="line"><span class="comment">10:  * <span class="doctag">@param</span> ref æŒ‡å‘</span></span><br /><span class="line"><span class="comment">11:  * <span class="doctag">@param</span> beanDefinition çˆ¶ Bean å®šä¹‰å¯¹è±¡</span></span><br /><span class="line"><span class="comment">12:  */</span></span><br /><span class="line"><span class="number">13</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseNested</span><span class="params">(Element element, ParserContext parserContext, Class&lt;?&gt; beanClass, <span class="keyword">boolean</span> required, String tag,</span></span></span><br /><span class="line"><span class="function"><span class="params"><span class="number">14</span>:                                 String property, String ref, BeanDefinition beanDefinition)</span> </span>{</span><br /><span class="line"><span class="number">15</span>:     NodeList nodeList = element.getChildNodes();</span><br /><span class="line"><span class="number">16</span>:     <span class="keyword">if</span> (nodeList != <span class="keyword">null</span> &amp;&amp; nodeList.getLength() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">17</span>:         <span class="keyword">boolean</span> first = <span class="keyword">true</span>;</span><br /><span class="line"><span class="number">18</span>:         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++) {</span><br /><span class="line"><span class="number">19</span>:             Node node = nodeList.item(i);</span><br /><span class="line"><span class="number">20</span>:             <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) {</span><br /><span class="line"><span class="number">21</span>:                 <span class="keyword">if</span> (tag.equals(node.getNodeName())</span><br /><span class="line"><span class="number">22</span>:                         || tag.equals(node.getLocalName())) { <span class="comment">// è¿™ä¸‰è¡Œï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºæŒ‡å®šè¦è§£æçš„å­å…ƒç´ </span></span><br /><span class="line"><span class="number">23</span>:                     <span class="comment">// ã€TODO 8008ã€‘ èŠ‹è‰¿ï¼Œdefault æ˜¯å¹²é”¤å­çš„</span></span><br /><span class="line"><span class="number">24</span>:                     <span class="keyword">if</span> (first) {</span><br /><span class="line"><span class="number">25</span>:                         first = <span class="keyword">false</span>;</span><br /><span class="line"><span class="number">26</span>:                         String isDefault = element.getAttribute(<span class="string">"default"</span>);</span><br /><span class="line"><span class="number">27</span>:                         <span class="keyword">if</span> (isDefault == <span class="keyword">null</span> || isDefault.length() == <span class="number">0</span>) {</span><br /><span class="line"><span class="number">28</span>:                             beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"default"</span>, <span class="string">"false"</span>);</span><br /><span class="line"><span class="number">29</span>:                         }</span><br /><span class="line"><span class="number">30</span>:                     }</span><br /><span class="line"><span class="number">31</span>:                     <span class="comment">// è§£æå­å…ƒç´ ï¼Œåˆ›å»º BeanDefinition å¯¹è±¡</span></span><br /><span class="line"><span class="number">32</span>:                     BeanDefinition subDefinition = parse((Element) node, parserContext, beanClass, required);</span><br /><span class="line"><span class="number">33</span>:                     <span class="comment">// è®¾ç½®å­ BeanDefinition ï¼ŒæŒ‡å‘çˆ¶ BeanDefinition ã€‚</span></span><br /><span class="line"><span class="number">34</span>:                     <span class="keyword">if</span> (subDefinition != <span class="keyword">null</span> &amp;&amp; ref != <span class="keyword">null</span> &amp;&amp; ref.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">35</span>:                         subDefinition.getPropertyValues().addPropertyValue(property, <span class="keyword">new</span> RuntimeBeanReference(ref));</span><br /><span class="line"><span class="number">36</span>:                     }</span><br /><span class="line"><span class="number">37</span>:                 }</span><br /><span class="line"><span class="number">38</span>:             }</span><br /><span class="line"><span class="number">39</span>:         }</span><br /><span class="line"><span class="number">40</span>:     }</span><br /><span class="line"><span class="number">41</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 20 è‡³ 22 è¡Œï¼š<strong>åª</strong>è§£æ<strong>æŒ‡å®šæ ‡ç­¾</strong>ã€‚ç›®å‰æœ‰<strong>å†…åµŒ</strong>çš„&nbsp;<code>&lt;dubbo:service /&gt;</code>&nbsp;å’Œ&nbsp;<code>&lt;dubbo:reference /&gt;</code>&nbsp;æ ‡ç­¾ã€‚</li>
<li>ç¬¬ 32 è¡Œï¼šè§£ææŒ‡å®šæ ‡ç­¾ï¼Œåˆ›å»ºå­ Bean å¯¹è±¡ã€‚</li>
<li>ç¬¬ 33 è‡³ 36 è¡Œï¼šè®¾ç½®åˆ›å»ºçš„<strong>å­</strong>&nbsp;Bean å¯¹è±¡ï¼ŒæŒ‡å‘<strong>çˆ¶</strong>&nbsp;Bean å¯¹è±¡ã€‚</li>
</ul>
<h3 id="3-3-3-parseMultiRef">3.3.3 parseMultiRef</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L301-L324" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseMultiRef(property, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æå¤šæŒ‡å‘çš„æƒ…å†µï¼Œä¾‹å¦‚å¤šæ³¨å†Œä¸­å¿ƒï¼Œå¤šåè®®ç­‰ç­‰ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * è§£æå¤šæŒ‡å‘çš„æƒ…å†µï¼Œä¾‹å¦‚å¤šæ³¨å†Œä¸­å¿ƒï¼Œå¤šåè®®ç­‰ç­‰ã€‚</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> property å±æ€§</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@param</span> value å€¼</span></span><br /><span class="line"><span class="comment"> 6:  * <span class="doctag">@param</span> beanDefinition Bean å®šä¹‰å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 7:  * <span class="doctag">@param</span> parserContext Spring è§£æä¸Šä¸‹æ–‡</span></span><br /><span class="line"><span class="comment"> 8:  */</span></span><br /><span class="line"> <span class="number">9</span>: <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br /><span class="line"><span class="number">10</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseMultiRef</span><span class="params">(String property, String value, RootBeanDefinition beanDefinition,</span></span></span><br /><span class="line"><span class="function"><span class="params"><span class="number">11</span>:                                   ParserContext parserContext)</span> </span>{</span><br /><span class="line"><span class="number">12</span>:     String[] values = value.split(<span class="string">"\\s*[,]+\\s*"</span>);</span><br /><span class="line"><span class="number">13</span>:     ManagedList list = <span class="keyword">null</span>;</span><br /><span class="line"><span class="number">14</span>:     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; values.length; i++) {</span><br /><span class="line"><span class="number">15</span>:         String v = values[i];</span><br /><span class="line"><span class="number">16</span>:         <span class="keyword">if</span> (v != <span class="keyword">null</span> &amp;&amp; v.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">17</span>:             <span class="keyword">if</span> (list == <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">18</span>:                 list = <span class="keyword">new</span> ManagedList();</span><br /><span class="line"><span class="number">19</span>:             }</span><br /><span class="line"><span class="number">20</span>:             list.add(<span class="keyword">new</span> RuntimeBeanReference(v));</span><br /><span class="line"><span class="number">21</span>:         }</span><br /><span class="line"><span class="number">22</span>:     }</span><br /><span class="line"><span class="number">23</span>:     beanDefinition.getPropertyValues().addPropertyValue(property, list);</span><br /><span class="line"><span class="number">24</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 12 è‡³ 22 è¡Œï¼šä»¥&nbsp;<code>.</code>&nbsp;æ‹†åˆ†<strong>å€¼</strong>å­—ç¬¦ä¸²ï¼Œåˆ›å»º RuntimeBeanReference æ•°ç»„ã€‚</li>
<li>ç¬¬ 23 è¡Œï¼šè®¾ç½® Bean å¯¹è±¡çš„æŒ‡å®šå±æ€§å€¼ã€‚</li>
</ul>
<h3 id="3-3-4-parseMethods">3.3.4 parseMethods</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L436-L476" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseMethods(id, nodeList, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ&nbsp;<code>&lt;dubbo:method /&gt;</code>&nbsp;æ ‡ç­¾ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * è§£æ `&lt;dubbo:method /&gt;`</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> id Bean çš„ `id` å±æ€§ã€‚</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@param</span> nodeList å­å…ƒç´ èŠ‚ç‚¹æ•°ç»„</span></span><br /><span class="line"><span class="comment"> 6:  * <span class="doctag">@param</span> beanDefinition Bean å®šä¹‰å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 7:  * <span class="doctag">@param</span> parserContext è§£æä¸Šä¸‹æ–‡</span></span><br /><span class="line"><span class="comment"> 8:  */</span></span><br /><span class="line"> <span class="number">9</span>: <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br /><span class="line"><span class="number">10</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">parseMethods</span><span class="params">(String id, NodeList nodeList, RootBeanDefinition beanDefinition,</span></span></span><br /><span class="line"><span class="function"><span class="params"><span class="number">11</span>:                                  ParserContext parserContext)</span> </span>{</span><br /><span class="line"><span class="number">12</span>:     <span class="keyword">if</span> (nodeList != <span class="keyword">null</span> &amp;&amp; nodeList.getLength() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">13</span>:         ManagedList methods = <span class="keyword">null</span>; <span class="comment">// è§£æçš„æ–¹æ³•æ•°ç»„</span></span><br /><span class="line"><span class="number">14</span>:         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++) {</span><br /><span class="line"><span class="number">15</span>:             Node node = nodeList.item(i);</span><br /><span class="line"><span class="number">16</span>:             <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) {</span><br /><span class="line"><span class="number">17</span>:                 Element element = (Element) node;</span><br /><span class="line"><span class="number">18</span>:                 <span class="keyword">if</span> (<span class="string">"method"</span>.equals(node.getNodeName())</span><br /><span class="line"><span class="number">19</span>:                         || <span class="string">"method"</span>.equals(node.getLocalName())) { <span class="comment">// è¿™ä¸‰è¡Œï¼Œåˆ¤æ–­å€¼è§£æ `&lt;dubbo:method /&gt;`</span></span><br /><span class="line"><span class="number">20</span>:                     <span class="comment">// æ–¹æ³•åä¸èƒ½ä¸ºç©º</span></span><br /><span class="line"><span class="number">21</span>:                     String methodName = element.getAttribute(<span class="string">"name"</span>);</span><br /><span class="line"><span class="number">22</span>:                     <span class="keyword">if</span> (methodName == <span class="keyword">null</span> || methodName.length() == <span class="number">0</span>) {</span><br /><span class="line"><span class="number">23</span>:                         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"&lt;dubbo:method&gt; name attribute == null"</span>);</span><br /><span class="line"><span class="number">24</span>:                     }</span><br /><span class="line"><span class="number">25</span>:                     <span class="keyword">if</span> (methods == <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">26</span>:                         methods = <span class="keyword">new</span> ManagedList();</span><br /><span class="line"><span class="number">27</span>:                     }</span><br /><span class="line"><span class="number">28</span>:                     <span class="comment">// è§£æ `&lt;dubbo:method /&gt;`ï¼Œåˆ›å»º BeanDefinition å¯¹è±¡</span></span><br /><span class="line"><span class="number">29</span>:                     BeanDefinition methodBeanDefinition = parse(((Element) node), parserContext, MethodConfig.class, <span class="keyword">false</span>);</span><br /><span class="line"><span class="number">30</span>:                     <span class="comment">// æ·»åŠ åˆ° `methods` ä¸­</span></span><br /><span class="line"><span class="number">31</span>:                     String name = id + <span class="string">"."</span> + methodName;</span><br /><span class="line"><span class="number">32</span>:                     BeanDefinitionHolder methodBeanDefinitionHolder = <span class="keyword">new</span> BeanDefinitionHolder(methodBeanDefinition, name);</span><br /><span class="line"><span class="number">33</span>:                     methods.add(methodBeanDefinitionHolder);</span><br /><span class="line"><span class="number">34</span>:                 }</span><br /><span class="line"><span class="number">35</span>:             }</span><br /><span class="line"><span class="number">36</span>:         }</span><br /><span class="line"><span class="number">37</span>:         <span class="keyword">if</span> (methods != <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">38</span>:             beanDefinition.getPropertyValues().addPropertyValue(<span class="string">"methods"</span>, methods);</span><br /><span class="line"><span class="number">39</span>:         }</span><br /><span class="line"><span class="number">40</span>:     }</span><br /><span class="line"><span class="number">41</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 13 è¡Œï¼šè§£æçš„æ–¹æ³•æ•°ç»„&nbsp;<code>methods</code>&nbsp;ã€‚</li>
<li>ç¬¬ 16 è‡³ 19 è¡Œï¼š<strong>åª</strong>è§£æ&nbsp;<code>&lt;dubbo:method&gt;</code>&nbsp;æ ‡ç­¾ã€‚</li>
<li>ç¬¬ 29 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L516-L518" target="_blank" rel="external nofollow noopener noreferrer"><code>#parse(Element, ParserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œ<strong>ä¸»æµç¨‹</strong>ï¼Œè§£æ&nbsp;<code>&lt;dubbo:method&gt;</code>&nbsp;æ ‡ç­¾ï¼Œåˆ›å»ºå­ Bean å¯¹è±¡ã€‚</li>
<li>ç¬¬ 33 è‡³ 36 è¡Œï¼šè®¾ç½®åˆ›å»ºçš„<strong>å­</strong>&nbsp;Bean å¯¹è±¡ï¼ŒæŒ‡å‘<strong>çˆ¶</strong>&nbsp;Bean å¯¹è±¡ã€‚</li>
<li>ç¬¬ 30 è‡³ 33 è¡Œï¼šæ·»åŠ å­ Bean å¯¹è±¡åˆ°&nbsp;<code>methods</code>&nbsp;ä¸­ã€‚</li>
<li>ç¬¬ 37 è‡³ 39 è¡Œï¼šè®¾ç½® Bean çš„&nbsp;<code>methods</code>&nbsp;ã€‚</li>
</ul>
<h3 id="3-3-5-parseArguments">3.3.5 parseArguments</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L436-L476" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseArguments(id, nodeList, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ&nbsp;<code>&lt;dubbo:argument /&gt;</code>&nbsp;æ ‡ç­¾ã€‚</p>
<p>å’Œ&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/">ã€Œ3.3.4 parseMethodsã€</a>&nbsp;åŸºæœ¬ä¸€è‡´ï¼ŒğŸ™‚ èƒ–å‹ç‚¹å‡»æ–¹æ³•ï¼Œç›´æ¥æŸ¥çœ‹ä»£ç ã€‚</p>
<h3 id="3-3-6-parseParameters">3.3.6 parseParameters</h3>
<p><a href="https://github.com/YunaiV/dubbo/blob/55227e1897030c42342c65b2fce8e1705844a531/dubbo-config/dubbo-config-spring/src/main/java/com/alibaba/dubbo/config/spring/schema/DubboBeanDefinitionParser.java#L401-L434" target="_blank" rel="external nofollow noopener noreferrer"><code>#parseParameters(id, nodeList, beanDefinition, parserContext)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ&nbsp;<code>&lt;dubbo:argument /&gt;</code>&nbsp;æ ‡ç­¾ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * è§£æ `&lt;dubbo:parameter /&gt;`</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> nodeList å­å…ƒç´ èŠ‚ç‚¹æ•°ç»„</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@param</span> beanDefinition Bean å®šä¹‰å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 6:  * <span class="doctag">@return</span> å‚æ•°é›†åˆ</span></span><br /><span class="line"><span class="comment"> 7:  */</span></span><br /><span class="line"> <span class="number">8</span>: <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br /><span class="line"> <span class="number">9</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ManagedMap <span class="title">parseParameters</span><span class="params">(NodeList nodeList, RootBeanDefinition beanDefinition)</span> </span>{</span><br /><span class="line"><span class="number">10</span>:     <span class="keyword">if</span> (nodeList != <span class="keyword">null</span> &amp;&amp; nodeList.getLength() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">11</span>:         ManagedMap parameters = <span class="keyword">null</span>;</span><br /><span class="line"><span class="number">12</span>:         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nodeList.getLength(); i++) {</span><br /><span class="line"><span class="number">13</span>:             Node node = nodeList.item(i);</span><br /><span class="line"><span class="number">14</span>:             <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) {</span><br /><span class="line"><span class="number">15</span>:                 <span class="keyword">if</span> (<span class="string">"parameter"</span>.equals(node.getNodeName())</span><br /><span class="line"><span class="number">16</span>:                         || <span class="string">"parameter"</span>.equals(node.getLocalName())) { <span class="comment">// è¿™ä¸‰è¡Œï¼Œåªè§£æå­å…ƒç´ ä¸­çš„ `&lt;dubbo:parameter /&gt;`</span></span><br /><span class="line"><span class="number">17</span>:                     <span class="keyword">if</span> (parameters == <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">18</span>:                         parameters = <span class="keyword">new</span> ManagedMap();</span><br /><span class="line"><span class="number">19</span>:                     }</span><br /><span class="line"><span class="number">20</span>:                     <span class="comment">// æ·»åŠ åˆ°å‚æ•°é›†åˆ</span></span><br /><span class="line"><span class="number">21</span>:                     String key = ((Element) node).getAttribute(<span class="string">"key"</span>);</span><br /><span class="line"><span class="number">22</span>:                     String value = ((Element) node).getAttribute(<span class="string">"value"</span>);</span><br /><span class="line"><span class="number">23</span>:                     <span class="keyword">boolean</span> hide = <span class="string">"true"</span>.equals(((Element) node).getAttribute(<span class="string">"hide"</span>)); <span class="comment">// ã€TODO 8007ã€‘ &lt;dubbo:parameter hide=&ldquo;&rdquo; /&gt; çš„ç”¨é€”</span></span><br /><span class="line"><span class="number">24</span>:                     <span class="keyword">if</span> (hide) {</span><br /><span class="line"><span class="number">25</span>:                         key = Constants.HIDE_KEY_PREFIX + key;</span><br /><span class="line"><span class="number">26</span>:                     }</span><br /><span class="line"><span class="number">27</span>:                     parameters.put(key, <span class="keyword">new</span> TypedStringValue(value, String.class));</span><br /><span class="line"><span class="number">28</span>:                 }</span><br /><span class="line"><span class="number">29</span>:             }</span><br /><span class="line"><span class="number">30</span>:         }</span><br /><span class="line"><span class="number">31</span>:         <span class="keyword">return</span> parameters;</span><br /><span class="line"><span class="number">32</span>:     }</span><br /><span class="line"><span class="number">33</span>:     <span class="keyword">return</span> <span class="keyword">null</span>;</span><br /><span class="line"><span class="number">34</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 13 è¡Œï¼šè§£æçš„å‚æ•°é›†åˆ&nbsp;<code>parameters</code>&nbsp;ã€‚</li>
<li>ç¬¬ 20 è‡³ 27 è¡Œï¼šæ·»åŠ &nbsp;<code>"key"</code>&nbsp;<code>"value"</code>&nbsp;åˆ°&nbsp;<code>parameters</code>&nbsp;ã€‚</li>
</ul>
</div>