<header class="article-header">
<h1 class="article-title">æ ¸å¿ƒæµç¨‹ä¸€è§ˆ</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>æœ¬æ–‡ä¸»è¦åˆ†äº«&nbsp;<strong>Dubbo çš„æ ¸å¿ƒæµç¨‹</strong>ã€‚<br />å¸Œæœ›é€šè¿‡æœ¬æ–‡èƒ½è®©èƒ–å‹å¯¹ Dubbo çš„æ ¸å¿ƒæµç¨‹æœ‰ä¸ªç®€å•çš„äº†è§£ã€‚</p>
<p>å¦å¤–ï¼Œç¬”è€…ä¼šç›¸å¯¹<strong>å¤§é‡</strong>å¼•ç”¨&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/design.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; æ¡†æ¶è®¾è®¡ã€‹</a>&nbsp;å’Œ&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/implementation.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; å®ç°ç»†èŠ‚ã€‹</a>&nbsp;ï¼Œå†™çš„çœŸçš„æŒºå¥½çš„ã€‚ğŸ™‚ æˆ–è€…è¯´ï¼Œæœ¬æ–‡æ˜¯è¯¥æ–‡ç« çš„<strong>ç»†åŒ–</strong>å’Œ<strong>è§£è¯´</strong>ã€‚<br />psï¼šé™äºæ’ç‰ˆï¼Œéƒ¨åˆ†åœ°æ–¹å¼•ç”¨ä¼šå­˜åœ¨æœªæ ‡æ˜çš„æƒ…å†µã€‚</p>
<h1 id="2-æ•´ä½“è®¾è®¡">2. æ•´ä½“è®¾è®¡</h1>
<blockquote>
<p>ğŸ˜ˆ æœ¬å°èŠ‚ï¼ŒåŸºæœ¬ä¸ºå¼•ç”¨ + é‡æ–°æ’ç‰ˆã€‚</p>
</blockquote>
<p>ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ•´ä½“è®¾è®¡å›¾ï¼Œç›¸å¯¹æ¯”è¾ƒ<strong>å¤æ‚</strong>ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; æ¡†æ¶è®¾è®¡ã€‹</a><br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/01.png" alt="æ•´ä½“è®¾è®¡" /></p>
</blockquote>
<h2 id="2-1-å›¾ä¾‹è¯´æ˜">2.1 å›¾ä¾‹è¯´æ˜</h2>
<blockquote>
<ul>
<li>æœ€é¡¶ä¸Šä¹ä¸ª<strong>å›¾æ ‡</strong>ï¼Œä»£è¡¨æœ¬å›¾ä¸­çš„å¯¹è±¡ä¸æµç¨‹ã€‚</li>
<li>å›¾ä¸­å·¦è¾¹&nbsp;<strong>æ·¡è“èƒŒæ™¯</strong>( Consumer ) çš„ä¸ºæœåŠ¡æ¶ˆè´¹æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œå³è¾¹&nbsp;<strong>æ·¡ç»¿è‰²èƒŒæ™¯</strong>( Provider ) çš„ä¸ºæœåŠ¡æä¾›æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œä½äºä¸­è½´çº¿ä¸Šçš„ä¸ºåŒæ–¹éƒ½ç”¨åˆ°çš„æ¥å£ã€‚</li>
<li>å›¾ä¸­ä»ä¸‹è‡³ä¸Šåˆ†ä¸ºåå±‚ï¼Œå„å±‚å‡ä¸º<strong>å•å‘</strong>ä¾èµ–ï¼Œå³è¾¹çš„&nbsp;<strong>é»‘è‰²ç®­å¤´</strong>( Depend ) ä»£è¡¨å±‚ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥å‰¥ç¦»ä¸Šå±‚è¢«å¤ç”¨ã€‚å…¶ä¸­ï¼ŒService å’Œ Config å±‚ä¸º APIï¼Œå…¶å®ƒå„å±‚å‡ä¸º&nbsp;<a href="http://blog.csdn.net/top_code/article/details/51934459" target="_blank" rel="external nofollow noopener noreferrer">SPI</a>&nbsp;ã€‚</li>
<li>å›¾ä¸­&nbsp;<strong>ç»¿è‰²å°å—</strong>( Interface ) çš„ä¸ºæ‰©å±•æ¥å£ï¼Œ<strong>è“è‰²å°å—</strong>( Class ) ä¸ºå®ç°ç±»ï¼Œå›¾ä¸­åªæ˜¾ç¤ºç”¨äºå…³è”å„å±‚çš„å®ç°ç±»ã€‚</li>
<li>å›¾ä¸­&nbsp;<strong>è“è‰²è™šçº¿</strong>( Init ) ä¸ºåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå³å¯åŠ¨æ—¶ç»„è£…é“¾ã€‚<strong>çº¢è‰²å®çº¿</strong>( Call )ä¸ºæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ï¼Œå³è¿è¡Œæ—¶è°ƒæ—¶é“¾ã€‚<strong>ç´«è‰²ä¸‰è§’ç®­å¤´</strong>( Inherit )ä¸ºç»§æ‰¿ï¼Œå¯ä»¥æŠŠå­ç±»çœ‹ä½œçˆ¶ç±»çš„åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œçº¿ä¸Šçš„æ–‡å­—ä¸ºè°ƒç”¨çš„æ–¹æ³•ã€‚</li>
</ul>
</blockquote>
<h2 id="2-2-å„å±‚è¯´æ˜">2.2 å„å±‚è¯´æ˜</h2>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šå»ºè®®å¯ä»¥å…ˆé˜…è¯»&nbsp;<a href="http://svip.iocoder.cn/Dubbo/intro/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; é¡¹ç›®ç»“æ„ä¸€è§ˆã€‹</a>&nbsp;æ–‡ç« ã€‚</p>
</blockquote>
<ul>
<li>==================== Business ====================</li>
<li><strong>Service ä¸šåŠ¡å±‚</strong>ï¼šä¸šåŠ¡ä»£ç çš„æ¥å£ä¸å®ç°ã€‚æˆ‘ä»¬å®é™…ä½¿ç”¨ Dubbo</li>
<li>==================== RPC ====================</li>
<li><strong>config é…ç½®å±‚</strong>ï¼šå¯¹å¤–é…ç½®æ¥å£ï¼Œä»¥ ServiceConfig, ReferenceConfig ä¸ºä¸­å¿ƒï¼Œå¯ä»¥ç›´æ¥åˆå§‹åŒ–é…ç½®ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Spring è§£æé…ç½®ç”Ÿæˆé…ç½®ç±»ã€‚
<ul>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-config" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-config</code></a>&nbsp;æ¨¡å—å®ç°ã€‚</li>
<li>è¿™å±‚çš„ä»£ç ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/implementation-intro/">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; API é…ç½®ã€‹</a>&nbsp;ã€<a href="http://svip.iocoder.cn/Dubbo/configuration-xml/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; XML é…ç½®ã€‹</a>&nbsp;ç­‰ç­‰æ–‡ç« ï¼Œå·²ç»è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li><strong>proxy æœåŠ¡ä»£ç†å±‚</strong>ï¼šæœåŠ¡æ¥å£é€æ˜ä»£ç†ï¼Œç”ŸæˆæœåŠ¡çš„å®¢æˆ·ç«¯ Stub å’ŒæœåŠ¡å™¨ç«¯ Skeleton,&nbsp;<del>ä»¥ ServiceProxy ä¸ºä¸­å¿ƒ</del>ï¼Œæ‰©å±•æ¥å£ä¸º ProxyFactory ã€‚
<ul>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-rpc-rpc</code></a>&nbsp;æ¨¡å—å®ç°ã€‚</li>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/proxy" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.proxy</code></a>åŒ… +&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ProxyFactory.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.ProxyFactory</code></a>æ¥å£ ã€‚</li>
<li>åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/implementation-intro/">ã€Œ4.5 ProxyFactoryã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li><strong>registry</strong>&nbsp;æ³¨å†Œä¸­å¿ƒå±‚ï¼šå°è£…æœåŠ¡åœ°å€çš„æ³¨å†Œä¸å‘ç°ï¼Œä»¥æœåŠ¡ URL ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º RegistryFactory, Registry, RegistryService ã€‚
<ul>
<li><a href="https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-registry" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-registry</code></a>&nbsp;æ¨¡å—å®ç°ã€‚</li>
</ul>
</li>
<li><strong>cluster è·¯ç”±å±‚</strong>ï¼šå°è£…å¤šä¸ªæä¾›è€…çš„è·¯ç”±åŠè´Ÿè½½å‡è¡¡ï¼Œå¹¶æ¡¥æ¥æ³¨å†Œä¸­å¿ƒï¼Œä»¥ Invoker ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Cluster, Directory, Router, LoadBalance ã€‚
<ul>
<li><a href="https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-cluster" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-cluster</code></a>&nbsp;æ¨¡å—å®ç°ã€‚</li>
<li>è¿™å±‚çš„ä»£ç ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/intro/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; é¡¹ç›®ç»“æ„ä¸€è§ˆã€‹ã€Œ3.4 dubbo-clusterã€</a>&nbsp;ç« èŠ‚ï¼Œæœ‰ç®€å•ä»‹ç»ã€‚</li>
</ul>
</li>
<li><strong>monitor ç›‘æ§å±‚</strong>ï¼šRPC è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç›‘æ§ï¼Œä»¥ Statistics ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º MonitorFactory, Monitor, MonitorService ã€‚
<ul>
<li><a href="https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-cluster" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-monitor</code></a>&nbsp;æ¨¡å—å®ç°ã€‚</li>
</ul>
</li>
<li>==================== Remoting ====================</li>
<li><strong>protocol è¿œç¨‹è°ƒç”¨å±‚</strong>ï¼šå°å°† RPC è°ƒç”¨ï¼Œä»¥ Invocation, Result ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Protocol, Invoker, Exporter ã€‚
<ul>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-rpc-rpc</code></a>&nbsp;æ¨¡å—å®ç°ã€‚</li>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/protocol" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol</code></a>åŒ… +&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ProxyFactory.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.Protocol</code></a>æ¥å£ ã€‚</li>
<li>åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/implementation-intro/">ã€Œ4.6 Protocolã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li><strong>exchange ä¿¡æ¯äº¤æ¢å±‚</strong>ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ Request, Response ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Exchanger, ExchangeChannel, ExchangeClient, ExchangeServer ã€‚
<ul>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-remoting-api</code></a>&nbsp;æ¨¡å—å®šä¹‰æ¥å£ã€‚</li>
<li><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/exchange/" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.remoting.exchange</code></a>åŒ…ã€‚</li>
</ul>
</li>
<li><strong>transport ç½‘ç»œä¼ è¾“å±‚</strong>ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Channel, Transporter, Client, Server, Codec ã€‚
<ul>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-remoting-api</code></a>&nbsp;æ¨¡å—å®šä¹‰æ¥å£ã€‚</li>
<li><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/transport/" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.remoting.transport</code></a>åŒ…ã€‚</li>
</ul>
</li>
<li><strong>serialize æ•°æ®åºåˆ—åŒ–å±‚</strong>ï¼šå¯å¤ç”¨çš„ä¸€äº›å·¥å…·ï¼Œæ‰©å±•æ¥å£ä¸º Serialization, ObjectInput, ObjectOutput, ThreadPool ã€‚
<ul>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-common" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-common</code></a>&nbsp;æ¨¡å—å®ç°ã€‚</li>
<li><a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize</code></a>åŒ…ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-3-å…³ç³»è¯´æ˜">2.3 å…³ç³»è¯´æ˜</h2>
<blockquote>
<p>åœ¨ RPC ä¸­ï¼ŒProtocol æ˜¯æ ¸å¿ƒå±‚ï¼Œä¹Ÿå°±æ˜¯åªè¦æœ‰ Protocol + Invoker + Exporter å°±å¯ä»¥å®Œæˆéé€æ˜çš„ RPC è°ƒç”¨ï¼Œç„¶ååœ¨ Invoker çš„ä¸»è¿‡ç¨‹ä¸Š Filter æ‹¦æˆªç‚¹ã€‚</p>
</blockquote>
<ul>
<li>è§£è¯´ï¼š<a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-rpc-rpc</code></a>&nbsp;æ¨¡å—å³å¯<strong>ç‹¬ç«‹</strong>å®Œæˆè¯¥åŠŸèƒ½ã€‚</li>
</ul>
<blockquote>
<p><strong>å›¾ä¸­çš„ Consumer å’Œ Provider æ˜¯æŠ½è±¡æ¦‚å¿µ</strong>ï¼Œåªæ˜¯æƒ³è®©çœ‹å›¾è€…æ›´ç›´è§‚çš„äº†è§£å“ªäº›ç±»åˆ†å±äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯ï¼Œä¸ç”¨ Client å’Œ Server çš„åŸå› æ˜¯ Dubbo åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½ä½¿ç”¨ Provider, Consumer, Registry, Monitor åˆ’åˆ†é€»è¾‘æ‹“æ™®èŠ‚ç‚¹ï¼Œä¿æŒç»Ÿä¸€æ¦‚å¿µã€‚</p>
</blockquote>
<ul>
<li>x</li>
</ul>
<blockquote>
<p>è€Œ Cluster æ˜¯å¤–å›´æ¦‚å¿µï¼Œæ‰€ä»¥ Cluster çš„ç›®çš„æ˜¯å°†å¤šä¸ª Invoker ä¼ªè£…æˆä¸€ä¸ª Invokerï¼Œè¿™æ ·å…¶å®ƒäººåªè¦å…³æ³¨ Protocol å±‚ Invoker å³å¯ï¼ŒåŠ ä¸Š Cluster æˆ–è€…å»æ‰ Cluster å¯¹å…¶å®ƒå±‚éƒ½ä¸ä¼šé€ æˆå½±å“ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæä¾›è€…æ—¶ï¼Œæ˜¯ä¸éœ€è¦ Cluster çš„ã€‚</p>
</blockquote>
<ul>
<li>è§£è¯´ï¼š<a href="https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-cluster" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-cluster</code></a>&nbsp;æ¨¡å—æä¾›çš„æ˜¯<strong>éå¿…é¡»</strong>çš„åŠŸèƒ½ã€‚ç§»é™¤è¯¥æ¨¡å—ï¼ŒRPC äº¦å¯æ­£å¸¸è¿è¡Œã€‚</li>
</ul>
<blockquote>
<p><strong>Proxy å±‚</strong>å°è£…äº†æ‰€æœ‰æ¥å£çš„é€æ˜åŒ–ä»£ç†ï¼Œè€Œåœ¨å…¶å®ƒå±‚éƒ½ä»¥ Invoker ä¸ºä¸­å¿ƒï¼Œåªæœ‰åˆ°äº†æš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨æ—¶ï¼Œæ‰ç”¨ Proxy å°† Invoker è½¬æˆæ¥å£ï¼Œæˆ–å°†æ¥å£å®ç°è½¬æˆ Invokerï¼Œä¹Ÿå°±æ˜¯å»æ‰ Proxy å±‚ RPC æ˜¯å¯ä»¥ Run çš„ï¼Œåªæ˜¯ä¸é‚£ä¹ˆé€æ˜ï¼Œä¸é‚£ä¹ˆçœ‹èµ·æ¥åƒè°ƒæœ¬åœ°æœåŠ¡ä¸€æ ·è°ƒè¿œç¨‹æœåŠ¡ã€‚</p>
</blockquote>
<ul>
<li>è§£è¯´ï¼šç®€å•ç²—æš´çš„è¯´ï¼ŒProxy ä¼š<strong>æ‹¦æˆª</strong>&nbsp;<code>service.doSomething(args)</code>&nbsp;çš„è°ƒç”¨ï¼Œ&ldquo;è½¬å‘&rdquo;ç»™è¯¥ Service å¯¹åº”çš„ Invoker ï¼Œä»è€Œå®ç°<strong>é€æ˜åŒ–</strong>çš„ä»£ç†ã€‚</li>
</ul>
<blockquote>
<p>è€Œ&nbsp;<strong>Remoting</strong>&nbsp;å®ç°æ˜¯ Dubbo åè®®çš„å®ç°ï¼Œå¦‚æœä½ é€‰æ‹© RMI åè®®ï¼Œæ•´ä¸ª Remoting éƒ½ä¸ä¼šç”¨ä¸Šã€‚Remoting å†…éƒ¨å†åˆ’ä¸º Transport ä¼ è¾“å±‚å’Œ Exchange ä¿¡æ¯äº¤æ¢å±‚ï¼Œ<strong>Transport å±‚</strong>åªè´Ÿè´£å•å‘æ¶ˆæ¯ä¼ è¾“ï¼Œæ˜¯å¯¹ Mina, Netty, Grizzly çš„æŠ½è±¡ï¼Œå®ƒä¹Ÿå¯ä»¥æ‰©å±• UDP ä¼ è¾“ï¼›è€Œ&nbsp;<strong>Exchange å±‚</strong>æ˜¯åœ¨ä¼ è¾“å±‚ä¹‹ä¸Šå°è£…äº† Request-Response è¯­ä¹‰ã€‚</p>
</blockquote>
<ul>
<li>x</li>
</ul>
<blockquote>
<p><strong>Registry å’Œ Monitor</strong>&nbsp;å®é™…ä¸Šä¸ç®—ä¸€å±‚ï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ï¼Œåªæ˜¯ä¸ºäº†å…¨å±€æ¦‚è§ˆï¼Œç”¨å±‚çš„æ–¹å¼ç”»åœ¨ä¸€èµ·ã€‚</p>
</blockquote>
<ul>
<li>x</li>
</ul>
<h1 id="3-æ ¸å¿ƒæµç¨‹">3. æ ¸å¿ƒæµç¨‹</h1>
<h2 id="3-1-è°ƒç”¨é“¾">3.1 è°ƒç”¨é“¾</h2>
<p>å±•å¼€æ€»è®¾è®¡å›¾çš„<strong>çº¢è‰²è°ƒç”¨é“¾</strong>( Call )ï¼Œå¦‚ä¸‹ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; æ¡†æ¶è®¾è®¡ã€‹</a><br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/02.png" alt="è°ƒç”¨é“¾" /></p>
</blockquote>
<ul>
<li>å‚ç›´åˆ†å±‚å¦‚ä¸‹ï¼š
<ul>
<li>ä¸‹æ–¹&nbsp;<strong>æ·¡è“èƒŒæ™¯</strong>( Consumer )ï¼šæœåŠ¡æ¶ˆè´¹æ–¹ä½¿ç”¨çš„æ¥å£</li>
<li>ä¸Šæ–¹&nbsp;<strong>æ·¡ç»¿è‰²èƒŒæ™¯</strong>( Provider )ï¼šæœåŠ¡æä¾›æ–¹ä½¿ç”¨çš„æ¥å£</li>
<li>ä¸­é—´&nbsp;<strong>ç²‰è‰²èƒŒæ™¯</strong>( Remoting )ï¼šé€šä¿¡éƒ¨åˆ†çš„æ¥å£</li>
</ul>
</li>
<li>è‡ª LoadBalance å‘ä¸Šï¼Œæ¯ä¸€è¡Œåˆ†æˆäº†<strong>å¤šä¸ª</strong>ç›¸åŒçš„ Interface ï¼ŒæŒ‡çš„æ˜¯<strong>è´Ÿè½½å‡è¡¡</strong>åï¼Œå‘ Provider å‘èµ·è°ƒç”¨ã€‚</li>
<li>å·¦è¾¹&nbsp;<strong>æ‹¬å·</strong>&nbsp;éƒ¨åˆ†ï¼Œä»£è¡¨äº†å‚ç›´éƒ¨åˆ†æ›´<strong>ç»†åŒ–</strong>çš„åˆ†å±‚ï¼Œä¾æ¬¡æ˜¯ï¼šCommonã€Remotingã€RPCã€Interface ã€‚</li>
<li>å³è¾¹&nbsp;<strong>è“è‰²è™šçº¿</strong>( Init ) ä¸ºåˆå§‹åŒ–è¿‡ç¨‹ï¼Œé€šè¿‡å¯¹åº”çš„ç»„ä»¶è¿›è¡Œåˆå§‹åŒ–ã€‚ä¾‹å¦‚ï¼ŒProxyFactory åˆå§‹åŒ–å‡º Proxy ã€‚</li>
</ul>
<h2 id="3-2-æš´éœ²æœåŠ¡">3.2 æš´éœ²æœåŠ¡</h2>
<p>å±•å¼€æ€»è®¾è®¡å›¾<strong>å·¦è¾¹</strong>æœåŠ¡æä¾›æ–¹æš´éœ²æœåŠ¡çš„<strong>è“è‰²åˆå§‹åŒ–é“¾</strong>( Init )ï¼Œæ—¶åºå›¾å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; æ¡†æ¶è®¾è®¡ã€‹</a><br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/09.jpeg" alt="æš´éœ²æœåŠ¡æ—¶åº" /></p>
</blockquote>
<h2 id="3-3-å¼•ç”¨æœåŠ¡">3.3 å¼•ç”¨æœåŠ¡</h2>
<p>å±•å¼€æ€»è®¾è®¡å›¾<strong>å³è¾¹</strong>æœåŠ¡æ¶ˆè´¹æ–¹å¼•ç”¨æœåŠ¡çš„<strong>è“è‰²åˆå§‹åŒ–é“¾</strong>( Init )ï¼Œæ—¶åºå›¾å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; æ¡†æ¶è®¾è®¡ã€‹</a><br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/10.jpeg" alt="å¼•ç”¨æœåŠ¡æ—¶åº" /></p>
</blockquote>
<h1 id="4-é¢†åŸŸæ¨¡å‹">4. é¢†åŸŸæ¨¡å‹</h1>
<p>æœ¬å°èŠ‚åˆ†äº«çš„ï¼Œåœ¨&nbsp;<a href="https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-rpc-api</code></a>&nbsp;ç›®å½•ä¸­ï¼Œå¦‚ä¸‹å›¾çº¢æ¡†éƒ¨åˆ†ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/03.png" alt="é¢†åŸŸæ¨¡å‹" /></p>
<h2 id="4-1-Invoker">4.1 Invoker</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Invoker.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.Invoker</code></a>&nbsp;ã€‚</p>
<blockquote>
<p>Invoker æ˜¯å®ä½“åŸŸï¼Œå®ƒæ˜¯ Dubbo çš„æ ¸å¿ƒæ¨¡å‹ï¼Œå…¶å®ƒæ¨¡å‹éƒ½å‘å®ƒé æ‰°ï¼Œæˆ–è½¬æ¢æˆå®ƒã€‚<br />å®ƒä»£è¡¨ä¸€ä¸ªå¯æ‰§è¡Œä½“ï¼Œå¯å‘å®ƒå‘èµ· invoke è°ƒç”¨ã€‚<br />å®ƒæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæœ¬åœ°çš„å®ç°ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªè¿œç¨‹çš„å®ç°ï¼Œä¹Ÿå¯èƒ½ä¸€ä¸ªé›†ç¾¤å®ç°ã€‚</p>
</blockquote>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Invoker</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Node</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get service interface.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> service interface.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Class&lt;T&gt; <span class="title">getInterface</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * invoke.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invocation</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> result</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Result <span class="title">invoke</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>#getInterface()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾— Service æ¥å£ã€‚</li>
<li><code>#invoke(Invocation)</code>&nbsp;æ–¹æ³•ï¼Œè°ƒç”¨æ–¹æ³•ã€‚</li>
</ul>
<h3 id="4-1-1-æ»¡çœ¼éƒ½æ˜¯-Invoker">4.1.1 æ»¡çœ¼éƒ½æ˜¯ Invoker</h3>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬è¦å¼•ç”¨&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/implementation.html#fn_5" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; å®ç°ç»†èŠ‚ã€‹</a>&nbsp;çš„&nbsp;<a href="http://svip.iocoder.cn/Dubbo/implementation-intro/"><strong>æ»¡çœ¼éƒ½æ˜¯ Invoker</strong></a>&nbsp;å°èŠ‚çš„å†…å®¹ï¼Œæ¥è¿›ä¸€æ­¥ç†è§£ Invoker ï¼š</p>
<p>ç”±äº Invoker æ˜¯ Dubbo é¢†åŸŸæ¨¡å‹ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå¾ˆå¤šè®¾è®¡æ€è·¯éƒ½æ˜¯å‘å®ƒé æ‹¢ã€‚<br />è¿™å°±ä½¿å¾— Invoker æ¸—é€åœ¨æ•´ä¸ªå®ç°ä»£ç é‡Œï¼Œå¯¹äºåˆšå¼€å§‹æ¥è§¦ Dubbo çš„äººï¼Œç¡®å®å®¹æ˜“ç»™ææ··äº†ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç²¾ç®€çš„å›¾æ¥è¯´æ˜æœ€é‡è¦çš„ä¸¤ç§ Invokerï¼šæœåŠ¡æä¾› Invoker å’ŒæœåŠ¡æ¶ˆè´¹ Invokerï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/04.png" alt="æ»¡çœ¼éƒ½æ˜¯ Invoker" /></p>
<p>ä¸ºäº†æ›´å¥½çš„è§£é‡Šä¸Šé¢è¿™å¼ å›¾ï¼Œæˆ‘ä»¬<strong>ç»“åˆæœåŠ¡æ¶ˆè´¹å’Œæä¾›è€…çš„ä»£ç ç¤ºä¾‹</strong>æ¥è¿›è¡Œè¯´æ˜ï¼š</p>
<ul>
<li>
<p>æœåŠ¡æ¶ˆè´¹è€…ä»£ç ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoClientAction</span> </span>{</span><br /><br /><span class="line">    <span class="keyword">private</span> DemoService demoService;</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDemoService</span><span class="params">(DemoService demoService)</span> </span>{</span><br /><span class="line">        <span class="keyword">this</span>.demoService = demoService;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>{</span><br /><span class="line">        String hello = demoService.sayHello(<span class="string">"world"</span> + i);</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ä¸Šé¢ä»£ç ä¸­çš„ DemoService å°±æ˜¯ä¸Šå›¾ä¸­æœåŠ¡æ¶ˆè´¹ç«¯çš„ Proxyï¼Œç”¨æˆ·ä»£ç é€šè¿‡è¿™ä¸ª Proxy è°ƒç”¨å…¶å¯¹åº”çš„ Invokerï¼Œè€Œè¯¥ Invoker å®ç°äº†çœŸæ­£çš„è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚</li>
</ul>
</li>
<li>
<p>æœåŠ¡æä¾›è€…ä»£ç ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title">DemoService</span> </span>{</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="string">"Hello "</span> + name;</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ä¸Šé¢è¿™ä¸ªç±»ä¼šè¢«å°è£…æˆä¸ºä¸€ä¸ª AbstractProxyInvoker å®ä¾‹ï¼Œå¹¶æ–°ç”Ÿæˆä¸€ä¸ª Exporter å®ä¾‹ã€‚è¿™æ ·å½“ç½‘ç»œé€šè®¯å±‚æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šæ‰¾åˆ°å¯¹åº”çš„ Exporter å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®ƒæ‰€å¯¹åº”çš„ AbstractProxyInvoker å®ä¾‹ï¼Œä»è€ŒçœŸæ­£è°ƒç”¨äº†æœåŠ¡æä¾›è€…çš„ä»£ç ã€‚</li>
</ul>
</li>
</ul>
<p><em>Dubbo é‡Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ Invoker ç±»ï¼Œä½†ä¸Šé¢ä¸¤ç§æ˜¯æœ€é‡è¦çš„</em>ã€‚</p>
<h3 id="4-1-2-ç±»å›¾">4.1.2 ç±»å›¾</h3>
<p>æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼ŒInvoker æ¸—é€åœ¨ Dubbo çš„ä»£ç ä¸­ï¼ŒInvoker çš„å®ç°ç±»ä¹Ÿéå¸¸éå¸¸éå¸¸å¤šï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/05.png" alt="Invoker å­ç±»" /></p>
<p>åç»­æˆ‘ä»¬ä¼šè¯¦ç»†åˆ†æã€‚</p>
<h2 id="4-2-Invocation">4.2 Invocation</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Invocation.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.Invocation</code></a>&nbsp;ã€‚</p>
<blockquote>
<p>Invocation æ˜¯ä¼šè¯åŸŸï¼Œå®ƒæŒæœ‰è°ƒç”¨è¿‡ç¨‹ä¸­çš„å˜é‡ï¼Œæ¯”å¦‚æ–¹æ³•åï¼Œå‚æ•°ç­‰ã€‚</p>
</blockquote>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Invocation</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get method name.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> method name.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">String <span class="title">getMethodName</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get parameter types.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> parameter types.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    Class&lt;?&gt;[] getParameterTypes();</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get arguments.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> arguments.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    Object[] getArguments();</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get attachments.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> attachments.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Map&lt;String, String&gt; <span class="title">getAttachments</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get attachment by key.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> attachment value.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">String <span class="title">getAttachment</span><span class="params">(String key)</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get attachment by key with default value.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> attachment value.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@serial</span></span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">String <span class="title">getAttachment</span><span class="params">(String key, String defaultValue)</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get the invoker in current context.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> invoker.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@transient</span></span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    Invoker&lt;?&gt; getInvoker();</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>#getMethodName()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—æ–¹æ³•åã€‚</li>
<li><code>#getParameterTypes()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—æ–¹æ³•å‚æ•°<strong>ç±»å‹</strong>æ•°ç»„ã€‚</li>
<li><code>#getArguments()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—æ–¹æ³•å‚æ•°æ•°ç»„ã€‚</li>
<li><code>#getAttachments()</code>&nbsp;ç­‰æ–¹æ³•ï¼Œè·å¾—éšå¼å‚æ•°ç›¸å…³ã€‚
<ul>
<li>ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/attachment.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; éšå¼å‚æ•°ã€‹</a>&nbsp;æ–‡æ¡£ã€‚</li>
<li>å’Œ HTTP Request&nbsp;<strong>Header</strong>&nbsp;æœ‰äº›ç›¸ä¼¼ã€‚</li>
</ul>
</li>
<li><code>#getInvoker()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—å¯¹åº”çš„ Invoker å¯¹è±¡ã€‚</li>
</ul>
<h3 id="4-2-1-ç±»å›¾">4.2.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/06.png" alt="Invocation å­ç±»" /></p>
<ul>
<li><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/RpcInvocation.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.RpcInvocation</code></a>
<ul>
<li>ç‚¹å‡»æŸ¥çœ‹ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚</li>
</ul>
</li>
<li><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-default/src/main/java/com/alibaba/dubbo/rpc/protocol/dubbo/DecodeableRpcInvocation.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.dubbo.DecodeableRpcInvocation</code></a>
<ul>
<li>Dubbo åè®®<strong>ç‹¬æœ‰</strong>ï¼Œåç»­æ–‡ç« åˆ†äº«ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-3-Result">4.3 Result</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Result.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.Result</code></a>&nbsp;ã€‚</p>
<p>Result æ˜¯ä¼šè¯åŸŸï¼Œå®ƒæŒæœ‰è°ƒç”¨è¿‡ç¨‹ä¸­è¿”å›å€¼ï¼Œå¼‚å¸¸ç­‰ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Result</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Get invoke result.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> result. if no result return null.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Object <span class="title">getValue</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Get exception.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> exception. if no exception return null.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Throwable <span class="title">getException</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Has exception.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> has exception.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasException</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Recreate.</span></span><br /><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br /><span class="line"><span class="comment">     * &lt;code&gt;</span></span><br /><span class="line"><span class="comment">     * if (hasException()) {</span></span><br /><span class="line"><span class="comment">     * throw getException();</span></span><br /><span class="line"><span class="comment">     * } else {</span></span><br /><span class="line"><span class="comment">     * return getValue();</span></span><br /><span class="line"><span class="comment">     * }</span></span><br /><span class="line"><span class="comment">     * &lt;/code&gt;</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> result.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> if has exception throw it.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Object <span class="title">recreate</span><span class="params">()</span> <span class="keyword">throws</span> Throwable</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get attachments.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> attachments.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Map&lt;String, String&gt; <span class="title">getAttachments</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get attachment by key.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> attachment value.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">String <span class="title">getAttachment</span><span class="params">(String key)</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get attachment by key with default value.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> attachment value.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">String <span class="title">getAttachment</span><span class="params">(String key, String defaultValue)</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>#getValue()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—è¿”å›å€¼ã€‚</li>
<li><code>#getException()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—è¿”å›çš„å¼‚å¸¸ã€‚
<ul>
<li><code>#hasException()</code>&nbsp;æ–¹æ³•ï¼Œæ˜¯å¦æœ‰å¼‚å¸¸ã€‚</li>
</ul>
</li>
<li>
<p><code>#recreate()</code>&nbsp;æ–¹æ³•ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// RpcResult.java</span></span><br /><br /><span class="line"><span class="keyword">private</span> Object result;</span><br /><br /><span class="line"><span class="keyword">private</span> Throwable exception;</span><br /><br /><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">recreate</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>{</span><br /><span class="line">    <span class="keyword">if</span> (exception != <span class="keyword">null</span>) {</span><br /><span class="line">        <span class="keyword">throw</span> exception;</span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">return</span> result;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p><code>#getAttachments()</code>&nbsp;ç­‰æ–¹æ³•ï¼Œè·å¾—<strong>è¿”å›</strong>çš„éšå¼å‚æ•°ç›¸å…³ã€‚</p>
<ul>
<li>ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/attachment.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; éšå¼å‚æ•°ã€‹</a>&nbsp;æ–‡æ¡£ã€‚</li>
<li>å’Œ HTTP Response&nbsp;<strong>Header</strong>&nbsp;æœ‰äº›ç›¸ä¼¼ã€‚</li>
</ul>
</li>
</ul>
<h3 id="4-3-1-ç±»å›¾">4.3.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/07.png" alt="Invocation å­ç±»" /></p>
<ul>
<li><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/RpcResult.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.RpcResult</code></a>
<ul>
<li>ç‚¹å‡»æŸ¥çœ‹ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚</li>
</ul>
</li>
<li><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-default/src/main/java/com/alibaba/dubbo/rpc/protocol/dubbo/DecodeableRpcResult.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.dubbo.DecodeableRpcResult</code></a>
<ul>
<li>Dubbo åè®®<strong>ç‹¬æœ‰</strong>ï¼Œåç»­æ–‡ç« åˆ†äº«ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-4-Filter">4.4 Filter</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Filter.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.Filter</code></a>&nbsp;ã€‚</p>
<p>è¿‡æ»¤å™¨æ¥å£ï¼Œå’Œæˆ‘ä»¬å¹³æ—¶ç†è§£çš„&nbsp;<a href="https://docs.oracle.com/javaee/5/api/javax/servlet/Filter.html" target="_blank" rel="external nofollow noopener noreferrer"><code>javax.servlet.Filter</code></a>&nbsp;åŸºæœ¬ä¸€è‡´ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Filter</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * do invoke filter.</span></span><br /><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br /><span class="line"><span class="comment">     * &lt;code&gt;</span></span><br /><span class="line"><span class="comment">     * // before filter</span></span><br /><span class="line"><span class="comment">     * Result result = invoker.invoke(invocation);</span></span><br /><span class="line"><span class="comment">     * // after filter</span></span><br /><span class="line"><span class="comment">     * return result;</span></span><br /><span class="line"><span class="comment">     * &lt;/code&gt;</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker    service</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invocation invocation.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> invoke result.</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Invoker#invoke(Invocation)</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p><code>#invoke(...)</code>&nbsp;æ–¹æ³•ï¼Œæ‰§è¡Œ Invoker çš„è¿‡æ»¤é€»è¾‘ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// ã€è‡ªå·±å®ç°ã€‘before filter</span></span><br /><br /><span class="line">Result result = invoker.invoke(invocation);</span><br /><br /><span class="line"><span class="comment">// ã€è‡ªå·±å®ç°ã€‘after filter</span></span><br /><br /><span class="line"><span class="keyword">return</span> result;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<h3 id="4-4-1-ç±»å›¾">4.4.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/08.png" alt="Filter å­ç±»" /></p>
<h2 id="4-5-ProxyFactory">4.5 ProxyFactory</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ProxyFactory.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.ProxyFactory</code></a>&nbsp;ï¼Œä»£ç†å·¥å‚æ¥å£ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span>(<span class="string">"javassist"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ProxyFactory</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * create proxy.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * åˆ›å»º Proxy ï¼Œåœ¨å¼•ç”¨æœåŠ¡è°ƒç”¨ã€‚</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> proxy</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span>({Constants.PROXY_KEY})</span><br /><span class="line">    &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * create invoker.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * åˆ›å»º Invoker ï¼Œåœ¨æš´éœ²æœåŠ¡æ—¶è°ƒç”¨ã€‚</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> proxy</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> type</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> url</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> invoker</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span>({Constants.PROXY_KEY})</span><br /><span class="line">    &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">getInvoker</span><span class="params">(T proxy, Class&lt;T&gt; type, URL url)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p><code>#getProxy(invoker)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º Proxy ï¼Œåœ¨<strong>å¼•ç”¨æœåŠ¡</strong>æ—¶è°ƒç”¨ã€‚</p>
<ul>
<li>æ–¹æ³•å‚æ•°å¦‚ä¸‹ï¼š
<ul>
<li><code>invoker</code>&nbsp;å‚æ•°ï¼ŒConsumer å¯¹ Provider è°ƒç”¨çš„ Invoker ã€‚</li>
</ul>
</li>
<li>
<p>æœåŠ¡æ¶ˆè´¹ç€å¼•ç”¨æœåŠ¡çš„&nbsp;<strong>ä¸»è¿‡ç¨‹</strong>&nbsp;å¦‚ä¸‹å›¾ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; å®ç°ç»†èŠ‚ã€‹</a><br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/12.png" alt="æœåŠ¡æ¶ˆè´¹ç€å¼•ç”¨æœåŠ¡çš„ä¸»è¿‡ç¨‹" /></p>
</blockquote>
<ul>
<li>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•çš„&nbsp;<code>invoker</code>&nbsp;å‚æ•°ï¼Œé€šè¿‡ Protocol å°†&nbsp;<strong>Serviceæ¥å£</strong>&nbsp;åˆ›å»ºå‡º Invoker ã€‚</li>
<li>é€šè¿‡åˆ›å»º Service çš„ Proxy ï¼Œå®ç°æˆ‘ä»¬åœ¨ä¸šåŠ¡ä»£ç†è°ƒç”¨ Service çš„æ–¹æ³•æ—¶ï¼Œ<strong>é€æ˜çš„å†…éƒ¨è½¬æ¢æˆè°ƒç”¨</strong>&nbsp;Invoker çš„&nbsp;<code>#invoke(Invocation)</code>&nbsp;æ–¹æ³•ã€‚ğŸ™‚ å¦‚æœè¿˜æ˜¯æ¯”è¾ƒæ¨¡ç³Šï¼Œæœ¨æœ‰å…³ç³»ï¼Œåé¢ä¼šæœ‰æ–‡ç« ï¼Œä¸“é—¨è¯¦ç»†ä»£ç çš„åˆ†äº«ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>#getInvoker(proxy, type, url)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º Invoker ï¼Œåœ¨<strong>æš´éœ²æœåŠ¡</strong>æ—¶è°ƒç”¨ã€‚</p>
<ul>
<li>æ–¹æ³•å‚æ•°å¦‚ä¸‹ï¼š
<ul>
<li><code>proxy</code>&nbsp;å‚æ•°ï¼ŒService å¯¹è±¡ã€‚</li>
<li><code>type</code>&nbsp;å‚æ•°ï¼ŒService æ¥å£ç±»å‹ã€‚</li>
<li><code>url</code>&nbsp;å‚æ•°ï¼ŒService å¯¹åº”çš„ Dubbo URL ã€‚</li>
</ul>
</li>
<li>
<p>æœåŠ¡æä¾›è€…æš´éœ²æœåŠ¡çš„&nbsp;<strong>ä¸»è¿‡ç¨‹</strong>&nbsp;å¦‚ä¸‹å›¾ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; å®ç°ç»†èŠ‚ã€‹</a><br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/11.png" alt="æœåŠ¡æä¾›è€…æš´éœ²æœåŠ¡çš„ä¸»è¿‡ç¨‹" /></p>
</blockquote>
<ul>
<li>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•åˆ›å»ºçš„ Invoker ï¼Œä¸‹ä¸€æ­¥ä¼šæäº¤ç»™ Protocol ï¼Œä» Invoker è½¬æ¢åˆ° Exporter ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-5-1-ç±»å›¾">4.5.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/13.png" alt="ProxyFactory å­ç±»" /></p>
<p>ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º Dubbo æ”¯æŒ Javassist å’Œ JDK Proxy ä¸¤ç§æ–¹å¼ç”Ÿæˆä»£ç†ã€‚</p>
<p>å…·ä½“å¦‚ä½•å®ç°ï¼Œè¯·çœ‹åé¢çš„æ–‡ç« ã€‚</p>
<h2 id="4-6-Protocol">4.6 Protocol</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Protocol.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.Protocol</code></a>&nbsp;ã€‚</p>
<blockquote>
<p>Protocol æ˜¯æœåŠ¡åŸŸï¼Œå®ƒæ˜¯ Invoker æš´éœ²å’Œå¼•ç”¨çš„ä¸»åŠŸèƒ½å…¥å£ã€‚<br />å®ƒè´Ÿè´£ Invoker çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</p>
</blockquote>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span>(<span class="string">"dubbo"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Protocol</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Get default port when user doesn't config the port.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> default port</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getDefaultPort</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Export service for remote invocation: &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 1. Protocol should record request source address after receive a request:</span></span><br /><span class="line"><span class="comment">     * RpcContext.getContext().setRemoteAddress();&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 2. export() must be idempotent, that is, there's no difference between invoking once and invoking twice when</span></span><br /><span class="line"><span class="comment">     * export the same URL&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 3. Invoker instance is passed in by the framework, protocol needs not to care &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;     Service type</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker Service invoker</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> exporter reference for exported service, useful for unexport the service later</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException thrown when error occurs during export the service, for example: port is occupied</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * æš´éœ²è¿œç¨‹æœåŠ¡ï¼š&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 1. åè®®åœ¨æ¥æ”¶è¯·æ±‚æ—¶ï¼Œåº”è®°å½•è¯·æ±‚æ¥æºæ–¹åœ°å€ä¿¡æ¯ï¼šRpcContext.getContext().setRemoteAddress();&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 2. export() å¿…é¡»æ˜¯å¹‚ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯æš´éœ²åŒä¸€ä¸ª URL çš„ Invoker ä¸¤æ¬¡ï¼Œå’Œæš´éœ²ä¸€æ¬¡æ²¡æœ‰åŒºåˆ«ã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 3. export() ä¼ å…¥çš„ Invoker ç”±æ¡†æ¶å®ç°å¹¶ä¼ å…¥ï¼Œåè®®ä¸éœ€è¦å…³å¿ƒã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;     æœåŠ¡çš„ç±»å‹</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker æœåŠ¡çš„æ‰§è¡Œä½“</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> exporter æš´éœ²æœåŠ¡çš„å¼•ç”¨ï¼Œç”¨äºå–æ¶ˆæš´éœ²</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException å½“æš´éœ²æœåŠ¡å‡ºé”™æ—¶æŠ›å‡ºï¼Œæ¯”å¦‚ç«¯å£å·²å ç”¨</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span></span><br /><span class="line">    &lt;T&gt; <span class="function">Exporter&lt;T&gt; <span class="title">export</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Refer a remote service: &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 1. When user calls `invoke()` method of `Invoker` object which's returned from `refer()` call, the protocol</span></span><br /><span class="line"><span class="comment">     * needs to correspondingly execute `invoke()` method of `Invoker` object &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 2. It's protocol's responsibility to implement `Invoker` which's returned from `refer()`. Generally speaking,</span></span><br /><span class="line"><span class="comment">     * protocol sends remote request in the `Invoker` implementation. &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 3. When there's check=false set in URL, the implementation must not throw exception but try to recover when</span></span><br /><span class="line"><span class="comment">     * connection fails.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;  Service type</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> type Service class</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> url  URL address for the remote service</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> invoker service's local proxy</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException when there's any error while connecting to the service provider</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * å¼•ç”¨è¿œç¨‹æœåŠ¡ï¼š&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 1. å½“ç”¨æˆ·è°ƒç”¨ refer() æ‰€è¿”å›çš„ Invoker å¯¹è±¡çš„ invoke() æ–¹æ³•æ—¶ï¼Œåè®®éœ€ç›¸åº”æ‰§è¡ŒåŒ URL è¿œç«¯ export() ä¼ å…¥çš„ Invoker å¯¹è±¡çš„ invoke() æ–¹æ³•ã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 2. refer() è¿”å›çš„ Invoker ç”±åè®®å®ç°ï¼Œåè®®é€šå¸¸éœ€è¦åœ¨æ­¤ Invoker ä¸­å‘é€è¿œç¨‹è¯·æ±‚ã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 3. å½“ url ä¸­æœ‰è®¾ç½® check=false æ—¶ï¼Œè¿æ¥å¤±è´¥ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶å†…éƒ¨è‡ªåŠ¨æ¢å¤ã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;  æœåŠ¡çš„ç±»å‹</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> type æœåŠ¡çš„ç±»å‹</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> url  è¿œç¨‹æœåŠ¡çš„URLåœ°å€</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> invoker æœåŠ¡çš„æœ¬åœ°ä»£ç†</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException å½“è¿æ¥æœåŠ¡æä¾›æ–¹å¤±è´¥æ—¶æŠ›å‡º</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span></span><br /><span class="line">    &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">refer</span><span class="params">(Class&lt;T&gt; type, URL url)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Destroy protocol: &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 1. Cancel all services this protocol exports and refers &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 2. Release all occupied resources, for example: connection, port, etc. &lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 3. Protocol can continue to export and refer new service even after it's destroyed.</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * é‡Šæ”¾åè®®ï¼š&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 1. å–æ¶ˆè¯¥åè®®æ‰€æœ‰å·²ç»æš´éœ²å’Œå¼•ç”¨çš„æœåŠ¡ã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 2. é‡Šæ”¾åè®®æ‰€å ç”¨çš„æ‰€æœ‰èµ„æºï¼Œæ¯”å¦‚è¿æ¥å’Œç«¯å£ã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     * 3. åè®®åœ¨é‡Šæ”¾åï¼Œä¾ç„¶èƒ½æš´éœ²å’Œå¼•ç”¨æ–°çš„æœåŠ¡ã€‚&lt;br&gt;</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>æ¯ä¸ªæ–¹æ³•çš„è¯´æ˜ï¼Œè¯·<strong>ç»†çœ‹</strong>æ–¹æ³•çš„æ³¨é‡Šã€‚</li>
</ul>
<blockquote>
<p>Dubbo å¤„ç†<strong>æœåŠ¡æš´éœ²</strong>çš„å…³é”®å°±åœ¨ Invoker è½¬æ¢åˆ° Exporter çš„è¿‡ç¨‹ã€‚<br />ä¸‹é¢æˆ‘ä»¬ä»¥ Dubbo å’Œ RMI è¿™ä¸¤ç§å…¸å‹åè®®çš„å®ç°æ¥è¿›è¡Œè¯´æ˜ï¼š</p>
<ul>
<li>
<p><strong>Dubbo çš„å®ç°</strong><br />Dubbo åè®®çš„ Invoker è½¬ä¸º Exporter å‘ç”Ÿåœ¨ DubboProtocol ç±»çš„ export æ–¹æ³•ï¼Œå®ƒä¸»è¦æ˜¯æ‰“å¼€ socket ä¾¦å¬æœåŠ¡ï¼Œå¹¶æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„å„ç§è¯·æ±‚ï¼Œé€šè®¯ç»†èŠ‚ç”± Dubbo è‡ªå·±å®ç°ã€‚</p>
</li>
<li>
<p><strong>RMI çš„å®ç°</strong><br />RMI åè®®çš„ Invoker è½¬ä¸º Exporter å‘ç”Ÿåœ¨ RmiProtocol ç±»çš„ export æ–¹æ³•ï¼Œå®ƒé€šè¿‡ Spring æˆ– Dubbo æˆ– JDK æ¥å®ç° RMI æœåŠ¡ï¼Œé€šè®¯ç»†èŠ‚è¿™ä¸€å—ç”± JDK åº•å±‚æ¥å®ç°ï¼Œè¿™å°±çœäº†ä¸å°‘å·¥ä½œé‡ã€‚</p>
</li>
</ul>
</blockquote>
<h3 id="4-6-1-ç±»å›¾">4.6.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/14.png" alt="Protocol å­ç±»" /></p>
<p>ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º Dubbo æ”¯æŒå¤šç§åè®®çš„å®ç°ã€‚</p>
<p>å…·ä½“å¦‚ä½•å®ç°ï¼Œè¯·çœ‹åé¢çš„æ–‡ç« ã€‚</p>
<h2 id="4-7-Exporter">4.7 Exporter</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Exporter.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.Exporter</code></a>&nbsp;ã€‚</p>
<p>Exporter ï¼ŒInvoker æš´éœ²æœåŠ¡åœ¨ Protocol ä¸Šçš„å¯¹è±¡ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Exporter</span>&lt;<span class="title">T</span>&gt; </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get invoker.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> invoker</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Invoker&lt;T&gt; <span class="title">getInvoker</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * unexport.</span></span><br /><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br /><span class="line"><span class="comment">     * &lt;code&gt;</span></span><br /><span class="line"><span class="comment">     * getInvoker().destroy();</span></span><br /><span class="line"><span class="comment">     * &lt;/code&gt;</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unexport</span><span class="params">()</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>#getInvoker()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—å¯¹åº”çš„ Invoker ã€‚</li>
<li><code>#unexport()</code>&nbsp;æ–¹æ³•ï¼Œå–æ¶ˆæš´éœ²ã€‚
<ul>
<li>Exporter ç›¸æ¯” Invoker æ¥å£ï¼Œå¤šäº†&nbsp;<strong>è¿™ä¸ªæ–¹æ³•</strong>ã€‚é€šè¿‡å®ç°è¯¥æ–¹æ³•ï¼Œä½¿<strong>ç›¸åŒ</strong>çš„ Invoker åœ¨<strong>ä¸åŒ</strong>çš„ Protocol å®ç°çš„å–æ¶ˆæš´éœ²é€»è¾‘ã€‚</li>
</ul>
</li>
</ul>
<h3 id="4-7-1-ç±»å›¾">4.7.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/15.png" alt="Exporter å­ç±»" /></p>
<p>å…·ä½“å¦‚ä½•å®ç°ï¼Œè¯·çœ‹åé¢çš„æ–‡ç« ã€‚</p>
<h2 id="4-8-InvokerListener">4.8 InvokerListener</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/InvokerListener.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.InvokerListener</code></a>&nbsp;ï¼ŒInvoker ç›‘å¬å™¨ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">InvokerListener</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The invoker referred</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡å¼•ç”¨å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Protocol#refer(Class, URL)</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">referred</span><span class="params">(Invoker&lt;?&gt; invoker)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The invoker destroyed.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡é”€æ¯å¼•ç”¨å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> invoker</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Invoker#destroy()</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroyed</span><span class="params">(Invoker&lt;?&gt; invoker)</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h3 id="4-8-1-ç±»å›¾">4.8.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/16.png" alt="InvokerListener å­ç±»" /></p>
<h2 id="4-9-ExporterListener">4.9 ExporterListener</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ExporterListener.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.ExporterListener</code></a>&nbsp;ï¼ŒExporter ç›‘å¬å™¨ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExporterListener</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The exporter exported.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡æš´éœ²å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> exporter</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Protocol#export(Invoker)</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exported</span><span class="params">(Exporter&lt;?&gt; exporter)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The exporter unexported.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡å–æ¶ˆæš´éœ²å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> exporter</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Exporter#unexport()</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unexported</span><span class="params">(Exporter&lt;?&gt; exporter)</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h3 id="4-9-1-ç±»å›¾">4.9.1 ç±»å›¾</h3>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/17.png" alt="ExporterListener å­ç±»" /></p>
</div>