<header class="article-header">
<h1 class="article-title">æœåŠ¡æš´éœ²ï¼ˆä¸€ï¼‰ä¹‹æœ¬åœ°æš´éœ²ï¼ˆInjvmï¼‰</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>Dubbo æœåŠ¡æš´éœ²æœ‰ä¸¤ç§æ–¹å¼</p>
<ul>
<li>
<p>æœ¬åœ°æš´éœ²ï¼ŒJVM æœ¬åœ°è°ƒç”¨ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">scope</span>=<span class="string">"local"</span> /&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>è¿œç¨‹æš´éœ²ï¼Œç½‘ç»œè¿œç¨‹é€šä¿¡ã€‚é…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">scope</span>=<span class="string">"remote"</span> /&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>ã€å¯ä»¥ä¸ç®—ã€‘ä¸æš´éœ²ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">scope</span>=<span class="string">"none"</span> /&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<p>åœ¨ä¸é…ç½®&nbsp;<code>scope</code>&nbsp;çš„æƒ…å†µä¸‹ï¼Œ<strong>é»˜è®¤ä¸¤ç§æ–¹å¼éƒ½æš´éœ²</strong>ã€‚å› ä¸ºï¼ŒDubbo è‡ªèº«æ— æ³•ç¡®è®¤åº”ç”¨ä¸­ï¼Œæ˜¯å¦å­˜åœ¨<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/local-call.html" target="_blank" rel="external nofollow noopener noreferrer">æœ¬åœ°å¼•ç”¨</a>çš„æƒ…å†µã€‚<br />å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸éœ€è¦é…ç½®&nbsp;<code>scope</code>&nbsp;ã€‚å¦‚æœèƒ–å‹å¯ä»¥æ˜ç¡®æœåŠ¡å™¨æ¶ˆè´¹å¼•ç”¨æœåŠ¡çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œè®¾ç½®ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ Dubbo æä¾›äº†å¤šç§åè®®( Protocol )å®ç°ã€‚</p>
<ul>
<li><strong>æœ¬æ–‡</strong>ä»…åˆ†äº«æœ¬åœ°æš´éœ²ï¼Œè¯¥æ–¹å¼ä»…ä½¿ç”¨ Injvm åè®®å®ç°ï¼Œå…·ä½“ä»£ç åœ¨&nbsp;<code>dubbo-rpc-injvm</code>&nbsp;æ¨¡å—ä¸­ã€‚</li>
<li><strong>ä¸‹å‡ ç¯‡</strong>ä¼šåˆ†äº«è¿œç¨‹æš´éœ²ï¼Œè¯¥æ–¹å¼æœ‰å¤šç§åè®®å®ç°ï¼Œä¾‹å¦‚ Dubbo ( é»˜è®¤åè®® )ã€Hessian ã€Rest ç­‰ç­‰ã€‚æˆ‘ä»¬ä¼šæ¯ä¸ªåè®®å¯¹åº”ä¸€ç¯‡æ–‡ç« ï¼Œè¿›è¡Œåˆ†äº«ã€‚</li>
</ul>
<h1 id="2-doExportUrls">2. doExportUrls</h1>
<p>æœ¬åœ°æš´éœ²æœåŠ¡çš„é¡ºåºå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_07/03.png" alt="æœ¬åœ°æš´éœ²é¡ºåºå›¾" /></p>
<p>åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-api-2/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; API é…ç½®ï¼ˆäºŒï¼‰ä¹‹æœåŠ¡æä¾›è€…ã€‹</a>&nbsp;ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°&nbsp;<code>ServiceConfig#export()</code>&nbsp;æ–¹æ³•ä¸­ï¼Œä¼šåœ¨é…ç½®åˆå§‹åŒ–å®Œæˆåï¼Œè°ƒç”¨é¡ºåºå›¾çš„<strong>èµ·ç‚¹</strong>&nbsp;<code>#doExportUrls()</code>&nbsp;æ–¹æ³•ï¼Œå¼€å§‹æš´éœ²æœåŠ¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æ³¨å†Œä¸­å¿ƒé…ç½®æ•°ç»„</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">protected</span> List&lt;ProtocolConfig&gt; protocols;</span><br /><br /><span class="line">  <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment">  2:  * æš´éœ² Dubbo URL</span></span><br /><span class="line"><span class="comment">  3:  */</span></span><br /><span class="line">  <span class="number">4</span>: <span class="meta">@SuppressWarnings</span>({<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>})</span><br /><span class="line">  <span class="number">5</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doExportUrls</span><span class="params">()</span> </span>{</span><br /><span class="line">  <span class="number">6</span>:     <span class="comment">// åŠ è½½æ³¨å†Œä¸­å¿ƒ URL æ•°ç»„</span></span><br /><span class="line">  <span class="number">7</span>:     List&lt;URL&gt; registryURLs = loadRegistries(<span class="keyword">true</span>);</span><br /><span class="line">  <span class="number">8</span>:     <span class="comment">// å¾ªç¯ `protocols` ï¼Œå‘é€ä¸ªæ³¨å†Œä¸­å¿ƒåˆ†ç»„æš´éœ²æœåŠ¡ã€‚</span></span><br /><span class="line">  <span class="number">9</span>:     <span class="keyword">for</span> (ProtocolConfig protocolConfig : protocols) {</span><br /><span class="line"> <span class="number">10</span>:         doExportUrlsFor1Protocol(protocolConfig, registryURLs);</span><br /><span class="line"> <span class="number">11</span>:     }</span><br /><span class="line"> <span class="number">12</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 7 è¡Œï¼šè°ƒç”¨&nbsp;<code>#loadRegistries(provider)</code>&nbsp;æ–¹æ³•ï¼ŒåŠ è½½æ³¨å†Œä¸­å¿ƒçš„ com.alibaba.dubbo.common.URL` æ•°ç»„ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Œ2.1 loadRegistriesã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li>ç¬¬ 8 è‡³ 11 è¡Œï¼šå¾ªç¯&nbsp;<code>protocols</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>#doExportUrlsFor1Protocol(protocolConfig, registryURLs)</code>&nbsp;æ–¹æ³•ï¼Œä½¿ç”¨<strong>å¯¹åº”çš„åè®®</strong>ï¼Œé€ä¸ªå‘<strong>æ³¨å†Œä¸­å¿ƒåˆ†ç»„</strong>æš´éœ²æœåŠ¡ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼ŒåŒ…å«äº†æœ¬åœ°å’Œè¿œç¨‹ä¸¤ç§æš´éœ²æ–¹å¼ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œæœ¬åœ°æš´éœ²ä¸ä¼šå‘æ³¨å†Œä¸­å¿ƒæ³¨å†ŒæœåŠ¡ï¼Œ<strong>å› ä¸ºä»…ä»…ç”¨äº JVM å†…éƒ¨æœ¬åœ°è°ƒç”¨ï¼Œå†…å­˜ä¸­å·²ç»æœ‰ç›¸å…³ä¿¡æ¯</strong>ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Œ2.2 doExportUrlsFor1Protocolã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-1-loadRegistries">2.1 loadRegistries</h2>
<blockquote>
<p>å‹æƒ…æç¤ºï¼Œå®é™…è¿™ä¸ªæ–¹æ³•ï¼Œæ”¾åœ¨æœåŠ¡çš„<strong>è¿œç¨‹æš´éœ²</strong>ä¸€æ–‡åˆ†äº«è¾ƒä¸ºåˆé€‚ã€‚<br />å› ä¸ºï¼Œ<strong>æœ¬åœ°æš´éœ²</strong>æ— éœ€å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œã€‚<br />æ‰€ä»¥ï¼Œè¯¥æ–¹æ³•ä¹Ÿå¯ä»¥æ”¾åˆ°<strong>è¿œç¨‹æš´éœ²</strong>ä¸€æ–‡åœ¨çœ‹ã€‚</p>
</blockquote>
<p><code>#loadRegistries(provider)</code>&nbsp;æ–¹æ³•ï¼ŒåŠ è½½æ³¨å†Œä¸­å¿ƒ&nbsp;<code>com.alibaba.dubbo.common.URL</code>&nbsp;æ•°ç»„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * åŠ è½½æ³¨å†Œä¸­å¿ƒ URL æ•°ç»„</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> provider æ˜¯å¦æ˜¯æœåŠ¡æä¾›è€…</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@return</span> URL æ•°ç»„</span></span><br /><span class="line"><span class="comment"> 6:  */</span></span><br /><span class="line"> <span class="number">7</span>: <span class="function"><span class="keyword">protected</span> List&lt;URL&gt; <span class="title">loadRegistries</span><span class="params">(<span class="keyword">boolean</span> provider)</span> </span>{</span><br /><span class="line"> <span class="number">8</span>:     <span class="comment">// æ ¡éªŒ RegistryConfig é…ç½®æ•°ç»„ã€‚</span></span><br /><span class="line"> <span class="number">9</span>:     checkRegistry();</span><br /><span class="line"><span class="number">10</span>:     <span class="comment">// åˆ›å»º æ³¨å†Œä¸­å¿ƒ URL æ•°ç»„</span></span><br /><span class="line"><span class="number">11</span>:     List&lt;URL&gt; registryList = <span class="keyword">new</span> ArrayList&lt;URL&gt;();</span><br /><span class="line"><span class="number">12</span>:     <span class="keyword">if</span> (registries != <span class="keyword">null</span> &amp;&amp; !registries.isEmpty()) {</span><br /><span class="line"><span class="number">13</span>:         <span class="keyword">for</span> (RegistryConfig config : registries) {</span><br /><span class="line"><span class="number">14</span>:             <span class="comment">// è·å¾—æ³¨å†Œä¸­å¿ƒçš„åœ°å€</span></span><br /><span class="line"><span class="number">15</span>:             String address = config.getAddress();</span><br /><span class="line"><span class="number">16</span>:             <span class="keyword">if</span> (address == <span class="keyword">null</span> || address.length() == <span class="number">0</span>) {</span><br /><span class="line"><span class="number">17</span>:                 address = Constants.ANYHOST_VALUE;</span><br /><span class="line"><span class="number">18</span>:             }</span><br /><span class="line"><span class="number">19</span>:             String sysaddress = System.getProperty(<span class="string">"dubbo.registry.address"</span>); <span class="comment">// ä»å¯åŠ¨å‚æ•°è¯»å–</span></span><br /><span class="line"><span class="number">20</span>:             <span class="keyword">if</span> (sysaddress != <span class="keyword">null</span> &amp;&amp; sysaddress.length() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">21</span>:                 address = sysaddress;</span><br /><span class="line"><span class="number">22</span>:             }</span><br /><span class="line"><span class="number">23</span>:             <span class="comment">// æœ‰æ•ˆçš„åœ°å€</span></span><br /><span class="line"><span class="number">24</span>:             <span class="keyword">if</span> (address.length() &gt; <span class="number">0</span></span><br /><span class="line"><span class="number">25</span>:                     &amp;&amp; !RegistryConfig.NO_AVAILABLE.equalsIgnoreCase(address)) {</span><br /><span class="line"><span class="number">26</span>:                 Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br /><span class="line"><span class="number">27</span>:                 <span class="comment">// å°†å„ç§é…ç½®å¯¹è±¡ï¼Œæ·»åŠ åˆ° `map` é›†åˆä¸­ã€‚</span></span><br /><span class="line"><span class="number">28</span>:                 appendParameters(map, application);</span><br /><span class="line"><span class="number">29</span>:                 appendParameters(map, config);</span><br /><span class="line"><span class="number">30</span>:                 <span class="comment">// æ·»åŠ  `path` `dubbo` `timestamp` `pid` åˆ° `map` é›†åˆä¸­ã€‚</span></span><br /><span class="line"><span class="number">31</span>:                 map.put(<span class="string">"path"</span>, RegistryService.class.getName());</span><br /><span class="line"><span class="number">32</span>:                 map.put(<span class="string">"dubbo"</span>, Version.getVersion());</span><br /><span class="line"><span class="number">33</span>:                 map.put(Constants.TIMESTAMP_KEY, String.valueOf(System.currentTimeMillis()));</span><br /><span class="line"><span class="number">34</span>:                 <span class="keyword">if</span> (ConfigUtils.getPid() &gt; <span class="number">0</span>) {</span><br /><span class="line"><span class="number">35</span>:                     map.put(Constants.PID_KEY, String.valueOf(ConfigUtils.getPid()));</span><br /><span class="line"><span class="number">36</span>:                 }</span><br /><span class="line"><span class="number">37</span>:                 <span class="comment">// è‹¥ä¸å­˜åœ¨ `protocol` å‚æ•°ï¼Œé»˜è®¤ "dubbo" æ·»åŠ åˆ° `map` é›†åˆä¸­ã€‚</span></span><br /><span class="line"><span class="number">38</span>:                 <span class="keyword">if</span> (!map.containsKey(<span class="string">"protocol"</span>)) {</span><br /><span class="line"><span class="number">39</span>:                     <span class="keyword">if</span> (ExtensionLoader.getExtensionLoader(RegistryFactory.class).hasExtension(<span class="string">"remote"</span>)) { <span class="comment">// "remote"</span></span><br /><span class="line"><span class="number">40</span>:                         map.put(<span class="string">"protocol"</span>, <span class="string">"remote"</span>);</span><br /><span class="line"><span class="number">41</span>:                     } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">42</span>:                         map.put(<span class="string">"protocol"</span>, <span class="string">"dubbo"</span>);</span><br /><span class="line"><span class="number">43</span>:                     }</span><br /><span class="line"><span class="number">44</span>:                 }</span><br /><span class="line"><span class="number">45</span>:                 <span class="comment">// è§£æåœ°å€ï¼Œåˆ›å»º Dubbo URL æ•°ç»„ã€‚ï¼ˆæ•°ç»„å¤§å°å¯ä»¥ä¸ºä¸€ï¼‰</span></span><br /><span class="line"><span class="number">46</span>:                 List&lt;URL&gt; urls = UrlUtils.parseURLs(address, map);</span><br /><span class="line"><span class="number">47</span>:                 <span class="comment">// å¾ªç¯ `url` ï¼Œè®¾ç½® "registry" å’Œ "protocol" å±æ€§ã€‚</span></span><br /><span class="line"><span class="number">48</span>:                 <span class="keyword">for</span> (URL url : urls) {</span><br /><span class="line"><span class="number">49</span>:                     <span class="comment">// è®¾ç½® `registry=${protocol}` å’Œ `protocol=registry` åˆ° URL</span></span><br /><span class="line"><span class="number">50</span>:                     url = url.addParameter(Constants.REGISTRY_KEY, url.getProtocol());</span><br /><span class="line"><span class="number">51</span>:                     url = url.setProtocol(Constants.REGISTRY_PROTOCOL);</span><br /><span class="line"><span class="number">52</span>:                     <span class="comment">// æ·»åŠ åˆ°ç»“æœ</span></span><br /><span class="line"><span class="number">53</span>:                     <span class="keyword">if</span> ((provider &amp;&amp; url.getParameter(Constants.REGISTER_KEY, <span class="keyword">true</span>)) <span class="comment">// æœåŠ¡æä¾›è€… &amp;&amp; æ³¨å†Œ</span></span><br /><span class="line"><span class="number">54</span>:                             || (!provider &amp;&amp; url.getParameter(Constants.SUBSCRIBE_KEY, <span class="keyword">true</span>))) { <span class="comment">// æœåŠ¡æ¶ˆè´¹è€… &amp;&amp; è®¢é˜…</span></span><br /><span class="line"><span class="number">55</span>:                         registryList.add(url);</span><br /><span class="line"><span class="number">56</span>:                     }</span><br /><span class="line"><span class="number">57</span>:                 }</span><br /><span class="line"><span class="number">58</span>:             }</span><br /><span class="line"><span class="number">59</span>:         }</span><br /><span class="line"><span class="number">60</span>:     }</span><br /><span class="line"><span class="number">61</span>:     <span class="keyword">return</span> registryList;</span><br /><span class="line"><span class="number">62</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 9 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/9d38b6f9f95798755141d6140e311e8fd51fecc1/dubbo-config/dubbo-config-api/src/main/java/com/alibaba/dubbo/config/AbstractInterfaceConfig.java#L122-L154" target="_blank" rel="external nofollow noopener noreferrer"><code>#checkRegistry()</code></a>&nbsp;æ–¹æ³•ï¼Œæ ¡éªŒ RegistryConfig é…ç½®ã€‚
<ul>
<li>ğŸ™‚ ç›´æ¥ç‚¹å‡»æ–¹æ³•æŸ¥çœ‹ï¼Œè¾ƒä¸ºç®€å•ï¼Œå·²ç»æ·»åŠ è¯¦ç»†æ³¨é‡Šã€‚</li>
</ul>
</li>
<li>ç¬¬ 11 è¡Œï¼š<strong>åˆ›å»º</strong>æ³¨å†Œä¸­å¿ƒ URL æ•°ç»„ã€‚</li>
<li>ç¬¬ 13 è¡Œï¼š<strong>å¾ªç¯</strong>æ³¨å†Œä¸­å¿ƒé…ç½®å¯¹è±¡æ•°ç»„&nbsp;<code>registries</code>&nbsp;ã€‚</li>
<li>ç¬¬ 14 è‡³ 22 è¡Œï¼šè·å¾—æ³¨å†Œä¸­å¿ƒçš„åœ°å€&nbsp;<code>address</code>&nbsp;ã€‚
<ul>
<li>ç¬¬ 19 è‡³ 22 è¡Œï¼šä»å¯åŠ¨å‚æ•°&nbsp;<code>dubbo.registry.address</code>&nbsp;è¯»å–ï¼Œè‹¥å­˜åœ¨ï¼Œ<strong>æœ€é«˜ä¼˜å…ˆçº§</strong>ï¼Œè¿›è¡Œè¦†ç›–ã€‚</li>
</ul>
</li>
<li>ç¬¬ 24 è‡³ 25 è¡Œï¼šåœ°å€&nbsp;<code>address</code>&nbsp;æ˜¯æœ‰æ•ˆåœ°å€ï¼ŒåŒ…æ‹¬&nbsp;<code>address != N/A</code>&nbsp;ã€‚
<ul>
<li><code>"N/A"</code>&nbsp;ä»£è¡¨ä¸é…ç½®æ³¨å†Œä¸­å¿ƒã€‚</li>
</ul>
</li>
<li>ç¬¬ 26 è¡Œï¼šåˆ›å»ºå‚æ•°é›†åˆ&nbsp;<code>map</code>&nbsp;ã€‚</li>
<li>ç¬¬ 28 è‡³ 29 è¡Œï¼šè°ƒç”¨&nbsp;<code>#appendParameters(map, config)</code>&nbsp;æ–¹æ³•ï¼Œå°†å„ç§é…ç½®å¯¹è±¡ï¼Œæ·»åŠ åˆ°&nbsp;<code>map</code>&nbsp;é›†åˆä¸­ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-api-1/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; API é…ç½®ï¼ˆä¸€ï¼‰ä¹‹åº”ç”¨ã€‹ã€Œ3.1 AbstractConfigã€</a>&nbsp;å·²ç»è¯¦ç»†è§£æã€‚</li>
<li><a href="https://github.com/YunaiV/dubbo/blob/4a877ee283af70c3f6a19c3b8b8e6918696540e6/dubbo-config/dubbo-config-api/src/main/java/com/alibaba/dubbo/config/RegistryConfig.java#L121-L124" target="_blank" rel="external nofollow noopener noreferrer"><code>RegistryConfig#getAddress()</code></a>&nbsp;ä¸Šæœ‰&nbsp;<code>@Parameter(excluded = true)</code>&nbsp;ï¼Œå› æ­¤&nbsp;<code>Registry.address</code>å±æ€§ä¸ä¼šæ·»åŠ åˆ°&nbsp;<code>map</code>&nbsp;ä¸­ã€‚</li>
</ul>
</li>
<li>ç¬¬ 30 è‡³ 36 è¡Œï¼šæ·»åŠ &nbsp;<code>path</code>&nbsp;<code>dubbo</code>&nbsp;<code>timestamp</code>&nbsp;<code>pid</code>&nbsp;åˆ°&nbsp;<code>map</code>&nbsp;é›†åˆä¸­ã€‚</li>
<li>ç¬¬ 37 è‡³ 44 è¡Œï¼šè‹¥ä¸å­˜åœ¨&nbsp;<code>protocol</code>&nbsp;å‚æ•°ï¼Œç¼ºçœé»˜è®¤ä¸º &ldquo;dubbo&rdquo; ï¼Œå¹¶æ·»åŠ åˆ°&nbsp;<code>map</code>&nbsp;é›†åˆä¸­ã€‚
<ul>
<li>ç¬¬ 39 è‡³ 40 è¡Œï¼š<strong>å¯ä»¥å¿½ç•¥</strong>ã€‚å› ä¸ºï¼Œ<code>remote</code>&nbsp;è¿™ä¸ªæ‹“å±•å®ç°å·²ç»ä¸å­˜åœ¨ã€‚</li>
</ul>
</li>
<li>ç¬¬ 46 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/UrlUtils.java#L147-L174" target="_blank" rel="external nofollow noopener noreferrer"><code>UrlUtils#parseURLs(address, map)</code></a>&nbsp;æ–¹æ³•ï¼Œè§£æ&nbsp;<code>address</code>&nbsp;ï¼Œåˆ›å»º Dubbo URL æ•°ç»„ï¼ˆæ•°ç»„å¤§å°å¯ä»¥ä¸ºä¸€ï¼‰ã€‚
<ul>
<li>ğŸ™‚ å·²ç»æ·»åŠ äº†ä»£ç æ³¨é‡Šï¼Œèƒ–å‹ç‚¹å‡»é“¾æ¥æŸ¥çœ‹ã€‚</li>
<li><code>address</code>&nbsp;å¯ä»¥ä½¿ç”¨&nbsp;<code>"|"</code>&nbsp;æˆ–è€…&nbsp;<code>";"</code>&nbsp;ä½œä¸ºåˆ†éš”ç¬¦ï¼Œè®¾ç½®å¤šä¸ªæ³¨å†Œä¸­å¿ƒ<strong>åˆ†ç»„</strong>ã€‚<strong>æ³¨æ„</strong>ï¼Œä¸€ä¸ªæ³¨å†Œä¸­å¿ƒé›†ç¾¤æ˜¯ä¸€ä¸ªåˆ†ç»„ï¼Œè€Œä¸æ˜¯å¤šä¸ªã€‚</li>
<li>è¿™ä¸ªæ–¹æ³•ä»åå­—ä¸Šå¾ˆéš¾çœ‹å‡ºå…·ä½“çš„å«ä¹‰ï¼Œçœ‹ä¸‹å›¾çš„<strong>æ³¨é‡Š</strong>ï¼Œç›¸ä¿¡èƒ–å‹èƒ½ç†è§£ã€‚<img src="http://static2.iocoder.cn/images/Dubbo/2018_03_07/01.png" alt="&#96;UrlUtils#parseURLs(address, map)&#96;" /></li>
</ul>
</li>
<li>ç¬¬ 47 è‡³ 57 è¡Œï¼šå¾ªç¯&nbsp;<code>urls</code>&nbsp;ï¼Œè®¾ç½® &ldquo;registry&rdquo; å’Œ &ldquo;protocol&rdquo; å±æ€§ã€‚
<ul>
<li>ç¬¬ 49 è‡³ 51 è¡Œï¼šè®¾ç½®&nbsp;<code>registry=${protocol}</code>&nbsp;å’Œ&nbsp;<code>protocol=registry</code>&nbsp;åˆ° URL ã€‚</li>
<li>ç¬¬ 53 è¡Œï¼šè‹¥æ˜¯æœåŠ¡<strong>æä¾›è€…</strong>ï¼Œåˆ¤æ–­æ˜¯å¦<strong>åªè®¢é˜…ä¸æ³¨å†Œ</strong>ã€‚å¦‚æœæ˜¯ï¼Œ<strong>ä¸æ·»åŠ </strong>ç»“æœåˆ°&nbsp;<code>registryList</code>&nbsp;ä¸­ã€‚å¯¹åº”&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/subscribe-only.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; åªè®¢é˜…ã€‹</a>&nbsp;æ–‡æ¡£ã€‚</li>
<li>ç¬¬ 54 è¡Œï¼šè‹¥æ˜¯æœåŠ¡<strong>æ¶ˆè´¹è€…</strong>ï¼Œåˆ¤æ–­æ˜¯å¦<strong>åªæ³¨å†Œä¸è®¢é˜…</strong>ã€‚å¦‚æœæ˜¯ï¼Œ<strong>ä¸æ·»åŠ </strong>åˆ°ç»“æœ&nbsp;<code>registryList</code>&nbsp;ã€‚å¯¹åº”&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/registry-only.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; åªæ³¨å†Œã€‹</a>&nbsp;æ–‡æ¡£ã€‚</li>
<li>ç¬¬ 53 è‡³ 56 è¡Œï¼šæ·»åŠ åˆ°ç»“æœ&nbsp;<code>registryList</code>&nbsp;ã€‚</li>
</ul>
</li>
<li>ä¸ºäº†èƒ–å‹æ›´åŠ å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ã€‚<img src="http://static2.iocoder.cn/images/Dubbo/2018_03_07/02.png" alt="æ•°æ®æµå‘" /></li>
</ul>
<h2 id="2-2-doExportUrlsFor1Protocol">2.2 doExportUrlsFor1Protocol</h2>
<p><code>#doExportUrlsFor1Protocol(protocolConfig, registryURLs)</code>&nbsp;æ–¹æ³•ï¼ŒåŸºäºå•ä¸ªåè®®ï¼Œæš´éœ²æœåŠ¡ã€‚<strong>ç®€åŒ–</strong>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * åŸºäºå•ä¸ªåè®®ï¼Œæš´éœ²æœåŠ¡</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> protocolConfig åè®®é…ç½®å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@param</span> registryURLs æ³¨å†Œä¸­å¿ƒé“¾æ¥å¯¹è±¡æ•°ç»„</span></span><br /><span class="line"><span class="comment"> 6:  */</span></span><br /><span class="line"> <span class="number">7</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">doExportUrlsFor1Protocol</span><span class="params">(ProtocolConfig protocolConfig, List&lt;URL&gt; registryURLs)</span> </span>{</span><br /><span class="line"> <span class="number">8</span>:     <span class="comment">// ... ã€çœç•¥ã€‘ åˆ›å»ºæœåŠ¡ URL å¯¹è±¡</span></span><br /><span class="line"> <span class="number">9</span>: </span><br /><span class="line"><span class="number">10</span>:     String scope = url.getParameter(Constants.SCOPE_KEY);</span><br /><span class="line"><span class="number">11</span>:     <span class="comment">// don't export when none is configured</span></span><br /><span class="line"><span class="number">12</span>:     <span class="keyword">if</span> (!Constants.SCOPE_NONE.toString().equalsIgnoreCase(scope)) {</span><br /><span class="line"><span class="number">13</span>: </span><br /><span class="line"><span class="number">14</span>:         <span class="comment">// export to local if the config is not remote (export to remote only when config is remote)</span></span><br /><span class="line"><span class="number">15</span>:         <span class="keyword">if</span> (!Constants.SCOPE_REMOTE.toString().equalsIgnoreCase(scope)) {</span><br /><span class="line"><span class="number">16</span>:             exportLocal(url);</span><br /><span class="line"><span class="number">17</span>:         }</span><br /><span class="line"><span class="number">18</span>:         <span class="comment">// export to remote if the config is not local (export to local only when config is local)</span></span><br /><span class="line"><span class="number">19</span>:         <span class="keyword">if</span> (!Constants.SCOPE_LOCAL.toString().equalsIgnoreCase(scope)) {</span><br /><span class="line"><span class="number">20</span>:             <span class="comment">// ... ã€çœç•¥ã€‘è¿œç¨‹æš´éœ² </span></span><br /><span class="line"><span class="number">21</span>:         }</span><br /><span class="line"><span class="number">22</span>:     }</span><br /><span class="line"><span class="number">23</span>:     <span class="keyword">this</span>.urls.add(url);</span><br /><span class="line"><span class="number">24</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 8 è¡Œï¼šã€çœç•¥ä»£ç ã€‘åˆ›å»ºæœåŠ¡ URL å¯¹è±¡ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/configuration-api-2/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; API é…ç½®ï¼ˆäºŒï¼‰ä¹‹æœåŠ¡æä¾›è€…ã€‹ã€Œ8. ServiceConfigã€</a>&nbsp;æœ‰è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li>ç¬¬ 15 è‡³ 17 è¡Œï¼šå½“é&nbsp;<code>"remote"</code>&nbsp;æ—¶ï¼Œè°ƒç”¨&nbsp;<code>#exportLocal(url)</code>&nbsp;æ–¹æ³•ï¼Œæœ¬åœ°æš´éœ²æœåŠ¡ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Œ2.2.1 exportLocalã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li>ç¬¬ 19 è‡³ 21 è¡Œï¼šã€çœç•¥ä»£ç ã€‘é&nbsp;<code>"local"</code>&nbsp;æ—¶ï¼Œè¿œç¨‹æš´éœ²æœåŠ¡ã€‚åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œè¯¦ç»†åˆ†äº«ã€‚</li>
</ul>
<h3 id="2-2-1-exportLocal">2.2.1 exportLocal</h3>
<p><code>#exportLocal(url)</code>&nbsp;æ–¹æ³•ï¼Œæœ¬åœ°æš´éœ²æœåŠ¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * è‡ªé€‚åº” Protocol å®ç°å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Protocol protocol = ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension();</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * è‡ªé€‚åº” ProxyFactory å®ç°å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ProxyFactory proxyFactory = ExtensionLoader.getExtensionLoader(ProxyFactory.class).getAdaptiveExtension();</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * {<span class="doctag">@link</span> #interfaceName} å¯¹åº”çš„æ¥å£ç±»</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * éé…ç½®</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> Class&lt;?&gt; interfaceClass;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * Service å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="comment">// reference to interface impl</span></span><br /><span class="line"><span class="keyword">private</span> T ref;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * æœåŠ¡é…ç½®æš´éœ²çš„ Exporter ã€‚</span></span><br /><span class="line"><span class="comment"> * URL ï¼šExporter ä¸ä¸€å®šæ˜¯ 1ï¼š1 çš„å…³ç³»ã€‚</span></span><br /><span class="line"><span class="comment"> * ä¾‹å¦‚ {<span class="doctag">@link</span> #scope} æœªè®¾ç½®æ—¶ï¼Œä¼šæš´éœ² Local + Remote ä¸¤ä¸ªï¼Œä¹Ÿå°±æ˜¯ URL ï¼šExporter = 1ï¼š2</span></span><br /><span class="line"><span class="comment"> *      {<span class="doctag">@link</span> #scope} è®¾ç½®ä¸ºç©ºæ—¶ï¼Œä¸ä¼šæš´éœ²ï¼Œä¹Ÿå°±æ˜¯ URL ï¼šExporter = 1ï¼š0</span></span><br /><span class="line"><span class="comment"> *      {<span class="doctag">@link</span> #scope} è®¾ç½®ä¸º Local æˆ– Remote ä»»ä¸€æ—¶ï¼Œä¼šæš´éœ² Local æˆ– Remote ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯ URL ï¼šExporter = 1ï¼š1</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * éé…ç½®ã€‚</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> List&lt;Exporter&lt;?&gt;&gt; exporters = <span class="keyword">new</span> ArrayList&lt;Exporter&lt;?&gt;&gt;();</span><br /><br /><span class="line">  <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment">  2:  * æœ¬åœ°æš´éœ²æœåŠ¡</span></span><br /><span class="line"><span class="comment">  3:  *</span></span><br /><span class="line"><span class="comment">  4:  * <span class="doctag">@param</span> url æ³¨å†Œä¸­å¿ƒ URL</span></span><br /><span class="line"><span class="comment">  5:  */</span></span><br /><span class="line">  <span class="number">6</span>: <span class="meta">@SuppressWarnings</span>({<span class="string">"unchecked"</span>, <span class="string">"rawtypes"</span>})</span><br /><span class="line">  <span class="number">7</span>: <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">exportLocal</span><span class="params">(URL url)</span> </span>{</span><br /><span class="line">  <span class="number">8</span>:     <span class="keyword">if</span> (!Constants.LOCAL_PROTOCOL.equalsIgnoreCase(url.getProtocol())) {</span><br /><span class="line">  <span class="number">9</span>:         <span class="comment">// åˆ›å»ºæœ¬åœ° Dubbo URL</span></span><br /><span class="line"> <span class="number">10</span>:         URL local = URL.valueOf(url.toFullString())</span><br /><span class="line"> <span class="number">11</span>:                 .setProtocol(Constants.LOCAL_PROTOCOL) <span class="comment">// injvm</span></span><br /><span class="line"> <span class="number">12</span>:                 .setHost(LOCALHOST) <span class="comment">// æœ¬åœ°</span></span><br /><span class="line"> <span class="number">13</span>:                 .setPort(<span class="number">0</span>); <span class="comment">// ç«¯å£=0</span></span><br /><span class="line"> <span class="number">14</span>:         <span class="comment">// æ·»åŠ æœåŠ¡çš„çœŸå®ç±»åï¼Œä¾‹å¦‚ DemoServiceImpl ï¼Œä»…ç”¨äº RestProtocol ä¸­ã€‚</span></span><br /><span class="line"> <span class="number">15</span>:         ServiceClassHolder.getInstance().pushServiceClass(getServiceClass(ref));</span><br /><span class="line"> <span class="number">16</span>:         <span class="comment">// ä½¿ç”¨ ProxyFactory åˆ›å»º Invoker å¯¹è±¡</span></span><br /><span class="line"> <span class="number">17</span>:         <span class="comment">// ä½¿ç”¨ Protocol æš´éœ² Invoker å¯¹è±¡</span></span><br /><span class="line"> <span class="number">18</span>:         Exporter&lt;?&gt; exporter = protocol.export(proxyFactory.getInvoker(ref, (Class) interfaceClass, local));</span><br /><span class="line"> <span class="number">19</span>:         <span class="comment">// æ·»åŠ åˆ° `exporters`</span></span><br /><span class="line"> <span class="number">20</span>:         exporters.add(exporter);</span><br /><span class="line"> <span class="number">21</span>:         logger.info(<span class="string">"Export dubbo service "</span> + interfaceClass.getName() + <span class="string">" to local registry"</span>);</span><br /><span class="line"> <span class="number">22</span>:     }</span><br /><span class="line"> <span class="number">23</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>protocol</code>&nbsp;<strong>é™æ€</strong>å±æ€§ï¼Œè‡ªé€‚åº” Protocol å®ç°å¯¹è±¡ã€‚
<ul>
<li>ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œè¯·çœ‹&nbsp;<a href="http://svip.iocoder.cn/Dubbo/spi/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æ‹“å±•æœºåˆ¶ SPIã€‹</a>&nbsp;æ–‡ç« ã€‚</li>
</ul>
</li>
<li><code>proxyFactory</code>&nbsp;<strong>é™æ€</strong>å±æ€§ï¼Œè‡ªé€‚åº” ProxyFactory å®ç°å¯¹è±¡ã€‚</li>
<li><code>interfaceClass</code>&nbsp;å±æ€§ï¼ŒService æ¥å£ã€‚</li>
<li><code>ref</code>&nbsp;å±æ€§ï¼ŒService å¯¹è±¡ã€‚</li>
<li><code>exporters</code>&nbsp;å±æ€§ï¼ŒExporter é›†åˆã€‚</li>
<li>========== åˆ†å‰²çº¿ ==========</li>
<li>ç¬¬ 9 è‡³ 13 è¡Œï¼šåŸºäºåŸæœ‰&nbsp;<code>url</code>&nbsp;ï¼Œåˆ›å»º<strong>æ–°çš„</strong>æœåŠ¡çš„æœ¬åœ° Dubbo URL å¯¹è±¡ï¼Œå¹¶è®¾ç½®å±æ€§&nbsp;<code>protocol=injvm</code><code>host=127.0.0.1</code>&nbsp;<code>port=0</code>&nbsp;ã€‚å› ä¸º&nbsp;<code>url</code>&nbsp;åœ¨åé¢è¿œç¨‹æš´éœ²æœåŠ¡ä¼šä½¿ç”¨ï¼Œæ‰€ä»¥è¦æ–°åˆ›å»ºã€‚</li>
<li>ç¬¬ 15 è¡Œï¼šæ·»åŠ æœåŠ¡çš„çœŸå®ç±»åï¼Œä¾‹å¦‚ DemoServiceImpl ï¼Œä»…ç”¨äº RestProtocol ä¸­ã€‚</li>
<li>ç¬¬ 18 è¡Œï¼šè°ƒç”¨&nbsp;<code>ProxyFactory#getInvoker(proxy, type, url)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º Invoker å¯¹è±¡ã€‚è¯¥ Invoker å¯¹è±¡ï¼Œæ‰§è¡Œ&nbsp;<code>#invoke(invocation)</code>&nbsp;æ–¹æ³•æ—¶ï¼Œå†…éƒ¨ä¼šè°ƒç”¨ Service å¯¹è±¡(&nbsp;<code>ref</code>&nbsp;)å¯¹åº”çš„è°ƒç”¨æ–¹æ³•ã€‚
<ul>
<li>ğŸ™‚ è¯¦ç»†çš„å®ç°ï¼Œåé¢å•ç‹¬å†™æ–‡ç« åˆ†äº«ã€‚</li>
</ul>
</li>
<li>ç¬¬ 18 è¡Œï¼šè°ƒç”¨&nbsp;<code>Protocol#export(invoker)</code>&nbsp;æ–¹æ³•ï¼Œæš´éœ²æœåŠ¡ã€‚
<ul>
<li>æ­¤å¤„ Dubbo SPI&nbsp;<strong>è‡ªé€‚åº”</strong>çš„ç‰¹æ€§çš„<strong>å¥½å¤„</strong>å°±å‡ºæ¥äº†ï¼Œå¯ä»¥<strong>è‡ªåŠ¨</strong>æ ¹æ® URL å‚æ•°ï¼Œè·å¾—å¯¹åº”çš„æ‹“å±•å®ç°ã€‚ä¾‹å¦‚ï¼Œ<code>invoker</code>ä¼ å…¥åï¼Œæ ¹æ®&nbsp;<code>invoker.url</code>&nbsp;è‡ªåŠ¨è·å¾—å¯¹åº” Protocol æ‹“å±•å®ç°ä¸º InjvmProtocol ã€‚</li>
<li>å®é™…ä¸Šï¼ŒProtocol æœ‰ä¸¤ä¸ª Wrapper æ‹“å±•å®ç°ç±»ï¼š ProtocolFilterWrapperã€ProtocolListenerWrapper ã€‚æ‰€ä»¥ï¼Œ<code>#export(...)</code>&nbsp;æ–¹æ³•çš„è°ƒç”¨é¡ºåºæ˜¯ï¼š<strong>Protocol$Adaptive =&gt; ProtocolFilterWrapper =&gt; ProtocolListenerWrapper =&gt; InjvmProtocol</strong>&nbsp;ã€‚</li>
<li>ğŸ™‚ è¯¦ç»†çš„è°ƒç”¨ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Œ3. Protocolã€</a>&nbsp;åœ¨è§£æã€‚</li>
</ul>
</li>
<li>ç¬¬ 20 è¡Œï¼šæ·»åŠ åˆ°&nbsp;<code>exporters</code>&nbsp;é›†åˆä¸­ã€‚</li>
</ul>
<h1 id="3-Protocol">3. Protocol</h1>
<p>Protocol&nbsp;<strong>æ¥å£</strong>ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æ ¸å¿ƒæµç¨‹ä¸€è§ˆã€‹ã€Œ4.6 Protocolã€</a>&nbsp;æœ‰è¯¦ç»†è§£æã€‚</p>
<p>æœ¬æ–‡æ¶‰åŠçš„ Protocol ç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_07/04.png" alt="Protocol ç±»å›¾" /></p>
<h2 id="3-1-Protocol-Adaptive">3.1 Protocol$Adaptive</h2>
<p>ä»£ç ç±»ä¼¼ä¸‹å›¾ï¼Œç¬”è€…å·æ‡’ï¼Œå°±ä¸å»é‡æ–°ç”Ÿæˆå•¦ã€‚</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_04/05.png" alt="è‡ªé€‚åº”æ‹“å±•çš„ä»£ç å®ç°çš„å­—ç¬¦ä¸²ç”Ÿæˆä¾‹å­" /></p>
<h2 id="3-2-ProtocolFilterWrapper">3.2 ProtocolFilterWrapper</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/protocol/ProtocolFilterWrapper.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.ProtocolFilterWrapper</code></a>&nbsp;ï¼Œå®ç° Protocol æ¥å£ï¼ŒProtocol çš„ Wrapper æ‹“å±•å®ç°ç±»ï¼Œç”¨äºç»™ Invoker å¢åŠ è¿‡æ»¤é“¾ã€‚</p>
<h3 id="3-2-1-export">3.2.1 export</h3>
<p>æœ¬æ–‡æ¶‰åŠçš„&nbsp;<code>#export(invoker)</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="number">1</span>: <span class="keyword">public</span> &lt;T&gt; <span class="function">Exporter&lt;T&gt; <span class="title">export</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"><span class="number">2</span>:     <span class="comment">// æ³¨å†Œä¸­å¿ƒ</span></span><br /><span class="line"><span class="number">3</span>:     <span class="keyword">if</span> (Constants.REGISTRY_PROTOCOL.equals(invoker.getUrl().getProtocol())) {</span><br /><span class="line"><span class="number">4</span>:         <span class="keyword">return</span> protocol.export(invoker);</span><br /><span class="line"><span class="number">5</span>:     }</span><br /><span class="line"><span class="number">6</span>:     <span class="comment">// å»ºç«‹å¸¦æœ‰ Filter è¿‡æ»¤é“¾çš„ Invoker ï¼Œå†æš´éœ²æœåŠ¡ã€‚</span></span><br /><span class="line"><span class="number">7</span>:     <span class="keyword">return</span> protocol.export(buildInvokerChain(invoker, Constants.SERVICE_FILTER_KEY, Constants.PROVIDER));</span><br /><span class="line"><span class="number">8</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 2 è‡³ 5 è¡Œï¼šå½“&nbsp;<code>invoker.url.protocl = registry</code>&nbsp;ï¼Œè·³è¿‡ï¼Œæœ¬åœ°æš´éœ²æœåŠ¡ä¸ä¼šç¬¦åˆè¿™ä¸ªåˆ¤æ–­ã€‚åœ¨è¿œç¨‹æš´éœ²æœåŠ¡ä¼šç¬¦åˆæš´éœ²è¯¥åˆ¤æ–­ï¼Œæ‰€ä»¥ä¸‹ä¸€ç¯‡æ–‡ç« åˆ†äº«ã€‚</li>
<li>ç¬¬ 7 è¡Œï¼šè°ƒç”¨&nbsp;<code>#buildInvokerChain(invoker, key, group)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»ºå¸¦æœ‰ Filter è¿‡æ»¤é“¾çš„ Invoker å¯¹è±¡ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Œ3.2.2 buildInvokerChainã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li>ç¬¬ 7 è¡Œï¼šè°ƒç”¨&nbsp;<code>protocol#export(invoker)</code>&nbsp;æ–¹æ³•ï¼Œç»§ç»­æš´éœ²æœåŠ¡ã€‚</li>
</ul>
<h3 id="3-2-2-buildInvokerChain">3.2.2 buildInvokerChain</h3>
<p><code>#buildInvokerChain(invoker, key, group)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»ºå¸¦ Filter é“¾çš„ Invoker å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="comment">/**</span></span><br /><span class="line"><span class="comment"> 2:  * åˆ›å»ºå¸¦ Filter é“¾çš„ Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 3:  *</span></span><br /><span class="line"><span class="comment"> 4:  * <span class="doctag">@param</span> invoker Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 5:  * <span class="doctag">@param</span> key è·å– URL å‚æ•°å</span></span><br /><span class="line"><span class="comment"> 6:  * <span class="doctag">@param</span> group åˆ†ç»„</span></span><br /><span class="line"><span class="comment"> 7:  * <span class="doctag">@param</span> &lt;T&gt; æ³›å‹</span></span><br /><span class="line"><span class="comment"> 8:  * <span class="doctag">@return</span> Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="comment"> 9:  */</span></span><br /><span class="line"><span class="number">10</span>: <span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">buildInvokerChain</span><span class="params">(<span class="keyword">final</span> Invoker&lt;T&gt; invoker, String key, String group)</span> </span>{</span><br /><span class="line"><span class="number">11</span>:     Invoker&lt;T&gt; last = invoker;</span><br /><span class="line"><span class="number">12</span>:     <span class="comment">// è·å¾—è¿‡æ»¤å™¨æ•°ç»„</span></span><br /><span class="line"><span class="number">13</span>:     List&lt;Filter&gt; filters = ExtensionLoader.getExtensionLoader(Filter.class).getActivateExtension(invoker.getUrl(), key, group);</span><br /><span class="line"><span class="number">14</span>:     <span class="comment">// å€’åºå¾ªç¯ Filter ï¼Œåˆ›å»ºå¸¦ Filter é“¾çš„ Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="number">15</span>:     <span class="keyword">if</span> (!filters.isEmpty()) {</span><br /><span class="line"><span class="number">16</span>:         <span class="keyword">for</span> (<span class="keyword">int</span> i = filters.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) {</span><br /><span class="line"><span class="number">17</span>:             <span class="keyword">final</span> Filter filter = filters.get(i);</span><br /><span class="line"><span class="number">18</span>:             <span class="keyword">final</span> Invoker&lt;T&gt; next = last;</span><br /><span class="line"><span class="number">19</span>:             last = <span class="keyword">new</span> Invoker&lt;T&gt;() {</span><br /><span class="line"><span class="number">20</span>: </span><br /><span class="line"><span class="number">21</span>:                 <span class="function"><span class="keyword">public</span> Class&lt;T&gt; <span class="title">getInterface</span><span class="params">()</span> </span>{</span><br /><span class="line"><span class="number">22</span>:                     <span class="keyword">return</span> invoker.getInterface();</span><br /><span class="line"><span class="number">23</span>:                 }</span><br /><span class="line"><span class="number">24</span>: </span><br /><span class="line"><span class="number">25</span>:                 <span class="function"><span class="keyword">public</span> URL <span class="title">getUrl</span><span class="params">()</span> </span>{</span><br /><span class="line"><span class="number">26</span>:                     <span class="keyword">return</span> invoker.getUrl();</span><br /><span class="line"><span class="number">27</span>:                 }</span><br /><span class="line"><span class="number">28</span>: </span><br /><span class="line"><span class="number">29</span>:                 <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAvailable</span><span class="params">()</span> </span>{</span><br /><span class="line"><span class="number">30</span>:                     <span class="keyword">return</span> invoker.isAvailable();</span><br /><span class="line"><span class="number">31</span>:                 }</span><br /><span class="line"><span class="number">32</span>: </span><br /><span class="line"><span class="number">33</span>:                 <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"><span class="number">34</span>:                     <span class="keyword">return</span> filter.invoke(next, invocation);</span><br /><span class="line"><span class="number">35</span>:                 }</span><br /><span class="line"><span class="number">36</span>: </span><br /><span class="line"><span class="number">37</span>:                 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>{</span><br /><span class="line"><span class="number">38</span>:                     invoker.destroy();</span><br /><span class="line"><span class="number">39</span>:                 }</span><br /><span class="line"><span class="number">40</span>: </span><br /><span class="line"><span class="number">41</span>:                 <span class="meta">@Override</span></span><br /><span class="line"><span class="number">42</span>:                 <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br /><span class="line"><span class="number">43</span>:                     <span class="keyword">return</span> invoker.toString();</span><br /><span class="line"><span class="number">44</span>:                 }</span><br /><span class="line"><span class="number">45</span>:             };</span><br /><span class="line"><span class="number">46</span>:         }</span><br /><span class="line"><span class="number">47</span>:     }</span><br /><span class="line"><span class="number">48</span>:     <span class="keyword">return</span> last;</span><br /><span class="line"><span class="number">49</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p><code>key</code>&nbsp;å±æ€§ï¼Œè·å¾— URL å‚æ•°åã€‚</p>
<ul>
<li>è¯¥å‚æ•°ç”¨äºè·å¾— ServiceConfig æˆ– ReferenceConfig é…ç½®çš„è‡ªå®šä¹‰è¿‡æ»¤å™¨ã€‚</li>
<li>
<p>ä»¥ ServiceConfig ä¸¾ä¾‹å­ï¼Œä¾‹å¦‚&nbsp;<code>url = injvm://127.0.0.1/com.alibaba.dubbo.demo.DemoService?anyhost=true&amp;application=demo-provider&amp;bind.ip=192.168.3.17&amp;bind.port=20880&amp;default.delay=-1&amp;default.retries=0&amp;default.service.filter=demo&amp;delay=-1&amp;dubbo=2.0.0&amp;generic=false&amp;interface=com.alibaba.dubbo.demo.DemoService&amp;methods=sayHello&amp;pid=81844&amp;qos.port=22222&amp;service.filter=demo&amp;side=provider&amp;timestamp=1520682156043</code>&nbsp;ä¸­ï¼Œ<strong><code>service.filter=demo</code></strong>ï¼Œè¿™æ˜¯ç¬”è€…é…ç½®è‡ªå®šä¹‰çš„ DemoFilter è¿‡æ»¤å™¨ã€‚</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.alibaba.dubbo.demo.DemoService"</span> <span class="attr">ref</span>=<span class="string">"demoService"</span> <span class="attr">filter</span>=<span class="string">"demo"</span> /&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>x</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>group</code>&nbsp;å±æ€§ï¼Œåˆ†ç»„ã€‚</p>
<ul>
<li>åœ¨æš´éœ²æœåŠ¡æ—¶ï¼Œ<code>group = provider</code>&nbsp;ã€‚</li>
<li>åœ¨å¼•ç”¨æœåŠ¡æ—¶ï¼Œ<code>group = consumer</code>&nbsp;ã€‚</li>
</ul>
</li>
<li>========== åˆ†å‰²çº¿ ==========</li>
<li>ç¬¬ 13 è¡Œï¼šè°ƒç”¨&nbsp;<code>ExtensionLoader#getActivateExtension(url, key, group)</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—è¿‡æ»¤å™¨æ•°ç»„ã€‚
<ul>
<li>ğŸ™‚ ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œè¯·çœ‹&nbsp;<a href="http://svip.iocoder.cn/Dubbo/spi/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æ‹“å±•æœºåˆ¶ SPIã€‹</a>&nbsp;æ–‡ç« ã€‚</li>
<li>ç»§ç»­ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºåŸºç¡€ï¼Œ<code>filters</code>&nbsp;ä¸ºï¼š
<ul>
<li>EchoFilter</li>
<li>ClassLoaderFilter</li>
<li>GenericFilter</li>
<li>ContextFilter</li>
<li>TraceFilter</li>
<li>TimeoutFilter</li>
<li>MonitorFilter</li>
<li>ExceptionFilter</li>
<li>DemoFilter ã€è‡ªå®šä¹‰ã€‘</li>
</ul>
</li>
</ul>
</li>
<li>ç¬¬ 15 è‡³ 47 è¡Œï¼š<strong>å€’åº</strong>å¾ªç¯ Filter ï¼Œåˆ›å»ºå¸¦ Filter é“¾çš„ Invoker å¯¹è±¡ã€‚å› ä¸ºæ˜¯é€šè¿‡<strong>åµŒå¥—</strong>å£°æ˜åŒ¿åç±»å¾ªç¯è°ƒç”¨çš„æ–¹å¼ï¼Œæ‰€ä»¥è¦å€’åºã€‚èƒ–å‹å¯ä»¥æ‰‹å·¥æ¨¡æ‹Ÿä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå®é™…è¿‡æ»¤çš„é¡ºåºï¼Œè¿˜æ˜¯æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„<strong>æ­£åº</strong>ã€‚</li>
</ul>
<h2 id="3-3-ProtocolListenerWrapper">3.3 ProtocolListenerWrapper</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/protocol/ProtocolListenerWrapper.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.ProtocolListenerWrapper</code></a>&nbsp;ï¼Œå®ç° Protocol æ¥å£ï¼ŒProtocol çš„ Wrapper æ‹“å±•å®ç°ç±»ï¼Œç”¨äºç»™ Exporter å¢åŠ  ExporterListener ï¼Œç›‘å¬ Exporter æš´éœ²å®Œæˆå’Œå–æ¶ˆæš´éœ²å®Œæˆã€‚</p>
<h3 id="3-3-1-export">3.3.1 export</h3>
<p>æœ¬æ–‡æ¶‰åŠçš„&nbsp;<code>#export(invoker)</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="keyword">public</span> &lt;T&gt; <span class="function">Exporter&lt;T&gt; <span class="title">export</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"> <span class="number">2</span>:     <span class="comment">// æ³¨å†Œä¸­å¿ƒ</span></span><br /><span class="line"> <span class="number">3</span>:     <span class="keyword">if</span> (Constants.REGISTRY_PROTOCOL.equals(invoker.getUrl().getProtocol())) {</span><br /><span class="line"> <span class="number">4</span>:         <span class="keyword">return</span> protocol.export(invoker);</span><br /><span class="line"> <span class="number">5</span>:     }</span><br /><span class="line"> <span class="number">6</span>:     <span class="comment">// æš´éœ²æœåŠ¡ï¼Œåˆ›å»º Exporter å¯¹è±¡</span></span><br /><span class="line"> <span class="number">7</span>:     Exporter&lt;T&gt; exporter = protocol.export(invoker);</span><br /><span class="line"> <span class="number">8</span>:     <span class="comment">// è·å¾— ExporterListener æ•°ç»„</span></span><br /><span class="line"> <span class="number">9</span>:     List&lt;ExporterListener&gt; listeners = Collections.unmodifiableList(ExtensionLoader.getExtensionLoader(ExporterListener.class).getActivateExtension(invoker.getUrl(), Constants.EXPORTER_LISTENER_KEY));</span><br /><span class="line"><span class="number">10</span>:     <span class="comment">// åˆ›å»ºå¸¦ ExporterListener çš„ Exporter å¯¹è±¡</span></span><br /><span class="line"><span class="number">11</span>:     <span class="keyword">return</span> <span class="keyword">new</span> ListenerExporterWrapper&lt;T&gt;(exporter, listeners);</span><br /><span class="line"><span class="number">12</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 2 è‡³ 5 è¡Œï¼šå½“&nbsp;<code>invoker.url.protocl = registry</code>&nbsp;ï¼Œè·³è¿‡ï¼Œæœ¬åœ°æš´éœ²æœåŠ¡ä¸ä¼šç¬¦åˆè¿™ä¸ªåˆ¤æ–­ã€‚åœ¨è¿œç¨‹æš´éœ²æœåŠ¡ä¼šç¬¦åˆæš´éœ²è¯¥åˆ¤æ–­ï¼Œæ‰€ä»¥ä¸‹ä¸€ç¯‡æ–‡ç« åˆ†äº«ã€‚</li>
<li>ç¬¬ 7 è¡Œï¼šè°ƒç”¨&nbsp;<code>InjvmProtocol#export(invoker)</code>&nbsp;æ–¹æ³•ï¼Œæš´éœ²æœ¬åœ°æœåŠ¡ï¼Œåˆ›å»º InjvmExporter å¯¹è±¡ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Œ4.2 InjvmExporterã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
<li>ç¬¬ 9 è¡Œï¼šè°ƒç”¨&nbsp;<code>ExtensionLoader#getActivateExtension(url, key, group)</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—ç›‘å¬å™¨æ•°ç»„ã€‚
<ul>
<li>ğŸ™‚ ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œè¯·çœ‹&nbsp;<a href="http://svip.iocoder.cn/Dubbo/spi/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æ‹“å±•æœºåˆ¶ SPIã€‹</a>&nbsp;æ–‡ç« ã€‚</li>
<li>ç»§ç»­ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºåŸºç¡€ï¼Œ<code>listeners</code>&nbsp;ä¸º<strong>ç©º</strong>ã€‚èƒ–å‹å¯ä»¥è‡ªè¡Œå®ç° ExporterListener ï¼Œå¹¶è¿›è¡Œé…ç½®&nbsp;<code>@Activate</code>æ³¨è§£ï¼Œæˆ–è€… XML ä¸­&nbsp;<code>listener</code>&nbsp;å±æ€§ã€‚</li>
</ul>
</li>
<li>ç¬¬ 11 è¡Œï¼šåˆ›å»ºå¸¦ ExporterListener çš„ ListenerExporterWrapper å¯¹è±¡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šæ‰§è¡Œ&nbsp;<code>ExporterListener#exported(exporter)</code>&nbsp;æ–¹æ³•ã€‚
<ul>
<li>ğŸ™‚ åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Œ4.3 ListenerExporterWrapperã€</a>&nbsp;è¯¦ç»†è§£æã€‚</li>
</ul>
</li>
</ul>
<h2 id="3-4-AbstractProtocol">3.4 AbstractProtocol</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/protocol/AbstractProtocol.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.AbstractProtocol</code></a>&nbsp;ï¼Œå®ç° Protocol æ¥å£ï¼Œåè®®æŠ½è±¡ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractProtocol</span> <span class="keyword">implements</span> <span class="title">Protocol</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Exporter é›†åˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * key: æœåŠ¡é”® {<span class="doctag">@link</span> #serviceKey(URL)} æˆ– {<span class="doctag">@link</span> URL#getServiceKey()} ã€‚</span></span><br /><span class="line"><span class="comment">     *      ä¸åŒåè®®ä¼šä¸åŒ</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Map&lt;String, Exporter&lt;?&gt;&gt; exporterMap = <span class="keyword">new</span> ConcurrentHashMap&lt;String, Exporter&lt;?&gt;&gt;();</span><br />    <br /><span class="line">    <span class="comment">// ... çœç•¥å’Œæœ¬æ–‡æ— å…³çš„æ–¹æ³•ä¸å±æ€§</span></span><br />    <br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>exporterMap</code>&nbsp;å±æ€§ï¼ŒExporter é›†åˆã€‚<strong>è¯¥é›†åˆæ‹¥æœ‰è¯¥åè®®ä¸­ï¼Œæ‰€æœ‰æš´éœ²ä¸­çš„ Exporter å¯¹è±¡</strong>ã€‚å…¶ä¸­&nbsp;<code>key</code>&nbsp;ä¸ºæœåŠ¡é”®ã€‚ä¸åŒåè®®çš„å®ç°ï¼Œç”Ÿæˆçš„æ–¹å¼<strong>ç•¥æœ‰å·®è·</strong>ã€‚ä¾‹å¦‚ï¼š
<ul>
<li>InjvmProtocol ä½¿ç”¨&nbsp;<code>URL#getServiceKey()</code>&nbsp;æ–¹æ³•</li>
<li>DubboProtocol ä½¿ç”¨&nbsp;<code>#serviceKey(URL)</code>&nbsp;æ–¹æ³•ã€‚</li>
<li>å·®åˆ«ä¸»è¦åœ¨äºæ˜¯å¦åŒ…å«&nbsp;<code>port</code>&nbsp;ã€‚å®é™…ä¸Šï¼Œä¹Ÿæ˜¯<strong>ä¸€è‡´çš„</strong>ã€‚å› ä¸º InjvmProtocol ç»Ÿä¸€&nbsp;<code>port=0</code>&nbsp;ã€‚</li>
</ul>
</li>
<li>è¯¥ç±»ä¸­ï¼Œ<strong>çœç•¥å’Œæœ¬æ–‡æ— å…³çš„æ–¹æ³•ä¸å±æ€§</strong>ã€‚</li>
</ul>
<h2 id="3-5-InjvmProtocol">3.5 InjvmProtocol</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-injvm/src/main/java/com/alibaba/dubbo/rpc/protocol/injvm/InjvmProtocol.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.injvm.InjvmProtocol</code></a>&nbsp;ï¼Œå®ç° AbstractProtocol æŠ½è±¡ç±»ï¼ŒInjvm åè®®å®ç°ç±»ã€‚</p>
<h3 id="3-5-1-å±æ€§">3.5.1 å±æ€§</h3>
<p>å±æ€§ç›¸å…³ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * åè®®å</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String NAME = Constants.LOCAL_PROTOCOL;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * é»˜è®¤ç«¯å£</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_PORT = <span class="number">0</span>;</span><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * å•ä¾‹ã€‚åœ¨ Dubbo SPI ä¸­ï¼Œè¢«åˆå§‹åŒ–ï¼Œæœ‰ä¸”ä»…æœ‰ä¸€æ¬¡ã€‚</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> InjvmProtocol INSTANCE;</span><br /><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">InjvmProtocol</span><span class="params">()</span> </span>{</span><br /><span class="line">    INSTANCE = <span class="keyword">this</span>;</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InjvmProtocol <span class="title">getInjvmProtocol</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">if</span> (INSTANCE == <span class="keyword">null</span>) {</span><br /><span class="line">        ExtensionLoader.getExtensionLoader(Protocol.class).getExtension(InjvmProtocol.NAME); <span class="comment">// load</span></span><br /><span class="line">    }</span><br /><span class="line">    <span class="keyword">return</span> INSTANCE;</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>NAME</code>&nbsp;<strong>é™æ€</strong>å±æ€§ï¼Œ<code>injvm</code>&nbsp;ï¼Œåè®®åã€‚</li>
<li><code>DEFAULT_PORT</code>&nbsp;<strong>é™æ€</strong>å±æ€§ï¼Œé»˜è®¤ç«¯å£ä¸º 0 ã€‚</li>
<li><code>INSTANCE</code>&nbsp;<strong>é™æ€</strong>å±æ€§ï¼Œå•ä¾‹ã€‚é€šè¿‡ Dubbo SPI åŠ è½½åˆ›å»ºï¼Œæœ‰ä¸”ä»…æœ‰ä¸€æ¬¡ã€‚
<ul>
<li><code>#getInjvmProtocol()</code>&nbsp;<strong>é™æ€</strong>æ–¹æ³•ï¼Œè·å¾—å•ä¾‹ã€‚</li>
</ul>
</li>
</ul>
<h3 id="3-5-2-export">3.5.2 export</h3>
<p>æœ¬æ–‡æ¶‰åŠçš„&nbsp;<code>#export(invoker)</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">Exporter&lt;T&gt; <span class="title">export</span><span class="params">(Invoker&lt;T&gt; invoker)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> InjvmExporter&lt;T&gt;(invoker, invoker.getUrl().getServiceKey(), exporterMap);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>åˆ›å»º InjvmExporter å¯¹è±¡ã€‚</li>
</ul>
<h1 id="4-Exporter">4. Exporter</h1>
<p>Exporter&nbsp;<strong>æ¥å£</strong>ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/service-export-local/">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; æ ¸å¿ƒæµç¨‹ä¸€è§ˆã€‹ã€Œ4.7 Exporterã€</a>&nbsp;æœ‰è¯¦ç»†è§£æã€‚</p>
<p>æœ¬æ–‡æ¶‰åŠçš„ Exporter ç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_07/05.png" alt="Exporter ç±»å›¾" /></p>
<h2 id="4-1-AbstractExporter">4.1 AbstractExporter</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/protocol/AbstractExporter.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.AbstractExporter</code></a>&nbsp;ï¼Œå®ç° Exporter æ¥å£ï¼ŒExporter æŠ½è±¡ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractExporter</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Exporter</span>&lt;<span class="title">T</span>&gt; </span>{</span><br /><br /><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Invoker å¯¹è±¡</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Invoker&lt;T&gt; invoker;</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * æ˜¯å¦å–æ¶ˆæš´éœ²æœåŠ¡</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> unexported = <span class="keyword">false</span>;</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AbstractExporter</span><span class="params">(Invoker&lt;T&gt; invoker)</span> </span>{</span><br /><span class="line">        <span class="keyword">if</span> (invoker == <span class="keyword">null</span>)</span><br /><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"service invoker == null"</span>);</span><br /><span class="line">        <span class="keyword">if</span> (invoker.getInterface() == <span class="keyword">null</span>)</span><br /><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"service type == null"</span>);</span><br /><span class="line">        <span class="keyword">if</span> (invoker.getUrl() == <span class="keyword">null</span>)</span><br /><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"service url == null"</span>);</span><br /><span class="line">        <span class="keyword">this</span>.invoker = invoker;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> Invoker&lt;T&gt; <span class="title">getInvoker</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> invoker;</span><br /><span class="line">    }</span><br />    <br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unexport</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">if</span> (unexported) {</span><br /><span class="line">            <span class="keyword">return</span>;</span><br /><span class="line">        }</span><br /><span class="line">        unexported = <span class="keyword">true</span>;</span><br /><span class="line">        getInvoker().destroy();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> getInvoker().toString();</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>invoker</code>&nbsp;å±æ€§ï¼ŒInvoker å¯¹è±¡ã€‚
<ul>
<li><code>#getInvoker()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾— Invoker å¯¹è±¡ã€‚</li>
</ul>
</li>
<li><code>unexported</code>&nbsp;å±æ€§ï¼Œæ˜¯å¦å–æ¶ˆæš´éœ²æœåŠ¡ã€‚
<ul>
<li><code>#unexport()</code>&nbsp;æ–¹æ³•ï¼Œå–æ¶ˆæš´éœ²æœåŠ¡ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-2-InjvmExporter">4.2 InjvmExporter</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-injvm/src/main/java/com/alibaba/dubbo/rpc/protocol/injvm/InjvmExporter.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.protocol.injvm.InjvmProtocol</code></a>&nbsp;ï¼Œå®ç° AbstractExporter æŠ½è±¡ç±»ï¼ŒInjvm Exporter å®ç°ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InjvmExporter</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractExporter</span>&lt;<span class="title">T</span>&gt; </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * æœåŠ¡é”®</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String key;</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Exporter é›†åˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * key: æœåŠ¡é”®</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * è¯¥å€¼å®é™…å°±æ˜¯ {<span class="doctag">@link</span> com.alibaba.dubbo.rpc.protocol.AbstractProtocol#exporterMap}</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Exporter&lt;?&gt;&gt; exporterMap;</span><br /><br /><span class="line">    InjvmExporter(Invoker&lt;T&gt; invoker, String key, Map&lt;String, Exporter&lt;?&gt;&gt; exporterMap) {</span><br /><span class="line">        <span class="keyword">super</span>(invoker);</span><br /><span class="line">        <span class="keyword">this</span>.key = key;</span><br /><span class="line">        <span class="keyword">this</span>.exporterMap = exporterMap;</span><br /><span class="line">        <span class="comment">// æ·»åŠ åˆ° Exporter é›†åˆ</span></span><br /><span class="line">        exporterMap.put(key, <span class="keyword">this</span>);</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unexport</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">super</span>.unexport();</span><br /><span class="line">        <span class="comment">// ç§»é™¤å‡º Exporter é›†åˆ</span></span><br /><span class="line">        exporterMap.remove(key);</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>key</code>&nbsp;å±æ€§ï¼ŒæœåŠ¡é”®ã€‚</li>
<li><code>exporterMap</code>&nbsp;å±æ€§ï¼ŒExporter é›†åˆã€‚åœ¨ä¸Šæ–‡&nbsp;<code>InjvmProtocol#export(invoker)</code>&nbsp;æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥å±æ€§å°±æ˜¯&nbsp;<code>AbstractProtocol.exporterMap</code>&nbsp;å±æ€§ã€‚
<ul>
<li><strong>æ„é€ æ–¹æ³•</strong>ï¼Œ<strong>å‘èµ·</strong>æš´éœ²ï¼Œå°†è‡ªå·±æ·»åŠ åˆ°&nbsp;<code>exporterMap</code>&nbsp;ä¸­ã€‚</li>
<li><code>#unexport()</code>&nbsp;æ–¹æ³•ï¼Œ<strong>å–æ¶ˆ</strong>æš´éœ²ï¼Œå°†è‡ªå·±ç§»é™¤å‡º&nbsp;<code>exporterMap</code>&nbsp;ä¸­ã€‚</li>
</ul>
</li>
</ul>
<h2 id="4-3-ListenerExporterWrapper">4.3 ListenerExporterWrapper</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/8de6d56d06965a38712c46a0220f4e59213db72f/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/listener/ListenerExporterWrapper.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.listener.ListenerExporterWrapper</code></a>&nbsp;ï¼Œå®ç° Exporter æ¥å£ï¼Œå…·æœ‰ç›‘å¬å™¨åŠŸèƒ½çš„ Exporter åŒ…è£…å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListenerExporterWrapper</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Exporter</span>&lt;<span class="title">T</span>&gt; </span>{</span><br /><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ListenerExporterWrapper.class);</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * çœŸå®çš„ Exporter å¯¹è±¡</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Exporter&lt;T&gt; exporter;</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Exporter ç›‘å¬å™¨æ•°ç»„</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;ExporterListener&gt; listeners;</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ListenerExporterWrapper</span><span class="params">(Exporter&lt;T&gt; exporter, List&lt;ExporterListener&gt; listeners)</span> </span>{</span><br /><span class="line">        <span class="keyword">if</span> (exporter == <span class="keyword">null</span>) {</span><br /><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"exporter == null"</span>);</span><br /><span class="line">        }</span><br /><span class="line">        <span class="keyword">this</span>.exporter = exporter;</span><br /><span class="line">        <span class="keyword">this</span>.listeners = listeners;</span><br /><span class="line">        <span class="comment">// æ‰§è¡Œç›‘å¬å™¨</span></span><br /><span class="line">        <span class="keyword">if</span> (listeners != <span class="keyword">null</span> &amp;&amp; !listeners.isEmpty()) {</span><br /><span class="line">            RuntimeException exception = <span class="keyword">null</span>;</span><br /><span class="line">            <span class="keyword">for</span> (ExporterListener listener : listeners) {</span><br /><span class="line">                <span class="keyword">if</span> (listener != <span class="keyword">null</span>) {</span><br /><span class="line">                    <span class="keyword">try</span> {</span><br /><span class="line">                        listener.exported(<span class="keyword">this</span>);</span><br /><span class="line">                    } <span class="keyword">catch</span> (RuntimeException t) {</span><br /><span class="line">                        logger.error(t.getMessage(), t);</span><br /><span class="line">                        exception = t;</span><br /><span class="line">                    }</span><br /><span class="line">                }</span><br /><span class="line">            }</span><br /><span class="line">            <span class="keyword">if</span> (exception != <span class="keyword">null</span>) {</span><br /><span class="line">                <span class="keyword">throw</span> exception;</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> Invoker&lt;T&gt; <span class="title">getInvoker</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> exporter.getInvoker();</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unexport</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">try</span> {</span><br /><span class="line">            exporter.unexport();</span><br /><span class="line">        } <span class="keyword">finally</span> {</span><br /><span class="line">            <span class="comment">// æ‰§è¡Œç›‘å¬å™¨</span></span><br /><span class="line">            <span class="keyword">if</span> (listeners != <span class="keyword">null</span> &amp;&amp; !listeners.isEmpty()) {</span><br /><span class="line">                RuntimeException exception = <span class="keyword">null</span>;</span><br /><span class="line">                <span class="keyword">for</span> (ExporterListener listener : listeners) {</span><br /><span class="line">                    <span class="keyword">if</span> (listener != <span class="keyword">null</span>) {</span><br /><span class="line">                        <span class="keyword">try</span> {</span><br /><span class="line">                            listener.unexported(<span class="keyword">this</span>);</span><br /><span class="line">                        } <span class="keyword">catch</span> (RuntimeException t) {</span><br /><span class="line">                            logger.error(t.getMessage(), t);</span><br /><span class="line">                            exception = t;</span><br /><span class="line">                        }</span><br /><span class="line">                    }</span><br /><span class="line">                }</span><br /><span class="line">                <span class="keyword">if</span> (exception != <span class="keyword">null</span>) {</span><br /><span class="line">                    <span class="keyword">throw</span> exception;</span><br /><span class="line">                }</span><br /><span class="line">            }</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><strong>æ„é€ æ–¹æ³•</strong>ï¼Œå¾ªç¯&nbsp;<code>listeners</code>&nbsp;ï¼Œæ‰§è¡Œ&nbsp;<code>ExporterListener#exported(listener)</code>&nbsp;ã€‚è‹¥æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ RuntimeException ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ï¼Œç»§ç»­æ‰§è¡Œï¼Œæœ€ç»ˆæ‰æŠ›å‡ºã€‚</li>
<li><code>#unexport()</code>&nbsp;æ–¹æ³•ï¼Œå¾ªç¯&nbsp;<code>listeners</code>&nbsp;ï¼Œæ‰§è¡Œ&nbsp;<code>ExporterListener#unexported(listener)</code>&nbsp;ã€‚è‹¥æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ RuntimeException ï¼Œæ‰“å°é”™è¯¯æ—¥å¿—ï¼Œç»§ç»­æ‰§è¡Œï¼Œæœ€ç»ˆæ‰æŠ›å‡ºã€‚</li>
</ul>
<h1 id="5-ExporterListener">5. ExporterListener</h1>
<p><a href="https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ExporterListener.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.ExporterListener</code></a>&nbsp;ï¼ŒExporter ç›‘å¬å™¨ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span></span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExporterListener</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The exporter exported.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡æš´éœ²å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> exporter</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Protocol#export(Invoker)</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">exported</span><span class="params">(Exporter&lt;?&gt; exporter)</span> <span class="keyword">throws</span> RpcException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * The exporter unexported.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * å½“æœåŠ¡å–æ¶ˆæš´éœ²å®Œæˆ</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> exporter</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RpcException</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.rpc.Exporter#unexport()</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unexported</span><span class="params">(Exporter&lt;?&gt; exporter)</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_03_01/17.png" alt="ExporterListener å­ç±»" /></p>
<h2 id="5-1-ExporterListenerAdapter">5.1 ExporterListenerAdapter</h2>
<p><code>com.alibaba.dubbo.rpc.listener.ExporterListenerAdapter</code>&nbsp;ï¼Œå®ç° ExporterListener æ¥å£ï¼ŒExporterListener é€‚é…å™¨æŠ½è±¡ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ExporterListenerAdapter</span> <span class="keyword">implements</span> <span class="title">ExporterListener</span> </span>{</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exported</span><span class="params">(Exporter&lt;?&gt; exporter)</span> <span class="keyword">throws</span> RpcException </span>{ }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unexported</span><span class="params">(Exporter&lt;?&gt; exporter)</span> <span class="keyword">throws</span> RpcException </span>{ }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</div>