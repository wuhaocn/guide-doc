<header class="article-header">
<h1 class="article-title">è¿‡æ»¤å™¨ï¼ˆäº”ï¼‰ä¹‹ TimeoutFilter</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>æœ¬æ–‡åˆ†äº«è¿‡æ»¤å™¨ TimeoutFilter ï¼Œç”¨äºæœåŠ¡<strong>æä¾›è€…</strong>ä¸­ã€‚</p>
<h1 id="2-TimeoutFilter">2. TimeoutFilter</h1>
<p><code>com.alibaba.dubbo.rpc.filter.TimeoutFilter</code>&nbsp;ï¼Œå®ç° Filter æ¥å£ï¼Œè¶…æ—¶è¿‡æ»¤å™¨ã€‚å¦‚æœæœåŠ¡è°ƒç”¨<strong>è¶…æ—¶</strong>ï¼Œè®°å½•<strong>å‘Šè­¦</strong>æ—¥å¿—ï¼Œ<strong>ä¸å¹²æ¶‰</strong>æœåŠ¡çš„è¿è¡Œã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="meta">@Activate</span>(group = Constants.PROVIDER)</span><br /><span class="line"> <span class="number">2</span>: <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeoutFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</span><br /><span class="line"> <span class="number">3</span>: </span><br /><span class="line"> <span class="number">4</span>:     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(TimeoutFilter.class);</span><br /><span class="line"> <span class="number">5</span>: </span><br /><span class="line"> <span class="number">6</span>:     <span class="meta">@Override</span></span><br /><span class="line"> <span class="number">7</span>:     <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"> <span class="number">8</span>:         <span class="keyword">long</span> start = System.currentTimeMillis();</span><br /><span class="line"> <span class="number">9</span>:         <span class="comment">// æœåŠ¡è°ƒç”¨</span></span><br /><span class="line"><span class="number">10</span>:         Result result = invoker.invoke(invocation);</span><br /><span class="line"><span class="number">11</span>:         <span class="comment">// è®¡ç®—è°ƒç”¨æ—¶é•¿</span></span><br /><span class="line"><span class="number">12</span>:         <span class="keyword">long</span> elapsed = System.currentTimeMillis() - start;</span><br /><span class="line"><span class="number">13</span>:         <span class="comment">// è¶…è¿‡æ—¶é•¿ï¼Œæ‰“å°å‘Šè­¦æ—¥å¿—</span></span><br /><span class="line"><span class="number">14</span>:         <span class="keyword">if</span> (invoker.getUrl() != <span class="keyword">null</span></span><br /><span class="line"><span class="number">15</span>:                 &amp;&amp; elapsed &gt; invoker.getUrl().getMethodParameter(invocation.getMethodName(), <span class="string">"timeout"</span>, Integer.MAX_VALUE)) {</span><br /><span class="line"><span class="number">16</span>:             <span class="keyword">if</span> (logger.isWarnEnabled()) {</span><br /><span class="line"><span class="number">17</span>:                 logger.warn(<span class="string">"invoke time out. method: "</span> + invocation.getMethodName()</span><br /><span class="line"><span class="number">18</span>:                         + <span class="string">" arguments: "</span> + Arrays.toString(invocation.getArguments()) + <span class="string">" , url is "</span></span><br /><span class="line"><span class="number">19</span>:                         + invoker.getUrl() + <span class="string">", invoke elapsed "</span> + elapsed + <span class="string">" ms."</span>);</span><br /><span class="line"><span class="number">20</span>:             }</span><br /><span class="line"><span class="number">21</span>:         }</span><br /><span class="line"><span class="number">22</span>:         <span class="keyword">return</span> result;</span><br /><span class="line"><span class="number">23</span>:     }</span><br /><span class="line"><span class="number">24</span>: </span><br /><span class="line"><span class="number">25</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç¬¬ 10 è¡Œï¼šè°ƒç”¨&nbsp;<code>Invoker#invoke(invocation)</code>&nbsp;æ–¹æ³•ï¼ŒæœåŠ¡è°ƒç”¨ã€‚</li>
<li>ç¬¬ 12 è¡Œï¼šè®¡ç®—è°ƒç”¨æ—¶é•¿ã€‚</li>
<li>ç¬¬ 13 è‡³ 21 è¡Œï¼šè¶…è¿‡æ—¶é•¿ï¼Œæ‰“å°<strong>å‘Šè­¦</strong>æ—¥å¿—ã€‚æ³¨æ„ï¼Œæ­¤å¤„çš„&nbsp;<code>"timeout"</code>&nbsp;å–å¾—çš„æ˜¯æœåŠ¡<strong>æä¾›è€…</strong>çš„é…ç½®ï¼Œä¸åŒäºæœåŠ¡<strong>æ¶ˆè´¹è€…</strong>çš„é…ç½®ã€‚</li>
<li>ç¬¬ 22 è¡Œï¼šè¿”å›è°ƒç”¨ç»“æœã€‚</li>
<li>ğŸ™‚ å†æ³¨æ„ï¼Œåœ¨æœåŠ¡<strong>æä¾›è€…</strong>ï¼Œæ‰§è¡ŒæœåŠ¡è°ƒç”¨æ—¶ï¼Œå³ä½¿<strong>è¶…è¿‡äº†è¶…æ—¶æ—¶é—´</strong>ï¼Œä¹Ÿä¸ä¼šå–æ¶ˆæ‰§è¡Œã€‚è™½ç„¶ï¼ŒæœåŠ¡<strong>æ¶ˆè´¹è€…</strong>ï¼Œå·²ç»ç»“æŸè°ƒç”¨ï¼Œè¿”å›è°ƒç”¨è¶…æ—¶ã€‚</li>
</ul>
</div>