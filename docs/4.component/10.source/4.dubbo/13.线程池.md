# çº¿ç¨‹æ± 

æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚

# 1. æ¦‚è¿°

åœ¨ [ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” çº¿ç¨‹æ¨¡å‹ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/thread-model.html) ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Dubbo æä¾›äº†**ä¸‰ç§çº¿ç¨‹æ± çš„å®ç°**ï¼š
ThreadPool

- fixed
  å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼Œå¯åŠ¨æ—¶å»ºç«‹çº¿ç¨‹ï¼Œä¸å…³é—­ï¼Œä¸€ç›´æŒæœ‰ã€‚(**ç¼ºçœ**)
- cached
  ç¼“å­˜çº¿ç¨‹æ± ï¼Œç©ºé—²ä¸€åˆ†é’Ÿè‡ªåŠ¨åˆ é™¤ï¼Œéœ€è¦æ—¶é‡å»ºã€‚
- limited
  å¯ä¼¸ç¼©çº¿ç¨‹æ± ï¼Œä½†æ± ä¸­çš„çº¿ç¨‹æ•°åªä¼šå¢é•¿ä¸ä¼šæ”¶ç¼©ã€‚åªå¢é•¿ä¸æ”¶ç¼©çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…æ”¶ç¼©æ—¶çªç„¶æ¥äº†å¤§æµé‡å¼•èµ·çš„æ€§èƒ½é—®é¢˜ã€‚

åœ¨ [
dubbo-common
](https://github.com/apache/incubator-dubbo/tree/master/dubbo-common) æ¨¡å—çš„

threadpool
åŒ…ä¸‹å®ç°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![threadpool](http://static2.iocoder.cn/images/Dubbo/2018_03_05/01.png)

# 2. ThreadPool

[
com.alibaba.dubbo.common.threadpool.ThreadPool
](https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-common/src/main/java/com/alibaba/dubbo/common/threadpool/ThreadPool.java) ï¼Œçº¿ç¨‹æ± æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
@SPI("fixed")
public interface ThreadPool{
//*/*
/* Thread pool
/*
/* @param url URL contains thread parameter
/* @return thread pool
/*/
@Adaptive({Constants.THREADPOOL_KEY})
Executor getExecutor(URL url);
}
```

- @SPI("fixed")
  æ³¨è§£ï¼ŒDubbo SPI **æ‹“å±•ç‚¹**ï¼Œé»˜è®¤ä¸º

"fixed"
ã€‚

- @Adaptive({Constants.THREADPOOL_KEY})
  æ³¨è§£ï¼ŒåŸºäº Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„çº¿ç¨‹æ± å®ç°ï¼Œä½¿ç”¨

URL.threadpool
å±æ€§ã€‚

- /#getExecutor(url)
  æ–¹æ³•ï¼Œè·å¾—**å¯¹åº”**çš„çº¿ç¨‹æ± çš„æ‰§è¡Œå™¨ã€‚

å­ç±»ç±»å›¾å¦‚ä¸‹ï¼š

![ç±»å›¾](http://static2.iocoder.cn/images/Dubbo/2018_03_05/02.png)

## 2.1 FixedThreadPool

com.alibaba.dubbo.common.threadpool.support.fixed.FixedThreadPool
ï¼Œå®ç° ThreadPool æ¥å£ï¼Œå›ºå®šå¤§å°çº¿ç¨‹æ± ï¼Œå¯åŠ¨æ—¶å»ºç«‹çº¿ç¨‹ï¼Œä¸å…³é—­ï¼Œä¸€ç›´æŒæœ‰ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
1: public class FixedThreadPool implements ThreadPool{
2:
3: @Override
4: public Executor getExecutor(URL url){
5: // çº¿ç¨‹å
6: String name = url.getParameter(Constants.THREAD_NAME_KEY, Constants.DEFAULT_THREAD_NAME);
7: // çº¿ç¨‹æ•°
8: int threads = url.getParameter(Constants.THREADS_KEY, Constants.DEFAULT_THREADS);
9: // é˜Ÿåˆ—æ•°
10: int queues = url.getParameter(Constants.QUEUES_KEY, Constants.DEFAULT_QUEUES);
11: // åˆ›å»ºæ‰§è¡Œå™¨
12: return new ThreadPoolExecutor(threads, threads, 0, TimeUnit.MILLISECONDS,
13: queues == 0 ? new SynchronousQueue<Runnable>() :
14: (queues < 0 ? new LinkedBlockingQueue<Runnable>()
15: : new LinkedBlockingQueue<Runnable>(queues)),
16: new NamedThreadFactory(name, true), new AbortPolicyWithReport(name, url));
17: }
18:
19: }
```

- ç¬¬ 5 è‡³ 10 è¡Œï¼šè·å¾—çº¿ç¨‹åã€çº¿ç¨‹æ•°ã€é˜Ÿåˆ—æ•°ã€‚ç›®å‰åªæœ‰æœåŠ¡æä¾›è€…ä½¿ç”¨ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š

```
<dubbo:service interface="com.alibaba.dubbo.demo.DemoService" ref="demoService">
<dubbo:parameter key="threadname" value="shuaiqi" />
<dubbo:parameter key="threads" value="123" />
<dubbo:parameter key="queues" value="10" />
</dubbo:service>
```

- ç¬¬ 11 è‡³ 16 è¡Œï¼šåˆ›å»ºæ‰§è¡Œå™¨ ThreadPoolExecutor å¯¹è±¡ã€‚

- æ ¹æ®ä¸åŒçš„é˜Ÿåˆ—æ•°ï¼Œä½¿ç”¨ä¸åŒçš„é˜Ÿåˆ—å®ç°ï¼š

- ç¬¬ 13 è¡Œï¼š

queues == 0
ï¼Œ SynchronousQueue å¯¹è±¡ã€‚

- ç¬¬ 14 è¡Œï¼š

queues < 0
ï¼Œ LinkedBlockingQueue å¯¹è±¡ã€‚

- ç¬¬ 15 è¡Œï¼š

queues > 0
ï¼Œå¸¦é˜Ÿåˆ—æ•°çš„ LinkedBlockingQueue å¯¹è±¡ã€‚

- æ¨èé˜…è¯»ï¼š

- [ã€ŠJava å¹¶å‘åŒ…ä¸­çš„åŒæ­¥é˜Ÿåˆ— SynchronousQueue å®ç°åŸç†ã€‹](http://ifeve.com/java-synchronousqueue/)
- [ã€ŠJava é˜»å¡é˜Ÿåˆ— ArrayBlockingQueue å’Œ LinkedBlockingQueue å®ç°åŸç†åˆ†æã€‹](https://fangjian0423.github.io/2016/05/10/java-arrayblockingqueue-linkedblockingqueue-analysis/)
- [ã€ŠèŠèŠå¹¶å‘ï¼ˆä¸‰ï¼‰â€”â€”JAVA çº¿ç¨‹æ± çš„åˆ†æå’Œä½¿ç”¨ã€‹](http://www.infoq.com/cn/articles/java-threadPool)
- [ã€ŠèŠèŠå¹¶å‘ï¼ˆä¸ƒï¼‰â€”â€”Java ä¸­çš„é˜»å¡é˜Ÿåˆ—ã€‹](http://www.infoq.com/cn/articles/java-blocking-queue)
- ç¬¬ 16 è¡Œï¼šåˆ›å»º [NamedThreadFactory](https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/NamedThreadFactory.java) å¯¹è±¡ï¼Œç”¨äºç”Ÿæˆ**çº¿ç¨‹å**ã€‚
- ç¬¬ 16 è¡Œï¼šåˆ›å»º AbortPolicyWithReport å¯¹è±¡ï¼Œç”¨äº**å½“ä»»åŠ¡æ·»åŠ åˆ°çº¿ç¨‹æ± ä¸­è¢«æ‹’ç»æ—¶**ã€‚

## 2.2 CachedThreadPool

com.alibaba.dubbo.common.threadpool.support.cached.CachedThreadPool
ï¼Œå®ç° ThreadPool æ¥å£ï¼Œç¼“å­˜çº¿ç¨‹æ± ï¼Œç©ºé—²ä¸€å®šæ—¶é•¿ï¼Œè‡ªåŠ¨åˆ é™¤ï¼Œéœ€è¦æ—¶é‡å»ºã€‚ä»£ç å¦‚ä¸‹ï¼š

```
1: public class CachedThreadPool implements ThreadPool{
2:
3: @Override
4: public Executor getExecutor(URL url){
5: // çº¿ç¨‹æ± å
6: String name = url.getParameter(Constants.THREAD_NAME_KEY, Constants.DEFAULT_THREAD_NAME);
7: // æ ¸å¿ƒçº¿ç¨‹æ•°
8: int cores = url.getParameter(Constants.CORE_THREADS_KEY, Constants.DEFAULT_CORE_THREADS);
9: // æœ€å¤§çº¿ç¨‹æ•°
10: int threads = url.getParameter(Constants.THREADS_KEY, Integer.MAX_VALUE);
11: // é˜Ÿåˆ—æ•°
12: int queues = url.getParameter(Constants.QUEUES_KEY, Constants.DEFAULT_QUEUES);
13: // çº¿ç¨‹å­˜æ´»æ—¶é•¿
14: int alive = url.getParameter(Constants.ALIVE_KEY, Constants.DEFAULT_ALIVE);
15: // åˆ›å»ºæ‰§è¡Œå™¨
16: return new ThreadPoolExecutor(cores, threads, alive, TimeUnit.MILLISECONDS,
17: queues == 0 ? new SynchronousQueue<Runnable>() :
18: (queues < 0 ? new LinkedBlockingQueue<Runnable>()
19: : new LinkedBlockingQueue<Runnable>(queues)),
20: new NamedThreadFactory(name, true), new AbortPolicyWithReport(name, url));
21: }
22:
23: }
```

- ç¬¬ 5 è‡³ 14 è¡Œï¼šè·å¾—çº¿ç¨‹åã€æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€é˜Ÿåˆ—æ•°ã€çº¿ç¨‹å­˜æ´»æ—¶é•¿ã€‚

- ğŸ™‚ é…ç½®æ–¹å¼å’Œ FixedThreadPool ç±»ä¼¼ï¼Œä½¿ç”¨

<dubbo:parameter />
é…ç½®ã€‚

- ç¬¬ 16 è‡³ 20 è¡Œï¼šåˆ›å»ºæ‰§è¡Œå™¨ ThreadPoolExecutor å¯¹è±¡ã€‚

- ğŸ™‚ å’Œ FixedThreadPool ç›¸å¯¹ç±»ä¼¼ã€‚

## 2.3 LimitedThreadPool

com.alibaba.dubbo.common.threadpool.support.limited.LimitedThreadPool
ï¼Œå®ç° ThreadPool æ¥å£ï¼Œå¯ä¼¸ç¼©çº¿ç¨‹æ± ï¼Œä½†æ± ä¸­çš„çº¿ç¨‹æ•°åªä¼šå¢é•¿ä¸ä¼šæ”¶ç¼©ã€‚åªå¢é•¿ä¸æ”¶ç¼©çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…æ”¶ç¼©æ—¶çªç„¶æ¥äº†å¤§æµé‡å¼•èµ·çš„æ€§èƒ½é—®é¢˜ã€‚ä»£ç å¦‚ä¸‹ï¼š

```
1: public class LimitedThreadPool implements ThreadPool{
2:
3: @Override
4: public Executor getExecutor(URL url){
5: // çº¿ç¨‹å
6: String name = url.getParameter(Constants.THREAD_NAME_KEY, Constants.DEFAULT_THREAD_NAME);
7: // æ ¸å¿ƒçº¿ç¨‹æ•°
8: int cores = url.getParameter(Constants.CORE_THREADS_KEY, Constants.DEFAULT_CORE_THREADS);
9: // æœ€å¤§çº¿ç¨‹æ•°
10: int threads = url.getParameter(Constants.THREADS_KEY, Constants.DEFAULT_THREADS);
11: // é˜Ÿåˆ—æ•°
12: int queues = url.getParameter(Constants.QUEUES_KEY, Constants.DEFAULT_QUEUES);
13: // åˆ›å»ºæ‰§è¡Œå™¨
14: return new ThreadPoolExecutor(cores, threads, Long.MAX_VALUE, TimeUnit.MILLISECONDS,
15: queues == 0 ? new SynchronousQueue<Runnable>() :
16: (queues < 0 ? new LinkedBlockingQueue<Runnable>()
17: : new LinkedBlockingQueue<Runnable>(queues)),
18: new NamedThreadFactory(name, true), new AbortPolicyWithReport(name, url));
19: }
20:
21: }
```

- å’Œ CachedThreadPool å®ç°æ˜¯åŸºæœ¬ä¸€è‡´çš„ï¼Œå·®å¼‚ç‚¹åœ¨

alive == Integer.MAX_VALUE
ï¼Œ**ç©ºé—²æ—¶é—´æ— é™å¤§**ï¼Œå³ä¸ä¼šè‡ªåŠ¨åˆ é™¤ã€‚

# 3. AbortPolicyWithReport

com.alibaba.dubbo.common.threadpool.support.AbortPolicyWithReport
ï¼Œå®ç°

java.util.concurrent.ThreadPoolExecutor.AbortPolicy
ï¼Œæ‹’ç»ç­–ç•¥å®ç°ç±»ã€‚**æ‰“å° JStack ï¼Œåˆ†æçº¿ç¨‹çŠ¶æ€**ã€‚

## 3.1 å±æ€§

```
//*/*
/* çº¿ç¨‹å
/*/
private final String threadName;
//*/*
/* URL å¯¹è±¡
/*/
private final URL url;
//*/*
/* æœ€åæ‰“å°æ—¶é—´
/*/
private static volatile long lastPrintTime = 0;
//*/*
/* ä¿¡å·é‡ï¼Œå¤§å°ä¸º 1 ã€‚
/*/
private static Semaphore guard = new Semaphore(1);
public AbortPolicyWithReport(String threadName, URL url){
this.threadName = threadName;
this.url = url;
}
```

## 3.2 rejectedExecution

/#rejectedExecution(Runnable, ThreadPoolExecutor)
**å®ç°**æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
1: @Override
2: public void rejectedExecution(Runnable r, ThreadPoolExecutor e){
3: // æ‰“å°å‘Šè­¦æ—¥å¿—
4: String msg = String.format("Thread pool is EXHAUSTED!" +
5: " Thread Name: %s, Pool Size: %d (active: %d, core: %d, max: %d, largest: %d), Task: %d (completed: %d)," +
6: " Executor status:(isShutdown:%s, isTerminated:%s, isTerminating:%s), in %s://%s:%d!",
7: threadName, e.getPoolSize(), e.getActiveCount(), e.getCorePoolSize(), e.getMaximumPoolSize(), e.getLargestPoolSize(),
8: e.getTaskCount(), e.getCompletedTaskCount(), e.isShutdown(), e.isTerminated(), e.isTerminating(),
9: url.getProtocol(), url.getIp(), url.getPort());
10: logger.warn(msg);
11: // æ‰“å° JStack ï¼Œåˆ†æçº¿ç¨‹çŠ¶æ€ã€‚
12: dumpJStack();
13: // æŠ›å‡º RejectedExecutionException å¼‚å¸¸
14: throw new RejectedExecutionException(msg);
15: }
```

- ç¬¬ 3 è‡³ 10 è¡Œï¼šæ‰“å°**å‘Šè­¦æ—¥å¿—**ã€‚
- ç¬¬ 12 è¡Œï¼šè°ƒç”¨

/#dumpJStack()
æ–¹æ³•ï¼Œæ‰“å° **JStack** ï¼Œåˆ†æçº¿ç¨‹çŠ¶æ€ã€‚

- ç¬¬ 14 è¡Œï¼šæŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚

## 3.3 dumpJStack

/#dumpJStack()
æ–¹æ³•ï¼Œæ‰“å° JStackã€‚ä»£ç å¦‚ä¸‹ï¼š

```
1: private void dumpJStack(){
2: long now = System.currentTimeMillis();
3:
4: // æ¯ 10 åˆ†é’Ÿï¼Œæ‰“å°ä¸€æ¬¡ã€‚
5: // dump every 10 minutes
6: if (now - lastPrintTime < 10 /* 60 /* 1000) {
7: return;
8: }
9:
10: // è·å¾—ä¿¡å·é‡
11: if (!guard.tryAcquire()) {
12: return;
13: }
14:
15: // åˆ›å»ºçº¿ç¨‹æ± ï¼Œåå°æ‰§è¡Œæ‰“å° JStack
16: Executors.newSingleThreadExecutor().execute(new Runnable() {
17: @Override
18: public void run(){
19:
20: // è·å¾—ç³»ç»Ÿ
21: String OS = System.getProperty("os.name").toLowerCase();
22: // è·å¾—è·¯å¾„
23: String dumpPath = url.getParameter(Constants.DUMP_DIRECTORY, System.getProperty("user.home"));
24: SimpleDateFormat sdf;
25: // window system don't support ":" in file name
26: if(OS.contains("win")){
27: sdf = new SimpleDateFormat("yyyy-MM-dd_HH-mm-ss");
28: }else {
29: sdf = new SimpleDateFormat("yyyy-MM-dd_HH:mm:ss");
30: }
31: String dateStr = sdf.format(new Date());
32: // è·å¾—è¾“å‡ºæµ
33: FileOutputStream jstackStream = null;
34: try {
35: jstackStream = new FileOutputStream(new File(dumpPath, "Dubbo_JStack.log" + "." + dateStr));
36: // æ‰“å° JStack
37: JVMUtil.jstack(jstackStream);
38: } catch (Throwable t) {
39: logger.error("dump jstack error", t);
40: } finally {
41: // é‡Šæ”¾ä¿¡å·é‡
42: guard.release();
43: // é‡Šæ”¾è¾“å‡ºæµ
44: if (jstackStream != null) {
45: try {
46: jstackStream.flush();
47: jstackStream.close();
48: } catch (IOException e) {
49: }
50: }
51: }
52: // è®°å½•æœ€åæ‰“å°æ—¶é—´
53: lastPrintTime = System.currentTimeMillis();
54: }
55: });
56:
57: }
```

- ç¬¬ 2 è‡³ 8 è¡Œï¼šæ¯ 10 åˆ†é’Ÿï¼Œ**åª**æ‰“å°ä¸€æ¬¡ã€‚
- ç¬¬ 10 è‡³ 13 è¡Œï¼šè·å¾—ä¿¡å·é‡ã€‚ä¿è¯ï¼ŒåŒä¸€æ—¶é—´ï¼Œ**æœ‰ä¸”ä»…æœ‰**ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ‰“å°ã€‚
- ç¬¬ 15 è‡³ 54 è¡Œï¼šåˆ›å»ºçº¿ç¨‹æ± ï¼Œ**åå°**æ‰§è¡Œæ‰“å° JStack ã€‚

- ç¬¬ 20 è‡³ 31 è¡Œï¼šè·å¾—è·¯å¾„ã€‚
- ç¬¬ 32 è‡³ 35 è¡Œï¼šè·å¾—æ–‡ä»¶è¾“å‡ºæµã€‚
- ç¬¬ 37 è¡Œï¼šè°ƒç”¨

JVMUtil/#jstack(OutputStream)
æ–¹æ³•ï¼Œæ‰“å° JStack ã€‚

- ç¬¬ 42 è¡Œï¼šé‡Šæ”¾ä¿¡å·é‡ã€‚
- ç¬¬ 44 è‡³ 50 è¡Œï¼šé‡Šæ”¾è¾“å‡ºæµã€‚
- ç¬¬ 53 è¡Œï¼šè®°å½•æœ€åæ‰“å°æ—¶é—´ã€‚

# 4. JVMUtil

[
com.alibaba.dubbo.common.utils.JVMUtil
](https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/JVMUtil.java) ï¼ŒJVM å·¥å…·ç±»ã€‚ç›®å‰ï¼Œä»…æœ‰ JStack åŠŸèƒ½ï¼Œèƒ–å‹å¯ä»¥ç‚¹å‡»é“¾æ¥ï¼Œè‡ªå·±æŸ¥çœ‹ä¸‹ä»£ç ã€‚

å¦‚ä¸‹æ˜¯ä¸€ä¸ª JStack æ—¥å¿—çš„ç¤ºä¾‹ï¼š

```
123312:tmp yunai$ cat Dubbo_JStack.log.2018-03-27_18\:57\:32
"pool-2-thread-1" Id=11 RUNNABLE
at sun.management.ThreadImpl.dumpThreads0(Native Method)
at sun.management.ThreadImpl.dumpAllThreads(ThreadImpl.java:454)
at com.alibaba.dubbo.common.utils.JVMUtil.jstack(JVMUtil.java:34)
at com.alibaba.dubbo.common.threadpool.support.AbortPolicyWithReport$1.run(AbortPolicyWithReport.java:122)
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
at java.lang.Thread.run(Thread.java:745)
Number of locked synchronizers = 1
- java.util.concurrent.ThreadPoolExecutor$Worker@5cbc508c
"Monitor Ctrl-Break" Id=5 RUNNABLE (in native)
at java.net.SocketInputStream.socketRead0(Native Method)
at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)
at java.net.SocketInputStream.read(SocketInputStream.java:171)
at java.net.SocketInputStream.read(SocketInputStream.java:141)
at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)
at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)
at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)
- locked java.io.InputStreamReader@5c7efb52
at java.io.InputStreamReader.read(InputStreamReader.java:184)
at java.io.BufferedReader.fill(BufferedReader.java:161)
at java.io.BufferedReader.readLine(BufferedReader.java:324)
- locked java.io.InputStreamReader@5c7efb52
at java.io.BufferedReader.readLine(BufferedReader.java:389)
at com.intellij.rt.execution.application.AppMainV2$1.run(AppMainV2.java:64)
"Signal Dispatcher" Id=4 RUNNABLE
"Finalizer" Id=3 WAITING on java.lang.ref.ReferenceQueue$Lock@197c6eb9
at java.lang.Object.wait(Native Method)
- waiting on java.lang.ref.ReferenceQueue$Lock@197c6eb9
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)
at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)
at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)
"Reference Handler" Id=2 WAITING on java.lang.ref.Reference$Lock@7b19fa34
at java.lang.Object.wait(Native Method)
- waiting on java.lang.ref.Reference$Lock@7b19fa34
at java.lang.Object.wait(Object.java:502)
at java.lang.ref.Reference.tryHandlePending(Reference.java:191)
at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)
"main" Id=1 TIMED_WAITING
at java.lang.Thread.sleep(Native Method)
at com.alibaba.dubbo.common.threadpool.AbortPolicyWithReportTest.jStackDumpTest(AbortPolicyWithReportTest.java:44)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:498)
at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
```

å¦å¤–ï¼Œèƒ–å‹å¯ä»¥çœ‹çœ‹ [ã€Šå¦‚ä½•ä½¿ç”¨ jstack åˆ†æçº¿ç¨‹çŠ¶æ€ã€‹](https://www.jianshu.com/p/6690f7e92f27) æ–‡ç« ã€‚
