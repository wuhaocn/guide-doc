## 选举算法源码中的总思路

Zookeeper 的 Leader 选举类是 FastLeaderElection，
该类是 ZAB 协议在 Leader 选举中的工 程应用，所以直接找到该类对其进行分析。
该类中的最为重要的方法为 lookForLeader()，是选举 Leader 的核心方法。该方法大体思路可以划分为以下几块：

### 选举前的准备工作

选举前需要做一些准备工作，例如，创建选举对象、创建选举过程中需要用到的集合、 初始化选举时限等。

## 将自己作为初始化 Leader 投出去

在当前 Server 第一次投票时会先将自己作为 Leader，然后将自己的选票广播给其它所 有 Server。

## 验证自己的投票与大家的投票谁更适合做 Leader

在“我选我”后，当前 Server 同样会接收到其它 Server 发送来的选票通知(Notification)。 通过 while 循环，遍历所有接收到的选票通知，比较谁更适合做 Leader。若找到一个比自己 更适合的 Leader，则修改自己选票，重新将新的选票广播出去。当然，每验证一个选票，则会将其记录到一个集合中，将来用于进行票数统计。

## 判断本轮选举是否应结束

其实在每次验证过谁更适合做 Leader 后，就会马上判断当前的选举是否可以结束了， 即当前主机所推荐的这个选票是否过半了。若过半了，则直接完成后续的一些收尾工作，例 如清空选举过程中所使用的集合，以备下次使用；再例如，生成最终的选票，以备其它 Server 来同步数据。若没有过半，则继续从队列中读取出下一个来自于其它主机的选票，然后进行验证。

源码解读

需要注意，对源码的阅读主要包含两方面。一个是对重要类、重要成员变量、重要方法 的注释的阅读；一个是对重要方法的业务逻辑的分析。
