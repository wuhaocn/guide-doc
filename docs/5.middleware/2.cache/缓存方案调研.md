# 缓存(数据)方案简介

## 1.业务层

- 需求
  针对业务完成缓存逻辑相关代码与业务逻辑解耦，降低业务缓存改造风险程度，
- 主要任务
  提取抽象接口，业务通过缓存接口进行使用，减少直接使用 redis 组件
  接口实现部分可通过 spi 扩展扩展存储接口
  对业务影响较小可以优先启动实施

## 2.组件层

- 升级为 redis 官方组件
  除去内部 redis 使用
- 添加缓存中间层
  支持多种存储介质
  支持 set 范围查询

| 组件层       | redis 原生 | 缓存中间层 |
| ------------ | ---------- | ---------- |
| 可控性       | 低         | 高(+1)     |
| 改造工作量   | 低 (+1)    | 高         |
| 代码复杂度   | 低 (+1)    | 高         |
| 升级难度     | 高         | 低(+1)     |
| 中间替代变动 | 高         | 低(+1)     |
| 使用规范性   | 低         | 高(+1)     |
| 业务出错概率 | 高         | 低（+1）   |

### 2.1 缓存组件支持功能

- 需求
  缓存组件为业务服务与缓存中间件中间层，增加本地内存缓存，redis 缓存层，数据库存储层封装
- 功能
  存储介质：支持三级缓存：内存，外置缓存(redis)， 数据库(Mysql)
  缓存功能：键值对访问，范围扫描

### 2.2 业务变更影响

- 业务服务
  业务服务使用 redis 组件需全量替换
- 组件层替换
  data 组件访问 redis 作为参数传递需要处理

## 3.缓存(数据)中间件

- 缓存数据库调研

| 中间件     | redis   | tendis  | influxdb | tikv    | opentsdb | ssdb    |
| ---------- | ------- | ------- | -------- | ------- | -------- | ------- |
| 开发语言   | C       | C       | GO       | GO      | JAVA     | C       |
| 性能(单机) | 10W(+-) | 5w(+-)  | -        | -       | -        | 5w(+-)  |
| 集群       | 完善    | 完善    | 无       | -       | -        | 主从    |
| 成熟度     | 高      | 中/低   | -        | 高      | -        | 高      |
| 维护成本   | 低      | 高      | -        | -       | -        | -       |
| 活跃度     | 高      | 高      | 高       | 高      | 高       | 高      |
| 存储模型   | 内存    | rocksdb | -        | rocksdb | -        | LevelDB |

- 可选用基本分为两大类
  - 一类是基于内存的 redis
  - 一类是基于硬盘的 rocksdb(或者 leveldb)

##
