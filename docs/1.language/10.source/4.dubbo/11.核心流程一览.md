# æ ¸å¿ƒæµç¨‹ä¸€è§ˆ

æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚

# 1. æ¦‚è¿°

æœ¬æ–‡ä¸»è¦åˆ†äº« **Dubbo çš„æ ¸å¿ƒæµç¨‹**ã€‚
å¸Œæœ›é€šè¿‡æœ¬æ–‡èƒ½è®©èƒ–å‹å¯¹ Dubbo çš„æ ¸å¿ƒæµç¨‹æœ‰ä¸ªç®€å•çš„äº†è§£ã€‚

å¦å¤–ï¼Œç¬”è€…ä¼šç›¸å¯¹**å¤§é‡**å¼•ç”¨ [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ¡†æ¶è®¾è®¡ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/design.html) å’Œ [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” å®ç°ç»†èŠ‚ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/implementation.html) ï¼Œå†™çš„çœŸçš„æŒºå¥½çš„ã€‚ğŸ™‚ æˆ–è€…è¯´ï¼Œæœ¬æ–‡æ˜¯è¯¥æ–‡ç« çš„**ç»†åŒ–**å’Œ**è§£è¯´**ã€‚
psï¼šé™äºæ’ç‰ˆï¼Œéƒ¨åˆ†åœ°æ–¹å¼•ç”¨ä¼šå­˜åœ¨æœªæ ‡æ˜çš„æƒ…å†µã€‚

# 2. æ•´ä½“è®¾è®¡

ğŸ˜ˆ æœ¬å°èŠ‚ï¼ŒåŸºæœ¬ä¸ºå¼•ç”¨ + é‡æ–°æ’ç‰ˆã€‚

ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ•´ä½“è®¾è®¡å›¾ï¼Œç›¸å¯¹æ¯”è¾ƒ**å¤æ‚**ï¼š

FROM [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ¡†æ¶è®¾è®¡ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/)
![æ•´ä½“è®¾è®¡](http://static2.iocoder.cn/images/Dubbo/2018_03_01/01.png)

## 2.1 å›¾ä¾‹è¯´æ˜

- æœ€é¡¶ä¸Šä¹ä¸ª**å›¾æ ‡**ï¼Œä»£è¡¨æœ¬å›¾ä¸­çš„å¯¹è±¡ä¸æµç¨‹ã€‚
- å›¾ä¸­å·¦è¾¹ **æ·¡è“èƒŒæ™¯**( Consumer ) çš„ä¸ºæœåŠ¡æ¶ˆè´¹æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œå³è¾¹ **æ·¡ç»¿è‰²èƒŒæ™¯**( Provider ) çš„ä¸ºæœåŠ¡æä¾›æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œä½äºä¸­è½´çº¿ä¸Šçš„ä¸ºåŒæ–¹éƒ½ç”¨åˆ°çš„æ¥å£ã€‚
- å›¾ä¸­ä»ä¸‹è‡³ä¸Šåˆ†ä¸ºåå±‚ï¼Œå„å±‚å‡ä¸º**å•å‘**ä¾èµ–ï¼Œå³è¾¹çš„ **é»‘è‰²ç®­å¤´**( Depend ) ä»£è¡¨å±‚ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥å‰¥ç¦»ä¸Šå±‚è¢«å¤ç”¨ã€‚å…¶ä¸­ï¼ŒService å’Œ Config å±‚ä¸º APIï¼Œå…¶å®ƒå„å±‚å‡ä¸º [SPI](http://blog.csdn.net/top_code/article/details/51934459) ã€‚
- å›¾ä¸­ **ç»¿è‰²å°å—**( Interface ) çš„ä¸ºæ‰©å±•æ¥å£ï¼Œ**è“è‰²å°å—**( Class ) ä¸ºå®ç°ç±»ï¼Œå›¾ä¸­åªæ˜¾ç¤ºç”¨äºå…³è”å„å±‚çš„å®ç°ç±»ã€‚
- å›¾ä¸­ **è“è‰²è™šçº¿**( Init ) ä¸ºåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå³å¯åŠ¨æ—¶ç»„è£…é“¾ã€‚**çº¢è‰²å®çº¿**( Call )ä¸ºæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ï¼Œå³è¿è¡Œæ—¶è°ƒæ—¶é“¾ã€‚**ç´«è‰²ä¸‰è§’ç®­å¤´**( Inherit )ä¸ºç»§æ‰¿ï¼Œå¯ä»¥æŠŠå­ç±»çœ‹ä½œçˆ¶ç±»çš„åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œçº¿ä¸Šçš„æ–‡å­—ä¸ºè°ƒç”¨çš„æ–¹æ³•ã€‚

## 2.2 å„å±‚è¯´æ˜

å‹æƒ…æç¤ºï¼šå»ºè®®å¯ä»¥å…ˆé˜…è¯» [ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆã€‹](http://svip.iocoder.cn/Dubbo/intro/?self) æ–‡ç« ã€‚

- ==================== Business ====================
- **Service ä¸šåŠ¡å±‚**ï¼šä¸šåŠ¡ä»£ç çš„æ¥å£ä¸å®ç°ã€‚æˆ‘ä»¬å®é™…ä½¿ç”¨ Dubbo
- ==================== RPC ====================
- **config é…ç½®å±‚**ï¼šå¯¹å¤–é…ç½®æ¥å£ï¼Œä»¥ ServiceConfig, ReferenceConfig ä¸ºä¸­å¿ƒï¼Œå¯ä»¥ç›´æ¥åˆå§‹åŒ–é…ç½®ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ Spring è§£æé…ç½®ç”Ÿæˆé…ç½®ç±»ã€‚

- [
  dubbo-config
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-config) æ¨¡å—å®ç°ã€‚
- è¿™å±‚çš„ä»£ç ï¼Œåœ¨ [ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” API é…ç½®ã€‹](http://svip.iocoder.cn/Dubbo/implementation-intro/) ã€[ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” XML é…ç½®ã€‹](http://svip.iocoder.cn/Dubbo/configuration-xml/?self) ç­‰ç­‰æ–‡ç« ï¼Œå·²ç»è¯¦ç»†è§£æã€‚
- **proxy æœåŠ¡ä»£ç†å±‚**ï¼šæœåŠ¡æ¥å£é€æ˜ä»£ç†ï¼Œç”ŸæˆæœåŠ¡çš„å®¢æˆ·ç«¯ Stub å’ŒæœåŠ¡å™¨ç«¯ Skeleton, ä»¥ ServiceProxy ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º ProxyFactory ã€‚

- [
  dubbo-rpc-rpc
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc) æ¨¡å—å®ç°ã€‚
- [
  com.alibaba.dubbo.rpc.proxy
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/proxy)åŒ… + [
  com.alibaba.dubbo.rpc.ProxyFactory
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ProxyFactory.java)æ¥å£ ã€‚
- åœ¨ [ã€Œ4.5 ProxyFactoryã€](http://svip.iocoder.cn/Dubbo/implementation-intro/) è¯¦ç»†è§£æã€‚
- **registry** æ³¨å†Œä¸­å¿ƒå±‚ï¼šå°è£…æœåŠ¡åœ°å€çš„æ³¨å†Œä¸å‘ç°ï¼Œä»¥æœåŠ¡ URL ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º RegistryFactory, Registry, RegistryService ã€‚

- [
  dubbo-registry
  ](https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-registry) æ¨¡å—å®ç°ã€‚
- **cluster è·¯ç”±å±‚**ï¼šå°è£…å¤šä¸ªæä¾›è€…çš„è·¯ç”±åŠè´Ÿè½½å‡è¡¡ï¼Œå¹¶æ¡¥æ¥æ³¨å†Œä¸­å¿ƒï¼Œä»¥ Invoker ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Cluster, Directory, Router, LoadBalance ã€‚

- [
  dubbo-cluster
  ](https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-cluster) æ¨¡å—å®ç°ã€‚
- è¿™å±‚çš„ä»£ç ï¼Œåœ¨ [ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” é¡¹ç›®ç»“æ„ä¸€è§ˆã€‹ã€Œ3.4 dubbo-clusterã€](http://svip.iocoder.cn/Dubbo/intro/?self) ç« èŠ‚ï¼Œæœ‰ç®€å•ä»‹ç»ã€‚
- **monitor ç›‘æ§å±‚**ï¼šRPC è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç›‘æ§ï¼Œä»¥ Statistics ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º MonitorFactory, Monitor, MonitorService ã€‚

- [
  dubbo-monitor
  ](https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-cluster) æ¨¡å—å®ç°ã€‚
- ==================== Remoting ====================
- **protocol è¿œç¨‹è°ƒç”¨å±‚**ï¼šå°å°† RPC è°ƒç”¨ï¼Œä»¥ Invocation, Result ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Protocol, Invoker, Exporter ã€‚

- [
  dubbo-rpc-rpc
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc) æ¨¡å—å®ç°ã€‚
- [
  com.alibaba.dubbo.rpc.protocol
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/protocol)åŒ… + [
  com.alibaba.dubbo.rpc.Protocol
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ProxyFactory.java)æ¥å£ ã€‚
- åœ¨ [ã€Œ4.6 Protocolã€](http://svip.iocoder.cn/Dubbo/implementation-intro/) è¯¦ç»†è§£æã€‚
- **exchange ä¿¡æ¯äº¤æ¢å±‚**ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ Request, Response ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Exchanger, ExchangeChannel, ExchangeClient, ExchangeServer ã€‚

- [
  dubbo-remoting-api
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api) æ¨¡å—å®šä¹‰æ¥å£ã€‚
- [
  com.alibaba.dubbo.remoting.exchange
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/exchange/)åŒ…ã€‚
- **transport ç½‘ç»œä¼ è¾“å±‚**ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Channel, Transporter, Client, Server, Codec ã€‚

- [
  dubbo-remoting-api
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api) æ¨¡å—å®šä¹‰æ¥å£ã€‚
- [
  com.alibaba.dubbo.remoting.transport
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/transport/)åŒ…ã€‚
- **serialize æ•°æ®åºåˆ—åŒ–å±‚**ï¼šå¯å¤ç”¨çš„ä¸€äº›å·¥å…·ï¼Œæ‰©å±•æ¥å£ä¸º Serialization, ObjectInput, ObjectOutput, ThreadPool ã€‚

- [
  dubbo-common
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-common) æ¨¡å—å®ç°ã€‚
- [
  com.alibaba.dubbo.common.serialize
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize)åŒ…ã€‚

## 2.3 å…³ç³»è¯´æ˜

åœ¨ RPC ä¸­ï¼ŒProtocol æ˜¯æ ¸å¿ƒå±‚ï¼Œä¹Ÿå°±æ˜¯åªè¦æœ‰ Protocol + Invoker + Exporter å°±å¯ä»¥å®Œæˆéé€æ˜çš„ RPC è°ƒç”¨ï¼Œç„¶ååœ¨ Invoker çš„ä¸»è¿‡ç¨‹ä¸Š Filter æ‹¦æˆªç‚¹ã€‚

- è§£è¯´ï¼š[
  dubbo-rpc-rpc
  ](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc) æ¨¡å—å³å¯**ç‹¬ç«‹**å®Œæˆè¯¥åŠŸèƒ½ã€‚
  **å›¾ä¸­çš„ Consumer å’Œ Provider æ˜¯æŠ½è±¡æ¦‚å¿µ**ï¼Œåªæ˜¯æƒ³è®©çœ‹å›¾è€…æ›´ç›´è§‚çš„äº†è§£å“ªäº›ç±»åˆ†å±äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯ï¼Œä¸ç”¨ Client å’Œ Server çš„åŸå› æ˜¯ Dubbo åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½ä½¿ç”¨ Provider, Consumer, Registry, Monitor åˆ’åˆ†é€»è¾‘æ‹“æ™®èŠ‚ç‚¹ï¼Œä¿æŒç»Ÿä¸€æ¦‚å¿µã€‚

- x
  è€Œ Cluster æ˜¯å¤–å›´æ¦‚å¿µï¼Œæ‰€ä»¥ Cluster çš„ç›®çš„æ˜¯å°†å¤šä¸ª Invoker ä¼ªè£…æˆä¸€ä¸ª Invokerï¼Œè¿™æ ·å…¶å®ƒäººåªè¦å…³æ³¨ Protocol å±‚ Invoker å³å¯ï¼ŒåŠ ä¸Š Cluster æˆ–è€…å»æ‰ Cluster å¯¹å…¶å®ƒå±‚éƒ½ä¸ä¼šé€ æˆå½±å“ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæä¾›è€…æ—¶ï¼Œæ˜¯ä¸éœ€è¦ Cluster çš„ã€‚

- è§£è¯´ï¼š[
  dubbo-cluster
  ](https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/dubbo-cluster) æ¨¡å—æä¾›çš„æ˜¯**éå¿…é¡»**çš„åŠŸèƒ½ã€‚ç§»é™¤è¯¥æ¨¡å—ï¼ŒRPC äº¦å¯æ­£å¸¸è¿è¡Œã€‚
  **Proxy å±‚**å°è£…äº†æ‰€æœ‰æ¥å£çš„é€æ˜åŒ–ä»£ç†ï¼Œè€Œåœ¨å…¶å®ƒå±‚éƒ½ä»¥ Invoker ä¸ºä¸­å¿ƒï¼Œåªæœ‰åˆ°äº†æš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨æ—¶ï¼Œæ‰ç”¨ Proxy å°† Invoker è½¬æˆæ¥å£ï¼Œæˆ–å°†æ¥å£å®ç°è½¬æˆ Invokerï¼Œä¹Ÿå°±æ˜¯å»æ‰ Proxy å±‚ RPC æ˜¯å¯ä»¥ Run çš„ï¼Œåªæ˜¯ä¸é‚£ä¹ˆé€æ˜ï¼Œä¸é‚£ä¹ˆçœ‹èµ·æ¥åƒè°ƒæœ¬åœ°æœåŠ¡ä¸€æ ·è°ƒè¿œç¨‹æœåŠ¡ã€‚

- è§£è¯´ï¼šç®€å•ç²—æš´çš„è¯´ï¼ŒProxy ä¼š**æ‹¦æˆª**

service.doSomething(args)
çš„è°ƒç”¨ï¼Œâ€œè½¬å‘â€ç»™è¯¥ Service å¯¹åº”çš„ Invoker ï¼Œä»è€Œå®ç°**é€æ˜åŒ–**çš„ä»£ç†ã€‚
è€Œ **Remoting** å®ç°æ˜¯ Dubbo åè®®çš„å®ç°ï¼Œå¦‚æœä½ é€‰æ‹© RMI åè®®ï¼Œæ•´ä¸ª Remoting éƒ½ä¸ä¼šç”¨ä¸Šã€‚Remoting å†…éƒ¨å†åˆ’ä¸º Transport ä¼ è¾“å±‚å’Œ Exchange ä¿¡æ¯äº¤æ¢å±‚ï¼Œ**Transport å±‚**åªè´Ÿè´£å•å‘æ¶ˆæ¯ä¼ è¾“ï¼Œæ˜¯å¯¹ Mina, Netty, Grizzly çš„æŠ½è±¡ï¼Œå®ƒä¹Ÿå¯ä»¥æ‰©å±• UDP ä¼ è¾“ï¼›è€Œ **Exchange å±‚**æ˜¯åœ¨ä¼ è¾“å±‚ä¹‹ä¸Šå°è£…äº† Request-Response è¯­ä¹‰ã€‚

- x
  **Registry å’Œ Monitor** å®é™…ä¸Šä¸ç®—ä¸€å±‚ï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ï¼Œåªæ˜¯ä¸ºäº†å…¨å±€æ¦‚è§ˆï¼Œç”¨å±‚çš„æ–¹å¼ç”»åœ¨ä¸€èµ·ã€‚

- x

# 3. æ ¸å¿ƒæµç¨‹

## 3.1 è°ƒç”¨é“¾

å±•å¼€æ€»è®¾è®¡å›¾çš„**çº¢è‰²è°ƒç”¨é“¾**( Call )ï¼Œå¦‚ä¸‹ï¼š
FROM [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ¡†æ¶è®¾è®¡ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/)
![è°ƒç”¨é“¾](http://static2.iocoder.cn/images/Dubbo/2018_03_01/02.png)

- å‚ç›´åˆ†å±‚å¦‚ä¸‹ï¼š

- ä¸‹æ–¹ **æ·¡è“èƒŒæ™¯**( Consumer )ï¼šæœåŠ¡æ¶ˆè´¹æ–¹ä½¿ç”¨çš„æ¥å£
- ä¸Šæ–¹ **æ·¡ç»¿è‰²èƒŒæ™¯**( Provider )ï¼šæœåŠ¡æä¾›æ–¹ä½¿ç”¨çš„æ¥å£
- ä¸­é—´ **ç²‰è‰²èƒŒæ™¯**( Remoting )ï¼šé€šä¿¡éƒ¨åˆ†çš„æ¥å£
- è‡ª LoadBalance å‘ä¸Šï¼Œæ¯ä¸€è¡Œåˆ†æˆäº†**å¤šä¸ª**ç›¸åŒçš„ Interface ï¼ŒæŒ‡çš„æ˜¯**è´Ÿè½½å‡è¡¡**åï¼Œå‘ Provider å‘èµ·è°ƒç”¨ã€‚
- å·¦è¾¹ **æ‹¬å·** éƒ¨åˆ†ï¼Œä»£è¡¨äº†å‚ç›´éƒ¨åˆ†æ›´**ç»†åŒ–**çš„åˆ†å±‚ï¼Œä¾æ¬¡æ˜¯ï¼šCommonã€Remotingã€RPCã€Interface ã€‚
- å³è¾¹ **è“è‰²è™šçº¿**( Init ) ä¸ºåˆå§‹åŒ–è¿‡ç¨‹ï¼Œé€šè¿‡å¯¹åº”çš„ç»„ä»¶è¿›è¡Œåˆå§‹åŒ–ã€‚ä¾‹å¦‚ï¼ŒProxyFactory åˆå§‹åŒ–å‡º Proxy ã€‚

## 3.2 æš´éœ²æœåŠ¡

å±•å¼€æ€»è®¾è®¡å›¾**å·¦è¾¹**æœåŠ¡æä¾›æ–¹æš´éœ²æœåŠ¡çš„**è“è‰²åˆå§‹åŒ–é“¾**( Init )ï¼Œæ—¶åºå›¾å¦‚ä¸‹ï¼š
FROM [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ¡†æ¶è®¾è®¡ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/)
![æš´éœ²æœåŠ¡æ—¶åº](http://static2.iocoder.cn/images/Dubbo/2018_03_01/09.jpeg)

## 3.3 å¼•ç”¨æœåŠ¡

å±•å¼€æ€»è®¾è®¡å›¾**å³è¾¹**æœåŠ¡æ¶ˆè´¹æ–¹å¼•ç”¨æœåŠ¡çš„**è“è‰²åˆå§‹åŒ–é“¾**( Init )ï¼Œæ—¶åºå›¾å¦‚ä¸‹ï¼š
FROM [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” æ¡†æ¶è®¾è®¡ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/)
![å¼•ç”¨æœåŠ¡æ—¶åº](http://static2.iocoder.cn/images/Dubbo/2018_03_01/10.jpeg)

# 4. é¢†åŸŸæ¨¡å‹

æœ¬å°èŠ‚åˆ†äº«çš„ï¼Œåœ¨ [
dubbo-rpc-api
](https://github.com/YunaiV/dubbo/tree/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api) ç›®å½•ä¸­ï¼Œå¦‚ä¸‹å›¾çº¢æ¡†éƒ¨åˆ†ï¼š

![é¢†åŸŸæ¨¡å‹](http://static2.iocoder.cn/images/Dubbo/2018_03_01/03.png)

## 4.1 Invoker

[
com.alibaba.dubbo.rpc.Invoker
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Invoker.java) ã€‚
Invoker æ˜¯å®ä½“åŸŸï¼Œå®ƒæ˜¯ Dubbo çš„æ ¸å¿ƒæ¨¡å‹ï¼Œå…¶å®ƒæ¨¡å‹éƒ½å‘å®ƒé æ‰°ï¼Œæˆ–è½¬æ¢æˆå®ƒã€‚
å®ƒä»£è¡¨ä¸€ä¸ªå¯æ‰§è¡Œä½“ï¼Œå¯å‘å®ƒå‘èµ· invoke è°ƒç”¨ã€‚
å®ƒæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæœ¬åœ°çš„å®ç°ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªè¿œç¨‹çš„å®ç°ï¼Œä¹Ÿå¯èƒ½ä¸€ä¸ªé›†ç¾¤å®ç°ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
public interface Invoker<T> extends Node{
//*/*
/* get service interface.
/*
/* @return service interface.
/*/
Class<T> getInterface();
//*/*
/* invoke.
/*
/* @param invocation
/* @return result
/* @throws RpcException
/*/
Result invoke(Invocation invocation) throws RpcException;
}
```

- /#getInterface()
  æ–¹æ³•ï¼Œè·å¾— Service æ¥å£ã€‚
- /#invoke(Invocation)
  æ–¹æ³•ï¼Œè°ƒç”¨æ–¹æ³•ã€‚

### 4.1.1 æ»¡çœ¼éƒ½æ˜¯ Invoker

ä¸‹é¢ï¼Œæˆ‘ä»¬è¦å¼•ç”¨ [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” å®ç°ç»†èŠ‚ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/implementation.html#fn_5) çš„ [**æ»¡çœ¼éƒ½æ˜¯ Invoker**](http://svip.iocoder.cn/Dubbo/implementation-intro/) å°èŠ‚çš„å†…å®¹ï¼Œæ¥è¿›ä¸€æ­¥ç†è§£ Invoker ï¼š

ç”±äº Invoker æ˜¯ Dubbo é¢†åŸŸæ¨¡å‹ä¸­éå¸¸é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå¾ˆå¤šè®¾è®¡æ€è·¯éƒ½æ˜¯å‘å®ƒé æ‹¢ã€‚
è¿™å°±ä½¿å¾— Invoker æ¸—é€åœ¨æ•´ä¸ªå®ç°ä»£ç é‡Œï¼Œå¯¹äºåˆšå¼€å§‹æ¥è§¦ Dubbo çš„äººï¼Œç¡®å®å®¹æ˜“ç»™ææ··äº†ã€‚

ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªç²¾ç®€çš„å›¾æ¥è¯´æ˜æœ€é‡è¦çš„ä¸¤ç§ Invokerï¼šæœåŠ¡æä¾› Invoker å’ŒæœåŠ¡æ¶ˆè´¹ Invokerï¼š

![æ»¡çœ¼éƒ½æ˜¯ Invoker](http://static2.iocoder.cn/images/Dubbo/2018_03_01/04.png)

ä¸ºäº†æ›´å¥½çš„è§£é‡Šä¸Šé¢è¿™å¼ å›¾ï¼Œæˆ‘ä»¬**ç»“åˆæœåŠ¡æ¶ˆè´¹å’Œæä¾›è€…çš„ä»£ç ç¤ºä¾‹**æ¥è¿›è¡Œè¯´æ˜ï¼š

- æœåŠ¡æ¶ˆè´¹è€…ä»£ç ï¼š

```
public class DemoClientAction{
private DemoService demoService;
public void setDemoService(DemoService demoService){
this.demoService = demoService;
}
public void start(){
String hello = demoService.sayHello("world" + i);
}
}
```

- ä¸Šé¢ä»£ç ä¸­çš„ DemoService å°±æ˜¯ä¸Šå›¾ä¸­æœåŠ¡æ¶ˆè´¹ç«¯çš„ Proxyï¼Œç”¨æˆ·ä»£ç é€šè¿‡è¿™ä¸ª Proxy è°ƒç”¨å…¶å¯¹åº”çš„ Invokerï¼Œè€Œè¯¥ Invoker å®ç°äº†çœŸæ­£çš„è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚
- æœåŠ¡æä¾›è€…ä»£ç ï¼š

```
public class DemoServiceImpl implements DemoService{
public String sayHello(String name) throws RemoteException{
return "Hello " + name;
}
}
```

- ä¸Šé¢è¿™ä¸ªç±»ä¼šè¢«å°è£…æˆä¸ºä¸€ä¸ª AbstractProxyInvoker å®ä¾‹ï¼Œå¹¶æ–°ç”Ÿæˆä¸€ä¸ª Exporter å®ä¾‹ã€‚è¿™æ ·å½“ç½‘ç»œé€šè®¯å±‚æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚åï¼Œä¼šæ‰¾åˆ°å¯¹åº”çš„ Exporter å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®ƒæ‰€å¯¹åº”çš„ AbstractProxyInvoker å®ä¾‹ï¼Œä»è€ŒçœŸæ­£è°ƒç”¨äº†æœåŠ¡æä¾›è€…çš„ä»£ç ã€‚

_Dubbo é‡Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„ Invoker ç±»ï¼Œä½†ä¸Šé¢ä¸¤ç§æ˜¯æœ€é‡è¦çš„_ã€‚

### 4.1.2 ç±»å›¾

æ­£å¦‚ä¸Šæ–‡æ‰€è¯´ï¼ŒInvoker æ¸—é€åœ¨ Dubbo çš„ä»£ç ä¸­ï¼ŒInvoker çš„å®ç°ç±»ä¹Ÿéå¸¸éå¸¸éå¸¸å¤šï¼Œå¦‚ä¸‹å›¾ï¼š

![Invoker å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/05.png)

åç»­æˆ‘ä»¬ä¼šè¯¦ç»†åˆ†æã€‚

## 4.2 Invocation

[
com.alibaba.dubbo.rpc.Invocation
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Invocation.java) ã€‚
Invocation æ˜¯ä¼šè¯åŸŸï¼Œå®ƒæŒæœ‰è°ƒç”¨è¿‡ç¨‹ä¸­çš„å˜é‡ï¼Œæ¯”å¦‚æ–¹æ³•åï¼Œå‚æ•°ç­‰ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
public interface Invocation{
//*/*
/* get method name.
/*
/* @return method name.
/* @serial
/*/
String getMethodName();
//*/*
/* get parameter types.
/*
/* @return parameter types.
/* @serial
/*/
Class<?>[] getParameterTypes();
//*/*
/* get arguments.
/*
/* @return arguments.
/* @serial
/*/
Object[] getArguments();
//*/*
/* get attachments.
/*
/* @return attachments.
/* @serial
/*/
Map<String, String> getAttachments();
//*/*
/* get attachment by key.
/*
/* @return attachment value.
/* @serial
/*/
String getAttachment(String key);
//*/*
/* get attachment by key with default value.
/*
/* @return attachment value.
/* @serial
/*/
String getAttachment(String key, String defaultValue);
//*/*
/* get the invoker in current context.
/*
/* @return invoker.
/* @transient
/*/
Invoker<?> getInvoker();
}
```

- /#getMethodName()
  æ–¹æ³•ï¼Œè·å¾—æ–¹æ³•åã€‚
- /#getParameterTypes()
  æ–¹æ³•ï¼Œè·å¾—æ–¹æ³•å‚æ•°**ç±»å‹**æ•°ç»„ã€‚
- /#getArguments()
  æ–¹æ³•ï¼Œè·å¾—æ–¹æ³•å‚æ•°æ•°ç»„ã€‚
- /#getAttachments()
  ç­‰æ–¹æ³•ï¼Œè·å¾—éšå¼å‚æ•°ç›¸å…³ã€‚

- ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” éšå¼å‚æ•°ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/attachment.html) æ–‡æ¡£ã€‚
- å’Œ HTTP Request **Header** æœ‰äº›ç›¸ä¼¼ã€‚
- /#getInvoker()
  æ–¹æ³•ï¼Œè·å¾—å¯¹åº”çš„ Invoker å¯¹è±¡ã€‚

### 4.2.1 ç±»å›¾

![Invocation å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/06.png)

- [
  com.alibaba.dubbo.rpc.RpcInvocation
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/RpcInvocation.java)

- ç‚¹å‡»æŸ¥çœ‹ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚
- [
  com.alibaba.dubbo.rpc.protocol.dubbo.DecodeableRpcInvocation
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-default/src/main/java/com/alibaba/dubbo/rpc/protocol/dubbo/DecodeableRpcInvocation.java)

- Dubbo åè®®**ç‹¬æœ‰**ï¼Œåç»­æ–‡ç« åˆ†äº«ã€‚

## 4.3 Result

[
com.alibaba.dubbo.rpc.Result
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Result.java) ã€‚

Result æ˜¯ä¼šè¯åŸŸï¼Œå®ƒæŒæœ‰è°ƒç”¨è¿‡ç¨‹ä¸­è¿”å›å€¼ï¼Œå¼‚å¸¸ç­‰ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
public interface Result{
//*/*
/* Get invoke result.
/*
/* @return result. if no result return null.
/*/
Object getValue();
//*/*
/* Get exception.
/*
/* @return exception. if no exception return null.
/*/
Throwable getException();
//*/*
/* Has exception.
/*
/* @return has exception.
/*/
boolean hasException();
//*/*
/* Recreate.
/* <p>
/* <code>
/* if (hasException()) {
/* throw getException();
/* } else {
/* return getValue();
/* }
/* </code>
/*
/* @return result.
/* @throws if has exception throw it.
/*/
Object recreate() throws Throwable;
//*/*
/* get attachments.
/*
/* @return attachments.
/*/
Map<String, String> getAttachments();
//*/*
/* get attachment by key.
/*
/* @return attachment value.
/*/
String getAttachment(String key);
//*/*
/* get attachment by key with default value.
/*
/* @return attachment value.
/*/
String getAttachment(String key, String defaultValue);
}
```

- /#getValue()
  æ–¹æ³•ï¼Œè·å¾—è¿”å›å€¼ã€‚
- /#getException()
  æ–¹æ³•ï¼Œè·å¾—è¿”å›çš„å¼‚å¸¸ã€‚

- /#hasException()
  æ–¹æ³•ï¼Œæ˜¯å¦æœ‰å¼‚å¸¸ã€‚
- /#recreate()
  æ–¹æ³•ï¼Œå®ç°ä»£ç å¦‚ä¸‹ï¼š

```
// RpcResult.java
private Object result;
private Throwable exception;
public Object recreate() throws Throwable{
if (exception != null) {
throw exception;
}
return result;
}
```

- /#getAttachments()
  ç­‰æ–¹æ³•ï¼Œè·å¾—**è¿”å›**çš„éšå¼å‚æ•°ç›¸å…³ã€‚

- ä¸äº†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” éšå¼å‚æ•°ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/attachment.html) æ–‡æ¡£ã€‚
- å’Œ HTTP Response **Header** æœ‰äº›ç›¸ä¼¼ã€‚

### 4.3.1 ç±»å›¾

![Invocation å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/07.png)

- [
  com.alibaba.dubbo.rpc.RpcResult
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/RpcResult.java)

- ç‚¹å‡»æŸ¥çœ‹ï¼Œæ¯”è¾ƒå®¹æ˜“ç†è§£ã€‚
- [
  com.alibaba.dubbo.rpc.protocol.dubbo.DecodeableRpcResult
  ](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-default/src/main/java/com/alibaba/dubbo/rpc/protocol/dubbo/DecodeableRpcResult.java)

- Dubbo åè®®**ç‹¬æœ‰**ï¼Œåç»­æ–‡ç« åˆ†äº«ã€‚

## 4.4 Filter

[
com.alibaba.dubbo.rpc.Filter
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Filter.java) ã€‚

è¿‡æ»¤å™¨æ¥å£ï¼Œå’Œæˆ‘ä»¬å¹³æ—¶ç†è§£çš„ [
javax.servlet.Filter
](https://docs.oracle.com/javaee/5/api/javax/servlet/Filter.html) åŸºæœ¬ä¸€è‡´ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
public interface Filter{
//*/*
/* do invoke filter.
/* <p>
/* <code>
/* // before filter
/* Result result = invoker.invoke(invocation);
/* // after filter
/* return result;
/* </code>
/*
/* @param invoker service
/* @param invocation invocation.
/* @return invoke result.
/* @throws RpcException
/* @see com.alibaba.dubbo.rpc.Invoker/#invoke(Invocation)
/*/
Result invoke(Invoker<?> invoker, Invocation invocation) throws RpcException;
}
```

- /#invoke(...)
  æ–¹æ³•ï¼Œæ‰§è¡Œ Invoker çš„è¿‡æ»¤é€»è¾‘ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š

```
// ã€è‡ªå·±å®ç°ã€‘before filter
Result result = invoker.invoke(invocation);
// ã€è‡ªå·±å®ç°ã€‘after filter
return result;
```

### 4.4.1 ç±»å›¾

![Filter å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/08.png)

## 4.5 ProxyFactory

[
com.alibaba.dubbo.rpc.ProxyFactory
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ProxyFactory.java) ï¼Œä»£ç†å·¥å‚æ¥å£ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
@SPI("javassist")
public interface ProxyFactory{
//*/*
/* create proxy.
/*
/* åˆ›å»º Proxy ï¼Œåœ¨å¼•ç”¨æœåŠ¡è°ƒç”¨ã€‚
/*
/* @param invoker
/* @return proxy
/*/
@Adaptive({Constants.PROXY_KEY})
<T> T getProxy(Invoker<T> invoker) throws RpcException;
//*/*
/* create invoker.
/*
/* åˆ›å»º Invoker ï¼Œåœ¨æš´éœ²æœåŠ¡æ—¶è°ƒç”¨ã€‚
/*
/* @param <T>
/* @param proxy
/* @param type
/* @param url
/* @return invoker
/*/
@Adaptive({Constants.PROXY_KEY})
<T> Invoker<T> getInvoker(T proxy, Class<T> type, URL url) throws RpcException;
}
```

- /#getProxy(invoker)
  æ–¹æ³•ï¼Œåˆ›å»º Proxy ï¼Œåœ¨**å¼•ç”¨æœåŠ¡**æ—¶è°ƒç”¨ã€‚

- æ–¹æ³•å‚æ•°å¦‚ä¸‹ï¼š

- invoker
  å‚æ•°ï¼ŒConsumer å¯¹ Provider è°ƒç”¨çš„ Invoker ã€‚
- æœåŠ¡æ¶ˆè´¹ç€å¼•ç”¨æœåŠ¡çš„ **ä¸»è¿‡ç¨‹** å¦‚ä¸‹å›¾ï¼š
  FROM [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” å®ç°ç»†èŠ‚ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/)
  ![æœåŠ¡æ¶ˆè´¹ç€å¼•ç”¨æœåŠ¡çš„ä¸»è¿‡ç¨‹](http://static2.iocoder.cn/images/Dubbo/2018_03_01/12.png)

- ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•çš„

invoker
å‚æ•°ï¼Œé€šè¿‡ Protocol å°† **Service æ¥å£** åˆ›å»ºå‡º Invoker ã€‚

- é€šè¿‡åˆ›å»º Service çš„ Proxy ï¼Œå®ç°æˆ‘ä»¬åœ¨ä¸šåŠ¡ä»£ç†è°ƒç”¨ Service çš„æ–¹æ³•æ—¶ï¼Œ**é€æ˜çš„å†…éƒ¨è½¬æ¢æˆè°ƒç”¨** Invoker çš„

/#invoke(Invocation)
æ–¹æ³•ã€‚ğŸ™‚ å¦‚æœè¿˜æ˜¯æ¯”è¾ƒæ¨¡ç³Šï¼Œæœ¨æœ‰å…³ç³»ï¼Œåé¢ä¼šæœ‰æ–‡ç« ï¼Œä¸“é—¨è¯¦ç»†ä»£ç çš„åˆ†äº«ã€‚

- /#getInvoker(proxy, type, url)
  æ–¹æ³•ï¼Œåˆ›å»º Invoker ï¼Œåœ¨**æš´éœ²æœåŠ¡**æ—¶è°ƒç”¨ã€‚

- æ–¹æ³•å‚æ•°å¦‚ä¸‹ï¼š

- proxy
  å‚æ•°ï¼ŒService å¯¹è±¡ã€‚
- type
  å‚æ•°ï¼ŒService æ¥å£ç±»å‹ã€‚
- url
  å‚æ•°ï¼ŒService å¯¹åº”çš„ Dubbo URL ã€‚
- æœåŠ¡æä¾›è€…æš´éœ²æœåŠ¡çš„ **ä¸»è¿‡ç¨‹** å¦‚ä¸‹å›¾ï¼š
  FROM [ã€ŠDubbo å¼€å‘æŒ‡å— â€”â€” å®ç°ç»†èŠ‚ã€‹](http://dubbo.apache.org/zh-cn/docs/dev/)
  ![æœåŠ¡æä¾›è€…æš´éœ²æœåŠ¡çš„ä¸»è¿‡ç¨‹](http://static2.iocoder.cn/images/Dubbo/2018_03_01/11.png)

- ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œè¯¥æ–¹æ³•åˆ›å»ºçš„ Invoker ï¼Œä¸‹ä¸€æ­¥ä¼šæäº¤ç»™ Protocol ï¼Œä» Invoker è½¬æ¢åˆ° Exporter ã€‚

### 4.5.1 ç±»å›¾

![ProxyFactory å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/13.png)

ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º Dubbo æ”¯æŒ Javassist å’Œ JDK Proxy ä¸¤ç§æ–¹å¼ç”Ÿæˆä»£ç†ã€‚

å…·ä½“å¦‚ä½•å®ç°ï¼Œè¯·çœ‹åé¢çš„æ–‡ç« ã€‚

## 4.6 Protocol

[
com.alibaba.dubbo.rpc.Protocol
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Protocol.java) ã€‚
Protocol æ˜¯æœåŠ¡åŸŸï¼Œå®ƒæ˜¯ Invoker æš´éœ²å’Œå¼•ç”¨çš„ä¸»åŠŸèƒ½å…¥å£ã€‚
å®ƒè´Ÿè´£ Invoker çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
@SPI("dubbo")
public interface Protocol{
//*/*
/* Get default port when user doesn't config the port.
/*
/* @return default port
/*/
int getDefaultPort();
//*/*
/* Export service for remote invocation: <br>
/* 1. Protocol should record request source address after receive a request:
/* RpcContext.getContext().setRemoteAddress();<br>
/* 2. export() must be idempotent, that is, there's no difference between invoking once and invoking twice when
/* export the same URL<br>
/* 3. Invoker instance is passed in by the framework, protocol needs not to care <br>
/*
/* @param <T> Service type
/* @param invoker Service invoker
/* @return exporter reference for exported service, useful for unexport the service later
/* @throws RpcException thrown when error occurs during export the service, for example: port is occupied
/*/
//*/*
/* æš´éœ²è¿œç¨‹æœåŠ¡ï¼š<br>
/* 1. åè®®åœ¨æ¥æ”¶è¯·æ±‚æ—¶ï¼Œåº”è®°å½•è¯·æ±‚æ¥æºæ–¹åœ°å€ä¿¡æ¯ï¼šRpcContext.getContext().setRemoteAddress();<br>
/* 2. export() å¿…é¡»æ˜¯å¹‚ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯æš´éœ²åŒä¸€ä¸ª URL çš„ Invoker ä¸¤æ¬¡ï¼Œå’Œæš´éœ²ä¸€æ¬¡æ²¡æœ‰åŒºåˆ«ã€‚<br>
/* 3. export() ä¼ å…¥çš„ Invoker ç”±æ¡†æ¶å®ç°å¹¶ä¼ å…¥ï¼Œåè®®ä¸éœ€è¦å…³å¿ƒã€‚<br>
/*
/* @param <T> æœåŠ¡çš„ç±»å‹
/* @param invoker æœåŠ¡çš„æ‰§è¡Œä½“
/* @return exporter æš´éœ²æœåŠ¡çš„å¼•ç”¨ï¼Œç”¨äºå–æ¶ˆæš´éœ²
/* @throws RpcException å½“æš´éœ²æœåŠ¡å‡ºé”™æ—¶æŠ›å‡ºï¼Œæ¯”å¦‚ç«¯å£å·²å ç”¨
/*/
@Adaptive
<T> Exporter<T> export(Invoker<T> invoker) throws RpcException;
//*/*
/* Refer a remote service: <br>
/* 1. When user calls `invoke()` method of `Invoker` object which's returned from `refer()` call, the protocol
/* needs to correspondingly execute `invoke()` method of `Invoker` object <br>
/* 2. It's protocol's responsibility to implement `Invoker` which's returned from `refer()`. Generally speaking,
/* protocol sends remote request in the `Invoker` implementation. <br>
/* 3. When there's check=false set in URL, the implementation must not throw exception but try to recover when
/* connection fails.
/*
/* @param <T> Service type
/* @param type Service class
/* @param url URL address for the remote service
/* @return invoker service's local proxy
/* @throws RpcException when there's any error while connecting to the service provider
/*/
//*/*
/* å¼•ç”¨è¿œç¨‹æœåŠ¡ï¼š<br>
/* 1. å½“ç”¨æˆ·è°ƒç”¨ refer() æ‰€è¿”å›çš„ Invoker å¯¹è±¡çš„ invoke() æ–¹æ³•æ—¶ï¼Œåè®®éœ€ç›¸åº”æ‰§è¡ŒåŒ URL è¿œç«¯ export() ä¼ å…¥çš„ Invoker å¯¹è±¡çš„ invoke() æ–¹æ³•ã€‚<br>
/* 2. refer() è¿”å›çš„ Invoker ç”±åè®®å®ç°ï¼Œåè®®é€šå¸¸éœ€è¦åœ¨æ­¤ Invoker ä¸­å‘é€è¿œç¨‹è¯·æ±‚ã€‚<br>
/* 3. å½“ url ä¸­æœ‰è®¾ç½® check=false æ—¶ï¼Œè¿æ¥å¤±è´¥ä¸èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶å†…éƒ¨è‡ªåŠ¨æ¢å¤ã€‚<br>
/*
/* @param <T> æœåŠ¡çš„ç±»å‹
/* @param type æœåŠ¡çš„ç±»å‹
/* @param url è¿œç¨‹æœåŠ¡çš„URLåœ°å€
/* @return invoker æœåŠ¡çš„æœ¬åœ°ä»£ç†
/* @throws RpcException å½“è¿æ¥æœåŠ¡æä¾›æ–¹å¤±è´¥æ—¶æŠ›å‡º
/*/
@Adaptive
<T> Invoker<T> refer(Class<T> type, URL url) throws RpcException;
//*/*
/* Destroy protocol: <br>
/* 1. Cancel all services this protocol exports and refers <br>
/* 2. Release all occupied resources, for example: connection, port, etc. <br>
/* 3. Protocol can continue to export and refer new service even after it's destroyed.
/*/
//*/*
/* é‡Šæ”¾åè®®ï¼š<br>
/* 1. å–æ¶ˆè¯¥åè®®æ‰€æœ‰å·²ç»æš´éœ²å’Œå¼•ç”¨çš„æœåŠ¡ã€‚<br>
/* 2. é‡Šæ”¾åè®®æ‰€å ç”¨çš„æ‰€æœ‰èµ„æºï¼Œæ¯”å¦‚è¿æ¥å’Œç«¯å£ã€‚<br>
/* 3. åè®®åœ¨é‡Šæ”¾åï¼Œä¾ç„¶èƒ½æš´éœ²å’Œå¼•ç”¨æ–°çš„æœåŠ¡ã€‚<br>
/*/
void destroy();
}
```

- æ¯ä¸ªæ–¹æ³•çš„è¯´æ˜ï¼Œè¯·**ç»†çœ‹**æ–¹æ³•çš„æ³¨é‡Šã€‚
  Dubbo å¤„ç†**æœåŠ¡æš´éœ²**çš„å…³é”®å°±åœ¨ Invoker è½¬æ¢åˆ° Exporter çš„è¿‡ç¨‹ã€‚
  ä¸‹é¢æˆ‘ä»¬ä»¥ Dubbo å’Œ RMI è¿™ä¸¤ç§å…¸å‹åè®®çš„å®ç°æ¥è¿›è¡Œè¯´æ˜ï¼š

- **Dubbo çš„å®ç°**
  Dubbo åè®®çš„ Invoker è½¬ä¸º Exporter å‘ç”Ÿåœ¨ DubboProtocol ç±»çš„ export æ–¹æ³•ï¼Œå®ƒä¸»è¦æ˜¯æ‰“å¼€ socket ä¾¦å¬æœåŠ¡ï¼Œå¹¶æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„å„ç§è¯·æ±‚ï¼Œé€šè®¯ç»†èŠ‚ç”± Dubbo è‡ªå·±å®ç°ã€‚
- **RMI çš„å®ç°**
  RMI åè®®çš„ Invoker è½¬ä¸º Exporter å‘ç”Ÿåœ¨ RmiProtocol ç±»çš„ export æ–¹æ³•ï¼Œå®ƒé€šè¿‡ Spring æˆ– Dubbo æˆ– JDK æ¥å®ç° RMI æœåŠ¡ï¼Œé€šè®¯ç»†èŠ‚è¿™ä¸€å—ç”± JDK åº•å±‚æ¥å®ç°ï¼Œè¿™å°±çœäº†ä¸å°‘å·¥ä½œé‡ã€‚

### 4.6.1 ç±»å›¾

![Protocol å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/14.png)

ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡º Dubbo æ”¯æŒå¤šç§åè®®çš„å®ç°ã€‚

å…·ä½“å¦‚ä½•å®ç°ï¼Œè¯·çœ‹åé¢çš„æ–‡ç« ã€‚

## 4.7 Exporter

[
com.alibaba.dubbo.rpc.Exporter
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/Exporter.java) ã€‚

Exporter ï¼ŒInvoker æš´éœ²æœåŠ¡åœ¨ Protocol ä¸Šçš„å¯¹è±¡ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
public interface Exporter<T>{
//*/*
/* get invoker.
/*
/* @return invoker
/*/
Invoker<T> getInvoker();
//*/*
/* unexport.
/* <p>
/* <code>
/* getInvoker().destroy();
/* </code>
/*/
void unexport();
}
```

- /#getInvoker()
  æ–¹æ³•ï¼Œè·å¾—å¯¹åº”çš„ Invoker ã€‚
- /#unexport()
  æ–¹æ³•ï¼Œå–æ¶ˆæš´éœ²ã€‚

- Exporter ç›¸æ¯” Invoker æ¥å£ï¼Œå¤šäº† **è¿™ä¸ªæ–¹æ³•**ã€‚é€šè¿‡å®ç°è¯¥æ–¹æ³•ï¼Œä½¿**ç›¸åŒ**çš„ Invoker åœ¨**ä¸åŒ**çš„ Protocol å®ç°çš„å–æ¶ˆæš´éœ²é€»è¾‘ã€‚

### 4.7.1 ç±»å›¾

![Exporter å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/15.png)

å…·ä½“å¦‚ä½•å®ç°ï¼Œè¯·çœ‹åé¢çš„æ–‡ç« ã€‚

## 4.8 InvokerListener

[
com.alibaba.dubbo.rpc.InvokerListener
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/InvokerListener.java) ï¼ŒInvoker ç›‘å¬å™¨ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
@SPI
public interface InvokerListener{
//*/*
/* The invoker referred
/*
/* å½“æœåŠ¡å¼•ç”¨å®Œæˆ
/*
/* @param invoker
/* @throws RpcException
/* @see com.alibaba.dubbo.rpc.Protocol/#refer(Class, URL)
/*/
void referred(Invoker<?> invoker) throws RpcException;
//*/*
/* The invoker destroyed.
/*
/* å½“æœåŠ¡é”€æ¯å¼•ç”¨å®Œæˆ
/*
/* @param invoker
/* @see com.alibaba.dubbo.rpc.Invoker/#destroy()
/*/
void destroyed(Invoker<?> invoker);
}
```

### 4.8.1 ç±»å›¾

![InvokerListener å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/16.png)

## 4.9 ExporterListener

[
com.alibaba.dubbo.rpc.ExporterListener
](https://github.com/YunaiV/dubbo/blob/6de0a069fcc870894e64ffd54a24e334b19dcb36/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/ExporterListener.java) ï¼ŒExporter ç›‘å¬å™¨ã€‚

ä»£ç å¦‚ä¸‹ï¼š

```
@SPI
public interface ExporterListener{
//*/*
/* The exporter exported.
/*
/* å½“æœåŠ¡æš´éœ²å®Œæˆ
/*
/* @param exporter
/* @throws RpcException
/* @see com.alibaba.dubbo.rpc.Protocol/#export(Invoker)
/*/
void exported(Exporter<?> exporter) throws RpcException;
//*/*
/* The exporter unexported.
/*
/* å½“æœåŠ¡å–æ¶ˆæš´éœ²å®Œæˆ
/*
/* @param exporter
/* @throws RpcException
/* @see com.alibaba.dubbo.rpc.Exporter/#unexport()
/*/
void unexported(Exporter<?> exporter);
}
```

### 4.9.1 ç±»å›¾

![ExporterListener å­ç±»](http://static2.iocoder.cn/images/Dubbo/2018_03_01/17.png)
