#### **题目**：zk 的 session 机制

#### **参考答案**：

zookeeper 会为每个客户端分配一个 session，类似于 web 服务器一样，用来标识客户端的身份。

session 的作用：

- 客户端标识
- 超时检查
- 请求的顺序执行
- 维护临时节点的生命周期
- watcher 通知

session 的状态：

- CONNECTING
- CONNECTED
- RECONNECTING
- RECONNECTED
- CLOSED

session 的属性：

- SessionID：会话 ID，全局唯一
- TimeOut：会话超时时间
- TickTime：下次会话超时时间点
- isClosing：会话是否已经被关闭

sessionID 的构成：

- 高 8 位代表创建 Session 时所在的 zk 节点的 id
- 中间 40 位代表 zk 节点当前角色在创建的时候的时间戳
- 低 16 位是一个计数器，初始值为 0
