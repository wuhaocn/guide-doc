<div id="page-content" class="rich_media_area_primary">

<div class="rich_media_area_primary_inner">





<div id="img-content" class="rich_media_wrp">

<h2 class="rich_media_title" id="activity-name">



九阶段读懂互联网的架构演变
</h2>
<div id="meta_content" class="rich_media_meta_list">

<span class="rich_media_meta rich_media_meta_nickname" id="profileBt">
<a href="javascript:void(0);" id="js_name">
泥瓦匠BYSocket                      </a>
<div id="js_profile_qrcode" class="profile_container" style="display:none;">
<div class="profile_inner">
<strong class="profile_nickname">泥瓦匠BYSocket</strong>
<img class="profile_avatar" id="js_profile_qrcode_img" src="" alt="">

<p class="profile_meta">
<label class="profile_meta_label">微信号</label>
<span class="profile_meta_value">bysocket</span>
</p>

<p class="profile_meta">
<label class="profile_meta_label">功能介绍</label>
<span class="profile_meta_value">坚持分享可落地的技术架构文章…</span>
</p>

</div>
<span class="profile_arrow_wrp" id="js_profile_arrow_wrp">
<i class="profile_arrow arrow_out"></i>
<i class="profile_arrow arrow_in"></i>
</span>
</div>
</span>
<em id="publish_time" class="rich_media_meta rich_media_meta_text">今天</em>
</div>



















<div class="rich_media_content " id="js_content" style="visibility: visible;">






<section data-mpa-template="t" mpa-paragraph-type="ignored" style="white-space: normal;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);" data-mpa-powered-by="yiban.io"><section data-mpa-template="t" mpa-paragraph-type="ignored" style="white-space: normal;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img class="rich_pages __bg_gif " data-ratio="0.15625" data-type="gif" data-w="640" data-src="https://mmbiz.qpic.cn/mmbiz_gif/ibWsDm0VIttia6jXjzK8ibXGeflxNWpk6I4bicLia5kFqFMfrZxyqw8UB2DrqP7BLsTnwiaVQ5ic5U7FcgicBEL88N1skg/640?wx_fmt=gif" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 640px !important; height: auto !important;" _width="640px" src="https://mmbiz.qpic.cn/mmbiz_gif/ibWsDm0VIttia6jXjzK8ibXGeflxNWpk6I4bicLia5kFqFMfrZxyqw8UB2DrqP7BLsTnwiaVQ5ic5U7FcgicBEL88N1skg/640?wx_fmt=gif&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" data-order="0" data-fail="0"></p><p style="max-width: 100%;min-height: 1em;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-size: 12px;letter-spacing: 1px;color: rgb(136, 136, 136);">关注<span style="text-align: center;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(136, 136, 136);">“</span><span style="text-align: center;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 128, 255);"><strong style="color: rgb(255, 104, 39);font-size: 15px;text-align: center;white-space: normal;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);letter-spacing: 0.5px;box-sizing: border-box !important;overflow-wrap: break-word !important;">泥瓦匠</strong></span><span style="text-align: center;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(136, 136, 136);">”，</span></span><span style="font-size: 12px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(136, 136, 136);">回复“</span><span style="font-size: 12px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(0, 128, 255);"><strong style="color: rgb(255, 104, 39);font-size: 15px;text-align: center;white-space: normal;max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);letter-spacing: 0.5px;box-sizing: border-box !important;overflow-wrap: break-word !important;">1024</strong></span><span style="font-size: 12px;letter-spacing: 1px;font-family: mp-quote, -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;color: rgb(136, 136, 136);">”，领取精选技术资料</span></p><hr style="max-width: 100%;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);color: rgb(0, 0, 0);font-size: medium;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;background-color: rgb(255, 255, 255);line-height: 25.6px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;line-height: 25.6px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;"><p style="margin-bottom: 5px;max-width: 100%;min-height: 1em;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;white-space: normal;text-align: left;text-size-adjust: auto;color: rgb(0, 0, 0);font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></p></section></section></section></section></section></section></section><p mpa-paragraph-type="body" style="white-space: normal;letter-spacing: 0.544px;text-align: right;background-color: rgb(255, 255, 255);"><span style="font-size: 10px;color: rgb(136, 136, 136);">来源：小M cnblogs.com/xiaoMzjm/p/5223799.html</span></p><p mpa-paragraph-type="body" style="white-space: normal;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><br></p><section style=""><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">前言</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段一、单机构建网站</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段二、应用服务器与数据库分离</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段三、应用服务器集群</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段四、数据库读写分离化</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段五、用搜索引擎缓解读库的压力</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段六、用缓存缓解读库的压力</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段七、数据库水平拆分与垂直拆分</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段八、应用的拆分</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">阶段九、引入消息中间件</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">十、总结</section></li></ul><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">前言</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><span style="">我们以javaweb为例，来搭建一个简单的电商系统，看看这个系统可以如何一</span><span style="">步步演变。</span><br></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">该系统具备的功能：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">用户模块：用户注册和管理</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">商品模块：商品展示和管理</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">交易模块：创建交易和管理</section></li></ul><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段一、单机构建网站</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">网站的初期，我们经常会在单机上跑我们所有的程序和软件。此时我们使用一个容器，如tomcat、jetty、jboos，然后直接使用JSP/servlet技术，或者使用一些开源的框架如maven+spring+struct+<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247488355&amp;idx=3&amp;sn=6296a7ad0d7916a542b0484c22dcdf24&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">hibernate</a>、maven+spring+springmvc+<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247488132&amp;idx=3&amp;sn=da485b7e53fc1a95acad6baf06892591&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mybatis</a>；最后再选择一个数据库管理系统来存储数据，如<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247488132&amp;idx=3&amp;sn=da485b7e53fc1a95acad6baf06892591&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mysql</a>、sqlserver、oracle，然后通过JDBC进行数据库的连接和操作。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">把以上的所有软件都装载同一台机器上，应用跑起来了，也算是一个小系统了。此时系统结果如下：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="1.2578947368421052" data-type="png" data-w="190" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwW2kECViceCKeWLaXZOPYXkly99jLKTS6aic194QUrp8gJEgvFbna872g/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwW2kECViceCKeWLaXZOPYXkly99jLKTS6aic194QUrp8gJEgvFbna872g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段二、应用服务器与数据库分离</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">随着网站的上线，访问量逐步上升，服务器的负载慢慢提高，在服务器还没有超载的时候，我们应该就要做好准备，提升网站的负载能力。假如我们代码层面已难以优化，在不提高单台机器的性能的情况下，增加机器是一个不错的方式，不仅可以有效地提高系统的负载能力，而且性价比高。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">增加的机器用来做什么呢？此时我们可以把数据库，web服务器拆分开来，这样不仅提高了单台机器的负载能力，也提高了容灾能力。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">应用服务器与数据库分开后的架构如下图所示：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.839041095890411" data-type="png" data-w="292" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwDEkaSEt2QrcibroZicAZq7FIGctt5aXxUNMdZQDxQUMg4SAI8gGaQCYA/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwDEkaSEt2QrcibroZicAZq7FIGctt5aXxUNMdZQDxQUMg4SAI8gGaQCYA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段三、应用服务器集群</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">随着访问量继续增加，单台应用服务器已经无法满足需求了。在假设数据库服务器没有压力的情况下，我们可以把应用服务器从一台变成了两台甚至多台，把用户的请求分散到不同的服务器中，从而提高负载能力。多台应用服务器之间没有直接的交互，他们都是依赖数据库各自对外提供服务。著名的做故障切换的软件有keepalived，keepalived是一个类似于layer3、4、7交换机制的软件，他不是某个具体软件故障切换的专属品，而是可以适用于各种软件的一款产品。keepalived配合上ipvsadm又可以做负载均衡，可谓是神器。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">我们以增加了一台应用服务器为例，增加后的系统结构图如下：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.6470588235294118" data-type="png" data-w="425" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwziaWBSJO93NaMOHjpvGgc7VjpaicOWlN9bVAckWr2wFygI9KBD8p60kw/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwziaWBSJO93NaMOHjpvGgc7VjpaicOWlN9bVAckWr2wFygI9KBD8p60kw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">系统演变到这里，将会出现下面四个问题</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">用户的请求由谁来转发到到具体的应用服务器</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">有什么转发的算法</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">应用服务器如何返回用户的请求</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">用户如果每次访问到的服务器不一样，那么如何维护session的一致性</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">我们来看看解决问题的方案</strong> ：</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">1、第一个问题即是负载均衡的问题，一般有5种解决方案：</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">1、<strong style="line-height: 1.6 !important;">http重定向</strong> 。HTTP重定向就是应用层的请求转发。用户的请求其实已经到了HTTP重定向负载均衡服务器，服务器根据算法要求用户重定向，用户收到重定向请求后，再次请求真正的集群</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：简单。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：性能较差。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">2、<strong style="line-height: 1.6 !important;">DNS域名解析负载均衡</strong> 。DNS域名解析负载均衡就是在用户请求DNS服务器，获取域名对应的IP地址时，DNS服务器直接给出负载均衡后的服务器IP。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：交给DNS，不用我们去维护负载均衡服务器。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：当一个应用服务器挂了，不能及时通知DNS，而且DNS负载均衡的控制权在域名服务商那里，网站无法做更多的改善和更强大的管理。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">3、<strong style="line-height: 1.6 !important;">反向代理服务器</strong> 。在用户的请求到达反向代理服务器时（已经到达网站机房），由反向代理服务器根据算法转发到具体的服务器。常用的apache，nginx都可以充当反向代理服务器。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：部署简单。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：代理服务器可能成为性能的瓶颈，特别是一次上传大文件。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">4、<strong style="line-height: 1.6 !important;">IP层负载均衡</strong> 。在请求到达负载均衡器后，负载均衡器通过修改请求的目的IP地址，从而实现请求的转发，做到负载均衡。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：性能更好。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：负载均衡器的宽带成为瓶颈。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">5、<strong style="line-height: 1.6 !important;">数据链路层负载均衡</strong> 。在请求到达负载均衡器后，负载均衡器通过修改请求的mac地址，从而做到负载均衡，与IP负载均衡不一样的是，当请求访问完服务器之后，直接返回客户。而无需再经过负载均衡器。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">2、第二个问题即是集群调度算法问题，常见的调度算法有10种。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">1、<strong style="line-height: 1.6 !important;">rr 轮询调度算法</strong> 。顾名思义，轮询分发请求。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：实现简单</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：不考虑每台服务器的处理能力</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">2、<strong style="line-height: 1.6 !important;">wrr 加权调度算法</strong> 。我们给每个服务器设置权值weight，负载均衡调度器根据权值调度服务器，服务器被调用的次数跟权值成正比。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：考虑了服务器处理能力的不同</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">3、<strong style="line-height: 1.6 !important;">sh 原地址散列</strong> ：提取用户IP，根据散列函数得出一个key，再根据静态映射表，查处对应的value，即目标服务器IP。过目标机器超负荷，则返回空。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">4、<strong style="line-height: 1.6 !important;">dh 目标地址散列</strong> ：同上，只是现在提取的是目标地址的IP来做哈希。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：以上两种算法的都能实现同一个用户访问同一个服务器。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">5、<strong style="line-height: 1.6 !important;">lc 最少连接</strong> 。优先把请求转发给连接数少的服务器。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：使得集群中各个服务器的负载更加均匀。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">6、<strong style="line-height: 1.6 !important;">wlc 加权最少连接</strong> 。在lc的基础上，为每台服务器加上权值。算法为：（活动连接数*256+非活动连接数）÷权重 ，计算出来的值小的服务器优先被选择。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：可以根据服务器的能力分配请求。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">7、<strong style="line-height: 1.6 !important;">sed 最短期望延迟</strong> 。其实sed跟wlc类似，区别是不考虑非活动连接数。算法为：（活动连接数+1)*256÷权重，同样计算出来的值小的服务器优先被选择。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">8、<strong style="line-height: 1.6 !important;">nq 永不排队</strong> 。改进的sed算法。我们想一下什么情况下才能“永不排队”，那就是服务器的连接数为0的时候，那么假如有服务器连接数为0，均衡器直接把请求转发给它，无需经过sed的计算。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">9、<strong style="line-height: 1.6 !important;">LBLC 基于局部性的最少连接</strong> 。均衡器根据请求的目的IP地址，找出该IP地址最近被使用的服务器，把请求转发之，若该服务器超载，最采用最少连接数算法。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">10、<strong style="line-height: 1.6 !important;">LBLCR 带复制的基于局部性的最少连接</strong> 。均衡器根据请求的目的IP地址，找出该IP地址最近使用的“服务器<strong style="line-height: 1.6 !important;">组</strong> ”，注意，并不是具体某个服务器，然后采用最少连接数从该组中挑出具体的某台服务器出来，把请求转发之。若该服务器超载，那么根据最少连接数算法，在集群的<strong style="line-height: 1.6 !important;">非</strong> 本服务器组的服务器中，找出一台服务器出来，加入本服务器组，然后把请求转发之。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">3、第三个问题是集群模式问题，一般3种解决方案：</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">1、<strong style="line-height: 1.6 !important;">NAT</strong> ：负载均衡器接收用户的请求，转发给具体服务器，服务器处理完请求返回给均衡器，均衡器再重新返回给用户。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">2、<strong style="line-height: 1.6 !important;">DR</strong> ：负载均衡器接收用户的请求，转发给具体服务器，服务器出来玩请求后直接返回给用户。需要系统支持IP Tunneling协议，难以跨平台。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">3、<strong style="line-height: 1.6 !important;">TUN</strong> ：同上，但无需IP Tunneling协议，跨平台性好，大部分系统都可以支持。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">4、第四个问题是session问题，一般有4种解决方案：</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">1、<strong style="line-height: 1.6 !important;">Session Sticky</strong> 。session sticky就是把同一个用户在某一个会话中的请求，都分配到固定的某一台服务器中，这样我们就不需要解决跨服务器的session问题了，常见的算法有ip_hash法，即上面提到的两种散列算法。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：实现简单。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：应用服务器重启则session消失。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">2、<strong style="line-height: 1.6 !important;">Session Replication</strong> 。session replication就是在集群中复制session，使得每个服务器都保存有全部用户的session数据。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：减轻负载均衡服务器的压力，不需要要实现ip_hasp算法来转发请求。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：复制时宽带开销大，访问量大的话session占用内存大且浪费。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">3、<strong style="line-height: 1.6 !important;">Session数据集中存储</strong> ：session数据集中存储就是利用数据库来存储session数据，实现了session和应用服务器的解耦。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：相比session replication的方案，集群间对于宽带和内存的压力减少了很多。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：需要维护存储session的数据库。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">4、<strong style="line-height: 1.6 !important;">Cookie Base</strong> ：cookie base就是把session存在cookie中，有浏览器来告诉应用服务器我的session是什么，同样实现了session和应用服务器的解耦。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">优点：实现简单，基本免维护。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缺点：cookie长度限制，安全性低，宽带消耗。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><br></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">值得一提的是</strong> ：</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">nginx目前支持的负载均衡算法有wrr、sh（支持一致性哈希）、fair（本人觉得可以归结为lc）。但nginx作为均衡器的话，还可以一同作为静态资源服务器。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">keepalived+ipvsadm比较强大，目前支持的算法有：rr、wrr、lc、wlc、lblc、sh、dh</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">keepalived支持集群模式有：NAT、DR、TUN</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">nginx本身并没有提供session同步的解决方案，而apache则提供了session共享的支持。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">好了，解决了以上的问题之后，<strong style="line-height: 1.6 !important;">系统的结构如下</strong> ：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="1.1011764705882352" data-type="png" data-w="425" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwddeRZicPjS2ZnZKgZprzeELWrjQHPonwiaZSAtRtFcn4ibVuDrXZlITicw/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwddeRZicPjS2ZnZKgZprzeELWrjQHPonwiaZSAtRtFcn4ibVuDrXZlITicw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段四、数据库读写分离化</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">上面我们总是假设数据库负载正常，但随着访问量的的提高，数据库的负载也在慢慢增大。那么可能有人马上就想到跟应用服务器一样，把数据库一份为二再负载均衡即可。但对于数据库来说，并没有那么简单。假如我们简单的把数据库一分为二，然后对于数据库的请求，分别负载到A机器和B机器，那么显而易见会造成两台数据库数据不统一的问题。那么对于这种情况，我们可以先考虑使用读写分离的方式。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">读写分离后的数据库系统结构如下：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="1.1077981651376148" data-type="png" data-w="436" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwP2DriaoF0EoibxwfgSHtv5uBu0h1fIuZ8VGwNuvtYRRUloUjm3k7fnGQ/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwP2DriaoF0EoibxwfgSHtv5uBu0h1fIuZ8VGwNuvtYRRUloUjm3k7fnGQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">这个结构变化后也会带来两个问题</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">主从数据库之间数据同步问题</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">应用对于数据源的选择问题</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">解决问题方案</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">我们可以使用<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247488132&amp;idx=3&amp;sn=da485b7e53fc1a95acad6baf06892591&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">MYSQL</a>自带的master+slave的方式实现主从复制。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">采用第三方数据库中间件，例如<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>。<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>是从cobar发展而来的，而cobar是阿里开源的数据库中间件，后来停止开发。<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>是国内比较好的<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247488132&amp;idx=3&amp;sn=da485b7e53fc1a95acad6baf06892591&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mysql</a>开源数据库分库分表中间件。</section></li></ol><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段五、用搜索引擎缓解读库的压力</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">数据库做读库的话，常常对模糊查找力不从心，即使做了读写分离，这个问题还未能解决。以我们所举的交易网站为例，发布的商品存储在数据库中，用户最常使用的功能就是查找商品，尤其是根据商品的标题来查找对应的商品。对于这种需求，一般我们都是通过like功能来实现的，但是这种方式的代价非常大。此时我们可以使用搜索引擎的倒排索引来完成。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">搜索引擎具有以下优点</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">它能够大大提高查询速度。</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">引入搜索引擎后也会带来以下的开销</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">带来大量的维护工作，我们需要自己实现索引的构建过程，设计全量/增加的构建方式来应对非实时与实时的查询需求。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">需要维护搜索引擎集群</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">搜索引擎并不能替代数据库，他解决了某些场景下的“读”的问题，是否引入搜索引擎，需要综合考虑整个系统的需求。引入搜索引擎后的系统结构如下：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="1.0801781737193763" data-type="png" data-w="449" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpw7qkPvmqxcApicFqgibVjWbZSHiaNyJZP3FmHJkIuuwlIBce9vq8oFobOw/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpw7qkPvmqxcApicFqgibVjWbZSHiaNyJZP3FmHJkIuuwlIBce9vq8oFobOw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段六、用缓存缓解读库的压力</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">1、<strong style="line-height: 1.6 !important;">后台应用层和数据库层的缓存</strong></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">随着访问量的增加，逐渐出现了许多用户访问同一部分内容的情况，对于这些比较热门的内容，没必要每次都从数据库读取。我们可以使用缓存技术，例如可以使用google的开源缓存技术guava或者使用memcacahe作为应用层的缓存，也可以使用<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247488260&amp;idx=3&amp;sn=6d626c5ba127951a8230dd1645f6bfc3&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">redis</a>作为数据库层的缓存。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">另外，在某些场景下，关系型数据库并不是很适合，例如我想做一个“每日输入密码错误次数限制”的功能，思路大概是在用户登录时，如果登录错误，则记录下该用户的IP和错误次数，那么这个数据要放在哪里呢？假如放在内存中，那么显然会占用太大的内容；假如放在关系型数据库中，那么既要建立数据库表，还要简历对应的java bean，还要写SQL等等。而分析一下我们要存储的数据，无非就是类似{ip:errorNumber}这样的key:value数据。对于这种数据，我们可以用NOSQL数据库来代替传统的关系型数据库。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">2、<strong style="line-height: 1.6 !important;">页面缓存</strong></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">除了数据缓存，还有页面缓存。比如使用HTML5的localstroage或者cookie。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">优点</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">减轻数据库的压力</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">大幅度提高访问速度</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">缺点</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">需要维护缓存服务器</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">提高了编码的复杂性</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">值得一提的是</strong> ：</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">缓存集群的调度算法不同与上面提到的应用服务器和数据库。最好采用“一致性哈希算法”，这样才能提高命中率。这个就不展开讲了，有兴趣的可以查阅相关资料。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">加入缓存后的结构</strong> ：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.8405545927209706" data-type="png" data-w="577" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpw86loVyWktNTl1kY8cDNjGLibggYsV8F3NlCiclbtJjgCwjKFcUZunHJw/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpw86loVyWktNTl1kY8cDNjGLibggYsV8F3NlCiclbtJjgCwjKFcUZunHJw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段七、数据库水平拆分与垂直拆分</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">我们的网站演进到现在，交易、商品、用户的数据都还在同一个数据库中。尽管采取了增加缓存，读写分离的方式，但随着数据库的压力继续增加，数据库的瓶颈越来越突出，此时，我们可以有数据垂直拆分和水平拆分两种选择。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">7.1、数据垂直拆分</strong></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">垂直拆分的意思是把数据库中不同的业务数据拆分道不同的数据库中，结合现在的例子，就是把交易、商品、用户的数据分开。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">优点</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">解决了原来把所有业务放在一个数据库中的压力问题。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">可以根据业务的特点进行更多的优化</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">缺点</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">需要维护多个数据库</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">问题</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">需要考虑原来跨业务的事务</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">跨数据库的join</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">解决问题方案</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">我们应该在应用层尽量避免跨数据库的事物，如果非要跨数据库，尽量在代码中控制。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">我们可以通过第三方应用来解决，如上面提到的<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>，<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>提供了丰富的跨库join方案，详情可参考<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>官方文档。</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">垂直拆分后的结构如下</strong> ：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.7028985507246377" data-type="png" data-w="690" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwgfHTOVXPib20S5hNmQzwScZLAuKbNzKpZgAIiaxHQCzJDq2UY40gTVMw/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwgfHTOVXPib20S5hNmQzwScZLAuKbNzKpZgAIiaxHQCzJDq2UY40gTVMw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">7.2、数据水平拆分</strong></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">数据水平拆分就是把同一个表中的数据拆分到两个甚至多个数据库中。产生数据水平拆分的原因是某个业务的数据量或者更新量到达了单个数据库的瓶颈，这时就可以把这个表拆分到两个或更多个数据库中。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">优点</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">如果我们能客服以上问题，那么我们将能够很好地对数据量及写入量增长的情况。</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">问题</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">访问用户信息的应用系统需要解决SQL路由的问题，因为现在用户信息分在了两个数据库中，需要在进行数据操作时了解需要操作的数据在哪里。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">主键的处理也变得不同，例如原来自增字段，现在不能简单地继续使用了。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">如果需要分页，就麻烦了。</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">解决问题方案</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">我们还是可以通过可以解决第三方中间件，如<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>。<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>可以通过SQL解析模块对我们的SQL进行解析，再根据我们的配置，把请求转发到具体的某个数据库。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">我们可以通过UUID保证唯一或自定义ID方案来解决。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;"><a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247486257&amp;idx=1&amp;sn=4d3c9c675f8833157641a2e0b48e498c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">mycat</a>也提供了丰富的分页查询方案，比如先从每个数据库做分页查询，再合并数据做一次分页查询等等。</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">数据水平拆分后的结构</strong> ：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.7191011235955056" data-type="png" data-w="712" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwjTibsvypV4OxQxmxOhx9icdtNOIV7dyGyeav8Xwe0deGBLQSglJWTjXw/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwjTibsvypV4OxQxmxOhx9icdtNOIV7dyGyeav8Xwe0deGBLQSglJWTjXw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段八、应用的拆分</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">8.1、拆分应用</strong></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">随着业务的发展，业务越来越多，应用越来越大。我们需要考虑如何避免让应用越来越臃肿。这就需要把应用拆开，从一个应用变为俩个甚至更多。还是以我们上面的例子，我们可以把用户、商品、交易拆分开。变成“用户、商品”和“用户，交易”两个子系统。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">拆分后的结构：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.7191011235955056" data-type="png" data-w="712" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwHwn2KudPMBLyicJ5x4YyyiaYMx9KiaMib4FDEX7Hd2PSlicvrjObvNpibb0g/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwHwn2KudPMBLyicJ5x4YyyiaYMx9KiaMib4FDEX7Hd2PSlicvrjObvNpibb0g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">问题</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">这样拆分后，可能会有一些相同的代码，如用户相关的代码，商品和交易都需要用户信息，所以在两个系统中都保留差不多的操作用户信息的代码。如何保证这些代码可以复用是一个需要解决的问题。</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">解决问题</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">通过走服务化的路线来解决</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">8.2、走服务化的道路</strong></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">为了解决上面拆分应用后所出现的问题，我们把公共的服务拆分出来，形成一种服务化的模式，简称SOA。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">采用服务化之后的系统结构：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.8455056179775281" data-type="png" data-w="712" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwrSx0Je2TbXbIrkACG8fBrzVPRs6SYOiaTbDF06v77ibHbwtDQYJMFwAQ/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwrSx0Je2TbXbIrkACG8fBrzVPRs6SYOiaTbDF06v77ibHbwtDQYJMFwAQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">优点</strong> ：</p><ul style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">相同的代码不会散落在不同的应用中了，这些实现放在了各个服务中心，使代码得到更好的维护。</section></li><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">我们把对数据库的交互放在了各个服务中心，让”前端“的web应用更注重与浏览器交互的工作。</section></li></ul><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">问题</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">如何进行远程的服务调用</section></li></ol><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><strong style="line-height: 1.6 !important;">解决方法</strong> ：</p><ol style="" class="list-paddingleft-2"><li><section style="color: rgb(1, 1, 1);margin-top: 0.3em;margin-bottom: 0.3em;line-height: 1.6 !important;">我们可以通过下面的引入消息中间件来解决</section></li></ol><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">阶段九、引入消息中间件</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">随着网站的继续发展，我们的系统中可能出现不同语言开发的子模块和部署在不同平台的子系统。此时我们需要一个平台来传递可靠的，与平台和语言无关的数据，并且能够把负载均衡透明化，能在调用过程中收集调用数据并分析之，推测出网站的访问增长率等等一系列需求，对于网站应该如何成长做出预测。开源消息中间件有阿里的<a href="https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&amp;mid=2247484647&amp;idx=1&amp;sn=9eb7e47d06faca20d530c70eec3b8d5c&amp;scene=21#wechat_redirect" style="border-bottom-width: 1px;border-bottom-style: solid;color: rgb(62, 100, 255);border-color: inherit;line-height: 1.6 !important;" data-linktype="2">dubbo</a>，可以搭配Google开源的分布式程序协调服务zookeeper实现服务器的注册与发现。</p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">引入消息中间件后的结构：</p><figure style="margin-top: 1em;margin-bottom: 1em;line-height: 1.6 !important;"><img data-ratio="0.9789325842696629" data-type="png" data-w="712" data-src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwngdAvXfDZakibk6ZD4G1UYtibo2UjHLY6vf1p3hcTz2j2DhVoruHicYmQ/640?wx_fmt=png" style="display: block; margin-right: auto; margin-left: auto; line-height: 1.6 !important; width: auto !important; height: auto !important; visibility: visible !important;" _width="auto" class="" src="https://mmbiz.qpic.cn/mmbiz_png/JdLkEI9sZffAp5glxwt1UkVQXYJUkUpwngdAvXfDZakibk6ZD4G1UYtibo2UjHLY6vf1p3hcTz2j2DhVoruHicYmQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></figure><h1 style="font-weight: bold;margin-top: 1em;margin-bottom: 1em;font-size: 1.4em;padding-bottom: 0.3em;border-bottom: 1px solid rgb(223, 226, 229);line-height: 1.6 !important;"><span style="line-height: 1.6 !important;">十、总结</span></h1><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;">以上的演变过程只是一个例子，并不适合所有的网站，实际中网站演进过程与自身业务和不同遇到的问题有密切的关系，没有固定的模式。只有认真的分析和不断地探究，才能发现适合自己网站的架构。<span style="font-size: inherit;font-family: -apple-system, system-ui, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0px;"></span></p><p style="margin-top: 1em;margin-bottom: 1em;font-size: inherit;line-height: 1.6 !important;"><br></p></section><hr style="white-space: normal;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><section data-mpa-template="t" mpa-paragraph-type="ignored" style="white-space: normal;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);"><p style="white-space: normal;max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></p><p style="white-space: normal;max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="max-width: 100%;font-size: 15px;color: rgb(255, 104, 39);box-sizing: border-box !important;overflow-wrap: break-word !important;"><strong style="max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;background-color: rgb(255, 255, 255);letter-spacing: 0.5px;box-sizing: border-box !important;overflow-wrap: break-word !important;">--END--</strong></span></p><p style="white-space: normal;max-width: 100%;min-height: 1em;text-align: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><br></p><section style="margin: 10px;white-space: normal;max-width: 100%;font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.544px;background-color: rgb(255, 255, 255);display: flex;align-items: center;justify-content: center;flex-direction: column;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="margin-bottom: -20px;padding: 3px 16px;max-width: 100%;background: rgb(255, 104, 39);z-index: 5;box-sizing: border-box !important;overflow-wrap: break-word !important;"><p style="max-width: 100%;min-height: 1em;color: rgb(255, 255, 255);box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="font-size: 15px;">下方二维码关注我</span></p></section><section style="max-width: 100%;width: 296px;box-sizing: border-box !important;overflow-wrap: break-word !important;"><img data-ratio="0.14864864864864866" data-type="png" data-w="296" data-src="https://mmbiz.qpic.cn/mmbiz_png/7B8iaauAfclNpr4X0q31Ikh53jibntBeVJIfpYYMVeqHuiad8VoRicBXQCquxSDtKkke42s2LgFgrKzRbDhvpia6DRQ/640?wx_fmt=png" style="box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 296px !important; height: auto !important;" _width="296px" class="" src="https://mmbiz.qpic.cn/mmbiz_png/7B8iaauAfclNpr4X0q31Ikh53jibntBeVJIfpYYMVeqHuiad8VoRicBXQCquxSDtKkke42s2LgFgrKzRbDhvpia6DRQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" crossorigin="anonymous" data-fail="0"></section><section style="line-height: 1.75em;"><section style="max-width: 100%;display: flex;justify-content: center;align-items: center;box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="max-width: 100%;background: rgb(255, 104, 39);box-sizing: border-box !important;overflow-wrap: break-word !important;"><section style="margin: -5px 5px 5px -5px;padding: 20px 40px 20px 28px;max-width: 100%;background: rgb(255, 255, 255);border-width: 1px;border-style: solid;border-color: rgb(255, 104, 39);display: flex;justify-content: center;flex-direction: column;box-sizing: border-box !important;overflow-wrap: break-word !important;"><p style="margin-top: 4px;max-width: 100%;min-height: 1em;font-size: 13px;line-height: 1.5;box-sizing: border-box !important;overflow-wrap: break-word !important;"><em><span style="font-size: 14px;letter-spacing: 0.544px;">因为坚持分享可落地的技术架构文章</span></em></p></section></section></section></section></section><p style="white-space: normal;text-align: center;"><img class="rich_pages img_loading" data-backh="423" data-backw="538" data-before-oversubscription-url="http://mmbiz.qpic.cn/mmbiz_jpg/nXyTmFfqCEOTictnAy0qTxHdatX9gz1YibmNy7Zyy4zJjuFn4ypdoaTQKbLmicrmw9JVgficZ0KAHdgSqYV0wY0INg/0?wx_fmt=jpeg" data-croporisrc="https://mmbiz.qpic.cn/mmbiz_png/nXyTmFfqCEOTictnAy0qTxHdatX9gz1YibaA2YyNIsTp3eoczxHEWoYAL0Yag6oakOkHEJph3hunlA5W4RbgIBGg/0?wx_fmt=png" data-cropx1="0" data-cropx2="600" data-cropy1="63.7630662020906" data-cropy2="421.2543554006969" data-ratio="0.5966666666666667" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_jpg/nXyTmFfqCEOTictnAy0qTxHdatX9gz1Yib2WdU7DFekvUXPIChJ7Ml2IpiasdAiaMU8YRKiaEGvedLBtkNuDVtHzRFA/640?wx_fmt=jpeg" data-type="jpeg" data-w="600" style="width: 574px !important; height: 343.293px !important;" _width="574px" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" crossorigin="anonymous"></p><h2 style="margin-top: 40px;margin-bottom: 20px;font-weight: bold;font-size: 1.3em;max-width: 100%;caret-color: rgb(0, 0, 0);color: rgb(0, 0, 0);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;text-align: left;white-space: normal;text-size-adjust: auto;border-bottom: 2px solid rgb(239, 112, 96);box-sizing: border-box !important;overflow-wrap: break-word !important;"><span style="margin-right: 3px;padding: 3px 10px 1px;max-width: 100%;display: inline-block;background-color: rgb(239, 112, 96);color: rgb(255, 255, 255);border-top-right-radius: 3px;border-top-left-radius: 3px;font-size: 16px;box-sizing: border-box !important;overflow-wrap: break-word !important;">推荐【小马哥 Java 星球】</span></h2><p><span style="font-size: 14px;">星主小马哥：</span></p><p><span style="font-size: 14px;">大家好，我是星主小马哥。欢迎加入「小马哥 Java 星球」，希望大家多在星球里沟通，让我们探讨技术，把握趋势，共同进步</span></p><p><br></p><p><span style="font-size: 14px;">深入探讨 Java 相关技术，包括行业动态，架构设计，设计模式，框架使用，源码分析等</span></p><p style="text-align: center;"><img class="rich_pages img_loading" data-ratio="1" data-s="300,640" data-src="https://mmbiz.qpic.cn/mmbiz_png/nXyTmFfqCEM3zxQMiaXXiabsbxziap2Xn89zOrTE7UhQBMmiaonEjwkAdls9B0aibRJa3HDCDOJD7PwwNpb2gaBFuVA/640?wx_fmt=png" data-type="png" data-w="634" style="width: 347px !important; height: 347px !important;" _width="347px" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" crossorigin="anonymous"></p><p style="text-align: left;"><span style="font-size: 14px;"><span style="max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.5px;text-size-adjust: auto;color: rgb(89, 86, 86);box-sizing: border-box !important;overflow-wrap: break-word !important;">👇点击</span><span style="max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.5px;text-size-adjust: auto;color: rgb(255, 104, 39);box-sizing: border-box !important;overflow-wrap: break-word !important;">「阅读原文」</span><span style="max-width: 100%;font-family: -apple-system-font, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif;letter-spacing: 0.5px;text-size-adjust: auto;color: rgb(89, 86, 86);box-sizing: border-box !important;overflow-wrap: break-word !important;">立即到手</span></span></p><p><br></p><p style="white-space: normal;text-align: center;"><img data-src="https://mmbiz.qpic.cn/mmbiz_gif/vrKwzDZZdtvVdXbEgAQcavUXIFkEormrjXKfPKdWKP80qbWy0zeIs5jxawBoJAj741Sc8HxbxHFFian0lSiaiccLQ/640?wx_fmt=gif" data-type="gif" data-ratio="0.4796875" data-w="640" data-backw="574" data-backh="275" data-before-oversubscription-url="https://mmbiz.qpic.cn/mmbiz_gif/vrKwzDZZdtvVdXbEgAQcavUXIFkEormrjXKfPKdWKP80qbWy0zeIs5jxawBoJAj741Sc8HxbxHFFian0lSiaiccLQ/640?wx_fmt=gif" style="font-family: -apple-system-font, system-ui, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei UI&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; letter-spacing: 0.544px; text-align: justify; width: 574px !important; height: 276.381px !important;" _width="574px" class="img_loading __bg_gif" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" data-order="1"><br></p></section>
</div>




<script nonce="" type="text/javascript">
var first_sceen__time = (+new Date());

if ("" == 1 && document.getElementById('js_content')) {
document.getElementById('js_content').addEventListener("selectstart",function(e){ e.preventDefault(); });
}


(function(){
if (navigator.userAgent.indexOf("WindowsWechat") != -1){
var link = document.createElement('link');
var head = document.getElementsByTagName('head')[0];
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = "//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx492bcc.css";
head.appendChild(link);
}
})();
</script>


<div id="js_sponsor_ad_area" style="display: none;"></div>



<div class="read-more__area" id="js_more_read_area" style="display:none;">

</div>


</div>




<ul id="js_hotspot_area" class="article_extend_area"></ul>






<div class="rich_media_tool" id="js_toobar3">
<div class="weui-flex">
<div class="weui-flex__item">


<a class="media_tool_meta meta_primary" id="js_view_source" href="##">阅读原文</a>
<div id="js_read_area3" class="media_tool_meta tips_global_primary meta_primary" style="display:none;">
<span id="readTxt">阅读</span>
<span id="readNum3"></span>
</div>
</div>

<span style="display:none;" class="media_tool_meta meta_extra meta_praise" id="like_old">
<i class="icon_praise_gray"></i><span class="praise_num" id="likeNum_old"></span>
</span>


<span style="visibility: hidden;" class="media_tool_meta meta_extra meta_like" id="like3">
<button class="like_btn" id="js_like_btn"> 
<span id="js_like_wording">在看</span><span class="like_num" id="likeNum3"></span>
</button>
</span>


</div> 

</div>



<div class="like_comment_wrp" id="js_like_comment" style="display: none;">
<div class="like_comment_inner">
<div class="like_comment_hd" style="display:none" id="js_like_title"></div>
<div class="like_comment_bd">
<div class="like_comment_tips" id="js_comment_area">
<i class="weui-icon-success"></i><i class="icon-success-primary"></i>已同步到看一看<a href="javascript:;" class="like_comment_share_link" id="js_like_comment_share">写下你的想法</a>
</div>
<div class="like_comment_extra_info" id="js_like_educate" style="display: none">
<p class="like_comment_extra_tips">
<span id="js_friend_like_area" style="display: none"></span>
<span id="js_friend_like_word">前往“发现”-“看一看”浏览“朋友在看”</span>
</p>
<p class="like_comment_pic_wrp">
<img class="like_comment_pic" src="//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_like_comment492329.png">
</p>
<button class="weui-btn weui-btn_primary" id="js_go_wow">前往看一看</button>
</div>
</div>
</div>
</div>
<div style="display:none;" id="wow_close_inform">
<div class="weui-mask"></div>
<div class="weui-dialog">
<div class="weui-dialog__hd"><strong class="weui-dialog__title">看一看入口已关闭</strong></div>
<div class="weui-dialog__bd">
在“设置”-“通用”-“发现页管理”打开“看一看”入口      </div>
<div class="weui-dialog__ft" id="wow_close_ack">
<a href="javascript:;" class="weui-dialog__btn weui-dialog__btn_primary">我知道了</a>
</div>
</div>
</div>

<div id="js_like_toast" style="display: none;">
<div class="weui-mask_transparent"></div>
<div class="weui-toast">
<i class="weui-icon-success-no-circle weui-icon_toast"></i>
<p class="weui-toast__content" id="js_toast_msg">已发送</p>
</div>
</div>

<div style="display: none;" id="js_comment_panel">
<div class="like_comment_primary_wrp editing" id="js_comment_wrp">
<div class="like_comment_primary_inner">
<div class="like_comment_primary_hd">
<div class="like_comment_primary_hd_side">
<button class="like_comment_primary_cancel" id="js_comment_cancel">
取消            <i class="weui-icon-close-thin"></i>
</button>
</div>
<h4 class="like_comment_primary_title"> 发送到看一看 </h4>
<div class="like_comment_primary_hd_side">
<button class="like_comment_primary_btn" id="js_comment_confirm" disabled="disabled">发送</button>
</div>
</div>
<div class="like_comment_primary_bd">
<div class="like_comment_media_title" id="js_panel_like_title">
九阶段读懂互联网的架构演变
</div>
<textarea class="like_comment_textarea weui-textarea" placeholder="写下你的想法..." id="js_comment_text"></textarea>
</div>
<span class="like_comment_msg" id="js_like_comment_msg" style="visibility: hidden;">最多200字，当前共<span id="js_like_current_cnt"></span>字</span>
</div>
</div>
<div class="like_comment_primary_mask" id="js_mask_2"></div>
</div>

<div id="js_loading" style="display: none;">
<div class="weui-mask_transparent"></div>
<div class="weui-toast">
<i class="weui-loading weui-icon_toast"></i>
<p class="weui-toast__content">发送中</p>
</div>
</div>



</div>
</div>