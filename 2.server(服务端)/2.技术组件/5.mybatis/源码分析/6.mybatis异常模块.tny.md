<div class="article-inner">

<header class="article-header">


<h1 class="article-title" itemprop="name">
精尽 MyBatis 源码分析 —— 异常模块
</h1>



<a href="/MyBatis/exception-package/" class="archive-article-date">
<time style="display: none;" datetime="2020-01-12T16:00:00.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-01-13</time>
</a>

</header>

<div class="article-entry" itemprop="articleBody">

<h1 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h1><p>本文，我们来分享 MyBatis 的异常模块，对应 <code>exceptions</code> 包。如下图所示：<img src="http://static2.iocoder.cn/images/MyBatis/2020_01_13/01.png" alt="`exceptions` 包"></p>
<p>在 <a href="http://svip.iocoder.cn/MyBatis/intro">《精尽 MyBatis 源码解析 —— 项目结构一览》</a> 中，简单介绍了这个模块如下：</p>
<blockquote>
<p>定义了 MyBatis 专有的 PersistenceException 和 TooManyResultsException 异常。</p>
</blockquote>
<p>实际上，MyBatis 不仅仅在 <code>exceptions</code> 包下有异常，在其他包下也有异常，整体如下类图：<img src="http://static2.iocoder.cn/images/MyBatis/2020_01_13/02.png" alt="异常体系"></p>
<p>下面，我们逐个包的异常看过看过去。</p>
<h1 id="2-exceptions-包"><a href="#2-exceptions-包" class="headerlink" title="2. exceptions 包"></a>2. <code>exceptions</code> 包</h1><h2 id="2-1-IbatisException"><a href="#2-1-IbatisException" class="headerlink" title="2.1 IbatisException"></a>2.1 IbatisException</h2><p><code>org.apache.ibatis.exceptions.IbatisException</code> ，实现 RuntimeException 类，IBatis 的<strong>异常基类</strong>。代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IbatisException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3880206998166270511L</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">IbatisException</span><span class="params">()</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">IbatisException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>(message);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">IbatisException</span><span class="params">(String message, Throwable cause)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>(message, cause);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">IbatisException</span><span class="params">(Throwable cause)</span> </span>{</span><br><span class="line">    <span class="keyword">super</span>(cause);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>实际上，IbatisException 已经在 2015 年被废弃，取代它的是 PersistenceException 类。</li>
</ul>
<h2 id="2-2-PersistenceException"><a href="#2-2-PersistenceException" class="headerlink" title="2.2 PersistenceException"></a>2.2 PersistenceException</h2><p><code>org.apache.ibatis.exceptions.PersistenceException</code> ，继承 IbatisException 类，目前 MyBatis <strong>真正的异常基类</strong>。代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersistenceException</span> <span class="keyword">extends</span> <span class="title">IbatisException</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">7537395265357977271L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersistenceException</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersistenceException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersistenceException</span><span class="params">(String message, Throwable cause)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersistenceException</span><span class="params">(Throwable cause)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-2-1-ExceptionFactory"><a href="#2-2-1-ExceptionFactory" class="headerlink" title="2.2.1 ExceptionFactory"></a>2.2.1 ExceptionFactory</h3><p><code>org.apache.ibatis.exceptions.ExceptionFactory</code> ，异常工厂。代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionFactory</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">ExceptionFactory</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">// Prevent Instantiation</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 包装异常成 PersistenceException</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message 消息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> e 发生的异常</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> PersistenceException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> RuntimeException <span class="title">wrapException</span><span class="params">(String message, Exception e)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PersistenceException(ErrorContext.instance().message(message).cause(e).toString(), e);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="2-3-TooManyResultsException"><a href="#2-3-TooManyResultsException" class="headerlink" title="2.3 TooManyResultsException"></a>2.3 TooManyResultsException</h2><p><code>org.apache.ibatis.exceptions.TooManyResultsException</code> ，继承 PersistenceException 类，查询返回过多结果的异常。期望返回一条，实际返回了多条。代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TooManyResultsException</span> <span class="keyword">extends</span> <span class="title">PersistenceException</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8935197089745865786L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TooManyResultsException</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TooManyResultsException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TooManyResultsException</span><span class="params">(String message, Throwable cause)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TooManyResultsException</span><span class="params">(Throwable cause)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h1 id="3-parsing-包"><a href="#3-parsing-包" class="headerlink" title="3. parsing 包"></a>3. <code>parsing</code> 包</h1><h2 id="3-1-ParsingException"><a href="#3-1-ParsingException" class="headerlink" title="3.1 ParsingException"></a>3.1 ParsingException</h2><p><code>org.apache.ibatis.parsing.ParsingException</code> ，继承 PersistenceException 类，解析异常。代码如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParsingException</span> <span class="keyword">extends</span> <span class="title">PersistenceException</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">176685891441325943L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParsingException</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParsingException</span><span class="params">(String message)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParsingException</span><span class="params">(String message, Throwable cause)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ParsingException</span><span class="params">(Throwable cause)</span> </span>{</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h1 id="3-其它包"><a href="#3-其它包" class="headerlink" title="3. 其它包"></a>3. 其它包</h1><p>实际上，我们会看到其他包，会和 <code>parsing</code> 包一样，都会定义其<strong>独有</strong>的异常类。但是，代码都是相同的。所以，这里就简单整理如下：</p>
<ul>
<li><code>reflection</code> 包：ReflectionException</li>
<li><code>logging</code> 包：LogException</li>
<li><code>builder</code> 包：BuilderException、IncompleteElementException</li>
<li><code>scripting</code> 包：ScriptingException</li>
<li><code>binding</code> 包：BindingException</li>
<li><code>type</code> 包：TypeException</li>
<li><code>session</code> 包：SqlSessionException</li>
<li><code>cache</code> 包：CacheException</li>
<li><code>transaction</code> 包：TransactionException</li>
<li><code>datasource</code> 包：DataSourceException</li>
<li><code>executor</code> 包：ResultMapException、ExecutorException、BatchExecutorException</li>
<li><code>plugin</code> 包：PluginException</li>
</ul>
<h1 id="666-彩蛋"><a href="#666-彩蛋" class="headerlink" title="666. 彩蛋"></a>666. 彩蛋</h1><p>哈哈哈，因为 <a href="http://svip.iocoder.cn/MyBatis/reflection-package">《精尽 MyBatis 源码分析 —— 反射模块》</a> 一文让我们都很累，所以这篇文章，给我们度假下。哈哈哈。</p>




</div>
<div class="article-info article-info-index">



<div class="article-category tagcloud">
<i class="icon-book icon"></i>
<ul class="article-tag-list">

<li class="article-tag-list-item">
<a href="/categories/MyBatis//" class="article-tag-list-link color3">MyBatis</a>
</li>

</ul>
</div>





<div class="clearfix"></div>
</div>
</div>