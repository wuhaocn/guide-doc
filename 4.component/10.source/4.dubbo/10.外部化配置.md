# å¤–éƒ¨åŒ–é…ç½®

æœ¬æ–‡å®é™…æ˜¯ ã€ŠDubbo æºç åˆ†æ â€”â€” é›†æˆ Spring Bootã€‹æ–‡ç« ã€‚è€ƒè™‘åˆ°å’Œ Dubbo é…ç½®æ¯”è¾ƒç›¸å…³ï¼Œæ‰€ä»¥æ”¹æˆè¿™ä¸ªæ ‡é¢˜ã€‚

* é‡ç‚¹æ˜¯ [ã€Œ4. dubbo-spring-boot-autoconfigure æºç ã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/) å°èŠ‚ã€‚
* é€‰æ‹©æ€§çœ‹ [ã€Œ5. dubbo-spring-boot-actuator æºç ã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/) å°èŠ‚ã€‚

# 1. æ¦‚è¿°

æœ¬æ–‡ï¼Œæˆ‘ä»¬æ¥åˆ†äº« [https://github.com/apache/incubator-dubbo-spring-boot-project](https://github.com/apache/incubator-dubbo-spring-boot-project) é¡¹ç›®çš„æºç è§£æï¼Œçœ‹çœ‹ Dubbo æ˜¯å¦‚ä½•é›†æˆåˆ° Spring Boot ä¸­çš„ã€‚

åœ¨é˜…è¯»æœ¬æ–‡ä¹‹å‰ï¼Œå¸Œæœ›èƒ–å‹èƒ½å¤Ÿå…ˆç†Ÿè¯» [ä¸­æ–‡æ–‡æ¡£](https://github.com/apache/incubator-dubbo-spring-boot-project/blob/master/README_CN.md) ã€‚æœ€å¥½å‘¢ï¼Œå½“ç„¶ä¸å¼ºåˆ¶ï¼Œå¯ä»¥æ“ç»ƒä¸‹æ¯ä¸ª Demo ã€‚

# 2. è°ƒè¯•ç¯å¢ƒæ­å»º

åœ¨è¯»æºç ä¹‹å‰ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯å…ˆæŠŠè°ƒè¯•ç¯å¢ƒæ­å»ºèµ·æ¥ã€‚

## 2.1 ä¾èµ–å·¥å…·

* JDK ï¼š1.8+
* Maven
* IntelliJ IDEA

## 2.2 æºç æ‹‰å–

ä»å®˜æ–¹ä»“åº“ [https://github.com/apache/incubator-dubbo-spring-boot-project](https://github.com/apache/incubator-dubbo-spring-boot-project)

Fork
å‡ºå±äºè‡ªå·±çš„ä»“åº“ã€‚ä¸ºä»€ä¹ˆè¦

Fork
ï¼Ÿæ—¢ç„¶å¼€å§‹é˜…è¯»ã€è°ƒè¯•æºç ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™ä¸€äº›æ³¨é‡Šï¼Œæœ‰äº†è‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥è¿›è¡Œè‡ªç”±çš„æäº¤ã€‚ğŸ˜ˆ

ä½¿ç”¨ IntelliJ IDEA ä» Fork å‡ºæ¥çš„ä»“åº“æ‹‰å–ä»£ç ã€‚æ‹‰å–å®Œæˆåï¼ŒMaven ä¼šä¸‹è½½ä¾èµ–åŒ…ï¼Œå¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œè€å¿ƒç­‰å¾…ä¸‹ã€‚

åœ¨ç­‰å¾…çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ¥ç®€å•è¯´ä¸‹ï¼Œæ­å»ºè°ƒè¯•ç¯å¢ƒçš„è¿‡ç¨‹ï¼š

1. å¯åŠ¨ Dubbo Provider
1. å¯åŠ¨ Dubbo Consumer

è€ƒè™‘åˆ°æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨

dubbo-registry-zookeeper-samples
é¡¹ç›®æä¾›çš„ç¤ºä¾‹ã€‚

ğŸ˜ˆ å¦å¤–ï¼Œæœ¬æ–‡ä½¿ç”¨çš„

incubator-dubbo-spring-boot-project
ç‰ˆæœ¬æ˜¯

0.2.1
ã€‚

## 2.3 å¯åŠ¨ Dubbo Provider

å³é”®è¿è¡Œ

dubbo-registry-zookeeper-samples
é¡¹ç›®ä¸‹çš„

provider-sample
çš„ DubboRegistryZooKeeperProviderBootstrap çš„

/#main(String[] args)
æ–¹æ³•ï¼ŒProvider å°±å¯åŠ¨å®Œæˆäº†ã€‚è¾“å‡ºæ—¥å¿—å¦‚ä¸‹å›¾ï¼š![æ—¥å¿—](http://static2.iocoder.cn/images/Dubbo/2019_02_11/01.jpg)

è¿™ä¸ªç¤ºä¾‹æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œæä¾›äº† EmbeddedZooKeeper ç±»ï¼Œç”¨äºå¯åŠ¨**å†…åµŒ**çš„ Zookeeper ã€‚

## 2.4 å¯åŠ¨ Dubbo Consumer

å³é”®è¿è¡Œ

dubbo-registry-zookeeper-samples
é¡¹ç›®ä¸‹çš„

consumer-sample
çš„ DubboRegistryZooKeeperConsumerBootstrap çš„

/#main(String[] args)
æ–¹æ³•ï¼ŒConsumer å°±å¯åŠ¨å®Œæˆäº†ã€‚è¾“å‡ºæ—¥å¿—å¦‚ä¸‹å›¾ï¼š![æ—¥å¿—](http://static2.iocoder.cn/images/Dubbo/2019_02_11/02.jpg)

å› ä¸º DubboRegistryZooKeeperConsumerBootstrap çš„ Spring Boot å¯åŠ¨è°ƒç”¨å¦‚ä¸‹ï¼š
```
// DubboRegistryZooKeeperConsumerBootstrap.java
private final Logger logger = LoggerFactory.getLogger(getClass());
@Reference(version = "${demo.service.version}")
private DemoService demoService;
@Bean
public ApplicationRunner runner(){
return args -> logger.info(demoService.sayHello("mercyblitz")); // å‘èµ·è°ƒç”¨
}
public static void main(String[] args){
SpringApplication.run(DubboRegistryZooKeeperConsumerBootstrap.class) // å¯åŠ¨
.close(); // <X> å…³é—­
}
```

* <X>
å¤„ï¼Œæ‰€ä»¥åœ¨å‘èµ·ä¸€æ¬¡ Dubbo è°ƒç”¨ä¹‹åï¼Œä¼šç›´æ¥å…³é—­ Spring Boot åº”ç”¨ã€‚å› æ­¤ï¼ŒJVM è¿›ç¨‹å°±ç›´æ¥ç»“æŸäº†ã€‚

# 3. é¡¹ç›®ç»“æ„ä¸€è§ˆ

æœ¬æ–‡ä¸»è¦åˆ†äº«

incubator-dubbo-spring-boot-project
çš„ **é¡¹ç›®ç»“æ„**ã€‚
å¸Œæœ›é€šè¿‡æœ¬æ–‡èƒ½è®©èƒ–å‹å¯¹

incubator-dubbo-spring-boot-project
çš„æ•´ä½“é¡¹ç›®æœ‰ä¸ªç®€å•çš„äº†è§£ã€‚

![é¡¹ç›®ç»“æ„ä¸€è§ˆ](http://static2.iocoder.cn/images/Dubbo/2019_02_11/03.jpg)

## 3.1 ä»£ç ç»Ÿè®¡

è¿™é‡Œå…ˆåˆ†äº«ä¸€ä¸ªå°æŠ€å·§ã€‚ç¬”è€…åœ¨å¼€å§‹æºç å­¦ä¹ æ—¶ï¼Œä¼šé¦–å…ˆäº†è§£é¡¹ç›®çš„ä»£ç é‡ã€‚

**ç¬¬ä¸€ç§æ–¹å¼**ï¼Œä½¿ç”¨ [IDEA Statistic](https://plugins.jetbrains.com/plugin/4509-statistic) æ’ä»¶ï¼Œç»Ÿè®¡æ•´ä½“ä»£ç é‡ã€‚

![Statistic ç»Ÿè®¡ä»£ç é‡](http://static2.iocoder.cn/images/Dubbo/2019_02_11/04.jpg)

æˆ‘ä»¬å¯ä»¥ç²—ç•¥çš„çœ‹åˆ°ï¼Œæ€»çš„ä»£ç é‡åœ¨ 2000 è¡Œã€‚è¿™å…¶ä¸­è¿˜åŒ…æ‹¬å•å…ƒæµ‹è¯•ï¼Œç¤ºä¾‹ç­‰ç­‰ä»£ç ã€‚
æ‰€ä»¥ï¼Œä¸æ…Œï¼Œä¸€ç‚¹ä¸æ…Œ~

**ç¬¬äºŒç§æ–¹å¼**ï¼Œä½¿ç”¨ [Shell è„šæœ¬å‘½ä»¤é€ä¸ª Maven æ¨¡å—ç»Ÿè®¡](http://blog.csdn.net/yhhwatl/article/details/52623879) ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç¬”è€…ä½¿ç”¨

find . -name "/*.java"|xargs cat|grep -v -e ^$ -e ^\s/*\/\/./*$|wc -l
ã€‚è¿™ä¸ªå‘½ä»¤åªè¿‡æ»¤äº†**éƒ¨åˆ†æ³¨é‡Š**ï¼Œæ‰€ä»¥ç›¸æ¯” [IDEA Statistic](https://plugins.jetbrains.com/plugin/4509-statistic) ä¼š**åå¤š**ã€‚

å½“ç„¶ï¼Œè€ƒè™‘åˆ°å‡†ç¡®æ€§ï¼Œèƒ–å‹éœ€è¦æ‰‹åŠ¨

cd
åˆ°æ¯ä¸ª Maven é¡¹ç›®çš„

src/main/java
ç›®å½•ä¸‹ï¼Œä»¥è¾¾åˆ°æ’é™¤å•å…ƒæµ‹è¯•çš„ä»£ç é‡ã€‚

![Shell è„šæœ¬ç»Ÿè®¡ä»£ç é‡](http://static2.iocoder.cn/images/Dubbo/2019_02_11/05.jpg)

ç»Ÿè®¡å®Œåï¼Œæ˜¯ä¸æ˜¯æ›´åŠ ä¸æ…Œäº†ã€‚å“ˆå“ˆå“ˆå“ˆã€‚

## 3.2 dubbo-spring-boot-parent æ¨¡å—

dubbo-spring-boot-parent
æ¨¡å—ï¼Œæ— å…·ä½“ä»£ç ï¼Œä½œä¸ºå…¶å®ƒé¡¹ç›®çš„ Maven Parent é¡¹ç›®ï¼Œä¾‹å¦‚å®šä¹‰äº†ä¾èµ–ç‰ˆæœ¬å·ã€‚

## 3.3 dubbo-spring-boot-starter æ¨¡å—

dubbo-spring-boot-starter
æ¨¡å—ï¼Œæ— å…·ä½“ä»£ç ï¼Œä½œä¸º Spring Boot Dubbo Starter æ¨¡å—ã€‚å…¶

pom.xml
çš„ä»£ç å¦‚ä¸‹ï¼š
```
<project xmlns="http://maven.apache.org/POM/4.0.0"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
<parent>
<groupId>com.alibaba.boot</groupId>
<artifactId>dubbo-spring-boot-parent</artifactId>
<version>${revision}</version>
<relativePath>../dubbo-spring-boot-parent</relativePath>
</parent>
<modelVersion>4.0.0</modelVersion>
<artifactId>dubbo-spring-boot-starter</artifactId>
<packaging>jar</packaging>
<name>Dubbo Spring Boot Starter</name>
<description>Dubbo Spring Boot Starter</description>
<dependencies>
<!-- Spring Boot dependencies -->
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter</artifactId>
<optional>true</optional>
</dependency>
<!-- ZK -->
<dependency>
<groupId>org.apache.zookeeper</groupId>
<artifactId>zookeeper</artifactId>
<optional>true</optional>
</dependency>
<dependency>
<groupId>org.apache.curator</groupId>
<artifactId>curator-framework</artifactId>
<optional>true</optional>
</dependency>
<dependency>
<groupId>com.alibaba.boot</groupId>
<artifactId>dubbo-spring-boot-autoconfigure</artifactId>
<version>${revision}</version>
</dependency>
</dependencies>
</project>
```

## 3.4 dubbo-spring-boot-distribution æ¨¡å—

dubbo-spring-boot-distribution
æ¨¡å—ï¼Œæ— å…·ä½“ä»£ç ï¼Œç”¨äº Spring Boot Dubbo ä½¿ç”¨ [
maven-assembly-plugin
](https://www.jianshu.com/p/14bcb17b99e0) æ’ä»¶ï¼Œæ‰“åŒ…å‡ºæˆ‘ä»¬åç»­ä½¿ç”¨çš„ [Releases](https://github.com/apache/incubator-dubbo-spring-boot-project/releases) ã€‚

## 3.5 dubbo-spring-boot-autoconfigure æ¨¡å—

dubbo-spring-boot-autoconfigure
æ¨¡å—ï¼Œ754 è¡Œä»£ç ï¼Œæä¾›äº† Spring Boot Dubbo çš„è‡ªåŠ¨é…ç½®ï¼ˆAutoConfigureï¼‰çš„å…·ä½“å®ç°ã€‚

## 3.6 dubbo-spring-boot-actuator æ¨¡å—

dubbo-spring-boot-actuator
æ¨¡å—ï¼Œ782 è¡Œä»£ç ï¼Œæä¾›äº† Spring Boot Dubbo çš„ Actuator çš„å…·ä½“å®ç°ã€‚
Spring Boot Actuator çš„å…³é”®ç‰¹æ€§ï¼Œæ˜¯åœ¨åº”ç”¨ç¨‹åºé‡Œæä¾›ä¼—å¤š HTTP æ¥å£ï¼Œé€šè¿‡å®ƒä»¬äº†è§£åº”ç”¨ç¨‹åºè¿è¡Œæ—¶çš„å†…éƒ¨çŠ¶å†µã€‚

## 3.7 dubbo-spring-boot-samples æ¨¡å—

dubbo-spring-boot-samples
æ¨¡å—ï¼Œ708 è¡Œä»£ç ï¼Œæä¾›äº†å››ä¸ªç¤ºä¾‹ã€‚æ¯”è¾ƒé‡ç‚¹å¯ä»¥çœ‹çš„æ˜¯ä¸¤ä¸ªï¼š

* dubbo-registry-zookeeper-samples
æ¨¡å—ï¼Œæä¾›åŸºäº Zookeeper ä½œä¸ºæ³¨å†Œä¸­å¿ƒçš„ä½¿ç”¨ç¤ºä¾‹ã€‚
* externalized-configuration-samples
æ¨¡å—ï¼Œæä¾›äº†å¤–éƒ¨åŒ–é…ç½®çš„ç¤ºä¾‹ã€‚

## 3.8 å°ç»“

è²Œä¼¼ä¹Ÿæ²¡å•¥å¥½å°ç»“çš„ã€‚æƒ³è¦å·æ‡’çš„è¯ï¼Œåªè¦çœ‹

dubbo-spring-boot-autoconfigure
æ¨¡å—ï¼Œä¸€å…±æ˜¯ 754 è¡Œä»£ç ã€‚å“ˆå“ˆå“ˆ~

å½“ç„¶ï¼ŒçœŸçš„è¦æ·±å…¥çš„è¯ï¼Œè¿˜æ˜¯è¦çœ‹ [Dubbo](https://github.com/apache/incubator-dubbo) æœ¬èº«çš„ä»£ç çš„ã€‚

# 4.

dubbo-spring-boot-autoconfigure
æºç 

dubbo-spring-boot-autoconfigure
æ¨¡å—ï¼Œæ‰€æœ‰ç±»å¦‚ä¸‹å›¾ï¼š![`dubbo-spring-boot-autoconfigure` æ¨¡å—](http://static2.iocoder.cn/images/Dubbo/2019_02_11/06.jpg)
å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯

autoconfigure
åŒ…ä¸‹ã€‚

## 4.1 DubboAutoConfiguration

com.alibaba.boot.dubbo.autoconfigure.DubboAutoConfiguration
ï¼ŒDubbo è‡ªåŠ¨é…ç½®ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboAutoConfiguration.java
@Configuration // é…ç½®ç±»
@ConditionalOnProperty(prefix = DUBBO_PREFIX, name = "enabled", matchIfMissing = true, havingValue = "true") // è¦æ±‚é…ç½®äº† "dubbo.enabled=true" æˆ–è€…ï¼Œ"dubbo.enabled" æœªé…ç½®
@ConditionalOnClass(AbstractConfig.class) // AbstractConfig ç±»å­˜åœ¨çš„æ—¶å€™ï¼Œå³ç”¨äºåˆ¤æ–­æœ‰ Dubbo åº“
public class DubboAutoConfiguration{
// ... çœç•¥å…¶å®ƒä»£ç 
}
```

* ç±»ä¸Šçš„æ¯ä¸ªæ³¨è§£çš„ä½œç”¨ï¼Œè¯·çœ‹å…¶åçš„æ³¨é‡Šã€‚

### 4.1.1 serviceAnnotationBeanPostProcessor

/#serviceAnnotationBeanPostProcessor()
æ–¹æ³•ï¼Œåˆ›å»º ServiceAnnotationBeanPostProcessor Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboAutoConfiguration.java
@ConditionalOnProperty(name = BASE_PACKAGES_PROPERTY_NAME) // é…ç½®äº† "dubbo.scan.base-package" å±æ€§ï¼Œå³è¦æ‰«æ Dubbo æ³¨è§£çš„åŒ…
@ConditionalOnClass(ConfigurationPropertySources.class) // æœ‰ Spring Boot é…ç½®åŠ è½½çš„åŠŸèƒ½
@Bean
public ServiceAnnotationBeanPostProcessor serviceAnnotationBeanPostProcessor(Environment environment){
// <1> è·å¾— "dubbo.scan.base-package" å±æ€§
Set<String> packagesToScan = environment.getProperty(BASE_PACKAGES_PROPERTY_NAME, Set.class, emptySet());
// <2> åˆ›å»º ServiceAnnotationBeanPostProcessor å¯¹è±¡
return new ServiceAnnotationBeanPostProcessor(packagesToScan);
}
```

* <1>
å¤„ï¼Œè·å¾—

"dubbo.scan.base-package"
å±æ€§ï¼Œå³è¦æ‰«æ Dubbo æ³¨è§£çš„åŒ…ã€‚
* <2>
å¤„ï¼Œåˆ›å»º ServiceAnnotationBeanPostProcessor å¯¹è±¡ã€‚åç»­ï¼ŒServiceAnnotationBeanPostProcessor ä¼šæ‰«æ

packagesToScan
åŒ…çš„ Dubbo

@Service
æ³¨è§£ï¼Œåˆ›å»ºå¯¹åº”çš„ Dubbo Service Bean å¯¹è±¡ä»¬ã€‚

* ServiceAnnotationBeanPostProcessor å±äº Dubbo é¡¹ç›®æœ¬èº«ï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä¸è§£æé€»ã€‚

### 4.1.2 referenceAnnotationBeanPostProcessor

/#referenceAnnotationBeanPostProcessor()
æ–¹æ³•ï¼Œåˆ›å»º Bean åå­—ä¸º

"referenceAnnotationBeanPostProcessor"
çš„ ReferenceAnnotationBeanPostProcessor Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboAutoConfiguration.java
@ConditionalOnMissingBean // ä¸å­˜åœ¨ ReferenceAnnotationBeanPostProcessor Bean çš„æ—¶å€™
@Bean(name = ReferenceAnnotationBeanPostProcessor.BEAN_NAME) // Bean çš„åå­—æ˜¯ referenceAnnotationBeanPostProcessor
public ReferenceAnnotationBeanPostProcessor referenceAnnotationBeanPostProcessor(){
return new ReferenceAnnotationBeanPostProcessor();
}
```

* åç»­ï¼ŒReferenceAnnotationBeanPostProcessor ä¼šæ‰«æ Dubbo

@Reference
æ³¨è§£ï¼Œåˆ›å»ºå¯¹åº”çš„ Dubbo Service Bean å¯¹è±¡ä»¬ã€‚

* ReferenceAnnotationBeanPostProcessor å±äº Dubbo é¡¹ç›®æœ¬èº«ï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä¸è§£æé€»ã€‚

### 4.1.3 relaxedDubboConfigBinder

/#relaxedDubboConfigBinder()
æ–¹æ³•ï¼Œåˆ›å»º RelaxedDubboConfigBinder Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboAutoConfiguration.java
@ConditionalOnClass(Binder.class) // å­˜åœ¨ Binder ç±»çš„æ—¶å€™
@Bean
@Scope(scopeName = SCOPE_PROTOTYPE) // å¤šä¾‹
public RelaxedDubboConfigBinder relaxedDubboConfigBinder(){
return new RelaxedDubboConfigBinder();
}
```

* RelaxedDubboConfigBinder ï¼Œç”¨äºå°†å…·ä½“çš„å±æ€§ï¼Œè®¾ç½®åˆ°ç›¸åº”çš„ AbstractConfig å¯¹è±¡ä¸­ã€‚
* ä¸ºä»€ä¹ˆ

@Scope(scopeName = SCOPE_PROTOTYPE)
æ³¨è§£æ˜¯**å¤šä¾‹**å‘¢ï¼Ÿå› ä¸ºæœ‰å¤šä¸ª AbstractConfig å¯¹è±¡å‘€~
* è¯¦ç»†çš„è§£æï¼Œè§ [ã€Œ4.2 RelaxedDubboConfigBinderã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/) ã€‚

### 4.1.4 XXXDubboConfigConfiguration

```
// DubboAutoConfiguration.java
//*/*
/* Single Dubbo Config Configuration
/*
/* @see EnableDubboConfig
/* @see DubboConfigConfiguration.Single
/*/
@EnableDubboConfig
protected static class SingleDubboConfigConfiguration{
}
//*/*
/* Multiple Dubbo Config Configuration , equals @EnableDubboConfig.multiple() == <code>true</code>
/*
/* @see EnableDubboConfig
/* @see DubboConfigConfiguration.Multiple
/*/
@ConditionalOnProperty(name = MULTIPLE_CONFIG_PROPERTY_NAME, havingValue = "true") // è¦æ±‚é…ç½® "dubbo.config.multiple=true" ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDubbo è‡ªå¸¦ "dubbo.config.multiple=true"
@EnableDubboConfig(multiple = true)
protected static class MultipleDubboConfigConfiguration{
}
```

* å…³äº

@EnableDubboConfig
æ³¨è§£çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹ [ã€ŠDubbo æ–°ç¼–ç¨‹æ¨¡å‹ä¹‹å¤–éƒ¨åŒ–é…ç½® â€”â€”

@EnableDubboConfig
ã€‹](https://segmentfault.com/a/1190000012661402#articleHeader4) ã€‚
* SingleDubboConfigConfiguration å¯¹åº”

@EnableDubboConfig(multiple = false)
ã€‚

* æ— ä»»ä½•æ¡ä»¶ï¼Œæ‰€ä»¥ä¼šåˆ›å»ºã€‚
* å¼•å…¥äº†å•ä¸ª Dubbo é…ç½®ç»‘å®š Bean çš„é…ç½®ã€‚å³é…ç½®æ–‡ä»¶å¦‚ä¸‹å±æ€§ï¼š
```
dubbo.application
dubbo.module
dubbo.registry
dubbo.protocol
dubbo.monitor
dubbo.provider
dubbo.consumer
```

* ~
* MultipleDubboConfigConfiguration å¯¹åº”

@EnableDubboConfig(multiple = true)
ã€‚

* è¦æ±‚é…ç½®

"dubbo.config.multiple=true"
ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒDubbo è‡ªå¸¦

"dubbo.config.multiple=true"
ï¼Œæ‰€ä»¥ä¹Ÿä¼šåˆ›å»ºã€‚
* å¼•å…¥äº†å¤šä¸ª Dubbo é…ç½®ç»‘å®š Bean çš„é…ç½®ã€‚å³é…ç½®æ–‡ä»¶å¦‚ä¸‹å±æ€§ï¼š
```
dubbo.applications
dubbo.modules
dubbo.registries
dubbo.protocols
dubbo.monitors
dubbo.providers
dubbo.consumers
```

* ~

## 4.2 RelaxedDubboConfigBinder

com.alibaba.boot.dubbo.autoconfigure.RelaxedDubboConfigBinder
ï¼Œç»§æ‰¿ AbstractDubboConfigBinder æŠ½è±¡ç±»ï¼Œè´Ÿè´£å°† Spring Boot çš„é…ç½®å±æ€§ï¼Œæ³¨å…¥åˆ° Dubbo AbstractConfig é…ç½®å¯¹è±¡ä¸­ã€‚ä»£ç  å¦‚ä¸‹ï¼š
```
// RelaxedDubboConfigBinder.java
@Override
public <C extends AbstractConfig> void bind(String prefix, C dubboConfig){
// <1.1> è·å¾— PropertySource æ•°ç»„
Iterable<PropertySource<?>> propertySources = getPropertySources();
// Converts ConfigurationPropertySources
// <1.2> è½¬æ¢æˆ ConfigurationPropertySource æ•°ç»„
Iterable<ConfigurationPropertySource> configurationPropertySources = from(propertySources);
// Wrap Bindable from DubboConfig instance
// <2> å°† dubboConfig åŒ…è£…æˆ Bindable å¯¹è±¡
Bindable<C> bindable = Bindable.ofInstance(dubboConfig);
// <3.1> åˆ›å»º Binder å¯¹è±¡
Binder binder = new Binder(configurationPropertySources, new PropertySourcesPlaceholdersResolver(propertySources));
// Get BindHandler
// <3.2> è·å¾— BindHandler å¯¹è±¡
BindHandler bindHandler = getBindHandler();
// Bind
// <3.3> æ‰§è¡Œç»‘å®šï¼Œä¼šå°† propertySources å±æ€§ï¼Œæ³¨å…¥åˆ° dubboConfig å¯¹è±¡ä¸­
binder.bind(prefix, bindable, bindHandler);
}
```

* AbstractDubboConfigBinder å±äº Dubbo é¡¹ç›®æœ¬èº«ï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä¸è§£æé€»ã€‚
* <1.1>
å¤„ï¼Œè°ƒç”¨çˆ¶ç±»çš„

/#getPropertySources()
æ–¹æ³•ï¼Œè·å¾— PropertySource æ•°ç»„ã€‚
* <1.2>
å¤„ï¼Œè°ƒç”¨

ConfigurationPropertySources/#from(Iterable<PropertySource<?>> sources)
æ–¹æ³•ï¼Œè½¬æ¢æˆ ConfigurationPropertySource æ•°ç»„ã€‚ä¸Šè¿°ä¸¤ä¸ªå˜é‡çš„å€¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![`configurationPropertySources` å±æ€§](http://static2.iocoder.cn/images/Dubbo/2019_02_11/07.jpg)
* <2>
å¤„ï¼Œè°ƒç”¨

Bindable/#ofInstance(T instance)
æ–¹æ³•ï¼Œå°†

dubboConfig
åŒ…è£…æˆ Bindable å¯¹è±¡ã€‚
* <3.1>
å¤„ï¼Œåˆ›å»º Binder å¯¹è±¡ã€‚
* <3.2>
å¤„ï¼Œè°ƒç”¨

/#getBindHandler()
æ–¹æ³•ï¼Œè·å¾— BindHandler å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// RelaxedDubboConfigBinder.java
private BindHandler getBindHandler(){
// è·å¾—é»˜è®¤çš„ BindHandler å¤„ç†å™¨
BindHandler handler = BindHandler.DEFAULT;
// è¿›ä¸€æ­¥åŒ…è£…æˆ IgnoreErrorsBindHandler å¯¹è±¡
if (isIgnoreInvalidFields()) {
handler = new IgnoreErrorsBindHandler(handler);
}
// è¿›ä¸€æ­¥åŒ…è£…æˆ NoUnboundElementsBindHandler å¯¹è±¡
if (!isIgnoreUnknownFields()) {
UnboundElementsSourceFilter filter = new UnboundElementsSourceFilter();
handler = new NoUnboundElementsBindHandler(handler, filter);
}
return handler;
}
```

* å…³äº BindHandler ç±»ï¼Œèƒ–å‹ä¸ç”¨æ·±ç©¶ï¼Œåªè¦çŸ¥é“å¦‚ä¸‹å³å¯ã€‚
æœ‰æ—¶å€™ï¼Œç»‘å®šæ—¶å¯èƒ½éœ€è¦å®ç°é¢å¤–çš„é€»è¾‘ï¼Œè€ŒBindHandleræ¥å£æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ æ¯ä¸ªBindHandleréƒ½å¯ä»¥å®ç°onStartï¼ŒonSuccessï¼ŒonFailureå’ŒonFinishæ–¹æ³•æ¥è¦†ç›–è¡Œä¸ºã€‚

Spring Bootæä¾›äº†ä¸€äº›å¤„ç†ç¨‹åºï¼Œä¸»è¦ç”¨äºæ”¯æŒç°æœ‰çš„@ConfigurationPropertiesç»‘å®šã€‚ ä¾‹å¦‚ï¼ŒValidationBindHandlerå¯ç”¨äºå¯¹ç»‘å®šå¯¹è±¡åº”ç”¨ValidatoréªŒè¯ã€‚
* <3.3>
å¤„ï¼Œè°ƒç”¨

Binder/#bind(String name, Bindable<T> target, BindHandler handler)
æ–¹æ³•ï¼Œå°†é…ç½®ä¸­ï¼ŒæŒ‡å®šå‰ç¼€ï¼ˆ

prefix
ï¼‰çš„å±æ€§ï¼Œæ³¨å…¥åˆ° AbstractConfig é…ç½®å¯¹è±¡ä¸­ã€‚ä¾‹å¦‚ä¸‹å›¾ï¼š![`dubboConfig` å±æ€§](http://static2.iocoder.cn/images/Dubbo/2019_02_11/08.jpg)
å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯

env
åŒ…ä¸‹ã€‚

## 4.3 DubboDefaultPropertiesEnvironmentPostProcessor

com.alibaba.boot.dubbo.env.DubboDefaultPropertiesEnvironmentPostProcessor
ï¼Œå®ç° EnvironmentPostProcessorã€Ordered æ¥å£ï¼Œç”Ÿæˆ Dubbo é»˜è®¤çš„é…ç½®ï¼Œæ·»åŠ åˆ°

environment
ä¸­ã€‚è€Œéœ€è¦ç”Ÿæˆçš„ Dubbo é»˜è®¤çš„é…ç½®å¦‚ä¸‹ï¼š
```
/# ç›´æ¥å¤ç”¨ spring.application.name
dubbo.application.name=
/# é»˜è®¤ä¸º true
dubbo.config.multiple=true
/# é»˜è®¤ä¸º false
dubbo.config.qos-enable=false
```

* å› æ­¤ï¼Œæˆ‘ä»¬åªè¦é…ç½®äº†

"spring.application.name"
çš„å±æ€§ï¼Œ

"dubbo.application.name"
å°±ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚

### 4.3.1 postProcessEnvironment

å®ç°

/#postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application)
æ–¹æ³•ï¼Œè‡ªåŠ¨ç”Ÿæˆ Dubbo é»˜è®¤é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboDefaultPropertiesEnvironmentPostProcessor.java
@Override
public void postProcessEnvironment(ConfigurableEnvironment environment, SpringApplication application){
MutablePropertySources propertySources = environment.getPropertySources();
// <1> ç”Ÿæˆ Dubbo é»˜è®¤é…ç½®
Map<String, Object> defaultProperties = createDefaultProperties(environment);
// <2> æœ‰é»˜è®¤é…ç½®ï¼Œåˆ™æ·»åŠ åˆ° environment ä¸­
if (!CollectionUtils.isEmpty(defaultProperties)) {
addOrReplace(propertySources, defaultProperties);
}
}
```

* <1>
å¤„ï¼Œè°ƒç”¨

/#createDefaultProperties(ConfigurableEnvironment environment)
æ–¹æ³•ï¼Œç”Ÿæˆ Dubbo é»˜è®¤é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboDefaultPropertiesEnvironmentPostProcessor.java
//*/*
/* The property name of Spring Application
/*
/* @see ContextIdApplicationContextInitializer
/*/
private static final String SPRING_APPLICATION_NAME_PROPERTY = "spring.application.name";
//*/*
/* The property name of {@link ApplicationConfig}
/*
/* @see EnableDubboConfig
/* @see EnableDubboConfigBinding
/*/
private static final String DUBBO_APPLICATION_NAME_PROPERTY = "dubbo.application.name";
//*/*
/* The property name of {@link EnableDubboConfig/#multiple() @EnableDubboConfig.multiple()}
/*/
private static final String DUBBO_CONFIG_MULTIPLE_PROPERTY = "dubbo.config.multiple";
//*/*
/* The property name of {@link ApplicationConfig/#getQosEnable() application's QOS enable}
/*/
private static final String DUBBO_APPLICATION_QOS_ENABLE_PROPERTY = "dubbo.application.qos-enable";
private Map<String, Object> createDefaultProperties(ConfigurableEnvironment environment){
Map<String, Object> defaultProperties = new HashMap<String, Object>();
// "dubbo.application.name"
setDubboApplicationNameProperty(environment, defaultProperties);
// "dubbo.config.multiple"
setDubboConfigMultipleProperty(defaultProperties);
// "dubbo.application.qos-enable"
setDubboApplicationQosEnableProperty(defaultProperties);
return defaultProperties;
}
private void setDubboApplicationNameProperty(Environment environment, Map<String, Object> defaultProperties){
String springApplicationName = environment.getProperty(SPRING_APPLICATION_NAME_PROPERTY);
if (StringUtils.hasLength(springApplicationName)
&& !environment.containsProperty(DUBBO_APPLICATION_NAME_PROPERTY)) {
defaultProperties.put(DUBBO_APPLICATION_NAME_PROPERTY, springApplicationName);
}
}
private void setDubboConfigMultipleProperty(Map<String, Object> defaultProperties){
defaultProperties.put(DUBBO_CONFIG_MULTIPLE_PROPERTY, Boolean.TRUE.toString());
}
private void setDubboApplicationQosEnableProperty(Map<String, Object> defaultProperties){
defaultProperties.put(DUBBO_APPLICATION_QOS_ENABLE_PROPERTY, Boolean.FALSE.toString());
}
```

* è™½ç„¶æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯æ¯”è¾ƒç®€å•ã€‚
* <2>
å¤„ï¼Œæœ‰ Dubbo é»˜è®¤é…ç½®ï¼Œåˆ™æ·»åŠ åˆ°

environment
ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboDefaultPropertiesEnvironmentPostProcessor.java
private static final String PROPERTY_SOURCE_NAME = "defaultProperties";
private void addOrReplace(MutablePropertySources propertySources, Map<String, Object> map){
// æƒ…å†µä¸€ï¼Œè·å¾—åˆ° "defaultProperties" å¯¹åº”çš„ PropertySource å¯¹è±¡ï¼Œåˆ™è¿›è¡Œæ›¿æ¢
MapPropertySource target = null;
if (propertySources.contains(PROPERTY_SOURCE_NAME)) {
PropertySource<?> source = propertySources.get(PROPERTY_SOURCE_NAME);
if (source instanceof MapPropertySource) { // æ‰¾åˆ°
target = (MapPropertySource) source;
// éå† map æ•°ç»„ï¼Œè¿›è¡Œæ›¿æ¢åˆ° "defaultProperties" ä¸­
for (String key : map.keySet()) {
if (!target.containsProperty(key)) {
target.getSource().put(key, map.get(key));
}
}
}
}
// æƒ…å†µäºŒï¼Œä¸å­˜åœ¨ "defaultProperties" å¯¹åº”çš„ PropertySource å¯¹è±¡ï¼Œåˆ™è¿›è¡Œæ·»åŠ 
if (target == null) {
target = new MapPropertySource(PROPERTY_SOURCE_NAME, map);
}
if (!propertySources.contains(PROPERTY_SOURCE_NAME)) {
propertySources.addLast(target);
}
}
```

* åˆ†æˆä¸¤ç§æƒ…å†µï¼Œä¹Ÿæ¯”è¾ƒç®€å•ã€‚èƒ–å‹è‡ªå·±ç…ç…~
å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯

context.event
åŒ…ä¸‹ã€‚

## 4.4 WelcomeLogoApplicationListener

com.alibaba.boot.dubbo.context.event.WelcomeLogoApplicationListener
ï¼Œå®ç° ApplicationListener æ¥å£ï¼Œå¤„ç† ApplicationEnvironmentPreparedEvent äº‹ä»¶ï¼Œä»è€Œæ‰“å° Dubbo Banner æ–‡æœ¬ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// WelcomeLogoApplicationListener.java
@Order(LoggingApplicationListener.DEFAULT_ORDER + 1)
public class WelcomeLogoApplicationListener implements ApplicationListener<ApplicationEnvironmentPreparedEvent>{
//*/*
/* æ˜¯å¦æ‰§è¡Œè¿‡
/*
/* é€šè¿‡è¯¥å˜é‡ï¼Œä¿è¯æœ‰ä¸”ä»…å¤„ç†ä¸€æ¬¡ ApplicationEnvironmentPreparedEvent äº‹ä»¶
/*/
private static AtomicBoolean processed = new AtomicBoolean(false);
@Override
public void onApplicationEvent(ApplicationEnvironmentPreparedEvent event){
// Skip if processed before, prevent duplicated execution in Hierarchical ApplicationContext
// å¦‚æœå·²ç»å¤„ç†ï¼Œåˆ™ç›´æ¥è·³è¿‡
if (processed.get()) {
return;
}
// è·å¾— Logger å¯¹è±¡
//*/*
/* Gets Logger After LoggingSystem configuration ready
/* @see LoggingApplicationListener
/*/
final Logger logger = LoggerFactory.getLogger(getClass());
// è·å¾— Dubbo Banner æ–‡æœ¬
String bannerText = buildBannerText();
if (logger.isInfoEnabled()) {
logger.info(bannerText);
} else {
System.out.print(bannerText);
}
// mark processed to be true
// æ ‡è®°å·²æ‰§è¡Œ
processed.compareAndSet(false, true);
}
String buildBannerText(){
StringBuilder bannerTextBuilder = new StringBuilder();
bannerTextBuilder
.append(LINE_SEPARATOR)
.append(LINE_SEPARATOR)
.append(" :: Dubbo Spring Boot (v").append(Version.getVersion(getClass(), "1.0.0")).append(") : ")
.append(DUBBO_SPRING_BOOT_GITHUB_URL)
.append(LINE_SEPARATOR)
.append(" :: Dubbo (v").append(Version.getVersion()).append(") : ")
.append(DUBBO_GITHUB_URL)
.append(LINE_SEPARATOR)
.append(" :: Discuss group : ")
.append(DUBBO_MAILING_LIST)
.append(LINE_SEPARATOR);
return bannerTextBuilder.toString();
}
}
```

* ç®€å•ï¼Œå°±ä¸å¤šåšè§£é‡Šäº†ã€‚

## 4.5 OverrideDubboConfigApplicationListener

com.alibaba.boot.dubbo.context.event.OverrideDubboConfigApplicationListener
ï¼Œå®ç° ApplicationListener æ¥å£ï¼Œä¹Ÿæ˜¯å¤„ç† ApplicationEnvironmentPreparedEvent äº‹ä»¶ï¼Œæ ¹æ®

"dubbo.config.override"
çš„å±æ€§å€¼ï¼Œè‹¥ä¸º

true
æ—¶ï¼Œåˆ™è¦†ç›–

environment
ä¸­

"dubbo."
å¼€å¤´çš„é…ç½®ï¼Œæ·»åŠ åˆ° Dubbo Properties å¯¹è±¡ä¸­ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// OverrideDubboConfigApplicationListener.java
@Order // LOWEST_PRECEDENCE Make sure last execution
public class OverrideDubboConfigApplicationListener implements ApplicationListener<ApplicationEnvironmentPreparedEvent>{
@Override
public void onApplicationEvent(ApplicationEnvironmentPreparedEvent event){
// è·å¾— Logger å¯¹è±¡
//*/*
/* Gets Logger After LoggingSystem configuration ready
/* @see LoggingApplicationListener
/*/
final Logger logger = LoggerFactory.getLogger(getClass());
// <1> è·å¾— "dubbo.config.override" å±æ€§å¯¹åº”çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º true
ConfigurableEnvironment environment = event.getEnvironment();
boolean override = environment.getProperty(OVERRIDE_CONFIG_PROPERTY_NAME, boolean.class, DEFAULT_OVERRIDE_CONFIG_PROPERTY_VALUE);
// <2> å¦‚æœè¦é‡å†™ï¼Œåˆ™è¦†ç›–æ·»åŠ åˆ° Dubbo Properties ä¸­
if (override) {
// <2.1> ä» environment ä¸­ï¼Œæå– "dubbo." å¼€å¤´çš„é…ç½®
SortedMap<String, Object> dubboProperties = filterDubboProperties(environment);
// <2.2> æ·»åŠ åˆ° Dubbo Properties ä¸­
ConfigUtils.getProperties().putAll(dubboProperties);
if (logger.isInfoEnabled()) {
logger.info("Dubbo Config was overridden by externalized configuration {}", dubboProperties);
}
} else {
if (logger.isInfoEnabled()) {
logger.info("Disable override Dubbo Config caused by property {} = {}", OVERRIDE_CONFIG_PROPERTY_NAME, override);
}
}
}
}
```

* <1>
å¤„ï¼Œè·å¾—

"dubbo.config.override"
å±æ€§å¯¹åº”çš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸º

true
ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboUtils.java
//*/*
/* The property name of override Dubbo config
/* <p>
/* The default value is {@link /#DEFAULT_OVERRIDE_CONFIG_PROPERTY_VALUE}
/*/
public static final String OVERRIDE_CONFIG_PROPERTY_NAME = DUBBO_CONFIG_PREFIX + PROPERTY_NAME_SEPARATOR + "override";
//*/*
/* The default property value of override Dubbo config
/*/
public static final boolean DEFAULT_OVERRIDE_CONFIG_PROPERTY_VALUE = true;
```
* <2>
å¤„ï¼Œå¦‚æœè¦é‡å†™ï¼Œåˆ™è¦†ç›–æ·»åŠ åˆ° Dubbo Properties ä¸­ã€‚
* <2.1>
å¤„ï¼Œè°ƒç”¨

DubboUtils/#filterDubboProperties(ConfigurableEnvironment environment)
æ–¹æ³•ï¼Œä»

environment
ä¸­ï¼Œæå–

"dubbo."
å¼€å¤´çš„é…ç½®ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboUtils.java
//*/*
/* The separator of property name
/*/
public static final String PROPERTY_NAME_SEPARATOR = ".";
//*/*
/* The prefix of property name of Dubbo
/*/
public static final String DUBBO_PREFIX = "dubbo";
//*/*
/* Filters Dubbo Properties from {@link ConfigurableEnvironment}
/*
/* @param environment {@link ConfigurableEnvironment}
/* @return Read-only SortedMap
/*/
public static SortedMap<String, Object> filterDubboProperties(ConfigurableEnvironment environment){
SortedMap<String, Object> dubboProperties = new TreeMap<>();
// è·å¾—æ‰€æœ‰çš„é…ç½®
Map<String, Object> properties = EnvironmentUtils.extractProperties(environment);
// éå†é…ç½®ï¼Œå¦‚æœä»¥ "dubbo." å¼€å¤´ï¼Œåˆ™æ·»åŠ åˆ° dubboProperties ä¸­
for (Map.Entry<String, Object> entry : properties.entrySet()) {
String propertyName = entry.getKey();
if (propertyName.startsWith(DUBBO_PREFIX + PROPERTY_NAME_SEPARATOR)
&& entry.getValue() != null) {
dubboProperties.put(propertyName, entry.getValue().toString());
}
}
// è¿”å› dubboProperties
return Collections.unmodifiableSortedMap(dubboProperties);
}
```

* å…¶ä¸­ï¼Œ

EnvironmentUtils/#extractProperties(ConfigurableEnvironment environment)
æ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰çš„é…ç½®ã€‚è€ƒè™‘åˆ°ç¯‡å¹…å°±ä¸èµ˜è¿°ï¼Œè‰¿è‰¿å·²ç»æ·»åŠ æ³¨é‡Šï¼Œç‚¹å‡» [é“¾æ¥](https://github.com/YunaiV/incubator-dubbo-spring-boot-project/blob/master/dubbo-spring-boot-autoconfigure/src/main/java/com/alibaba/boot/dubbo/util/EnvironmentUtils.java) æŸ¥çœ‹ã€‚
* <2.2>
å¤„ï¼Œè°ƒç”¨ Dubbo çš„

ConfigUtils/#getProperties()
æ–¹æ³•ï¼Œè·å¾— Dubbo Properties ã€‚ç„¶åå†å°†

dubboProperties
å˜é‡ï¼Œæ·»åŠ åˆ° Dubbo Properties ä¸­ã€‚

## 4.6 AwaitingNonWebApplicationListener

com.alibaba.boot.dubbo.context.event.AwaitingNonWebApplicationListener
ï¼Œå®ç° SmartApplicationListener æ¥å£ï¼Œå®ç°åœ¨é Web çš„ç¯å¢ƒä¸‹ï¼Œæä¾› JVM ä¸é€€å‡ºå…³é—­çš„åŠŸèƒ½ï¼Œå³ JVM ä¸€ç›´è¿è¡Œç€ã€‚
èƒ–å‹å¯ä»¥è¯•è¯•ï¼Œå¯åŠ¨ä¸€ä¸ªé Web ç¯å¢ƒçš„ Spring Boot åº”ç”¨ï¼Œç„¶åä¼šå‘ç°ï¼ŒJVM ä¼šåœ¨å¯åŠ¨å®Œ Spring Boot åº”ç”¨åï¼Œè‡ªåŠ¨å…³é—­ã€‚

### 4.6.1 supportsEventType

å®ç°

/#supportsEventType(Class<? extends ApplicationEvent> eventType)
æ–¹æ³•ï¼Œåˆ¤æ–­æ”¯æŒçš„äº‹ä»¶ç±»å‹æ˜¯ ApplicationReadyEvent å’Œ ContextClosedEvent ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AwaitingNonWebApplicationListener.java
private static final Class<? extends ApplicationEvent>[] SUPPORTED_APPLICATION_EVENTS =
of(ApplicationReadyEvent.class, ContextClosedEvent.class);
@Override
public boolean supportsEventType(Class<? extends ApplicationEvent> eventType){
return ObjectUtils.containsElement(SUPPORTED_APPLICATION_EVENTS, eventType);
}
private static <T> T[] of(T... values) {
return values;
}
```

* ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚

### 4.6.2 supportsSourceType

å®ç°

/#supportsSourceType(Class<?> sourceType)
æ–¹æ³•ï¼Œåˆ¤æ–­æ”¯æŒçš„äº‹ä»¶æ¥æºã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AwaitingNonWebApplicationListener.java
@Override
public boolean supportsSourceType(Class<?> sourceType){
return true;
}
```

* å…¨éƒ¨è¿”å›

true
ï¼Œæ„å‘³æ”¯æŒæ‰€æœ‰çš„äº‹ä»¶æ¥æºã€‚

### 4.6.3 onApplicationEvent

```
// AwaitingNonWebApplicationListener.java
@Override
public void onApplicationEvent(ApplicationEvent event){
if (event instanceof ApplicationReadyEvent) {
onApplicationReadyEvent((ApplicationReadyEvent) event); // <1>
} else if (event instanceof ContextClosedEvent) {
onContextClosedEvent((ContextClosedEvent) event); // <2>
}
}
```

* <1>
å¤„ï¼Œå½“æ˜¯ ApplicationReadyEvent äº‹ä»¶æ—¶ï¼Œè°ƒç”¨

/#onApplicationReadyEvent(ApplicationReadyEvent event)
æ–¹æ³•ï¼Œå¤„ç† ApplicationReadyEvent äº‹ä»¶ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ4.6.3.1 onApplicationReadyEventã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/) ã€‚
* <2>
å¤„ï¼Œå½“æ˜¯ ContextClosedEvent äº‹ä»¶æ—¶ï¼Œè°ƒç”¨

/#onApplicationReadyEvent(ContextClosedEvent event)
æ–¹æ³•ï¼Œå¤„ç† ApplicationReadyEvent äº‹ä»¶ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ4.6.3.2 onContextClosedEventã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/) ã€‚

### 4.6.3.1 onApplicationReadyEvent

/#onApplicationReadyEvent(ApplicationReadyEvent event)
æ–¹æ³•ï¼Œå¤„ç† ApplicationReadyEvent äº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AwaitingNonWebApplicationListener.java
protected void onApplicationReadyEvent(ApplicationReadyEvent event){
// <1> å¦‚æœæ˜¯ Web ç¯å¢ƒï¼Œåˆ™ç›´æ¥è¿”å›
final SpringApplication springApplication = event.getSpringApplication();
if (!WebApplicationType.NONE.equals(springApplication.getWebApplicationType())) {
return;
}
// <2> å¯åŠ¨ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ï¼Œä»è€Œå®ç°ç­‰å¾…
await();
}
```

* <1>
å¤„ï¼Œå¦‚æœæ˜¯ Web ç¯å¢ƒï¼Œåˆ™ç›´æ¥è¿”å›ã€‚å› ä¸ºï¼Œå·²ç»æä¾›äº† JVM ä¸é€€å‡ºå…³é—­çš„åŠŸèƒ½ã€‚
* <2>
å¤„ï¼Œè°ƒç”¨

/#await()
æ–¹æ³•ï¼Œå¯åŠ¨ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ï¼Œä»è€Œå®ç°ç­‰å¾…ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AwaitingNonWebApplicationListener.java
//*/*
/* æ˜¯å¦å·²ç»ç­‰å¾…å®Œæˆ
/*/
private static final AtomicBoolean awaited = new AtomicBoolean(false);
private final Lock lock = new ReentrantLock();
private final Condition condition = lock.newCondition();
private final ExecutorService executorService = Executors.newSingleThreadExecutor();
protected void await(){
// has been waited, return immediately
// å¦‚æœå·²ç»å¤„äºé˜»å¡ç­‰å¾…ï¼Œç›´æ¥è¿”å›
if (awaited.get()) {
return;
}
// åˆ›å»ºä»»åŠ¡ï¼Œå®ç°é˜»å¡
executorService.execute(() -> executeMutually(() -> {
while (!awaited.get()) {
if (logger.isInfoEnabled()) {
logger.info(" [Dubbo] Current Spring Boot Application is await...");
}
try {
condition.await();
} catch (InterruptedException e) {
Thread.currentThread().interrupt();
}
}
}));
}
private void executeMutually(Runnable runnable){
try {
lock.lock();
// <X> æ‰§è¡Œ Runnable
runnable.run();
} finally {
lock.unlock();
}
}
```

* åŸºäº Lock + Condition å®ç°ç­‰å¾…é€šçŸ¥ã€‚
* /#executeMutually(Runnable runnable)
æ–¹æ³•ï¼Œè¢«

executorService
åˆ›å»ºä»»åŠ¡æ‰€è°ƒç”¨ã€‚è€Œè¯¥ä»»åŠ¡å› ä¸ºè°ƒç”¨

Condition/#await()
æ–¹æ³•ï¼Œé˜»å¡ç­‰å¾…ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼ŒJVM è‡³å°‘æœ‰ä¸€ä¸ªè¯¥ç”¨æˆ·çº¿ç¨‹æœªè¿è¡Œç»“æŸï¼Œé‚£ä¹ˆæ­¤æ—¶ [JVM å…³é—­çš„æ¡ä»¶](https://blog.csdn.net/hongxingxiaonan/article/details/50528041) ä¸è¢«æ»¡è¶³ï¼Œæ‰€ä»¥å°±ä¸ä¼šé€€å‡ºã€‚

### 4.6.3.2 onApplicationReadyEvent

/#onApplicationReadyEvent(ContextClosedEvent event)
æ–¹æ³•ï¼Œå¤„ç† ContextClosedEvent äº‹ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AwaitingNonWebApplicationListener.java
protected void onContextClosedEvent(ContextClosedEvent event){
// <1> é‡Šæ”¾
release();
// <2> å…³é—­çº¿ç¨‹æ± 
shutdown();
}
```

* <1>
å¤„ï¼Œè°ƒç”¨

/#release()
æ–¹æ³•ï¼Œè¿›è¡Œé‡Šæ”¾ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AwaitingNonWebApplicationListener.java
protected void release(){
executeMutually(() -> {
// CAS è®¾ç½® awaited ä¸º true
while (awaited.compareAndSet(false, true)) {
if (logger.isInfoEnabled()) {
logger.info(" [Dubbo] Current Spring Boot Application is about to shutdown...");
}
// é€šçŸ¥ Condition
condition.signalAll();
}
});
}
```

* é€šè¿‡è°ƒç”¨

Condition/#signalAll()
æ–¹æ³•ï¼Œé€šçŸ¥ Condition ã€‚ä»è€Œåœ¨ [ã€Œ4.6.3.1 onApplicationReadyEventã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/)ä¸­ï¼Œå¯åŠ¨çš„çº¿ç¨‹çš„é˜»å¡ï¼Œè¿›è¡Œåœæ­¢ã€‚
* <2>
å¤„ï¼Œè°ƒç”¨

/#shutdown()
æ–¹æ³•ï¼Œå…³é—­çº¿ç¨‹æ± ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AwaitingNonWebApplicationListener.java
private void shutdown(){
if (!executorService.isShutdown()) {
// Shutdown executorService
executorService.shutdown();
}
}
```

# 5.

dubbo-spring-boot-actuator
æºç 

dubbo-spring-boot-autoconfigure
æ¨¡å—ï¼Œæ‰€æœ‰ç±»å¦‚ä¸‹å›¾ï¼š![`dubbo-spring-boot-autoconfigure` æ¨¡å—](http://static2.iocoder.cn/images/Dubbo/2019_02_11/09.jpg)

## 5.1 ä½¿ç”¨æŒ‡å—

ä½¿ç”¨æ—¶ï¼Œéœ€è¦å¯¼å…¥

dubbo-spring-boot-actuator
ä¾èµ–ã€‚å³å¦‚ä¸‹ï¼š
```
<!-- å¯¼å…¥ WEB ç¯å¢ƒ -->
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-web</artifactId>
</dependency>
<!-- å¯¼å…¥ Spring Boot Actuator -->
<dependency>
<groupId>org.springframework.boot</groupId>
<artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
<!-- å¯¼å…¥ Dubbo Spring Boot Actuator -->
<dependency>
<groupId>com.alibaba.boot</groupId>
<artifactId>dubbo-spring-boot-actuator</artifactId>
</dependency>
```

è§‚çœ‹æœ¬å°èŠ‚ï¼Œèƒ–å‹éœ€è¦å¯¹ Spring Boot Actuator æœ‰ç›¸å…³çš„äº†è§£ã€‚å¦‚æœä¸çŸ¥é“ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šä¸€èµ·æ¥å­¦ SpringBoot 2.x | ç¬¬åå››ç¯‡ï¼šå¼ºå¤§çš„ Actuator æœåŠ¡ç›‘æ§ä¸ç®¡ç†ã€‹](http://www.iocoder.cn/Spring-Boot/battcn/v2-actuator-introduce/) æ–‡ç« ã€‚

å¦å¤–ï¼Œ[ã€ŠDubbo å®˜æ–¹æ–‡æ¡£ â€”â€” Dubbo Spring Boot Production-Readyã€‹](https://github.com/apache/incubator-dubbo-spring-boot-project/tree/master/dubbo-spring-boot-actuator) æ–‡ç« ï¼Œä¹Ÿæ˜¯éœ€è¦å…ˆç…ç…çš„ã€‚

å¦‚æœèƒ–å‹ä½¿ç”¨çš„æ˜¯ Spring Boot 2ï¼Œæœ‰ä¸€ä¸ªå‘è¦æ³¨æ„ï¼Œå› ä¸º [ã€ŠSpring Boot 2.0 çš„ Actuator åªæš´éœ² health å’Œ infoã€‹](https://blog.csdn.net/qq_20367813/article/details/79154981) ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œæ·»åŠ è¦å¼€å¯çš„ Dubbo Endpoint ã€‚ä¾‹å¦‚ï¼š
```
/# application.properties
management.endpoints.web.exposure.include=health,info,dubbo,dubboconfigs
```

* æ­¤æ—¶ï¼Œæˆ‘ä»¬å¤šå¼€å¯äº†

dubbo
å’Œ

dubboconfigs
è¿™ä¸¤ä¸ª EndPoint ã€‚T T å‘äº†è‡ªå·±å¥½ä¹…~
å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯

autoconfigure
åŒ…ä¸‹ã€‚

## 5.2 DubboEndpointsAutoConfiguration

com.alibaba.boot.dubbo.actuate.autoconfigure.DubboEndpointsAutoConfiguration
ï¼ŒDubbo Endpoint è‡ªåŠ¨é…ç½®ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboEndpointsAutoConfiguration.java
@Configuration
@PropertySource(
name = "Dubbo Endpoints Default Properties",
value = "classpath:/META-INF/dubbo-endpoins-default.properties") // å¯¼å…¥è¯¥é…ç½®æ–‡ä»¶
public class DubboEndpointsAutoConfiguration{
@Bean
@ConditionalOnMissingBean
@ConditionalOnEnabledEndpoint
public DubboEndpoint dubboEndpoint(){
return new DubboEndpoint();
}
@Bean
@ConditionalOnMissingBean
@ConditionalOnEnabledEndpoint
public DubboConfigsMetadataEndpoint dubboConfigsMetadataEndpoint(){
return new DubboConfigsMetadataEndpoint();
}
@Bean
@ConditionalOnMissingBean
@ConditionalOnEnabledEndpoint
public DubboPropertiesEndpoint dubboPropertiesEndpoint(){
return new DubboPropertiesEndpoint();
}
@Bean
@ConditionalOnMissingBean
@ConditionalOnEnabledEndpoint
public DubboReferencesMetadataEndpoint dubboReferencesMetadataEndpoint(){
return new DubboReferencesMetadataEndpoint();
}
@Bean
@ConditionalOnMissingBean
@ConditionalOnEnabledEndpoint
public DubboServicesMetadataEndpoint dubboServicesMetadataEndpoint(){
return new DubboServicesMetadataEndpoint();
}
@Bean
@ConditionalOnMissingBean
@ConditionalOnEnabledEndpoint
public DubboShutdownEndpoint dubboShutdownEndpoint(){
return new DubboShutdownEndpoint();
}
}
```

* æ¯ä¸ªæ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª Dubbo Endpint Bean ã€‚ä¸€å…±æœ‰ 6 ä¸ªã€‚
* @PropertySource
æ³¨è§£ï¼Œå¯¼å…¥

"classpath:/META-INF/dubbo-endpoins-default.properties"
é…ç½®æ–‡ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š  ```
/# dubbo-endpoins-default.properties
/# Dubbo Endpoints Default Properties is loaded by @PropertySource with low order,
/# those values of properties can be override by higher PropertySource
/# @see DubboEndpointsAutoConfiguration
/# Set enabled for Dubbo Endpoints è®¾ç½® Dubbo Endpoints æ˜¯å¦å¼€å¯
management.endpoint.dubbo.enabled = true
management.endpoint.dubboshutdown.enabled = false
management.endpoint.dubboconfigs.enabled = true
management.endpoint.dubboservices.enabled = false
management.endpoint.dubboreferences.enabled = false
management.endpoint.dubboproperties.enabled = true
/# "management.endpoints.web.base-path" should not be configured in this file
/# Re-defines path-mapping of Dubbo Web Endpoints é‡å‘½å Dubbo Web Endpoints è·¯å¾„
management.endpoints.web.path-mapping.dubboshutdown = dubbo/shutdown
management.endpoints.web.path-mapping.dubboconfigs = dubbo/configs
management.endpoints.web.path-mapping.dubboservices = dubbo/services
management.endpoints.web.path-mapping.dubboreferences = dubbo/references
management.endpoints.web.path-mapping.dubboproperties = dubbo/properties
```

## 5.3 DubboHealthIndicatorAutoConfiguration

com.alibaba.boot.dubbo.actuate.autoconfigure.DubboHealthIndicatorAutoConfiguration
ï¼ŒDubbo Health Indicator è‡ªåŠ¨é…ç½®ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboHealthIndicatorAutoConfiguration.java
@Configuration
@ConditionalOnClass({HealthIndicator.class}) // å­˜åœ¨ HealthIndicator ç±»çš„æƒ…å†µ
@AutoConfigureBefore({EndpointAutoConfiguration.class}) // åœ¨ EndpointAutoConfiguration è‡ªåŠ¨é…ç½®ç±»ä¹‹å‰åˆå§‹åŒ–
@AutoConfigureAfter(DubboAutoConfiguration.class) // åœ¨ DubboAutoConfiguration è‡ªåŠ¨é…ç½®ç±»ä¹‹ååˆå§‹åŒ–
@ConditionalOnEnabledHealthIndicator("dubbo")
@EnableConfigurationProperties(DubboHealthIndicatorProperties.class) // è‡ªåŠ¨é…ç½® DubboHealthIndicatorProperties ç±»
public class DubboHealthIndicatorAutoConfiguration{
@Bean
@ConditionalOnMissingBean
public DubboHealthIndicator dubboHealthIndicator(){
return new DubboHealthIndicator();
}
}
```

* æ¯ä¸ªæ³¨è§£ï¼Œçœ‹åé¢çš„ä»£ç æ³¨é‡Šã€‚
* å”¯ä¸€çš„æ–¹æ³•ï¼Œåˆ›å»º DubboHealthIndicator Bean å¯¹è±¡ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ5.5 DubboHealthIndicatorã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/) ã€‚

## 5.4 DubboHealthIndicatorProperties

com.alibaba.boot.dubbo.actuate.health.DubboHealthIndicatorProperties
ï¼ŒDubbo Health Indicator Properties ç±»ã€‚ä»£ç ä»£ç å¦‚ä¸‹ï¼š
```
// DubboHealthIndicatorProperties.java
@ConfigurationProperties(prefix = PREFIX, ignoreUnknownFields = false) // "management.health.dubbo" å¼€å¤´çš„é…ç½®
public class DubboHealthIndicatorProperties{
//*/*
/* The prefix of {@link DubboHealthIndicatorProperties}
/*/
public static final String PREFIX = "management.health.dubbo";
private Status status = new Status();
// ... çœç•¥ setting/getting æ–¹æ³•
//*/*
/* The nested class for {@link StatusChecker}'s names
/* <pre>
/* registry=com.alibaba.dubbo.registry.status.RegistryStatusChecker
/* spring=com.alibaba.dubbo.config.spring.status.SpringStatusChecker
/* datasource=com.alibaba.dubbo.config.spring.status.DataSourceStatusChecker
/* memory=com.alibaba.dubbo.common.status.support.MemoryStatusChecker
/* load=com.alibaba.dubbo.common.status.support.LoadStatusChecker
/* server=com.alibaba.dubbo.rpc.protocol.dubbo.status.ServerStatusChecker
/* threadpool=com.alibaba.dubbo.rpc.protocol.dubbo.status.ThreadPoolStatusChecker
/* </pre>
/*
/* @see StatusChecker
/*/
public static class Status{
//*/*
/* The defaults names of {@link StatusChecker}
/* <p>
/* The defaults : "memory", "load"
/*/
private Set<String> defaults = new LinkedHashSet<>(Arrays.asList("memory", "load"));
//*/*
/* The extra names of {@link StatusChecker}
/*
/* é…ç½®çš„ "management.health.dubbo.extras" é›†åˆ
/*
/* æ¯ä¸ªå…ƒç´ ï¼Œæ˜¯ StatusChecker çš„å®ç°ç±»
/*/
private Set<String> extras = new LinkedHashSet<>();
// ... çœç•¥ setting/getting æ–¹æ³•
}
}
```

* è¯»å–ä»¥

"management.health.dubbo"
å¼€å¤´çš„é…ç½®ã€‚
å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯

health
åŒ…ä¸‹ã€‚

## 5.5 DubboHealthIndicator

com.alibaba.boot.dubbo.actuate.health.DubboHealthIndicator
ï¼Œç»§æ‰¿ AbstractHealthIndicator æŠ½è±¡ç±»ï¼ŒDubbo Health Indicator å®ç°ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š

### 5.4.1 doHealthCheck

å®ç°

/#doHealthCheck(Health.Builder builder)
æ–¹æ³•ï¼Œæ‰§è¡Œå¥åº·æ£€æŸ¥ã€‚ä»£ç å¦‚ä¸‹ï¼š
åœ¨è¯·æ±‚

/actuator/health
æ¥å£æ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚
  ```
// DubboHealthIndicator.java
@Override
protected void doHealthCheck(Health.Builder builder) throws Exception{
// <1> è·å¾— StatusChecker å¯¹åº”çš„ Dubbo ExtensionLoader å¯¹è±¡
ExtensionLoader<StatusChecker> extensionLoader = getExtensionLoader(StatusChecker.class);
// <2> è§£æ StatusChecker çš„åå­—çš„ Map
Map<String, String> statusCheckerNamesMap = resolveStatusCheckerNamesMap();
// <3> å£°æ˜ hasErrorã€hasUnknown å˜é‡
boolean hasError = false; // æ˜¯å¦æœ‰é”™è¯¯çš„è¿”å›
boolean hasUnknown = false; // æ˜¯å¦æœ‰æœªçŸ¥çš„è¿”å›
// Up first
// <4> å…ˆ builder æ ‡è®°çŠ¶æ€æ˜¯ UP
builder.up();
// <5> éå† statusCheckerNamesMap å…ƒç´ 
for (Map.Entry<String, String> entry : statusCheckerNamesMap.entrySet()) {
// <6.1> è·å¾— StatusChecker çš„åå­—
String statusCheckerName = entry.getKey();
// <6.2> è·å¾— source
String source = entry.getValue();
// <6.3> è·å¾— StatusChecker å¯¹è±¡
StatusChecker checker = extensionLoader.getExtension(statusCheckerName);
// <6.4> æ‰§è¡Œæ ¡éªŒ
com.alibaba.dubbo.common.status.Status status = checker.check();
// <7.1> è·å¾—æ ¡éªŒç»“æœ
com.alibaba.dubbo.common.status.Status.Level level = status.getLevel();
// <7.2> å¦‚æœæ˜¯ ERROR æ£€éªŒç»“æœï¼Œåˆ™æ ‡è®° hasError ä¸º true ï¼Œå¹¶æ ‡è®° builder çŠ¶æ€ä¸º down
if (!hasError // ä¸å­˜åœ¨ hasError çš„æ—¶å€™
&& level.equals(com.alibaba.dubbo.common.status.Status.Level.ERROR)) {
hasError = true;
builder.down();
}
// <7.3> å¦‚æœæ˜¯ UNKNOWN æ£€éªŒç»“æœï¼Œåˆ™æ ‡è®° hasUnknown ä¸º true ï¼Œå¹¶æ ‡è®° builder çŠ¶æ€ä¸º unknown
if (!hasError && !hasUnknown // ä¸å­˜åœ¨ hasError ä¸”ä¸å­˜åœ¨ hasUnknown
&& level.equals(com.alibaba.dubbo.common.status.Status.Level.UNKNOWN)) {
hasUnknown = true;
builder.unknown();
}
// <8.1> åˆ›å»º detail Map
Map<String, Object> detail = new LinkedHashMap<>();
// <8.2> è®¾ç½® detail å±æ€§å€¼
detail.put("source", source);
detail.put("status", status); // æ ¡éªŒç»“æœ
// <8.3> æ·»åŠ åˆ° builder ä¸­
builder.withDetail(statusCheckerName, detail);
}
}
```

* å¤§ä½“æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹é¡ºç€æ³¨é‡Šæ¥ç…ç…å³å¯ã€‚
* <2>
å¤„ï¼Œè°ƒç”¨

/#resolveStatusCheckerNamesMap()
æ–¹æ³•ï¼Œè§£æ StatusChecker çš„åå­—çš„ Map ã€‚å› ä¸ºè¿™ä¸ªå¯¹åç»­é€»è¾‘éå¸¸å…³é”®ï¼Œæ‰€ä»¥èƒ–å‹å…ˆè·³åˆ° [ã€Œ5.4.2 resolveStatusCheckerNamesMapã€](http://svip.iocoder.cn/Dubbo/configuration-Externalized/) ä¸­ã€‚çœ‹å®Œä¹‹åï¼Œåœ¨å›åˆ°æ­¤å¤„ã€‚
* æœ€ç»ˆè¿”å›

builder
çš„ç»“æœï¼Œå¦‚ä¸‹å›¾ï¼š![`builder` ç»“æœ](http://static2.iocoder.cn/images/Dubbo/2019_02_11/11.jpg)

### 5.4.2 resolveStatusCheckerNamesMap

/#resolveStatusCheckerNamesMap()
æ–¹æ³•ï¼Œè§£æ StatusChecker çš„åå­—çš„ Mapã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboHealthIndicator.java
//*/*
/* Resolves the map of {@link StatusChecker}'s name and its' source.
/*
/* è§£æ StatusChecker çš„åå­—çš„ Map
/*
/* KEYï¼šStatusChecker çš„åå­—
/* VALUEï¼šé…ç½®çš„æ¥æº
/*
/* @return non-null {@link Map}
/*/
protected Map<String, String> resolveStatusCheckerNamesMap(){
// åˆ›å»º Map
Map<String, String> statusCheckerNamesMap = new LinkedHashMap<>();
// <1> ä» DubboHealthIndicatorProperties ä¸­è·å–
statusCheckerNamesMap.putAll(resolveStatusCheckerNamesMapFromDubboHealthIndicatorProperties());
// <2> ä» ProtocolConfig ä¸­è·å–
statusCheckerNamesMap.putAll(resolveStatusCheckerNamesMapFromProtocolConfigs());
// <3> ä» ProviderConfig ä¸­è·å–
statusCheckerNamesMap.putAll(resolveStatusCheckerNamesMapFromProviderConfig());
return statusCheckerNamesMap;
}
```

* <1>
å¤„ï¼Œè°ƒç”¨

/#resolveStatusCheckerNamesMapFromDubboHealthIndicatorProperties()
æ–¹æ³•ï¼Œä» DubboHealthIndicatorProperties ä¸­è·å–ã€‚ä»£ç å¦‚ä¸‹ï¼š  ```
// DubboHealthIndicator.java
@Autowired
private DubboHealthIndicatorProperties dubboHealthIndicatorProperties;
private Map<String, String> resolveStatusCheckerNamesMapFromDubboHealthIndicatorProperties(){
// è·å¾— DubboHealthIndicatorProperties.Status
DubboHealthIndicatorProperties.Status status = dubboHealthIndicatorProperties.getStatus();
// åˆ›å»º Map
Map<String, String> statusCheckerNamesMap = new LinkedHashMap<>();
// 1. è¯»å– defaults å±æ€§
for (String statusName : status.getDefaults()) {
statusCheckerNamesMap.put(statusName, PREFIX + ".status.defaults");
}
// 2. è¯»å– extras å±æ€§
for (String statusName : status.getExtras()) {
statusCheckerNamesMap.put(statusName, PREFIX + ".status.extras");
}
return statusCheckerNamesMap;
}
```

* <2>
å¤„ï¼Œè°ƒç”¨

/#resolveStatusCheckerNamesMapFromProtocolConfigs()
æ–¹æ³•ï¼Œä» ProtocolConfig ä¸­è·å–ã€‚ä»£ç å¦‚ä¸‹ï¼š  ```
// DubboHealthIndicator.java
@Autowired(required = false)
private Map<String, ProtocolConfig> protocolConfigs = Collections.emptyMap();
private Map<String, String> resolveStatusCheckerNamesMapFromProtocolConfigs(){
// åˆ›å»º Map
Map<String, String> statusCheckerNamesMap = new LinkedHashMap<>();
// éå† protocolConfigs
for (Map.Entry<String, ProtocolConfig> entry : protocolConfigs.entrySet()) {
// è·å¾— Bean çš„åå­—
String beanName = entry.getKey();
// è·å¾— ProtocolConfig å¯¹è±¡
ProtocolConfig protocolConfig = entry.getValue();
// è·å¾— ProtocolConfig çš„ StatusChecker çš„åå­—çš„é›†åˆ
Set<String> statusCheckerNames = getStatusCheckerNames(protocolConfig);
// éå† statusCheckerNames æ•°ç»„
for (String statusCheckerName : statusCheckerNames) {
// æ„å»º source å±æ€§
String source = buildSource(beanName, protocolConfig);
// æ·»åŠ åˆ° statusCheckerNamesMap ä¸­
statusCheckerNamesMap.put(statusCheckerName, source);
}
}
return statusCheckerNamesMap;
}
private Set<String> getStatusCheckerNames(ProtocolConfig protocolConfig){
String status = protocolConfig.getStatus();
return StringUtils.commaDelimitedListToSet(status);
}
private Set<String> getStatusCheckerNames(ProviderConfig providerConfig){
String status = providerConfig.getStatus();
return StringUtils.commaDelimitedListToSet(status);
}
private String buildSource(String beanName, Object bean){
return beanName + "@" + bean.getClass().getSimpleName() + ".getStatus()";
}
```

* <3>
å¤„ï¼Œè°ƒç”¨

/#resolveStatusCheckerNamesMapFromProviderConfig()
æ–¹æ³•ï¼Œä» ProviderConfig ä¸­è·å–ã€‚ä»£ç å¦‚ä¸‹ï¼š  ```
// DubboHealthIndicator.java
@Autowired(required = false)
private Map<String, ProviderConfig> providerConfigs = Collections.emptyMap();
private Map<String, String> resolveStatusCheckerNamesMapFromProviderConfig(){
// åˆ›å»º Map
Map<String, String> statusCheckerNamesMap = new LinkedHashMap<>();
// éå† providerConfigs
for (Map.Entry<String, ProviderConfig> entry : providerConfigs.entrySet()) {
// è·å¾— Bean çš„åå­—
String beanName = entry.getKey();
// è·å¾— ProviderConfig å¯¹è±¡
ProviderConfig providerConfig = entry.getValue();
// è·å¾— ProtocolConfig çš„ StatusChecker çš„åå­—çš„é›†åˆ
Set<String> statusCheckerNames = getStatusCheckerNames(providerConfig);
// éå† statusCheckerNames æ•°ç»„
for (String statusCheckerName : statusCheckerNames) {
// æ„å»º source å±æ€§
String source = buildSource(beanName, providerConfig);
// æ·»åŠ åˆ° statusCheckerNamesMap ä¸­
statusCheckerNamesMap.put(statusCheckerName, source);
}
}
return statusCheckerNamesMap;
}
```

* æœ€ç»ˆçš„ç»“æœï¼Œç¤ºä¾‹å¦‚ä¸‹å›¾ï¼š![`statusCheckerNamesMap` å±æ€§](http://static2.iocoder.cn/images/Dubbo/2019_02_11/10.jpg)
å¦‚ä¸‹å¼€å§‹ï¼Œæ˜¯

endpoint
åŒ…ä¸‹ã€‚

## 5.6 AbstractDubboEndpoint

com.alibaba.boot.dubbo.actuate.endpoint.AbstractDubboEndpoint
ï¼Œå®ç° ApplicationContextAwareã€EnvironmentAware æ¥å£ï¼ŒDubbo Endpoint æŠ½è±¡ç±»ï¼Œæä¾›ç»™å­ç±»å·¥å…·æ–¹æ³•ã€‚

### 5.6.1 åŸºæœ¬å±æ€§

```
// AbstractDubboEndpoint.java
protected ApplicationContext applicationContext;
protected ConfigurableEnvironment environment;
@Override
public void setApplicationContext(ApplicationContext applicationContext) throws BeansException{
this.applicationContext = applicationContext;
}
@Override
public void setEnvironment(Environment environment){
if (environment instanceof ConfigurableEnvironment) {
this.environment = (ConfigurableEnvironment) environment;
}
}
```

### 5.6.2 resolveBeanMetadata

/#resolveBeanMetadata(Object bean)
æ–¹æ³•ï¼Œè·å¾— Bean çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AbstractDubboEndpoint.java
protected Map<String, Object> resolveBeanMetadata(final Object bean){
// åˆ›å»º Map
final Map<String, Object> beanMetadata = new LinkedHashMap<>();
try {
// è·å¾— BeanInfo å¯¹è±¡
BeanInfo beanInfo = Introspector.getBeanInfo(bean.getClass());
// è·å¾— PropertyDescriptor æ•°ç»„
PropertyDescriptor[] propertyDescriptors = beanInfo.getPropertyDescriptors();
// éå† PropertyDescriptor æ•°ç»„
for (PropertyDescriptor propertyDescriptor : propertyDescriptors) {
// è·å¾— Method å¯¹è±¡
Method readMethod = propertyDescriptor.getReadMethod();
// è¯»å–å±æ€§ï¼Œæ·»åŠ åˆ° beanMetadata ä¸­
if (readMethod != null && isSimpleType(propertyDescriptor.getPropertyType())) {
String name = Introspector.decapitalize(propertyDescriptor.getName());
Object value = readMethod.invoke(bean);
beanMetadata.put(name, value);
}
}
} catch (Exception e) {
throw new RuntimeException(e);
}
return beanMetadata;
}
private static boolean isSimpleType(Class<?> type){
return isPrimitiveOrWrapper(type) // åŸºæœ¬ç±»å‹ or åŒ…è£…ç±»å‹
|| type == String.class
|| type == BigDecimal.class
|| type == BigInteger.class
|| type == Date.class
|| type == URL.class
|| type == Class.class
;
}
```

* ç›®çš„æ˜¯è¯»å– Bean çš„åŸºæœ¬å±æ€§ã€‚ç¤ºä¾‹å¦‚ä¸‹å›¾ï¼š![`beanMetadata` ç»“æœ](http://static2.iocoder.cn/images/Dubbo/2019_02_11/12.jpg)

### 5.6.3 getServiceBeansMap

/#getServiceBeansMap()
æ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰ ServiceBean ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AbstractDubboEndpoint.java
protected Map<String, ServiceBean> getServiceBeansMap(){
return BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, ServiceBean.class);
}
```

### 5.6.4 getProtocolConfigsBeanMap

/#getProtocolConfigsBeanMap()
æ–¹æ³•ï¼Œè·å¾—æ‰€æœ‰ ProtocolConfig ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AbstractDubboEndpoint.java
protected Map<String, ProtocolConfig> getProtocolConfigsBeanMap(){
return BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, ProtocolConfig.class);
}
```

### 5.6.5 getReferenceAnnotationBeanPostProcessor

/#getReferenceAnnotationBeanPostProcessor()
æ–¹æ³•ï¼Œè·å¾— ReferenceAnnotationBeanPostProcessor Bean å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// AbstractDubboEndpoint.java
protected ReferenceAnnotationBeanPostProcessor getReferenceAnnotationBeanPostProcessor(){
return applicationContext.getBean(ReferenceAnnotationBeanPostProcessor.BEAN_NAME, ReferenceAnnotationBeanPostProcessor.class);
}
```

## 5.7 DubboEndpoint

com.alibaba.boot.dubbo.actuate.endpoint.DubboEndpoint
ï¼ŒDubbo Endpoint ï¼Œè·å¾— Dubbo Meta Dataï¼ˆå…ƒæ•°æ®ï¼‰ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboEndpoint.java
//*/*
/* Actuator {@link Endpoint} to expose Dubbo Meta Data
/*/
@Endpoint(id = "dubbo")
public class DubboEndpoint{
@ReadOperation
public Map<String, Object> invoke(){
// åˆ›å»º Map
Map<String, Object> metaData = new LinkedHashMap<>();
// timestamp
metaData.put("timestamp", System.currentTimeMillis());
// versions
Map<String, String> versions = new LinkedHashMap<>();
versions.put("dubbo-spring-boot", Version.getVersion(DubboUtils.class, "1.0.0"));
versions.put("dubbo", Version.getVersion());
// urls
Map<String, String> urls = new LinkedHashMap<>();
urls.put("dubbo", DUBBO_GITHUB_URL);
urls.put("mailing-list", DUBBO_MAILING_LIST);
urls.put("github", DUBBO_SPRING_BOOT_GITHUB_URL);
urls.put("issues", DUBBO_SPRING_BOOT_ISSUES_URL);
urls.put("git", DUBBO_SPRING_BOOT_GIT_URL);
metaData.put("versions", versions);
metaData.put("urls", urls);
return metaData;
}
}
```

## 5.8 DubboConfigsMetadataEndpoint

com.alibaba.boot.dubbo.actuate.endpoint.DubboConfigsMetadataEndpoint
ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾— æ‰€æœ‰çš„ Dubbo é…ç½®ç±»çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboConfigsMetadataEndpoint.java
//*/*
/* Dubbo Configs Metadata {@link Endpoint}
/*/
@Endpoint(id = "dubboconfigs")
public class DubboConfigsMetadataEndpoint extends AbstractDubboEndpoint{
@ReadOperation
public Map<String, Map<String, Map<String, Object>>> configs() {
// åˆ›å»º Map
// KEYï¼šè·å¾—ç±»çš„ç®€ç§°ã€‚ä¾‹å¦‚ï¼šApplicationConfigã€ConsumerConfig
// KEY2ï¼šBean çš„åç§°
// VALUEï¼šBean çš„å…ƒæ•°æ®
Map<String, Map<String, Map<String, Object>>> configsMap = new LinkedHashMap<>();
// éå†æ¯ä¸ªé…ç½®ç±»ï¼Œæ·»åŠ å…¶çš„ Bean ä»¬ï¼Œåˆ° configsMap ä¸­
addDubboConfigBeans(ApplicationConfig.class, configsMap);
addDubboConfigBeans(ConsumerConfig.class, configsMap);
addDubboConfigBeans(MethodConfig.class, configsMap);
addDubboConfigBeans(ModuleConfig.class, configsMap);
addDubboConfigBeans(MonitorConfig.class, configsMap);
addDubboConfigBeans(ProtocolConfig.class, configsMap);
addDubboConfigBeans(ProviderConfig.class, configsMap);
addDubboConfigBeans(ReferenceConfig.class, configsMap);
addDubboConfigBeans(RegistryConfig.class, configsMap);
addDubboConfigBeans(ServiceConfig.class, configsMap);
return configsMap;
}
private void addDubboConfigBeans(Class<? extends AbstractConfig> dubboConfigClass, Map<String, Map<String, Map<String, Object>>> configsMap){
// è·å¾—æŒ‡å®šç±» dubboConfigClass çš„ Map
Map<String, ? extends AbstractConfig> dubboConfigBeans = BeanFactoryUtils.beansOfTypeIncludingAncestors(applicationContext, dubboConfigClass);
// è·å¾—ç±»çš„ç®€ç§°ã€‚ä¾‹å¦‚ï¼šApplicationConfigã€ConsumerConfig
String name = dubboConfigClass.getSimpleName();
// åˆ›å»º Map
Map<String, Map<String, Object>> beansMetadata = new TreeMap<>();
// éå† dubboConfigBeans æ•°ç»„
for (Map.Entry<String, ? extends AbstractConfig> entry : dubboConfigBeans.entrySet()) {
// è·å¾— Bean çš„åå­—
String beanName = entry.getKey();
// è·å¾— Bean çš„å…ƒæ•°æ®
AbstractConfig configBean = entry.getValue();
Map<String, Object> configBeanMeta = super.resolveBeanMetadata(configBean);
// æ·»åŠ åˆ° beansMetadata ä¸­
beansMetadata.put(beanName, configBeanMeta);
}
// æ·»åŠ åˆ° configsMap ä¸­
configsMap.put(name, beansMetadata);
}
}
```

## 5.7 DubboPropertiesEndpoint

com.alibaba.boot.dubbo.actuate.endpoint.DubboPropertiesEndpoint
ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾— Dubbo Properties ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboPropertiesEndpoint.java
//*/*
/* Dubbo Properties {@link Endpoint}
/*/
@Endpoint(id = "dubboproperties")
public class DubboPropertiesEndpoint extends AbstractDubboEndpoint{
@ReadOperation
public SortedMap<String, Object> properties(){
return DubboUtils.filterDubboProperties(environment);
}
}
```

## 5.8 DubboReferencesMetadataEndpoint

com.alibaba.boot.dubbo.actuate.endpoint.DubboReferencesMetadataEndpoint
ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾—æ‰€æœ‰çš„ Dubbo

@Reference
Bean çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboReferencesMetadataEndpoint.java
//*/*
/* Dubbo {@link Reference} Metadata {@link Endpoint}
/*/
@Endpoint(id = "dubboreferences")
public class DubboReferencesMetadataEndpoint extends AbstractDubboEndpoint{
@ReadOperation
public Map<String, Map<String, Object>> references() {
// åˆ›å»º Map
// KEYï¼šBean çš„åå­—
// VALUEï¼šBean çš„å…ƒæ•°æ®
Map<String, Map<String, Object>> referencesMetadata = new LinkedHashMap<>();
// è·å¾— ReferenceAnnotationBeanPostProcessor Bean å¯¹è±¡
ReferenceAnnotationBeanPostProcessor beanPostProcessor = super.getReferenceAnnotationBeanPostProcessor();
// injected Field ReferenceBean Cache
referencesMetadata.putAll(buildReferencesMetadata(beanPostProcessor.getInjectedFieldReferenceBeanMap()));
// injected Method ReferenceBean Cache
referencesMetadata.putAll(buildReferencesMetadata(beanPostProcessor.getInjectedMethodReferenceBeanMap()));
return referencesMetadata;
}
private Map<String, Map<String, Object>> buildReferencesMetadata(Map<InjectionMetadata.InjectedElement, ReferenceBean<?>> injectedElementReferenceBeanMap) {
// åˆ›å»º Map
// KEYï¼šBean çš„åå­—
// VALUEï¼šBean çš„å…ƒæ•°æ®
Map<String, Map<String, Object>> referencesMetadata = new LinkedHashMap<>();
// éå† injectedElementReferenceBeanMap å…ƒç´ 
for (Map.Entry<InjectionMetadata.InjectedElement, ReferenceBean<?>> entry : injectedElementReferenceBeanMap.entrySet()) {
InjectionMetadata.InjectedElement injectedElement = entry.getKey();
// è·å¾— ReferenceBean å¯¹è±¡
ReferenceBean<?> referenceBean = entry.getValue();
// è·å¾— Bean å…ƒæ•°æ®
Map<String, Object> beanMetadata = super.resolveBeanMetadata(referenceBean);
// è·å¾— invoker å±æ€§
beanMetadata.put("invoker", super.resolveBeanMetadata(referenceBean.get()));
// æ·»åŠ åˆ° referencesMetadata ä¸­
referencesMetadata.put(String.valueOf(injectedElement.getMember()), beanMetadata);
}
return referencesMetadata;
}
}
```

## 5.9 DubboServicesMetadataEndpoint

com.alibaba.boot.dubbo.actuate.endpoint.DubboServicesMetadataEndpoint
ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œè·å¾—æ‰€æœ‰çš„ Dubbo

@Service
Bean çš„å…ƒæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboServicesMetadataEndpoint.java
//*/*
/* Dubbo {@link Service} Metadata {@link Endpoint}
/*/
@Endpoint(id = "dubboservices")
public class DubboServicesMetadataEndpoint extends AbstractDubboEndpoint{
@ReadOperation
public Map<String, Map<String, Object>> services() {
// è·å¾—æ‰€æœ‰çš„ ServiceBean
Map<String, ServiceBean> serviceBeansMap = super.getServiceBeansMap();
// åˆ›å»º Map
// KEYï¼šBean çš„åå­—
// VALUEï¼šBean çš„å…ƒæ•°æ®
Map<String, Map<String, Object>> servicesMetadata = new LinkedHashMap<>(serviceBeansMap.size());
// éå† serviceBeansMap å…ƒç´ 
for (Map.Entry<String, ServiceBean> entry : serviceBeansMap.entrySet()) {
// è·å¾— Bean çš„åå­—
String serviceBeanName = entry.getKey();
// è·å¾— ServiceBean å¯¹è±¡
ServiceBean serviceBean = entry.getValue();
// è·å¾— Bean çš„å…ƒæ•°æ®
Map<String, Object> serviceBeanMetadata = super.resolveBeanMetadata(serviceBean);
// è·å¾— Service å¯¹è±¡ã€‚è‹¥è·å¾—åˆ°ï¼Œåˆ™æ·»åŠ åˆ° serviceBeanMetadata ä¸­
Object service = resolveServiceBean(serviceBeanName, serviceBean);
if (service != null) {
// Add Service implementation class
serviceBeanMetadata.put("serviceClass", service.getClass().getName());
}
// æ·»åŠ åˆ° servicesMetadata ä¸­
servicesMetadata.put(serviceBeanName, serviceBeanMetadata);
}
return servicesMetadata;
}
private Object resolveServiceBean(String serviceBeanName, ServiceBean serviceBean){
int index = serviceBeanName.indexOf("/#");
if (index > -1) {
Class<?> interfaceClass = serviceBean.getInterfaceClass();
String serviceName = serviceBeanName.substring(index + 1);
if (applicationContext.containsBean(serviceName)) {
return applicationContext.getBean(serviceName, interfaceClass);
}
}
return null;
}
}
```

## 5.10 DubboShutdownEndpoint

com.alibaba.boot.dubbo.actuate.endpoint.DubboShutdownEndpoint
ï¼Œç»§æ‰¿ AbstractDubboEndpoint æŠ½è±¡ç±»ï¼Œå…³é—­ Dubbo ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
// DubboShutdownEndpoint.java
//*/*
/* Dubbo Shutdown
/*/
@Endpoint(id = "dubboshutdown")
public class DubboShutdownEndpoint extends AbstractDubboEndpoint{
@WriteOperation
public Map<String, Object> shutdown() throws Exception{
// åˆ›å»º Map
Map<String, Object> shutdownCountData = new LinkedHashMap<>();
// registries
// è·å¾—æ³¨å†Œçš„æ•°é‡
int registriesCount = AbstractRegistryFactory.getRegistries().size();
// protocols
// è·å¾— Protocol çš„æ•°é‡
int protocolsCount = super.getProtocolConfigsBeanMap().size();
// é”€æ¯ ProtocolConfig
ProtocolConfig.destroyAll();
// æ·»åŠ åˆ° shutdownCountData ä¸­
shutdownCountData.put("registries", registriesCount);
shutdownCountData.put("protocols", protocolsCount);
// Service Beans
// è·å¾—æ‰€æœ‰ ServiceBean ï¼Œç„¶åé€ä¸ªé”€æ¯
Map<String, ServiceBean> serviceBeansMap = super.getServiceBeansMap();
if (!serviceBeansMap.isEmpty()) {
for (ServiceBean serviceBean : serviceBeansMap.values()) {
serviceBean.destroy();
}
}
// æ·»åŠ åˆ° shutdownCountData ä¸­
shutdownCountData.put("services", serviceBeansMap.size());
// Reference Beans
// è·å¾— ReferenceAnnotationBeanPostProcessor å¯¹è±¡
ReferenceAnnotationBeanPostProcessor beanPostProcessor = super.getReferenceAnnotationBeanPostProcessor();
// è·å¾— Reference Bean çš„æ•°é‡
int referencesCount = beanPostProcessor.getReferenceBeans().size();
// é”€æ¯æ‰€æœ‰ Reference Bean
beanPostProcessor.destroy();
// æ·»åŠ åˆ° shutdownCountData ä¸­
shutdownCountData.put("references", referencesCount);
// Set Result to complete
Map<String, Object> shutdownData = new TreeMap<>();
shutdownData.put("shutdown.count", shutdownCountData);
return shutdownData;
}
}
```

* é€šè¿‡è°ƒç”¨è¯¥æ¥å£ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿œç¨‹å…³é—­ Dubbo æœåŠ¡ã€‚