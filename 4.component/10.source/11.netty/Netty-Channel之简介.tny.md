<div class="article-inner">


<header class="article-header">


<h1 class="article-title" itemprop="name">
ç²¾å°½ Netty æºç è§£æ â€”â€” Channelï¼ˆä¸€ï¼‰ä¹‹ç®€ä»‹
</h1>


</header>

<div class="article-entry" itemprop="articleBody">

<!-- Table of Contents -->

<h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä¸æ–­çœ‹åˆ° Netty Channel çš„èº«å½±ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åœ¨ <a href="http://svip.iocoder.cn/Netty/bootstrap-1-server/">ã€Šç²¾å°½ Netty æºç åˆ†æ â€”â€” å¯åŠ¨ï¼ˆä¸€ï¼‰ä¹‹æœåŠ¡ç«¯ã€‹</a> ä¸­ï¼Œæˆ‘ä»¬çœ‹äº†æœåŠ¡ç«¯ NioServerSocketChannel <strong>å¯¹è±¡åˆ›å»º</strong>çš„è¿‡ç¨‹ã€‚</li>
<li>åœ¨ <a href="http://svip.iocoder.cn/Netty/bootstrap-2-client/">ã€Šç²¾å°½ Netty æºç åˆ†æ â€”â€” å¯åŠ¨ï¼ˆäºŒï¼‰ä¹‹å®¢æˆ·ç«¯ã€‹</a> ä¸­ï¼Œæˆ‘ä»¬çœ‹äº†å®¢æˆ·ç«¯ NioSocketChannel <strong>å¯¹è±¡åˆ›å»º</strong>çš„è¿‡ç¨‹ã€‚ </li>
</ul>
<p>ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æœ¬å°èŠ‚çš„åç»­æ–‡ç« ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦è¿™æ ·ä¸€ç¯‡æ–‡ç« ï¼Œæ•´ä½“æ€§çš„å†çœ‹ä¸€æ¬¡ Channel çš„é¢è²Œã€‚</p>
<h1 id="2-Channel"><a href="#2-Channel" class="headerlink" title="2. Channel"></a>2. Channel</h1><p><code>io.netty.channel.Channel</code> ï¼Œå®ç° AttributeMapã€ChannelOutboundInvokerã€Comparable æ¥å£ï¼ŒNetty Channel æ¥å£ã€‚</p>
<p>åœ¨ <a href="http://svip.iocoder.cn/Netty/intro-1/">ã€Šç²¾å°½ Netty æºç åˆ†æ â€”â€” Netty ç®€ä»‹ï¼ˆä¸€ï¼‰ä¹‹é¡¹ç›®ç»“æ„ã€‹</a> ä¸­ï¼Œæˆ‘ä»¬å¯¹ Channel çš„ç»„ä»¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>Channel æ˜¯ Netty ç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼Œå®ƒé™¤äº†åŒ…æ‹¬åŸºæœ¬çš„ I/O æ“ä½œï¼Œå¦‚ bindã€connectã€readã€write ä¹‹å¤–ï¼Œè¿˜åŒ…æ‹¬äº† Netty æ¡†æ¶ç›¸å…³çš„ä¸€äº›åŠŸèƒ½ï¼Œå¦‚è·å–è¯¥ Channel çš„ EventLoop ã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œä½œä¸ºæ ¸å¿ƒç±»çš„ Socket ï¼Œå®ƒå¯¹ç¨‹åºå‘˜æ¥è¯´å¹¶ä¸æ˜¯é‚£ä¹ˆå‹å¥½ï¼Œç›´æ¥ä½¿ç”¨å…¶æˆæœ¬è¿˜æ˜¯ç¨å¾®é«˜äº†ç‚¹ã€‚è€Œ Netty çš„ Channel åˆ™æä¾›çš„ä¸€ç³»åˆ—çš„ API ï¼Œå®ƒå¤§å¤§é™ä½äº†ç›´æ¥ä¸ Socket è¿›è¡Œæ“ä½œçš„å¤æ‚æ€§ã€‚è€Œç›¸å¯¹äºåŸç”Ÿ NIO çš„ Channelï¼ŒNetty çš„ Channel å…·æœ‰å¦‚ä¸‹ä¼˜åŠ¿( æ‘˜è‡ªã€ŠNettyæƒå¨æŒ‡å—( ç¬¬äºŒç‰ˆ )ã€‹) ï¼š</p>
<ul>
<li>åœ¨ Channel æ¥å£å±‚ï¼Œé‡‡ç”¨ Facade æ¨¡å¼è¿›è¡Œç»Ÿä¸€å°è£…ï¼Œå°†ç½‘ç»œ I/O æ“ä½œã€ç½‘ç»œ I/O ç›¸å…³è”çš„å…¶ä»–æ“ä½œå°è£…èµ·æ¥ï¼Œç»Ÿä¸€å¯¹å¤–æä¾›ã€‚</li>
<li>Channel æ¥å£çš„å®šä¹‰å°½é‡å¤§è€Œå…¨ï¼Œä¸º SocketChannel å’Œ ServerSocketChannel æä¾›ç»Ÿä¸€çš„è§†å›¾ï¼Œç”±ä¸åŒå­ç±»å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œå…¬å…±åŠŸèƒ½åœ¨æŠ½è±¡çˆ¶ç±»ä¸­å®ç°ï¼Œæœ€å¤§ç¨‹åº¦åœ°å®ç°åŠŸèƒ½å’Œæ¥å£çš„é‡ç”¨ã€‚</li>
<li>å…·ä½“å®ç°é‡‡ç”¨èšåˆè€ŒéåŒ…å«çš„æ–¹å¼ï¼Œå°†ç›¸å…³çš„åŠŸèƒ½ç±»èšåˆåœ¨ Channel ä¸­ï¼Œç”± Channel ç»Ÿä¸€è´Ÿè´£å’Œè°ƒåº¦ï¼ŒåŠŸèƒ½å®ç°æ›´åŠ çµæ´»ã€‚</li>
</ul>
</blockquote>
<h2 id="2-1-åŸºç¡€æŸ¥è¯¢"><a href="#2-1-åŸºç¡€æŸ¥è¯¢" class="headerlink" title="2.1 åŸºç¡€æŸ¥è¯¢"></a>2.1 åŸºç¡€æŸ¥è¯¢</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the globally unique identifier of this {<span class="doctag">@link</span> Channel}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel çš„ç¼–å·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ChannelId <span class="title">id</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the {<span class="doctag">@link</span> EventLoop} this {<span class="doctag">@link</span> Channel} was registered to.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel æ³¨å†Œåˆ°çš„ EventLoop</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">EventLoop <span class="title">eventLoop</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the parent of this channel.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * çˆ¶ Channel å¯¹è±¡</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the parent channel.</span></span><br><span class="line"><span class="comment"> *         {<span class="doctag">@code</span> null} if this channel does not have a parent channel.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Channel <span class="title">parent</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the configuration of this channel.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel é…ç½®å‚æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ChannelConfig <span class="title">config</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns an &lt;em&gt;internal-use-only&lt;/em&gt; object that provides unsafe operations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unsafe å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Unsafe <span class="title">unsafe</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the assigned {<span class="doctag">@link</span> ChannelPipeline}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ChannelPipeline å¯¹è±¡ï¼Œç”¨äºå¤„ç† Inbound å’Œ Outbound äº‹ä»¶çš„å¤„ç†</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ChannelPipeline <span class="title">pipeline</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the assigned {<span class="doctag">@link</span> ByteBufAllocator} which will be used to allocate {<span class="doctag">@link</span> ByteBuf}s.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ByteBuf åˆ†é…å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ByteBufAllocator <span class="title">alloc</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the local address where this channel is bound to.  The returned</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> SocketAddress} is supposed to be down-cast into more concrete</span></span><br><span class="line"><span class="comment"> * type such as {<span class="doctag">@link</span> InetSocketAddress} to retrieve the detailed</span></span><br><span class="line"><span class="comment"> * information.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æœ¬åœ°åœ°å€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the local address of this channel.</span></span><br><span class="line"><span class="comment"> *         {<span class="doctag">@code</span> null} if this channel is not bound.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">SocketAddress <span class="title">localAddress</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the remote address where this channel is connected to.  The</span></span><br><span class="line"><span class="comment"> * returned {<span class="doctag">@link</span> SocketAddress} is supposed to be down-cast into more</span></span><br><span class="line"><span class="comment"> * concrete type such as {<span class="doctag">@link</span> InetSocketAddress} to retrieve the detailed</span></span><br><span class="line"><span class="comment"> * information.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¿œç«¯åœ°å€</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the remote address of this channel.</span></span><br><span class="line"><span class="comment"> *         {<span class="doctag">@code</span> null} if this channel is not connected.</span></span><br><span class="line"><span class="comment"> *         If this channel is not connected but it can receive messages</span></span><br><span class="line"><span class="comment"> *         from arbitrary remote addresses (e.g. {<span class="doctag">@link</span> DatagramChannel},</span></span><br><span class="line"><span class="comment"> *         use {<span class="doctag">@link</span> DatagramPacket#recipient()} to determine</span></span><br><span class="line"><span class="comment"> *         the origination of the received message as this method will</span></span><br><span class="line"><span class="comment"> *         return {<span class="doctag">@code</span> null}.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">SocketAddress <span class="title">remoteAddress</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>è‡ªèº«åŸºæœ¬ä¿¡æ¯æœ‰ <code>#id()</code>ã€<code>#parent()</code>ã€<code>#config()</code>ã€<code>#localAddress()</code>ã€<code>#remoteAddress()</code> æ–¹æ³•ã€‚</li>
<li>æ¯ä¸ª Channel éƒ½æœ‰çš„æ ¸å¿ƒç»„ä»¶æœ‰ <code>#eventLoop()</code>ã€<code>#unsafe()</code>ã€<code>#pipeline()</code>ã€<code>#alloc()</code> æ–¹æ³•ã€‚</li>
</ul>
<h2 id="2-2-çŠ¶æ€æŸ¥è¯¢"><a href="#2-2-çŠ¶æ€æŸ¥è¯¢" class="headerlink" title="2.2 çŠ¶æ€æŸ¥è¯¢"></a>2.2 çŠ¶æ€æŸ¥è¯¢</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns {<span class="doctag">@code</span> true} if the {<span class="doctag">@link</span> Channel} is open and may get active later</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel æ˜¯å¦æ‰“å¼€ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * true è¡¨ç¤º Channel å¯ç”¨</span></span><br><span class="line"><span class="comment"> * false è¡¨ç¤º Channel å·²å…³é—­ï¼Œä¸å¯ç”¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isOpen</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns {<span class="doctag">@code</span> true} if the {<span class="doctag">@link</span> Channel} is registered with an {<span class="doctag">@link</span> EventLoop}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel æ˜¯å¦æ³¨å†Œ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * true è¡¨ç¤º Channel å·²æ³¨å†Œåˆ° EventLoop ä¸Š</span></span><br><span class="line"><span class="comment"> * false è¡¨ç¤º Channel æœªæ³¨å†Œåˆ° EventLoop ä¸Š</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isRegistered</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return {<span class="doctag">@code</span> true} if the {<span class="doctag">@link</span> Channel} is active and so connected.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel æ˜¯å¦æ¿€æ´»</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å¯¹äºæœåŠ¡ç«¯ ServerSocketChannel ï¼Œtrue è¡¨ç¤º Channel å·²ç»ç»‘å®šåˆ°ç«¯å£ä¸Šï¼Œå¯æä¾›æœåŠ¡</span></span><br><span class="line"><span class="comment"> * å¯¹äºå®¢æˆ·ç«¯ SocketChannel ï¼Œtrue è¡¨ç¤º Channel è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isActive</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns {<span class="doctag">@code</span> true} if and only if the I/O thread will perform the</span></span><br><span class="line"><span class="comment"> * requested write operation immediately.  Any write requests made when</span></span><br><span class="line"><span class="comment"> * this method returns {<span class="doctag">@code</span> false} are queued until the I/O thread is</span></span><br><span class="line"><span class="comment"> * ready to process the queued write requests.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel æ˜¯å¦å¯å†™</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * å½“ Channel çš„å†™ç¼“å­˜åŒº outbound é null ä¸”å¯å†™æ—¶ï¼Œè¿”å› true</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isWritable</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å¾—è·ç¦»ä¸å¯å†™è¿˜æœ‰å¤šå°‘å­—èŠ‚æ•°</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Get how many bytes can be written until {<span class="doctag">@link</span> #isWritable()} returns {<span class="doctag">@code</span> false}.</span></span><br><span class="line"><span class="comment"> * This quantity will always be non-negative. If {<span class="doctag">@link</span> #isWritable()} is {<span class="doctag">@code</span> false} then 0.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">bytesBeforeUnwritable</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å¾—è·ç¦»å¯å†™è¿˜è¦å¤šå°‘å­—èŠ‚æ•°</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * Get how many bytes must be drained from underlying buffers until {<span class="doctag">@link</span> #isWritable()} returns {<span class="doctag">@code</span> true}.</span></span><br><span class="line"><span class="comment"> * This quantity will always be non-negative. If {<span class="doctag">@link</span> #isWritable()} is {<span class="doctag">@code</span> true} then 0.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">bytesBeforeWritable</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸€ä¸ª<strong>æ­£å¸¸ç»“æŸ</strong>çš„ Channel çŠ¶æ€è½¬ç§»æœ‰<strong>ä¸¤</strong>ç§æƒ…å†µï¼š</p>
<ul>
<li><p>æœåŠ¡ç«¯ç”¨äºç»‘å®š( bind )çš„ Channel ã€æˆ–è€…å®¢æˆ·ç«¯å‘èµ·è¿æ¥( connect )çš„ Channel ã€‚</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">REGISTERED -&gt; CONNECT/BIND -&gt; ACTIVE -&gt; CLOSE -&gt; INACTIVE -&gt; UNREGISTERED</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>æœåŠ¡ç«¯æ¥å—( accept )å®¢æˆ·ç«¯çš„ Channel ã€‚</p>
<figure class="highlight shell"><table><tbody><tr><td class="code"><pre><span class="line">REGISTERED -&gt; ACTIVE -&gt; CLOSE -&gt; INACTIVE -&gt; UNREGISTERED</span><br></pre></td></tr></tbody></table></figure>
</li>
</ul>
<p>ä¸€ä¸ª<strong>å¼‚å¸¸å…³é—­</strong>çš„ Channel çŠ¶æ€è½¬ç§»ä¸ç¬¦åˆä¸Šé¢çš„ã€‚</p>
<h2 id="2-3-IO-æ“ä½œ"><a href="#2-3-IO-æ“ä½œ" class="headerlink" title="2.3 IO æ“ä½œ"></a>2.3 IO æ“ä½œ</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function">Channel <span class="title">read</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function">Channel <span class="title">flush</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç»§æ‰¿è‡ª ChannelOutboundInvoker æ¥å£ã€‚å®é™…è¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">ChannelFuture <span class="title">bind</span><span class="params">(SocketAddress localAddress)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress, SocketAddress localAddress)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">disconnect</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">close</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">deregister</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">connect</span><span class="params">(SocketAddress remoteAddress, SocketAddress localAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">disconnect</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">close</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">deregister</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelOutboundInvoker <span class="title">read</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">write</span><span class="params">(Object msg)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">write</span><span class="params">(Object msg, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelOutboundInvoker <span class="title">flush</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">writeAndFlush</span><span class="params">(Object msg, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">writeAndFlush</span><span class="params">(Object msg)</span></span>;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>å¯¹æ¯”ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¼šå‘ç° Channel é‡å†™ ChannelOutboundInvoker è¿™ä¸¤ä¸ªæ¥å£çš„åŸå› æ˜¯ï¼šå°†è¿”å›å€¼ä» ChannelOutboundInvoker ä¿®æ”¹æˆ Channel ã€‚</p>
</li>
<li>æˆ‘ä»¬çœ‹åˆ°é™¤äº† <code>#read()</code> å’Œ <code>#flush()</code> æ–¹æ³•ï¼Œå…¶å®ƒæ–¹æ³•çš„è¿”å›å€¼çš„ç±»å‹éƒ½æ˜¯ ChannelFuture ï¼Œè¿™è¡¨æ˜è¿™äº›æ“ä½œæ˜¯<strong>å¼‚æ­¥</strong> IO çš„è¿‡ç¨‹ã€‚</li>
</ul>
<h2 id="2-4-å¼‚æ­¥ç»“æœ-Future"><a href="#2-4-å¼‚æ­¥ç»“æœ-Future" class="headerlink" title="2.4 å¼‚æ­¥ç»“æœ Future"></a>2.4 å¼‚æ­¥ç»“æœ Future</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the {<span class="doctag">@link</span> ChannelFuture} which will be notified when this</span></span><br><span class="line"><span class="comment"> * channel is closed.  This method always returns the same future instance.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Channel å…³é—­çš„ Future å¯¹è±¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ChannelFuture <span class="title">closeFuture</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>é™¤äº†è‡ªå®šä¹‰çš„ <code>#closeFuture()</code> æ–¹æ³•ï¼Œä¹Ÿä» ChannelOutboundInvoker æ¥å£ç»§æ‰¿äº†å‡ ä¸ªæ¥å£æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">ChannelPromise <span class="title">newPromise</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelProgressivePromise <span class="title">newProgressivePromise</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ChannelFuture <span class="title">newSucceededFuture</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelFuture <span class="title">newFailedFuture</span><span class="params">(Throwable cause)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ChannelPromise <span class="title">voidPromise</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>é€šè¿‡è¿™äº›æ¥å£æ–¹æ³•ï¼Œå¯åˆ›å»ºæˆ–è·å¾—å’Œè¯¥ Channel ç›¸å…³çš„ Future / Promise å¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-5-ç±»å›¾"><a href="#2-5-ç±»å›¾" class="headerlink" title="2.5 ç±»å›¾"></a>2.5 ç±»å›¾</h2><p>Channel çš„å­æ¥å£å’Œå®ç°ç±»å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="http://static2.iocoder.cn/images/Netty/2018_07_01/01.png" title="Channel çš„å­æ¥å£å’Œå®ç°ç±»" class="fancybox" rel="article0"><img src="http://static2.iocoder.cn/images/Netty/2018_07_01/01.png" alt="Channel çš„å­æ¥å£å’Œå®ç°ç±»"></a><span class="caption">Channel çš„å­æ¥å£å’Œå®ç°ç±»</span></p>
<ul>
<li>æœ¬å›¾åŒ…å«äº† NIOã€OIOã€Localã€Embedded å››ç§ Channel å®ç°ç±»ã€‚è¯´æ˜å¦‚ä¸‹ï¼š<a href="http://static2.iocoder.cn/images/Netty/2018_07_01/02.png" title="Channel å››ç§ Channel å®ç°ç±»çš„è¯´æ˜" class="fancybox" rel="article0"><img src="http://static2.iocoder.cn/images/Netty/2018_07_01/02.png" alt="Channel å››ç§ Channel å®ç°ç±»çš„è¯´æ˜"></a><span class="caption">Channel å››ç§ Channel å®ç°ç±»çš„è¯´æ˜</span></li>
<li>æœ¬ç³»åˆ—ä»…åˆ†äº« NIO éƒ¨åˆ†ï¼Œæ‰€ä»¥è£å‰ªç±»å›¾å¦‚ä¸‹ï¼š<a href="http://static2.iocoder.cn/images/Netty/2018_07_01/03.png" title="NIO Channel ç±»å›¾" class="fancybox" rel="article0"><img src="http://static2.iocoder.cn/images/Netty/2018_07_01/03.png" alt="NIO Channel ç±»å›¾"></a><span class="caption">NIO Channel ç±»å›¾</span></li>
</ul>
<h1 id="3-Unsafe"><a href="#3-Unsafe" class="headerlink" title="3. Unsafe"></a>3. Unsafe</h1><p>Unsafe <strong>æ¥å£</strong>ï¼Œå®šä¹‰åœ¨åœ¨ <code>io.netty.channel.Channel</code> å†…éƒ¨ï¼Œå’Œ Channel çš„æ“ä½œ<strong>ç´§å¯†ç»“åˆ</strong>ï¼Œä¸‹æ–‡æˆ‘ä»¬å°†çœ‹åˆ°ã€‚</p>
<p>Unsafe ç›´è¯‘ä¸­æ–‡ä¸ºâ€œä¸å®‰å…¨â€ï¼Œå°±æ˜¯å‘Šè¯‰æˆ‘ä»¬ï¼Œ<strong>æ— éœ€</strong>ä¸”<strong>ä¸å¿…è¦</strong>åœ¨æˆ‘ä»¬ä½¿ç”¨ Netty çš„ä»£ç ä¸­ï¼Œ<strong>ä¸èƒ½ç›´æ¥</strong>è°ƒç”¨ Unsafe ç›¸å…³çš„æ–¹æ³•ã€‚Netty æ³¨é‡Šè¯´æ˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;em&gt;Unsafe&lt;/em&gt; operations that should &lt;em&gt;never&lt;/em&gt; be called from user-code. </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * These methods are only provided to implement the actual transport, and must be invoked from an I/O thread except for the</span></span><br><span class="line"><span class="comment"> * following methods:</span></span><br><span class="line"><span class="comment"> * &lt;ul&gt;</span></span><br><span class="line"><span class="comment"> *   &lt;li&gt;{<span class="doctag">@link</span> #localAddress()}&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *   &lt;li&gt;{<span class="doctag">@link</span> #remoteAddress()}&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *   &lt;li&gt;{<span class="doctag">@link</span> #closeForcibly()}&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *   &lt;li&gt;{<span class="doctag">@link</span> #register(EventLoop, ChannelPromise)}&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *   &lt;li&gt;{<span class="doctag">@link</span> #deregister(ChannelPromise)}&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> *   &lt;li&gt;{<span class="doctag">@link</span> #voidPromise()}&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/ul&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></tbody></table></figure>
<p>ğŸ˜ˆ å½“ç„¶ï¼Œå¯¹äºæˆ‘ä»¬æƒ³è¦äº†è§£ Netty å†…éƒ¨å®ç°çš„èƒ–å‹ï¼Œé‚£å¿…é¡»å¼€æ‰’å®ƒçš„ä»£ç å®ç°è½ã€‚å› ä¸ºå®ƒå’Œ Channel å¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯¹å®ƒçš„æ¥å£åšä¸‹åˆ†ç±»ã€‚</p>
<h2 id="3-1-åŸºç¡€æŸ¥è¯¢"><a href="#3-1-åŸºç¡€æŸ¥è¯¢" class="headerlink" title="3.1 åŸºç¡€æŸ¥è¯¢"></a>3.1 åŸºç¡€æŸ¥è¯¢</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the assigned {<span class="doctag">@link</span> RecvByteBufAllocator.Handle} which will be used to allocate {<span class="doctag">@link</span> ByteBuf}'s when</span></span><br><span class="line"><span class="comment"> * receiving data.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * ByteBuf åˆ†é…å™¨çš„å¤„ç†å™¨</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">RecvByteBufAllocator.<span class="function">Handle <span class="title">recvBufAllocHandle</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the {<span class="doctag">@link</span> SocketAddress} to which is bound local or</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> null} if none.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æœ¬åœ°åœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">SocketAddress <span class="title">localAddress</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the {<span class="doctag">@link</span> SocketAddress} to which is bound remote or</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> null} if none is bound yet.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¿œç«¯åœ°å€</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">SocketAddress <span class="title">remoteAddress</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="3-2-çŠ¶æ€æŸ¥è¯¢"><a href="#3-2-çŠ¶æ€æŸ¥è¯¢" class="headerlink" title="3.2 çŠ¶æ€æŸ¥è¯¢"></a>3.2 çŠ¶æ€æŸ¥è¯¢</h2><p>æ—  ğŸ˜ˆ</p>
<h2 id="3-3-IO-æ“ä½œ"><a href="#3-3-IO-æ“ä½œ" class="headerlink" title="3.3 IO æ“ä½œ"></a>3.3 IO æ“ä½œ</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">register</span><span class="params">(EventLoop eventLoop, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bind</span><span class="params">(SocketAddress localAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect</span><span class="params">(SocketAddress remoteAddress, SocketAddress localAddress, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disconnect</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">closeForcibly</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deregister</span><span class="params">(ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">beginRead</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(Object msg, ChannelPromise promise)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">flush</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns the {<span class="doctag">@link</span> ChannelOutboundBuffer} of the {<span class="doctag">@link</span> Channel} where the pending write requests are stored.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ChannelOutboundBuffer <span class="title">outboundBuffer</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="3-4-å¼‚æ­¥ç»“æœ-Future"><a href="#3-4-å¼‚æ­¥ç»“æœ-Future" class="headerlink" title="3.4 å¼‚æ­¥ç»“æœ Future"></a>3.4 å¼‚æ­¥ç»“æœ Future</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return a special ChannelPromise which can be reused and passed to the operations in {<span class="doctag">@link</span> Unsafe}.</span></span><br><span class="line"><span class="comment"> * It will never be notified of a success or error and so is only a placeholder for operations</span></span><br><span class="line"><span class="comment"> * that take a {<span class="doctag">@link</span> ChannelPromise} as argument but for which you not want to get notified.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">ChannelPromise <span class="title">voidPromise</span><span class="params">()</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="3-5-ç±»å›¾"><a href="#3-5-ç±»å›¾" class="headerlink" title="3.5 ç±»å›¾"></a>3.5 ç±»å›¾</h2><p>Unsafe çš„å­æ¥å£å’Œå®ç°ç±»å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="http://static2.iocoder.cn/images/Netty/2018_07_01/04.png" title="Unsafe çš„å­æ¥å£å’Œå®ç°ç±»" class="fancybox" rel="article0"><img src="http://static2.iocoder.cn/images/Netty/2018_07_01/04.png" alt="Unsafe çš„å­æ¥å£å’Œå®ç°ç±»"></a><span class="caption">Unsafe çš„å­æ¥å£å’Œå®ç°ç±»</span></p>
<ul>
<li>å·²ç»ç»è¿‡è£å‰ªï¼Œä»…ä¿ç•™ NIO Channel ç›¸å…³çš„ Unsafe çš„å­æ¥å£å’Œå®ç°ç±»éƒ¨åˆ†ã€‚</li>
<li>æˆ‘ä»¬ä¼šå‘ç°ï¼Œå¯¹äº Channel å’Œ Unsafe æ¥è¯´ï¼Œç±»åä¸­åŒ…å« Byte æ˜¯å±äºå®¢æˆ·ç«¯çš„ï¼ŒMessage æ˜¯å±äºæœåŠ¡ç«¯çš„ã€‚</li>
</ul>
<h1 id="4-ChanelId"><a href="#4-ChanelId" class="headerlink" title="4. ChanelId"></a>4. ChanelId</h1><p><code>io.netty.channel.ChannelId</code> å®ç° Serializableã€Comparable æ¥å£ï¼ŒChannel ç¼–å·æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ChannelId</span> <span class="keyword">extends</span> <span class="title">Serializable</span>, <span class="title">Comparable</span>&lt;<span class="title">ChannelId</span>&gt; </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the short but globally non-unique string representation of the {<span class="doctag">@link</span> ChannelId}.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å…¨å±€éå”¯ä¸€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">asShortText</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the long yet globally unique string representation of the {<span class="doctag">@link</span> ChannelId}.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * å…¨å±€å”¯ä¸€</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">asLongText</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>#asShortText()</code> æ–¹æ³•ï¼Œè¿”å›çš„ç¼–å·ï¼ŒçŸ­ï¼Œä½†æ˜¯å…¨å±€éå”¯ä¸€ã€‚</li>
<li><code>#asLongText()</code> æ–¹æ³•ï¼Œè¿”å›çš„ç¼–å·ï¼Œé•¿ï¼Œä½†æ˜¯å…¨å±€å”¯ä¸€ã€‚</li>
</ul>
<p>ChanelId çš„<strong>é»˜è®¤</strong>å®ç°ç±»ä¸º <code>io.netty.channel.DefaultChannelId</code> ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•ç”Ÿæˆ Channel çš„<strong>ä¸¤ç§</strong>ç¼–å·çš„ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">asShortText</span><span class="params">()</span> </span>{</span><br><span class="line">    String shortValue = <span class="keyword">this</span>.shortValue;</span><br><span class="line">    <span class="keyword">if</span> (shortValue == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">this</span>.shortValue = shortValue = ByteBufUtil.hexDump(data, data.length - RANDOM_LEN, RANDOM_LEN);</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> shortValue;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">asLongText</span><span class="params">()</span> </span>{</span><br><span class="line">    String longValue = <span class="keyword">this</span>.longValue;</span><br><span class="line">    <span class="keyword">if</span> (longValue == <span class="keyword">null</span>) {</span><br><span class="line">        <span class="keyword">this</span>.longValue = longValue = newLongValue();</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> longValue;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å¯¹äº <code>#asShortText()</code> æ–¹æ³•ï¼Œä»…ä½¿ç”¨æœ€å 4 å­—èŠ‚çš„éšæœºæ•°å­—ï¼Œå¹¶è½¬æ¢æˆ 16 è¿›åˆ¶çš„æ•°å­—å­—ç¬¦ä¸²ã€‚ä¹Ÿå› æ­¤ï¼ŒçŸ­ï¼Œä½†æ˜¯å…¨å±€éå”¯ä¸€ã€‚</li>
<li><p>å¯¹äº <code>#asLongText()</code> æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨ <code>#newLongValue()</code> æ–¹æ³•ç”Ÿæˆã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">newLongValue</span><span class="params">()</span> </span>{</span><br><span class="line">    StringBuilder buf = <span class="keyword">new</span> StringBuilder(<span class="number">2</span> * data.length + <span class="number">5</span>); <span class="comment">// + 5 çš„åŸå› æ˜¯æœ‰ 5 ä¸ª '-'</span></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    i = appendHexDumpField(buf, i, MACHINE_ID.length); <span class="comment">// MAC åœ°å€ã€‚</span></span><br><span class="line">    i = appendHexDumpField(buf, i, PROCESS_ID_LEN); <span class="comment">// è¿›ç¨‹ ID ã€‚4 å­—èŠ‚ã€‚</span></span><br><span class="line">    i = appendHexDumpField(buf, i, SEQUENCE_LEN); <span class="comment">// 32 ä½æ•°å­—ï¼Œé¡ºåºå¢é•¿ã€‚4 å­—èŠ‚ã€‚</span></span><br><span class="line">    i = appendHexDumpField(buf, i, TIMESTAMP_LEN); <span class="comment">// æ—¶é—´æˆ³ã€‚8 å­—èŠ‚ã€‚</span></span><br><span class="line">    i = appendHexDumpField(buf, i, RANDOM_LEN); <span class="comment">// 32 ä½æ•°å­—ï¼Œéšæœºã€‚4 å­—èŠ‚ã€‚</span></span><br><span class="line">    <span class="keyword">assert</span> i == data.length;</span><br><span class="line">    <span class="keyword">return</span> buf.substring(<span class="number">0</span>, buf.length() - <span class="number">1</span>);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">appendHexDumpField</span><span class="params">(StringBuilder buf, <span class="keyword">int</span> i, <span class="keyword">int</span> length)</span> </span>{</span><br><span class="line">    buf.append(ByteBufUtil.hexDump(data, i, length));</span><br><span class="line">    buf.append(<span class="string">'-'</span>);</span><br><span class="line">    i += length;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å…·ä½“çš„ç”Ÿæˆè§„åˆ™ï¼Œè§ä»£ç ã€‚æœ€ç»ˆä¹Ÿæ˜¯ 16 è¿›åˆ¶çš„æ•°å­—ã€‚ä¹Ÿå› æ­¤ï¼Œé•¿ï¼Œä½†æ˜¯å…¨å±€å”¯ä¸€ã€‚</li>
</ul>
</li>
</ul>
<h1 id="5-ChannelConfig"><a href="#5-ChannelConfig" class="headerlink" title="5. ChannelConfig"></a>5. ChannelConfig</h1><p><code>io.netty.channel.ChannelConfig</code> ï¼ŒChannel é…ç½®æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line">Map&lt;ChannelOption&lt;?&gt;, Object&gt; getOptions();</span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">getOption</span><span class="params">(ChannelOption&lt;T&gt; option)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">setOptions</span><span class="params">(Map&lt;ChannelOption&lt;?&gt;, ?&gt; options)</span></span>;</span><br><span class="line">&lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">setOption</span><span class="params">(ChannelOption&lt;T&gt; option, T value)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getConnectTimeoutMillis</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setConnectTimeoutMillis</span><span class="params">(<span class="keyword">int</span> connectTimeoutMillis)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getMaxMessagesPerRead</span><span class="params">()</span></span>;</span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="function">ChannelConfig <span class="title">setMaxMessagesPerRead</span><span class="params">(<span class="keyword">int</span> maxMessagesPerRead)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getWriteSpinCount</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setWriteSpinCount</span><span class="params">(<span class="keyword">int</span> writeSpinCount)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">ByteBufAllocator <span class="title">getAllocator</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setAllocator</span><span class="params">(ByteBufAllocator allocator)</span></span>;</span><br><span class="line"></span><br><span class="line">&lt;T extends RecvByteBufAllocator&gt; <span class="function">T <span class="title">getRecvByteBufAllocator</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setRecvByteBufAllocator</span><span class="params">(RecvByteBufAllocator allocator)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isAutoRead</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setAutoRead</span><span class="params">(<span class="keyword">boolean</span> autoRead)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isAutoClose</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setAutoClose</span><span class="params">(<span class="keyword">boolean</span> autoClose)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getWriteBufferHighWaterMark</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setWriteBufferHighWaterMark</span><span class="params">(<span class="keyword">int</span> writeBufferHighWaterMark)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getWriteBufferLowWaterMark</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setWriteBufferLowWaterMark</span><span class="params">(<span class="keyword">int</span> writeBufferLowWaterMark)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">MessageSizeEstimator <span class="title">getMessageSizeEstimator</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setMessageSizeEstimator</span><span class="params">(MessageSizeEstimator estimator)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function">WriteBufferWaterMark <span class="title">getWriteBufferWaterMark</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function">ChannelConfig <span class="title">setWriteBufferWaterMark</span><span class="params">(WriteBufferWaterMark writeBufferWaterMark)</span></span>;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><p>è°ƒç”¨ <code>#setOption(ChannelOption&lt;T&gt; option, T value)</code> æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨ç›¸åº”çš„ <code>#setXXX(...)</code> æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// DefaultChannelConfig.java</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"deprecation"</span>)</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">setOption</span><span class="params">(ChannelOption&lt;T&gt; option, T value)</span> </span>{</span><br><span class="line">    validate(option, value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (option == CONNECT_TIMEOUT_MILLIS) {</span><br><span class="line">        setConnectTimeoutMillis((Integer) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == MAX_MESSAGES_PER_READ) {</span><br><span class="line">        setMaxMessagesPerRead((Integer) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == WRITE_SPIN_COUNT) {</span><br><span class="line">        setWriteSpinCount((Integer) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == ALLOCATOR) {</span><br><span class="line">        setAllocator((ByteBufAllocator) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == RCVBUF_ALLOCATOR) {</span><br><span class="line">        setRecvByteBufAllocator((RecvByteBufAllocator) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == AUTO_READ) {</span><br><span class="line">        setAutoRead((Boolean) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == AUTO_CLOSE) {</span><br><span class="line">        setAutoClose((Boolean) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == WRITE_BUFFER_HIGH_WATER_MARK) {</span><br><span class="line">        setWriteBufferHighWaterMark((Integer) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == WRITE_BUFFER_LOW_WATER_MARK) {</span><br><span class="line">        setWriteBufferLowWaterMark((Integer) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == WRITE_BUFFER_WATER_MARK) {</span><br><span class="line">        setWriteBufferWaterMark((WriteBufferWaterMark) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == MESSAGE_SIZE_ESTIMATOR) {</span><br><span class="line">        setMessageSizeEstimator((MessageSizeEstimator) value);</span><br><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (option == SINGLE_EVENTEXECUTOR_PER_GROUP) {</span><br><span class="line">        setPinEventExecutorPerGroup((Boolean) value);</span><br><span class="line">    } <span class="keyword">else</span> {</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ChannelConfig çš„é…ç½®é¡¹ <code>io.netty.channel.ChannelOption</code> å¾ˆå¤šï¼Œèƒ–å‹å¯ä»¥çœ‹ä¸‹ <a href="https://www.jianshu.com/p/0bff7c020af2" rel="external nofollow noopener noreferrer" target="_blank">ã€ŠNettyï¼šoption å’Œ childOption å‚æ•°è®¾ç½®è¯´æ˜ã€‹</a> ï¼Œäº†è§£æ„Ÿå…´è¶£çš„é…ç½®é¡¹ã€‚</p>
</li>
</ul>
<h2 id="5-1-ç±»å›¾"><a href="#5-1-ç±»å›¾" class="headerlink" title="5.1 ç±»å›¾"></a>5.1 ç±»å›¾</h2><p>ChannelConfig çš„å­æ¥å£å’Œå®ç°ç±»å¦‚ä¸‹å›¾ï¼š</p>
<p><a href="http://static2.iocoder.cn/images/Netty/2018_07_01/05.png" title="ChannelConfig çš„å­æ¥å£å’Œå®ç°ç±»" class="fancybox" rel="article0"><img src="http://static2.iocoder.cn/images/Netty/2018_07_01/05.png" alt="ChannelConfig çš„å­æ¥å£å’Œå®ç°ç±»"></a><span class="caption">ChannelConfig çš„å­æ¥å£å’Œå®ç°ç±»</span></p>
<ul>
<li>å·²ç»ç»è¿‡è£å‰ªï¼Œä»…ä¿ç•™ NIO Channel ç›¸å…³çš„ ChannelConfig çš„å­æ¥å£å’Œå®ç°ç±»éƒ¨åˆ†ã€‚</li>
</ul>
<h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>æ­£å¦‚æ–‡å¤´æ‰€è¯´ï¼Œåœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä¸æ–­çœ‹åˆ° Netty Channel çš„èº«å½±ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åœ¨ <a href="http://svip.iocoder.cn/Netty/bootstrap-1-server/">ã€Šç²¾å°½ Netty æºç åˆ†æ â€”â€” å¯åŠ¨ï¼ˆä¸€ï¼‰ä¹‹æœåŠ¡ç«¯ã€‹</a> ä¸­ï¼Œæˆ‘ä»¬çœ‹äº†æœåŠ¡ç«¯ NioServerSocketChannel <strong>bind</strong> çš„è¿‡ç¨‹ã€‚</li>
<li>åœ¨ <a href="http://svip.iocoder.cn/Netty/bootstrap-2-client/">ã€Šç²¾å°½ Netty æºç åˆ†æ â€”â€” å¯åŠ¨ï¼ˆäºŒï¼‰ä¹‹å®¢æˆ·ç«¯ã€‹</a> ä¸­ï¼Œæˆ‘ä»¬çœ‹äº†å®¢æˆ·ç«¯ NioSocketChannel <strong>connect</strong> çš„è¿‡ç¨‹ã€‚ </li>
</ul>
<p>åœ¨åç»­çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ†äº« Netty NIO Channel çš„å…¶ä»–æ“ä½œï¼ŒğŸ˜ˆ ä¸€ç¯‡ä¸€ä¸ªæ“ä½œã€‚</p>
<hr>
<p>æ¨èé˜…è¯»æ–‡ç« ï¼š</p>
<ul>
<li>Hypercube <a href="https://www.jianshu.com/p/fffc18d33159" rel="external nofollow noopener noreferrer" target="_blank">ã€Šè‡ªé¡¶å‘ä¸‹æ·±å…¥åˆ†æ Nettyï¼ˆå…­ï¼‰â€“Channelæ€»è¿°ã€‹</a></li>
</ul>


</div>
<!--
<footer class="article-footer">
<a data-url="http://svip.iocoder.cn/Netty/Channel-1-intro/" data-id="ck4pl3foz00dnfgcfyrv52nd1" class="article-share-link">åˆ†äº«</a>



</footer>
-->
</div>