<div class="article-inner">


<header class="article-header">


<h1 class="article-title" itemprop="name">
ç²¾å°½ Netty æºç è§£æ â€”â€” ChannelHandlerï¼ˆä¸‰ï¼‰ä¹‹ SimpleChannelInboundHandler
</h1>


</header>

<div class="article-entry" itemprop="articleBody">

<!-- Table of Contents -->

<h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1. æ¦‚è¿°"></a>1. æ¦‚è¿°</h1><p>åœ¨æœ¬æ–‡ï¼Œæˆ‘ä»¬æ¥åˆ†äº« SimpleChannelInboundHandler å¤„ç†å™¨ã€‚è€ƒè™‘åˆ° Simple<strong>UserEvent</strong>ChannelHandler å’Œ SimpleChannelInboundHandler çš„å®ç°åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥ä¹Ÿä¼šåœ¨æœ¬æ–‡ä¸­åˆ†äº«ã€‚</p>
<p>å¦‚æœèƒ–å‹å¯¹ SimpleChannelInboundHandler çš„ä½¿ç”¨ä¸äº†è§£ï¼Œè¯·å…ˆçœ‹ä¸‹ <a href="https://blog.csdn.net/linuu/article/details/51307060" rel="external nofollow noopener noreferrer" target="_blank">ã€Šä¸€èµ·å­¦Nettyï¼ˆä¸‰ï¼‰ä¹‹ SimpleChannelInboundHandlerã€‹</a> ï¼Œå˜¿å˜¿ã€‚</p>
<h1 id="2-SimpleChannelInboundHandler"><a href="#2-SimpleChannelInboundHandler" class="headerlink" title="2. SimpleChannelInboundHandler"></a>2. SimpleChannelInboundHandler</h1><p><code>io.netty.channel.SimpleChannelInboundHandler</code> ï¼Œç»§æ‰¿ ChannelInboundHandlerAdapter ç±»ï¼ŒæŠ½è±¡ç±»ï¼Œå¤„ç†<strong>æŒ‡å®šç±»å‹</strong>çš„æ¶ˆæ¯ã€‚åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° SimpleChannelInboundHandler åï¼Œå®ç°å¯¹<strong>æŒ‡å®šç±»å‹</strong>çš„æ¶ˆæ¯çš„è‡ªå®šä¹‰å¤„ç†ã€‚</p>
<h2 id="2-1-æ„é€ æ–¹æ³•"><a href="#2-1-æ„é€ æ–¹æ³•" class="headerlink" title="2.1 æ„é€ æ–¹æ³•"></a>2.1 æ„é€ æ–¹æ³•</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">I</span>&gt; <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»å‹åŒ¹é…å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TypeParameterMatcher matcher;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨å®Œæ¶ˆæ¯ï¼Œæ˜¯å¦è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #channelRead(ChannelHandlerContext, Object)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> autoRelease;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * see {<span class="doctag">@link</span> #SimpleChannelInboundHandler(boolean)} with {<span class="doctag">@code</span> true} as boolean parameter.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleChannelInboundHandler</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance which will try to detect the types to match out of the type parameter of the class.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> autoRelease   {<span class="doctag">@code</span> true} if handled messages should be released automatically by passing them to</span></span><br><span class="line"><span class="comment">     *                      {<span class="doctag">@link</span> ReferenceCountUtil#release(Object)}.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleChannelInboundHandler</span><span class="params">(<span class="keyword">boolean</span> autoRelease)</span> </span>{</span><br><span class="line">        <span class="comment">// &lt;1&gt; è·å¾— matcher</span></span><br><span class="line">        matcher = TypeParameterMatcher.find(<span class="keyword">this</span>, SimpleChannelInboundHandler.class, <span class="string">"I"</span>);</span><br><span class="line">        <span class="keyword">this</span>.autoRelease = autoRelease;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * see {<span class="doctag">@link</span> #SimpleChannelInboundHandler(Class, boolean)} with {<span class="doctag">@code</span> true} as boolean value.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleChannelInboundHandler</span><span class="params">(Class&lt;? extends I&gt; inboundMessageType)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(inboundMessageType, <span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> inboundMessageType    The type of messages to match</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> autoRelease           {<span class="doctag">@code</span> true} if handled messages should be released automatically by passing them to</span></span><br><span class="line"><span class="comment">     *                              {<span class="doctag">@link</span> ReferenceCountUtil#release(Object)}.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleChannelInboundHandler</span><span class="params">(Class&lt;? extends I&gt; inboundMessageType, <span class="keyword">boolean</span> autoRelease)</span> </span>{</span><br><span class="line">        <span class="comment">// &lt;2&gt; è·å¾— matcher</span></span><br><span class="line">        matcher = TypeParameterMatcher.get(inboundMessageType);</span><br><span class="line">        <span class="keyword">this</span>.autoRelease = autoRelease;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... çœç•¥å…¶å®ƒæ–¹æ³•</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li><code>matcher</code> å±æ€§ï¼Œæœ‰<strong>ä¸¤ç§</strong>æ–¹å¼èµ‹å€¼ã€‚<ul>
<li>ã€å¸¸ç”¨ã€‘<code>&lt;1&gt;</code> å¤„ï¼Œä½¿ç”¨ç±»çš„ <code>I</code> æ³›å‹å¯¹åº”çš„ TypeParameterMatcher ç±»å‹åŒ¹é…å™¨ã€‚</li>
<li><code>&lt;2&gt;</code> å¤„ï¼Œä½¿ç”¨ <code>inboundMessageType</code> å‚æ•°å¯¹åº”çš„ TypeParameterMatcher ç±»å‹åŒ¹é…å™¨ã€‚</li>
<li>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¤ªéœ€è¦ç‰¹åˆ«è¯¦ç»†çš„äº†è§£ <code>io.netty.util.internal.TypeParameterMatcher</code> çš„ä»£ç å®ç°ï¼Œæ„Ÿå…´è¶£çš„èƒ–å‹å¯ä»¥è‡ªå·±çœ‹çœ‹ <a href="http://donald-draper.iteye.com/blog/2387772" rel="external nofollow noopener noreferrer" target="_blank">ã€Šnetty ç®€å•Inboundé€šé“å¤„ç†å™¨ï¼ˆSimpleChannelInboundHandlerï¼‰ã€‹</a> çš„ <a href="#">ã€ŒTypeParameterMatcherã€</a> éƒ¨åˆ†ã€‚</li>
</ul>
</li>
<li><code>autoRelease</code> å±æ€§ï¼Œä½¿ç”¨å®Œæ¶ˆæ¯ï¼Œæ˜¯å¦è‡ªåŠ¨é‡Šæ”¾ã€‚</li>
</ul>
<h2 id="2-2-acceptInboundMessage"><a href="#2-2-acceptInboundMessage" class="headerlink" title="2.2 acceptInboundMessage"></a>2.2 acceptInboundMessage</h2><p><code>#acceptInboundMessage(Object msg)</code> æ–¹æ³•ï¼Œåˆ¤æ–­æ¶ˆæ¯æ˜¯å¦åŒ¹é…ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns {<span class="doctag">@code</span> true} if the given message should be handled. If {<span class="doctag">@code</span> false} it will be passed to the next</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@link</span> ChannelInboundHandler} in the {<span class="doctag">@link</span> ChannelPipeline}.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">acceptInboundMessage</span><span class="params">(Object msg)</span> </span>{</span><br><span class="line">    <span class="keyword">return</span> matcher.match(msg);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<code>matcher</code> çš„ç±»å‹æ˜¯ ReflectiveMatcher( å®ƒæ˜¯ TypeParameterMatcher çš„å†…éƒ¨ç±» )ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ReflectiveMatcher</span> <span class="keyword">extends</span> <span class="title">TypeParameterMatcher</span> </span>{</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»å‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; type;</span><br><span class="line">    </span><br><span class="line">    ReflectiveMatcher(Class&lt;?&gt; type) {</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(Object msg)</span> </span>{</span><br><span class="line">        <span class="keyword">return</span> type.isInstance(msg); <span class="comment">// &lt;1&gt;</span></span><br><span class="line">    }</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>åŒ¹é…é€»è¾‘ï¼Œçœ‹ <code>&lt;1&gt;</code> å¤„ï¼Œä½¿ç”¨ <code>Class#isInstance(Object obj)</code> æ–¹æ³•ã€‚å¯¹äºè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬å®šä¹‰çš„ <code>I</code> æ³›å‹æ˜¯ä¸ªçˆ¶ç±»ï¼Œé‚£å¯ä»¥åŒ¹é…æ‰€æœ‰çš„å­ç±»ã€‚ä¾‹å¦‚ <code>I</code> è®¾ç½®ä¸º Object ç±»ï¼Œé‚£ä¹ˆæ‰€æœ‰æ¶ˆæ¯ï¼Œéƒ½å¯ä»¥è¢«åŒ¹é…åˆ—ã€‚</li>
</ul>
<h2 id="2-3-channelRead"><a href="#2-3-channelRead" class="headerlink" title="2.3 channelRead"></a>2.3 channelRead</h2><figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"> <span class="number">1</span>: <span class="meta">@Override</span></span><br><span class="line"> <span class="number">2</span>: <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">channelRead</span><span class="params">(ChannelHandlerContext ctx, Object msg)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line"> <span class="number">3</span>:     <span class="comment">// æ˜¯å¦è¦é‡Šæ”¾æ¶ˆæ¯</span></span><br><span class="line"> <span class="number">4</span>:     <span class="keyword">boolean</span> release = <span class="keyword">true</span>;</span><br><span class="line"> <span class="number">5</span>:     <span class="keyword">try</span> {</span><br><span class="line"> <span class="number">6</span>:         <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºåŒ¹é…çš„æ¶ˆæ¯</span></span><br><span class="line"> <span class="number">7</span>:         <span class="keyword">if</span> (acceptInboundMessage(msg)) {</span><br><span class="line"> <span class="number">8</span>:             <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line"> <span class="number">9</span>:             I imsg = (I) msg;</span><br><span class="line"><span class="number">10</span>:             <span class="comment">// å¤„ç†æ¶ˆæ¯</span></span><br><span class="line"><span class="number">11</span>:             channelRead0(ctx, imsg);</span><br><span class="line"><span class="number">12</span>:         } <span class="keyword">else</span> {</span><br><span class="line"><span class="number">13</span>:             <span class="comment">// ä¸éœ€è¦é‡Šæ”¾æ¶ˆæ¯</span></span><br><span class="line"><span class="number">14</span>:             release = <span class="keyword">false</span>;</span><br><span class="line"><span class="number">15</span>:             <span class="comment">// è§¦å‘ Channel Read åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line"><span class="number">16</span>:             ctx.fireChannelRead(msg);</span><br><span class="line"><span class="number">17</span>:         }</span><br><span class="line"><span class="number">18</span>:     } <span class="keyword">finally</span> {</span><br><span class="line"><span class="number">19</span>:         <span class="comment">// åˆ¤æ–­ï¼Œæ˜¯å¦è¦é‡Šæ”¾æ¶ˆæ¯</span></span><br><span class="line"><span class="number">20</span>:         <span class="keyword">if</span> (autoRelease &amp;&amp; release) {</span><br><span class="line"><span class="number">21</span>:             ReferenceCountUtil.release(msg);</span><br><span class="line"><span class="number">22</span>:         }</span><br><span class="line"><span class="number">23</span>:     }</span><br><span class="line"><span class="number">24</span>: }</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>ç¬¬ 4 è¡Œï¼š<code>release</code> å±æ€§ï¼Œæ˜¯å¦éœ€è¦é‡Šæ”¾æ¶ˆæ¯ã€‚</li>
<li><p>ç¬¬ 7 è¡Œï¼šè°ƒç”¨ <code>#acceptInboundMessage(Object msg)</code> æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºåŒ¹é…çš„æ¶ˆæ¯ã€‚</p>
<ul>
<li><p>â‘  <strong>åŒ¹é…</strong>ï¼Œè°ƒç”¨ <code>#channelRead0(ChannelHandlerContext ctx, I msg)</code> <strong>æŠ½è±¡</strong>æ–¹æ³•ï¼Œå¤„ç†æ¶ˆæ¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;strong&gt;Please keep in mind that this method will be renamed to</span></span><br><span class="line"><span class="comment"> * {<span class="doctag">@code</span> messageReceived(ChannelHandlerContext, I)} in 5.0.&lt;/strong&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Is called for each message of type {<span class="doctag">@link</span> I}.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> ctx           the {<span class="doctag">@link</span> ChannelHandlerContext} which this {<span class="doctag">@link</span> SimpleChannelInboundHandler}</span></span><br><span class="line"><span class="comment"> *                      belongs to</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> msg           the message to handle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception    is thrown if an error occurred</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, I msg)</span> <span class="keyword">throws</span> Exception</span>;</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>å­ç±»å®ç° SimpleChannelInboundHandler ç±»åï¼Œå®ç°è¯¥æ–¹æ³•ï¼Œå°±èƒ½å¾ˆæ–¹ä¾¿çš„å¤„ç†æ¶ˆæ¯ã€‚</li>
</ul>
</li>
<li>â‘¡ <strong>ä¸åŒ¹é…</strong>ï¼Œæ ‡è®°ä¸éœ€è¦é‡Šæ”¾æ¶ˆæ¯ï¼Œå¹¶è§¦å‘ Channel Read åˆ°<strong>ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</strong>ã€‚</li>
</ul>
</li>
<li>ç¬¬ 18 è‡³ 23 è¡Œï¼šé€šè¿‡ <code>release</code> å˜é‡ + <code>autoRelease</code> å±æ€§ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦é‡Šæ”¾æ¶ˆæ¯ã€‚è‹¥éœ€è¦ï¼Œè°ƒç”¨ <code>ReferenceCountUtil#release(Object msg)</code> æ–¹æ³•ï¼Œé‡Šæ”¾æ¶ˆæ¯ã€‚ğŸ˜ˆ è¿˜æ˜¯è›®æ–¹ä¾¿çš„ã€‚</li>
</ul>
<h1 id="3-SimpleUserEventChannelHandler"><a href="#3-SimpleUserEventChannelHandler" class="headerlink" title="3. SimpleUserEventChannelHandler"></a>3. SimpleUserEventChannelHandler</h1><p><code>io.netty.channel.SimpleUserEventChannelHandler</code> ï¼Œç»§æ‰¿ ChannelInboundHandlerAdapter ç±»ï¼ŒæŠ½è±¡ç±»ï¼Œå¤„ç†<strong>æŒ‡å®šäº‹ä»¶</strong>çš„æ¶ˆæ¯ã€‚</p>
<p>SimpleUserEventChannelHandler å’Œ SimpleChannelInboundHandler åŸºæœ¬ä¸€è‡´ï¼Œå·®åˆ«åœ¨äºå°†æŒ‡å®šç±»å‹çš„æ¶ˆæ¯ï¼Œæ”¹æˆäº†åˆ¶å®šç±»å‹çš„äº‹ä»¶ã€‚ğŸ˜ˆ æ‰€ä»¥ï¼Œç¬”è€…å°±ä¸è¯¦ç»†è§£æäº†ã€‚</p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleUserEventChannelHandler</span>&lt;<span class="title">I</span>&gt; <span class="keyword">extends</span> <span class="title">ChannelInboundHandlerAdapter</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç±»å‹åŒ¹é…å™¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TypeParameterMatcher matcher;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨å®Œæ¶ˆæ¯ï¼Œæ˜¯å¦è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #channelRead(ChannelHandlerContext, Object)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> autoRelease;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * see {<span class="doctag">@link</span> #SimpleUserEventChannelHandler(boolean)} with {<span class="doctag">@code</span> true} as boolean parameter.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleUserEventChannelHandler</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance which will try to detect the types to match out of the type parameter of the class.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> autoRelease   {<span class="doctag">@code</span> true} if handled events should be released automatically by passing them to</span></span><br><span class="line"><span class="comment">     *                      {<span class="doctag">@link</span> ReferenceCountUtil#release(Object)}.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleUserEventChannelHandler</span><span class="params">(<span class="keyword">boolean</span> autoRelease)</span> </span>{</span><br><span class="line">        matcher = TypeParameterMatcher.find(<span class="keyword">this</span>, SimpleUserEventChannelHandler.class, <span class="string">"I"</span>);</span><br><span class="line">        <span class="keyword">this</span>.autoRelease = autoRelease;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * see {<span class="doctag">@link</span> #SimpleUserEventChannelHandler(Class, boolean)} with {<span class="doctag">@code</span> true} as boolean value.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleUserEventChannelHandler</span><span class="params">(Class&lt;? extends I&gt; eventType)</span> </span>{</span><br><span class="line">        <span class="keyword">this</span>(eventType, <span class="keyword">true</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new instance</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventType      The type of events to match</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> autoRelease    {<span class="doctag">@code</span> true} if handled events should be released automatically by passing them to</span></span><br><span class="line"><span class="comment">     *                       {<span class="doctag">@link</span> ReferenceCountUtil#release(Object)}.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">SimpleUserEventChannelHandler</span><span class="params">(Class&lt;? extends I&gt; eventType, <span class="keyword">boolean</span> autoRelease)</span> </span>{</span><br><span class="line">        matcher = TypeParameterMatcher.get(eventType);</span><br><span class="line">        <span class="keyword">this</span>.autoRelease = autoRelease;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns {<span class="doctag">@code</span> true} if the given user event should be handled. If {<span class="doctag">@code</span> false} it will be passed to the next</span></span><br><span class="line"><span class="comment">     * {<span class="doctag">@link</span> ChannelInboundHandler} in the {<span class="doctag">@link</span> ChannelPipeline}.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">acceptEvent</span><span class="params">(Object evt)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="keyword">return</span> matcher.match(evt);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">userEventTriggered</span><span class="params">(ChannelHandlerContext ctx, Object evt)</span> <span class="keyword">throws</span> Exception </span>{</span><br><span class="line">        <span class="comment">// æ˜¯å¦è¦é‡Šæ”¾æ¶ˆæ¯</span></span><br><span class="line">        <span class="keyword">boolean</span> release = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºåŒ¹é…çš„æ¶ˆæ¯</span></span><br><span class="line">            <span class="keyword">if</span> (acceptEvent(evt)) {</span><br><span class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                I ievt = (I) evt;</span><br><span class="line">                <span class="comment">// å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">                eventReceived(ctx, ievt);</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// ä¸éœ€è¦é‡Šæ”¾æ¶ˆæ¯</span></span><br><span class="line">                release = <span class="keyword">false</span>;</span><br><span class="line">                <span class="comment">// è§¦å‘ Channel Read åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">                ctx.fireUserEventTriggered(evt);</span><br><span class="line">            }</span><br><span class="line">        } <span class="keyword">finally</span> {</span><br><span class="line">            <span class="comment">// åˆ¤æ–­ï¼Œæ˜¯å¦è¦é‡Šæ”¾æ¶ˆæ¯</span></span><br><span class="line">            <span class="keyword">if</span> (autoRelease &amp;&amp; release) {</span><br><span class="line">                ReferenceCountUtil.release(evt);</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Is called for each user event triggered of type {<span class="doctag">@link</span> I}.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> ctx the {<span class="doctag">@link</span> ChannelHandlerContext} which this {<span class="doctag">@link</span> SimpleUserEventChannelHandler} belongs to</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> evt the user event to handle</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception is thrown if an error occurred</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">eventReceived</span><span class="params">(ChannelHandlerContext ctx, I evt)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h1 id="666-å½©è›‹"><a href="#666-å½©è›‹" class="headerlink" title="666. å½©è›‹"></a>666. å½©è›‹</h1><p>æœ¨æœ‰å½©è›‹ï¼Œhoho ã€‚</p>


</div>
<!--
<footer class="article-footer">
<a data-url="http://svip.iocoder.cn/Netty/ChannelHandler-3-SimpleChannelInboundHandler/" data-id="ck4pl3fp800eafgcfs0vk8nsu" class="article-share-link">åˆ†äº«</a>



</footer>
-->
</div>