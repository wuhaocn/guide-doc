# ç²¾å°½ MyBatis æºç åˆ†æ â€”â€” è°ƒè¯•ç¯å¢ƒæ­å»º

[2020-01-01]()

# []( "1. ä¾èµ–å·¥å…·")1. ä¾èµ–å·¥å…·

* Maven
* Git
* JDK
* IntelliJ IDEA

# []( "2. æºç æ‹‰å–")2. æºç æ‹‰å–

ä»å®˜æ–¹ä»“åº“ [https://github.com/mybatis/mybatis-3](https://github.com/mybatis/mybatis-3)

Fork
å‡ºå±äºè‡ªå·±çš„ä»“åº“ã€‚ä¸ºä»€ä¹ˆè¦

Fork
ï¼Ÿæ—¢ç„¶å¼€å§‹é˜…è¯»ã€è°ƒè¯•æºç ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå†™ä¸€äº›æ³¨é‡Šï¼Œæœ‰äº†è‡ªå·±çš„ä»“åº“ï¼Œå¯ä»¥è¿›è¡Œè‡ªç”±çš„æäº¤ã€‚ğŸ˜ˆ

ä½¿ç”¨

IntelliJ IDEA
ä»

Fork
å‡ºæ¥çš„ä»“åº“æ‹‰å–ä»£ç ã€‚

æœ¬æ–‡ä½¿ç”¨çš„ MyBatis ç‰ˆæœ¬ä¸º

3.5.0-SNAPSHOT
ã€‚

å› ä¸º MyBatis æ˜¯æœ‰äº›å¹´ä»½çš„æ¡†æ¶ï¼Œæ‰€ä»¥å…‹éš†çš„è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œè€å¿ƒç­‰å¾…ã€‚

# []( "3. è°ƒè¯•")3. è°ƒè¯•

MyBatis æƒ³è¦è°ƒè¯•ï¼Œéå¸¸æ–¹ä¾¿ï¼Œåªéœ€è¦æ‰“å¼€

org.apache.ibatis.autoconstructor.AutoConstructorTest
å•å…ƒæµ‹è¯•ç±»ï¼Œä»»æ„ä¸€ä¸ªå•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œå³é”®ï¼Œå¼€å§‹è°ƒè¯•å³å¯ã€‚

å½“ç„¶ï¼Œè€ƒè™‘åˆ°è®©å¤§å®¶æ›´å¥½çš„ç†è§£ AutoConstructorTest è¿™ä¸ªç±»ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¯¦ç»†è§£æä¸‹ã€‚AutoConstructorTest æ‰€åœ¨åœ¨

autoconstructor
åŒ…ä¸‹ï¼Œæ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š

![åŒ…ç»“æ„å›¾](http://static2.iocoder.cn/images/MyBatis/2020_01_01/01.jpg)

# []( "4. mybatis-config.xml")4. mybatis-config.xml

mybatis-config.xml
ï¼ŒMyBatis é…ç½®æ–‡ä»¶ã€‚XML å¦‚ä¸‹ï¼š
```
<!DOCTYPE configuration
PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-config.dtd">
<configuration>
<!-- autoMappingBehavior should be set in each test case -->
<environments default="development">
<environment id="development">
<!-- é…ç½®äº‹åŠ¡ç®¡ç† -->
<transactionManager type="JDBC">
<property name="" value=""/>
</transactionManager>
<!-- é…ç½®æ•°æ®æº -->
<dataSource type="UNPOOLED">
<property name="driver" value="org.hsqldb.jdbcDriver"/>
<property name="url" value="jdbc:hsqldb:mem:automapping"/>
<property name="username" value="sa"/>
</dataSource>
</environment>
</environments>
<!-- æ‰«æ Mapper æ–‡ä»¶ -->
<mappers>
<mapper resource="org/apache/ibatis/autoconstructor/AutoConstructorMapper.xml"/>
</mappers>
</configuration>
```

* åœ¨

<environments />
æ ‡ç­¾ä¸­ï¼Œé…ç½®äº†äº‹åŠ¡ç®¡ç†å’Œæ•°æ®æºã€‚è€ƒè™‘åˆ°å‡å°‘å¤–éƒ¨ä¾èµ–ï¼Œæ‰€ä»¥ä½¿ç”¨äº† [HSQLDB](https://zh.wikipedia.org/wiki/HSQLDB) ã€‚
* åœ¨

<mappers />
æ ‡ç­¾ä¸­ï¼Œé…ç½®äº†éœ€è¦æ‰«æçš„ Mapper æ–‡ä»¶ã€‚ç›®å‰ï¼Œä»…ä»…æ‰«æ

AutoConstructorMapper.xml
æ–‡ä»¶ã€‚

# []( "5. AutoConstructorMapper.xml")5. AutoConstructorMapper.xml

AutoConstructorMapper.xml
ï¼ŒMapper æ–‡ä»¶ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.apache.ibatis.autoconstructor.AutoConstructorMapper">
</mapper>
```

* å¯¹åº”çš„æ¥å£ä¸º

org.apache.ibatis.autoconstructor.AutoConstructorMapper
ã€‚

## []( "5.1 AutoConstructorMapper")5.1 AutoConstructorMapper

```
public interface AutoConstructorMapper{
// ========== PrimitiveSubject ==========
@Select("SELECT /* FROM subject WHERE id = /#{id}")
PrimitiveSubject getSubject(final int id);
@Select("SELECT /* FROM subject")
List<PrimitiveSubject> getSubjects();
// ========== AnnotatedSubject ==========
@Select("SELECT /* FROM subject")
List<AnnotatedSubject> getAnnotatedSubjects();
// ========== BadSubject ==========
@Select("SELECT /* FROM subject")
List<BadSubject> getBadSubjects();
// ========== ExtensiveSubject ==========
@Select("SELECT /* FROM extensive_subject")
List<ExtensiveSubject> getExtensiveSubject();
}
```

* ä½¿ç”¨æ³¨è§£çš„æ–¹æ³•ï¼Œç¼–å†™ SQL ã€‚

# []( "6. CreateDB.sql")6. CreateDB.sql

CreateDB.sql
æ–‡ä»¶ï¼Œç”¨äºå•å…ƒæµ‹è¯•é‡Œï¼Œåˆå§‹åŒ–æ•°æ®åº“çš„æ•°æ®ã€‚å¦‚ä¸‹ï¼š
```
DROP TABLE subject
IF EXISTS;
DROP TABLE extensive_subject
IF EXISTS;
CREATE TABLE subject (
id INT NOT NULL,
name VARCHAR(20),
age INT NOT NULL,
height INT,
weight INT,
active BIT,
dt TIMESTAMP
);
CREATE TABLE extensive_subject (
aByte TINYINT,
aShort SMALLINT,
aChar CHAR,
anInt INT,
aLong BIGINT,
aFloat FLOAT,
aDouble DOUBLE,
aBoolean BIT,
aString VARCHAR(255),
anEnum VARCHAR(50),
aClob LONGVARCHAR,
aBlob LONGVARBINARY,
aTimestamp TIMESTAMP
);
INSERT INTO subject VALUES
(1, 'a', 10, 100, 45, 1, CURRENT_TIMESTAMP),
(2, 'b', 10, NULL, 45, 1, CURRENT_TIMESTAMP),
(2, 'c', 10, NULL, NULL, 0, CURRENT_TIMESTAMP);
INSERT INTO extensive_subject
VALUES
(1, 1, 'a', 1, 1, 1, 1.0, 1, 'a', 'AVALUE', 'ACLOB', 'aaaaaabbbbbb', CURRENT_TIMESTAMP),
(2, 2, 'b', 2, 2, 2, 2.0, 2, 'b', 'BVALUE', 'BCLOB', '010101010101', CURRENT_TIMESTAMP),
(3, 3, 'c', 3, 3, 3, 3.0, 3, 'c', 'CVALUE', 'CCLOB', '777d010078da', CURRENT_TIMESTAMP);
```

* åˆ›å»ºäº†

subject
è¡¨ï¼Œå¹¶åˆå§‹åŒ–ä¸‰æ¡æ•°æ®ã€‚
* åˆ›å»ºäº†

extensive_subject
è¡¨ï¼Œå¹¶åˆå§‹åŒ–ä¸‰æ¡æ•°æ®ã€‚

# []( "7. POJO")7. POJO

åœ¨ AutoConstructorMapper ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å››ä¸ª POJO ç±»ã€‚ä½†æ˜¯ï¼Œä»

CreateDB.sql
ä¸­ï¼Œå®é™…åªæœ‰ä¸¤ä¸ªè¡¨ã€‚è¿™ä¸ªæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­å¾€ä¸‹çœ‹å™¢ã€‚

## []( "7.1 AnnotatedSubject")7.1 AnnotatedSubject

```
package org.apache.ibatis.autoconstructor;
import org.apache.ibatis.annotations.AutomapConstructor;
public class AnnotatedSubject{
private final int id;
private final String name;
private final int age;
private final int height;
private final int weight;
public AnnotatedSubject(final int id, final String name, final int age, final int height, final int weight){
this.id = id;
this.name = name;
this.age = age;
this.height = height;
this.weight = weight;
}
@AutomapConstructor
public AnnotatedSubject(final int id, final String name, final int age, final Integer height, final Integer weight){
this.id = id;
this.name = name;
this.age = age;
this.height = height == null ? 0 : height;
this.weight = weight == null ? 0 : weight;
}
}
```

* å¯¹åº”

subject
è¡¨ã€‚
* @AutomapConstructor
æ³¨è§£ï¼Œè¡¨ç¤º MyBatis æŸ¥è¯¢åï¼Œåœ¨åˆ›å»º AnnotatedSubject å¯¹è±¡ï¼Œä½¿ç”¨è¯¥æ„é€ æ–¹æ³•ã€‚

* ğŸ˜ˆ å®é™…åœºæ™¯ä¸‹ï¼Œéå¸¸å°‘ä½¿ç”¨è¿™ä¸ªæ³¨è§£ï¼Œç”šè‡³ Google ä¸Šèµ„æ–™ä¹Ÿä¸å¤šã€‚

### []( "7.1.1 PrimitiveSubject")7.1.1 PrimitiveSubject

```
package org.apache.ibatis.autoconstructor;
import java.util.Date;
public class PrimitiveSubject{
private final int id;
private final String name;
private final int age;
private final int height;
private final int weight;
private final boolean active;
private final Date dt;
public PrimitiveSubject(final int id, final String name, final int age, final int height, final int weight, final boolean active, final Date dt){
this.id = id;
this.name = name;
this.age = age;
this.height = height;
this.weight = weight;
this.active = active;
this.dt = dt;
}
}
```

* å¯¹åº”çš„ä¹Ÿæ˜¯

subject
è¡¨ã€‚
* å’Œ AnnotatedSubject ä¸åŒï¼Œåœ¨å…¶æ„é€ æ–¹æ³•ä¸Šï¼Œ

weight
å’Œ

height
æ–¹æ³•å‚æ•°çš„ç±»å‹æ˜¯

int
ï¼Œè€Œä¸æ˜¯ Integer ã€‚é‚£ä¹ˆï¼Œå¦‚æœ

subject
è¡¨ä¸­çš„è®°å½•ï¼Œè¿™ä¸¤ä¸ªå­—æ®µä¸º

NULL
æ—¶ï¼Œä¼šåˆ›å»º PrimitiveSubject å¯¹è±¡æŠ¥é”™ã€‚

### []( "7.1.2 BadSubject")7.1.2 BadSubject

```
package org.apache.ibatis.autoconstructor;
public class BadSubject{
private final int id;
private final String name;
private final int age;
private final Height height;
private final Double weight;
public BadSubject(final int id, final String name, final int age, final Height height, final Double weight){
this.id = id;
this.name = name;
this.age = age;
this.height = height;
this.weight = weight == null ? 0 : weight;
}
private class Height{
}
}
```

* å¯¹åº”çš„ä¹Ÿæ˜¯

subject
è¡¨ã€‚
* å’Œ AnnotatedSubject ä¸åŒï¼Œåœ¨å…¶æ„é€ æ–¹æ³•ä¸Šï¼Œ

height
æ–¹æ³•å‚æ•°çš„ç±»å‹æ˜¯ Height ï¼Œè€Œä¸æ˜¯ Integer ã€‚å› ä¸º MyBatis æ— æ³•è¯†åˆ« Height ç±»ï¼Œæ‰€ä»¥ä¼šåˆ›å»º BadSubject å¯¹è±¡æŠ¥é”™ã€‚
è€è‰¿è‰¿ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒPOJO å¯¹è±¡é‡Œï¼Œä¸ä½¿ç”¨åŸºæœ¬ç±»å‹ã€‚

## []( "7.2 ExtensiveSubject")7.2 ExtensiveSubject

```
package org.apache.ibatis.autoconstructor;
public class ExtensiveSubject{
private final byte aByte;
private final short aShort;
private final char aChar;
private final int anInt;
private final long aLong;
private final float aFloat;
private final double aDouble;
private final boolean aBoolean;
private final String aString;
// enum types
private final TestEnum anEnum;
// array types
// string to lob types:
private final String aClob;
private final String aBlob;
public ExtensiveSubject(final byte aByte,
final short aShort,
final char aChar,
final int anInt,
final long aLong,
final float aFloat,
final double aDouble,
final boolean aBoolean,
final String aString,
final TestEnum anEnum,
final String aClob,
final String aBlob){
this.aByte = aByte;
this.aShort = aShort;
this.aChar = aChar;
this.anInt = anInt;
this.aLong = aLong;
this.aFloat = aFloat;
this.aDouble = aDouble;
this.aBoolean = aBoolean;
this.aString = aString;
this.anEnum = anEnum;
this.aClob = aClob;
this.aBlob = aBlob;
}
public enum TestEnum {
AVALUE, BVALUE, CVALUE;
}
}
```

* å¯¹åº”çš„ä¹Ÿæ˜¯

extensive_subject
è¡¨ã€‚
* è¿™æ˜¯ä¸ªå¤æ‚å¯¹è±¡ï¼ŒåŸºæœ¬æ¶µç›–äº†å„ç§ç±»å‹çš„æ•°æ®ã€‚

# []( "8. AutoConstructorTest")8. AutoConstructorTest

org.apache.ibatis.autoconstructor.AutoConstructorTest
ï¼Œå•å…ƒæµ‹è¯•ç±»ã€‚

## []( "8.1 setUp")8.1 setUp

```
private static SqlSessionFactory sqlSessionFactory;
@BeforeClass
public static void setUp() throws Exception{
// create a SqlSessionFactory
// åˆ›å»º SqlSessionFactory å¯¹è±¡ï¼ŒåŸºäº mybatis-config.xml é…ç½®æ–‡ä»¶ã€‚
try (Reader reader = Resources.getResourceAsReader("org/apache/ibatis/autoconstructor/mybatis-config.xml")) {
sqlSessionFactory = new SqlSessionFactoryBuilder().build(reader);
}
// populate in-memory database
// åˆå§‹åŒ–æ•°æ®åˆ°å†…å­˜æ•°æ®åº“ï¼ŒåŸºäº CreateDB.sql SQL æ–‡ä»¶ã€‚
BaseDataTest.runScript(sqlSessionFactory.getConfiguration().getEnvironment().getDataSource(),
"org/apache/ibatis/autoconstructor/CreateDB.sql");
}
```

* åˆ›å»º SqlSessionFactory å¯¹è±¡ï¼ŒåŸºäº

mybatis-config.xml
é…ç½®æ–‡ä»¶ã€‚
* åˆå§‹åŒ–æ•°æ®åˆ°å†…å­˜æ•°æ®åº“ï¼ŒåŸºäº

CreateDB.sql
SQL æ–‡ä»¶ã€‚

## []( "8.2 æµ‹è¯•æ–¹æ³•")8.2 æµ‹è¯•æ–¹æ³•

å³é”®ä»»ä¸€å•å…ƒæµ‹è¯•æ–¹æ³•ï¼Œæ„‰å¿«çš„è°ƒè¯•èµ·æ¥æŠŠã€‚

# []( "666. å½©è›‹")666. å½©è›‹

å°æ’¸æ€¡æƒ…ï¼Œå¤§æ’¸ä¼¤èº«ã€‚
* [MyBatis]()