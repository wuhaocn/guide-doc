<header class="article-header">
<h1 class="article-title">NIO æœåŠ¡å™¨ï¼ˆä¸€ï¼‰ä¹‹æŠ½è±¡ API</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>ä»æœ¬å°èŠ‚å¼€å§‹ï¼Œæˆ‘ä»¬æ¥åˆ†äº« Dubbo&nbsp;<strong>è‡ªå·±</strong>å®ç°çš„ NIO æœåŠ¡å™¨ï¼Œä½¿ç”¨åœ¨&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/references/protocol/dubbo.html" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo://</code></a>&nbsp;å’Œ&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/references/protocol/thrift.html" target="_blank" rel="external nofollow noopener noreferrer"><code>thrift://</code></a>&nbsp;åè®®ä¸Šã€‚</p>
<p>åœ¨ NIO æ¡†æ¶çš„é€‰å‹ä¸Šï¼Œå¼ºå¤§çš„ Java ç¤¾åŒºé‡Œæœ‰ minaã€nettyã€grizzly ç­‰ï¼Œç”šè‡³ netty æä¾›äº† 3.x å’Œ 4.x çš„ç‰ˆæœ¬ã€‚é‚£ä¹ˆè¯¥å’‹åŠå‘¢ï¼Ÿ</p>
<p>Dubbo å¼€å‘å›¢é˜Ÿçš„é€‰æ‹©æ˜¯ï¼š</p>
<ul>
<li>API å±‚ï¼š
<ul>
<li><code>dubbo-remoting-api</code></li>
</ul>
</li>
<li>å®ç°å±‚ï¼š
<ul>
<li><code>dubbo-remoting-netty3</code></li>
<li><code>dubbo-remoting-netty4</code></li>
<li><code>dubbo-remoting-mina</code></li>
<li><code>dubbo-remoting-grizzly</code></li>
<li><code>dubbo-remoting-p2p</code></li>
</ul>
</li>
</ul>
<p>å†é…åˆä¸Š Dubbo SPI çš„æœºåˆ¶ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå®šä¹‰ä½¿ç”¨å“ªä¸€ç§å…·ä½“çš„å®ç°ã€‚ç¾æ»‹æ»‹ã€‚</p>
<h1 id="2-ä¸€è§ˆ">2. ä¸€è§ˆ</h1>
<p>è¿˜æ˜¯è€æ ·å­ï¼Œç¬”è€…ä¹ æƒ¯æ€§å¯¹ä»£ç é‡è¿›è¡Œä¸‹ç»Ÿè®¡ï¼Œ<code>dubbo-remoting</code>&nbsp;çš„<strong>ä»£ç é‡</strong>å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_12_01/01.png" alt="ä»£ç é‡" /></p>
<p>WTF ï¼ï¼ï¼&nbsp;<code>dubbo-remoting-api</code>&nbsp;çš„ä»£ç é‡ç«Ÿç„¶è¿‘<strong>ä¸‡è¡Œ</strong>ï¼Ÿ</p>
<p>{__/}<br />( &bull; - &bull;)<br />/ã¤æ·¡å®š @èƒ–å‹</p>
<p>æˆ‘ä»¬æ¥é¦–å…ˆçœ‹ä¸€å¼ å›¾ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/design.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; æ¡†æ¶è®¾è®¡ã€‹</a></p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_12_01/02.png" alt="æ•´ä½“è®¾è®¡" /></p>
</blockquote>
<p><strong>çº¢æ¡†éƒ¨åˆ†</strong>ï¼ŒProtocol =&gt; Exchange =&gt; Transport =&gt; Serialize çš„è°ƒç”¨é¡ºåºã€‚</p>
<blockquote>
<ul>
<li><strong>exchange</strong>&nbsp;ä¿¡æ¯äº¤æ¢å±‚ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ Request, Response ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Exchanger, ExchangeChannel, ExchangeClient, ExchangeServerã€‚</li>
<li><strong>transport</strong>&nbsp;ç½‘ç»œä¼ è¾“å±‚ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Channel, Transporter, Client, Server, Codec</li>
<li><strong>serialize</strong>&nbsp;æ•°æ®åºåˆ—åŒ–å±‚ï¼šå¯å¤ç”¨çš„ä¸€äº›å·¥å…·ï¼Œæ‰©å±•æ¥å£ä¸º Serialization, ObjectInput, ObjectOutput, ThreadPool</li>
</ul>
</blockquote>
<p>åœ¨ç¬”è€…åˆçœ‹&nbsp;<code>dubbo-remoting-api</code>&nbsp;çš„ä»£ç æ—¶ï¼Œå¯¹&nbsp;<strong>exchange</strong>&nbsp;å’Œ&nbsp;<strong>transport</strong>&nbsp;çš„ç†è§£æ˜¯æ¯”è¾ƒæ¨¡ç³Šçš„ã€‚ç®€å•æ¥è¯´ï¼Œ<strong>exchange</strong>&nbsp;åœ¨&nbsp;<strong>transport</strong>&nbsp;ä¹‹ä¸Šï¼Œæ„é€ äº† Requestï¼ŒResponse æ¨¡å‹ï¼Œ<strong>ä¸€ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªå“åº”</strong>ã€‚è¿™æ ·çš„æ–¹å¼ï¼Œæ‰ç¬¦åˆæˆ‘ä»¬å®é™…ä¸šåŠ¡å¼€å‘çš„éœ€è¦ã€‚å½“ç„¶ï¼Œå³ä½¿æ˜¯ Requestï¼ŒResponse ä¹Ÿåˆ†æˆ<strong>åŒæ­¥å’Œå¼‚æ­¥</strong>è¿”å›ï¼Œé‡è¦çš„æ˜¯ï¼Œèƒ½å¤Ÿ<strong>ä¸€ä¸€æ˜ å°„</strong>ã€‚</p>
<p>èƒ–å‹å¦‚æœæœ‰å…´è¶£ï¼Œå¯ä»¥çœ‹çœ‹ï¼š</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Request%E2%80%93response" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠRequest&ndash;responseã€‹</a></li>
<li><a href="https://en.wikipedia.org/wiki/Client%E2%80%93server_model" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠClient&ndash;server modelã€‹</a></li>
</ul>
<p>çœ‹å®Œä»¥ä¸ŠçŸ¥è¯†ï¼Œæˆ‘ä»¬åœ¨å›è¿‡å¤´çœ‹&nbsp;<code>dubbo-remoting-api</code>&nbsp;çš„é¡¹ç›®ç»“æ„å°±æ¸…æ™°äº†ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_12_01/03.png" alt="dubbo-remoting-api" /></p>
<ul>
<li>æœ€å¤–å±‚ï¼šé€šç”¨æ¥å£ã€‚</li>
<li><code>buffer</code>&nbsp;åŒ…ï¼šç¼“å†²åŒºã€‚</li>
<li><code>exchange</code>&nbsp;åŒ…ï¼šä¿¡æ¯äº¤æ¢å±‚</li>
<li><code>transporter</code>&nbsp;åŒ…ï¼šç½‘ç»œä¼ è¾“å±‚</li>
<li><code>telnet</code>&nbsp;åŒ…ï¼š<a href="http://dubbo.apache.org/zh-cn/docs/dev/impls/telnet-handler.html" target="_blank" rel="external nofollow noopener noreferrer">Telnet å‘½ä»¤</a></li>
</ul>
<p>å¦‚ä¸Šçš„æ¯ä¸€å±‚/åŒ…ï¼Œæˆ‘ä»¬éƒ½ä¼šç‹¬ç«‹ä¸€ç¯‡æ–‡ç« ï¼Œè¿›è¡Œåˆ†äº«ã€‚<br />å½“ç„¶ï¼Œ<code>dubbo-remoting-api</code>&nbsp;æ¨¡å—ï¼Œåªè´Ÿè´£ API å±‚æŠ½è±¡å’Œéƒ¨åˆ†å®ç°ï¼Œæœ€ç»ˆèƒ½å¤Ÿ<strong>çœŸæ­£é€šä¿¡</strong>ï¼Œéœ€è¦&nbsp;<code>dubbo-remoting-netty</code>&nbsp;ç­‰ç­‰æ¨¡å—æ¥å®ç°ã€‚å¯¹åº”çš„æ¯ä¸€ä¸ªå®ç°æ¨¡å—ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯ç‹¬ç«‹ä¸€ç¯‡æ–‡ç« ã€‚</p>
<p>ğŸ™‚ æ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œç¾æ»‹æ»‹ï¼Ÿ</p>
<h1 id="3-æœ€å¤–å±‚ï¼šé€šç”¨æ¥å£">3. æœ€å¤–å±‚ï¼šé€šç”¨æ¥å£</h1>
<p>èƒ–å‹å…ˆçœ‹çœ‹&nbsp;<a href="https://blog.csdn.net/u013252773/article/details/21046697?self" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠNetty4.0å­¦ä¹ ç¬”è®°ç³»åˆ—ä¹‹ä¸€ï¼šServerä¸Clientçš„é€šè®¯ã€‹</a>&nbsp;<strong>æ•™ç¨‹æ–‡ç« </strong>ã€‚åœ¨è¯¥æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä½¿ç”¨ Netty åœ¨å››ä¸ªç±»ï¼š</p>
<blockquote>
<ul>
<li>1ã€HelloServer ï¼šserverç±»ï¼Œå¯åŠ¨Netty server</li>
<li>2ã€HelloServerInHandlerï¼šserverçš„handlerï¼Œæ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</li>
<li>3ã€HelloClientï¼šclientç±»ï¼Œå»ºç«‹äºNetty serverçš„è¿æ¥</li>
<li>4ã€HelloClientIntHandlerï¼šclientçš„handlerï¼Œæ¥æ”¶serverç«¯çš„æ¶ˆæ¯ï¼Œå¹¶å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯</li>
</ul>
</blockquote>
<p>æ°å¥½ï¼Œå’Œ&nbsp;<code>dubbo-remoting-api</code>&nbsp;æ¨¡å—ï¼Œå®šä¹‰çš„ Serverã€Clientã€ChannelHandler&nbsp;<strong>æ¥å£</strong>å¯¹åº”ã€‚æˆ‘ä»¬ä»¥<code>dubbo-remoting-netty4</code>&nbsp;æ¨¡å—çš„ï¼Œä¸¾ä¾‹å­ã€‚æ•´ç†å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>ä¸Šæ–‡</th>
<th><code>dubbo-remoting-api</code></th>
<th><code>dubbo-remoting-netty4</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>HelloServer</td>
<td>Server æ¥å£</td>
<td><a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyServer.java" target="_blank" rel="external nofollow noopener noreferrer">NettyServer</a>&nbsp;å®ç°ç±»</td>
</tr>
<tr>
<td>HelloServerInHandlerï¼šserver</td>
<td>ChannelHandler æ¥å£</td>
<td><a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyServerHandler.java" target="_blank" rel="external nofollow noopener noreferrer">NettyServerHandler</a>&nbsp;å®ç°ç±»</td>
</tr>
<tr>
<td>HelloClient</td>
<td>Client æ¥å£</td>
<td><a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyClient.java" target="_blank" rel="external nofollow noopener noreferrer">NettyClient</a>&nbsp;å®ç°ç±»</td>
</tr>
<tr>
<td>HelloServerInHandler</td>
<td>ChannelHandler æ¥å£</td>
<td><a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyClientHandler.java" target="_blank" rel="external nofollow noopener noreferrer">NettyClientHandler</a>&nbsp;å®ç°ç±»</td>
</tr>
</tbody>
</table>
<p>å› ä¸º<strong>æ•™ç¨‹æ–‡ç« </strong>ï¼Œä»¥æ•™ç¨‹ Demo ä¸ºå‡†ï¼Œå®é™…ä¼šæœ‰æ›´å¤šéœ€è¦æŠ½è±¡çš„ï¼Œä¾‹å¦‚ï¼šCodec åè®®ç¼–è§£ç ï¼ŒDispatcher æ¶ˆæ¯ç­‰åˆ†å‘ã€‚èƒ–å‹å†æ¥çœ‹çœ‹&nbsp;<code>dubbo://</code>&nbsp;çš„å¤„ç†æµç¨‹ï¼š</p>
<blockquote>
<p>FROM&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/references/protocol/dubbo.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; dubbo://ã€‹</a><br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_12_01/04.png" alt="dubbo:// " /></p>
<ul>
<li>Transporter: mina, netty, grizzy</li>
<li>Serialization: dubbo, hessian2, java, json</li>
<li>Dispatcher: all, direct, message, execution, connection</li>
<li>ThreadPool: fixed, cached</li>
</ul>
</blockquote>
<p>å¦‚æœè¿™ä¸ªå›¾è¯»ä¸æ‡‚ï¼Œæ²¡å…³ç³»ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹æ¯ä¸ªæ¥å£ã€‚åé¢ï¼Œèƒ–å‹å¯ä»¥å›è¿‡å¤´æ¥ç†è§£è¿™ä¸ªå›¾ã€‚</p>
<p><strong>æœ¬æ–‡æ¶‰åŠçš„ç±»å›¾å¦‚ä¸‹</strong>ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_12_01/05.png" alt="ç±»å›¾" /></p>
<h1 id="4-Endpoint">4. Endpoint</h1>
<p><code>com.alibaba.dubbo.remoting.Endpoint</code>&nbsp;ï¼Œ<strong>ç«¯ç‚¹</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>å±æ€§ç›¸å…³</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function">URL <span class="title">getUrl</span><span class="params">()</span></span>;</span><br /><br /><span class="line"><span class="function">InetSocketAddress <span class="title">getLocalAddress</span><span class="params">()</span></span>;</span><br /><br /><span class="line"><span class="function">ChannelHandler <span class="title">getChannelHandler</span><span class="params">()</span></span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>å‘é€æ¶ˆæ¯</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send</span><span class="params">(Object message)</span> <span class="keyword">throws</span> RemotingException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send</span><span class="params">(Object message, <span class="keyword">boolean</span> sent)</span> <span class="keyword">throws</span> RemotingException</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>å…³ç³»ç›¸å…³</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">()</span></span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">close</span><span class="params">(<span class="keyword">int</span> timeout)</span></span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">startClose</span><span class="params">()</span></span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isClosed</span><span class="params">()</span></span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<p>Endpoint ï¼Œä»ä¸­æ–‡ä¸Šè§£é‡Šæ¥è¯´æ˜¯ï¼Œ&ldquo;<strong>ç«¯ç‚¹</strong>&rdquo;ã€‚ä»å­—é¢ä¸Šæ¥çœ‹ï¼Œä¸å¤ªå®¹æ˜“ç†è§£ã€‚åœ¨&nbsp;<code>dubbo-remoting-api</code>&nbsp;ä¸­ï¼Œä¸€ä¸ª Client æˆ– Server ï¼Œéƒ½æ˜¯ä¸€ä¸ª Endpoint ã€‚ğŸ™‚ ä¸åŒç³»ç»Ÿçš„ï¼ŒEndpoint ä»£è¡¨çš„ä¼šç•¥æœ‰å·®è·ï¼Œä¾‹å¦‚ SpringMVC ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚ Restful URL ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª Endpoint ï¼Œèƒ–å‹å¯ä»¥ Google æŸ¥è¯¢ï¼Œç†è§£æ›´å¤šã€‚</p>
<h2 id="4-1-Channel">4.1 Channel</h2>
<p><code>com.alibaba.dubbo.remoting.Channel</code>&nbsp;ï¼Œç»§æ‰¿ Endpoint æ¥å£ï¼Œ<strong>é€šé“</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>è¿æ¥ç›¸å…³</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function">InetSocketAddress <span class="title">getRemoteAddress</span><span class="params">()</span></span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isConnected</span><span class="params">()</span></span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>å±æ€§ç›¸å…³</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">hasAttribute</span><span class="params">(String key)</span></span>;</span><br /><span class="line"><span class="function">Object <span class="title">getAttribute</span><span class="params">(String key)</span></span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setAttribute</span><span class="params">(String key, Object value)</span></span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">removeAttribute</span><span class="params">(String key)</span></span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<p>å’Œ Netty Channel ä¸€è‡´ï¼Œ<strong>é€šè®¯çš„è½½ä½“</strong>ã€‚åœ¨åé¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨&nbsp;<code>dubbo-remoting-netty4</code>&nbsp;é¡¹ç›®ä¸­ï¼Œ<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyChannel.java" target="_blank" rel="external nofollow noopener noreferrer">NettyChannel</a>&nbsp;æ˜¯ Dubbo Channel çš„å®ç°ï¼Œå†…éƒ¨æœ‰<strong>çœŸæ­£çš„</strong>&nbsp;Netty Channel å±æ€§ï¼Œç”¨äº<strong>é€šè®¯</strong>ã€‚</p>
<h2 id="4-2-Client">4.2 Client</h2>
<p><code>com.alibaba.dubbo.remoting.Client</code>&nbsp;ï¼Œå®ç° Endpoint å’Œ Channel å’Œ Resetable æ¥å£ï¼Œ<strong>å®¢æˆ·ç«¯</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// é‡è¿</span></span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reconnect</span><span class="params">()</span> <span class="keyword">throws</span> RemotingException</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="4-3-Server">4.3 Server</h2>
<p><code>com.alibaba.dubbo.remoting.Server</code>&nbsp;ï¼Œç»§æ‰¿ Endpoint å’Œ Resetable æ¥å£ï¼Œ<strong>æœåŠ¡å™¨</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// æ˜¯å¦ç»‘å®šæœ¬åœ°ç«¯å£ï¼Œæä¾›æœåŠ¡ã€‚å³ï¼Œæ˜¯å¦å¯åŠ¨æˆåŠŸï¼Œå¯è¿æ¥ï¼Œæ¥æ”¶æ¶ˆæ¯ç­‰ã€‚</span></span><br /><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isBound</span><span class="params">()</span></span>;</span><br /><br /><span class="line"><span class="comment">// è·å¾—è¿æ¥ä¸ŠæœåŠ¡å™¨çš„é€šé“ï¼ˆå®¢æˆ·ç«¯ï¼‰ä»¬</span></span><br /><span class="line"><span class="function">Collection&lt;Channel&gt; <span class="title">getChannels</span><span class="params">()</span></span>;</span><br /><span class="line"><span class="function">Channel <span class="title">getChannel</span><span class="params">(InetSocketAddress remoteAddress)</span></span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h3 id="4-3-1-Resetable">4.3.1 Resetable</h3>
<p><code>com.alibaba.dubbo.common.Resetable</code>&nbsp;ï¼Œ<strong>å¯é‡ç½®</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">(URL url)</span></span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>Server å®ç° Resetable æ¥å£ï¼Œåœ¨å®ç°&nbsp;<code>#reset(url)</code>&nbsp;æ–¹æ³•ï¼Œç”¨äºæ ¹æ®æ–°ä¼ å…¥çš„&nbsp;<code>url</code>&nbsp;å±æ€§ï¼Œé‡ç½®è‡ªå·±å†…éƒ¨çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚&nbsp;<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/transport/AbstractServer.java#L80-L129" target="_blank" rel="external nofollow noopener noreferrer"><code>AbstractServer#reset(url)</code></a>&nbsp;æ–¹æ³•ã€‚</p>
<h1 id="5-ChannelHandler">5. ChannelHandler</h1>
<p><code>com.alibaba.dubbo.remoting.ChannelHandler</code>&nbsp;ï¼Œ<strong>é€šé“å¤„ç†å™¨</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connected</span><span class="params">(Channel channel)</span> <span class="keyword">throws</span> RemotingException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disconnected</span><span class="params">(Channel channel)</span> <span class="keyword">throws</span> RemotingException</span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sent</span><span class="params">(Channel channel, Object message)</span> <span class="keyword">throws</span> RemotingException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">received</span><span class="params">(Channel channel, Object message)</span> <span class="keyword">throws</span> RemotingException</span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">caught</span><span class="params">(Channel channel, Throwable exception)</span> <span class="keyword">throws</span> RemotingException</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>å’Œ Netty ChannelHandler ä¸€è‡´ï¼Œ<strong>è´Ÿè´£ Channel ä¸­çš„é€»è¾‘å¤„ç†</strong>ã€‚åœ¨åé¢çš„æ–‡ç« ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°åœ¨&nbsp;<code>dubbo-remoting-netty4</code>&nbsp;é¡¹ç›®ä¸­ï¼Œ<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyServerHandler.java" target="_blank" rel="external nofollow noopener noreferrer">NettyServerHandler</a>&nbsp;æ˜¯ Netty ChannelHandler çš„å®ç°ï¼Œå†…éƒ¨è°ƒç”¨ Netty ChannelHandler çš„æ–¹æ³•ï¼Œè¿›è¡Œé€»è¾‘å¤„ç†ã€‚</p>
<h1 id="6-Transporter">6. Transporter</h1>
<p><code>com.alibaba.dubbo.remoting.Transporter</code>&nbsp;ï¼Œ<strong>ç½‘ç»œä¼ è¾“</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span>(<span class="string">"netty"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Transporter</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Bind a server.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * ç»‘å®šä¸€ä¸ªæœåŠ¡å™¨</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> url     server url</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler é€šé“å¤„ç†å™¨</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> server æœåŠ¡å™¨</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RemotingException å½“ç»‘å®šå‘ç”Ÿå¼‚å¸¸æ—¶</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.remoting.Transporters#bind(URL, Receiver, ChannelHandler)</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span>({Constants.SERVER_KEY, Constants.TRANSPORTER_KEY})</span><br /><span class="line">    <span class="function">Server <span class="title">bind</span><span class="params">(URL url, ChannelHandler handler)</span> <span class="keyword">throws</span> RemotingException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Connect to a server.</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * è¿æ¥ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå³åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> url     server url æœåŠ¡å™¨åœ°å€</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> handler é€šé“å¤„ç†å™¨</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> client å®¢æˆ·ç«¯</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RemotingException å½“è¿æ¥å‘ç”Ÿå¼‚å¸¸æ—¶</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@see</span> com.alibaba.dubbo.remoting.Transporters#connect(URL, Receiver, ChannelListener)</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span>({Constants.CLIENT_KEY, Constants.TRANSPORTER_KEY})</span><br /><span class="line">    <span class="function">Client <span class="title">connect</span><span class="params">(URL url, ChannelHandler handler)</span> <span class="keyword">throws</span> RemotingException</span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>@SPI("netty")</code>&nbsp;æ³¨è§£ï¼ŒDubbo SPI&nbsp;<strong>æ‹“å±•ç‚¹</strong>ï¼Œé»˜è®¤ä¸º&nbsp;<code>"netty"</code>&nbsp;ã€‚æ³¨æ„ï¼Œæ­¤å¤„çš„&nbsp;<code>netty</code>&nbsp;å¯¹åº”çš„æ˜¯ netty3 ï¼Œå› ä¸º Dubbo é¡¹ç›®åœ¨å¼€å‘æ—¶ï¼Œnetty4 å¹¶æœªå‘å¸ƒã€‚é…ç½®æ–¹å¼è§&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/netty4.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; Netty4ã€‹</a>&nbsp;æ–‡æ¡£ã€‚</li>
<li><code>@Adaptive({Constants.SERVER_KEY, Constants.TRANSPORTER_KEY})</code>&nbsp;æ³¨è§£ï¼ŒåŸºäº Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ Server å®ç°ï¼Œä½¿ç”¨&nbsp;<code>URL.server</code>&nbsp;æˆ–&nbsp;<code>URL.transporter</code>&nbsp;å±æ€§ã€‚</li>
<li><code>@Adaptive({Constants.CLIENT_KEY, Constants.TRANSPORTER_KEY})</code>&nbsp;æ³¨è§£ï¼ŒåŸºäº Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ Client å®ç°ï¼Œä½¿ç”¨&nbsp;<code>URL.client</code>&nbsp;æˆ–&nbsp;<code>URL.transporter</code>&nbsp;å±æ€§ã€‚</li>
</ul>
<h2 id="6-1-Transporters">6.1 Transporters</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/7fad710c2dbf66356d5e7b7995e843b8f6225652/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/Transporters.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.remoting.Transporters</code></a>&nbsp;ï¼ŒTransporter é—¨é¢ç±»ã€‚</p>
<blockquote>
<p>å‹æƒ…æç¤ºï¼šFacade è®¾è®¡æ¨¡å¼ï¼Œå‚è§&nbsp;<a href="https://blog.csdn.net/hguisu/article/details/7533759" target="_blank" rel="external nofollow noopener noreferrer">ã€Š è®¾è®¡æ¨¡å¼ï¼ˆä¹ï¼‰å¤–è§‚æ¨¡å¼Facadeï¼ˆç»“æ„å‹ï¼‰ã€‹</a>&nbsp;æ–‡ç« ã€‚</p>
</blockquote>
<p><code>#bind(String url, ChannelHandler... handler)</code>&nbsp;<strong>é™æ€</strong>æ–¹æ³•ï¼Œç»‘å®šä¸€ä¸ªæœåŠ¡å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Server <span class="title">bind</span><span class="params">(String url, ChannelHandler... handler)</span> <span class="keyword">throws</span> RemotingException </span>{</span><br /><span class="line"> <span class="number">2</span>:     <span class="keyword">return</span> bind(URL.valueOf(url), handler);</span><br /><span class="line"> <span class="number">3</span>: }</span><br /><span class="line"> <span class="number">4</span>: </span><br /><span class="line"> <span class="number">5</span>: <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Server <span class="title">bind</span><span class="params">(URL url, ChannelHandler... handlers)</span> <span class="keyword">throws</span> RemotingException </span>{</span><br /><span class="line"> <span class="number">6</span>:     <span class="keyword">if</span> (url == <span class="keyword">null</span>) {</span><br /><span class="line"> <span class="number">7</span>:         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"url == null"</span>);</span><br /><span class="line"> <span class="number">8</span>:     }</span><br /><span class="line"> <span class="number">9</span>:     <span class="keyword">if</span> (handlers == <span class="keyword">null</span> || handlers.length == <span class="number">0</span>) {</span><br /><span class="line"><span class="number">10</span>:         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"handlers == null"</span>);</span><br /><span class="line"><span class="number">11</span>:     }</span><br /><span class="line"><span class="number">12</span>:     <span class="comment">// åˆ›å»º handler</span></span><br /><span class="line"><span class="number">13</span>:     ChannelHandler handler;</span><br /><span class="line"><span class="number">14</span>:     <span class="keyword">if</span> (handlers.length == <span class="number">1</span>) {</span><br /><span class="line"><span class="number">15</span>:         handler = handlers[<span class="number">0</span>];</span><br /><span class="line"><span class="number">16</span>:     } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">17</span>:         handler = <span class="keyword">new</span> ChannelHandlerDispatcher(handlers);</span><br /><span class="line"><span class="number">18</span>:     }</span><br /><span class="line"><span class="number">19</span>:     <span class="comment">// åˆ›å»º Server å¯¹è±¡</span></span><br /><span class="line"><span class="number">20</span>:     <span class="keyword">return</span> getTransporter().bind(url, handler);</span><br /><span class="line"><span class="number">21</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å’Œ&nbsp;<code>Transporter#bind(url, handler)</code>&nbsp;æ–¹æ³•ï¼Œå¯¹åº”ã€‚</li>
<li>ç¬¬ 12 è‡³ 18 è¡Œï¼šåˆ›å»º&nbsp;<code>handler</code>&nbsp;ã€‚è‹¥&nbsp;<code>handlers</code>&nbsp;æ˜¯å¤šä¸ªï¼Œä½¿ç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/7fad710c2dbf66356d5e7b7995e843b8f6225652/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/transport/ChannelHandlerDispatcher.java" target="_blank" rel="external nofollow noopener noreferrer">ChannelHandlerDispatcher</a>&nbsp;è¿›è¡Œå°è£…ã€‚åœ¨ ChannelHandlerDispatcher ä¸­ï¼Œä¼šå¾ªç¯è°ƒç”¨&nbsp;<code>handlers</code>&nbsp;ï¼Œå¯¹åº”çš„æ–¹æ³•ã€‚</li>
<li>
<p>ç¬¬ 20 è¡Œï¼šè°ƒç”¨&nbsp;<code>#getTransporter()</code>&nbsp;æ–¹æ³•ï¼ŒåŸºäº Dubbo SPI æœºåˆ¶ï¼Œè·å¾— Transporter$Adaptive å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Transporter <span class="title">getTransporter</span><span class="params">()</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> ExtensionLoader.getExtensionLoader(Transporter.class).getAdaptiveExtension();</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>ç¬¬ 20 è¡Œï¼šè°ƒç”¨&nbsp;<code>Transporter#bind(url, handler)</code>&nbsp;æ–¹æ³•ï¼Œåœ¨ Transporter$Adaptive å¯¹è±¡ä¸­ï¼Œä¼šæ ¹æ®&nbsp;<code>url</code>&nbsp;å‚æ•°ï¼Œè·å¾—å¯¹åº”çš„&nbsp;<strong>Transporter å®ç°å¯¹è±¡</strong>ï¼ˆä¾‹å¦‚ï¼Œ&nbsp;<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyTransporter.java" target="_blank" rel="external nofollow noopener noreferrer">NettyTransporter</a>ï¼‰ï¼Œä»è€Œåˆ›å»ºå¯¹åº”çš„ Server å¯¹è±¡ï¼ˆä¾‹å¦‚ï¼Œ&nbsp;<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-netty4/src/main/java/com/alibaba/dubbo/remoting/transport/netty4/NettyServer.java" target="_blank" rel="external nofollow noopener noreferrer">NettyServer</a>ï¼‰ã€‚</p>
</li>
</ul>
<p>å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ª&nbsp;<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/Transporters.java#L59-L76" target="_blank" rel="external nofollow noopener noreferrer"><code>#connect(url, handler)</code></a>&nbsp;<strong>é™æ€</strong>æ–¹æ³•ï¼Œè¿æ¥ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå³åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ã€‚ğŸ™‚ å’Œä¸Šé¢æ–¹æ³•ç±»ä¼¼ï¼Œèƒ–å‹è‡ªå·±çœ‹å’¯ã€‚</p>
<h1 id="7-Codec2">7. Codec2</h1>
<p><code>com.alibaba.dubbo.remoting.Codec2</code>&nbsp;ï¼Œ<strong>ç¼–è§£ç å™¨</strong>æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * ç¼–ç </span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@param</span> channel é€šé“</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@param</span> buffer Buffer</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@param</span> message æ¶ˆæ¯</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException å½“ç¼–ç å‘ç”Ÿå¼‚å¸¸æ—¶</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Adaptive</span>({Constants.CODEC_KEY})</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">encode</span><span class="params">(Channel channel, ChannelBuffer buffer, Object message)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * è§£ç </span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@param</span> channel é€šé“</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@param</span> buffer Buffer</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@return</span> æ¶ˆæ¯</span></span><br /><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException å½“è§£ç å‘ç”Ÿå¼‚å¸¸æ—¶</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="meta">@Adaptive</span>({Constants.CODEC_KEY})</span><br /><span class="line"><span class="function">Object <span class="title">decode</span><span class="params">(Channel channel, ChannelBuffer buffer)</span> <span class="keyword">throws</span> IOException</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>@SPI("netty")</code>&nbsp;æ³¨è§£ï¼ŒDubbo SPI&nbsp;<strong>æ‹“å±•ç‚¹</strong>ã€‚</li>
<li><code>@Adaptive({Constants.CODEC_KEY})</code>&nbsp;æ³¨è§£ï¼ŒåŸºäº Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ Codec2 å®ç°ï¼Œä½¿ç”¨&nbsp;<code>URL.codec</code>&nbsp;å±æ€§ã€‚</li>
</ul>
<p>å¦å¤–ï¼Œè§£ç è¿‡ç¨‹ä¸­ï¼Œéœ€è¦è§£å†³ TCP æ‹†åŒ…ã€ç²˜åŒ…çš„åœºæ™¯ï¼Œå› æ­¤è§£ç ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// Codec2.java</span></span><br /><span class="line"><span class="keyword">enum</span> DecodeResult {</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * éœ€è¦æ›´å¤šè¾“å…¥</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    NEED_MORE_INPUT,</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * å¿½ç•¥ä¸€äº›è¾“å…¥</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    SKIP_SOME_INPUT</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ç›®å‰&nbsp;<code>SKIP_SOME_INPUT</code>&nbsp;ï¼Œæš‚æœªä½¿ç”¨ã€‚</li>
<li>æ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥æå‰çœ‹ä¸‹&nbsp;<a href="http://chen-tao.github.io/2015/10/03/nettytcp/" target="_blank" rel="external nofollow noopener noreferrer">ã€Šé«˜æ€§èƒ½ç½‘ç»œæ¡†æ¶Nettyçš„TCPæ‹†åŒ…ã€ç²˜åŒ…è§£å†³æ–¹æ¡ˆã€‹</a>&nbsp;æ–‡ç« ã€‚åœ¨åç»­çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ—¢ä¼šçœ‹åˆ°åŸºäº<strong>é•¿åº¦</strong>çš„æ–¹æ¡ˆï¼Œä¹Ÿä¼šçœ‹åˆ°åŸºäº<strong>ç•Œå®šç¬¦</strong>çš„æ–¹æ¡ˆã€‚</li>
</ul>
<h2 id="7-1-Codec">7.1 Codec</h2>
<p><a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/Codec.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.remoting.Codec</code>&nbsp;</a>ï¼Œ<strong>è€çš„</strong>ç¼–è§£ç å™¨æ¥å£ï¼Œè¢« Codec2 å–ä»£ã€‚</p>
<p>é€šè¿‡&nbsp;<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/transport/codec/CodecAdapter.java" target="_blank" rel="external nofollow noopener noreferrer">CodecAdapter</a>&nbsp;ï¼Œå°† Codec é€‚é…æˆ Codec2 ã€‚</p>
<h2 id="7-2-Decodeable">7.2 Decodeable</h2>
<p><code>com.alibaba.dubbo.remoting.Decodeable</code>&nbsp;ï¼Œ<strong>å¯è§£ç </strong>çš„æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// è§£ç </span></span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">decode</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h1 id="8-Dispatcher">8. Dispatcher</h1>
<p><code>com.alibaba.dubbo.remoting.Dispatcher</code>&nbsp;ï¼Œ<strong>è°ƒåº¦å™¨</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span>(AllDispatcher.NAME)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Dispatcher</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@Adaptive</span>({Constants.DISPATCHER_KEY, <span class="string">"dispather"</span>, <span class="string">"channel.handler"</span>})</span><br /><span class="line">    <span class="comment">// The last two parameters are reserved for compatibility with the old configuration</span></span><br /><span class="line">    <span class="function">ChannelHandler <span class="title">dispatch</span><span class="params">(ChannelHandler handler, URL url)</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>@SPI(AllDispatcher.NAME)</code>&nbsp;æ³¨è§£ï¼ŒDubbo SPI&nbsp;<strong>æ‹“å±•ç‚¹</strong>ï¼Œé»˜è®¤ä¸º&nbsp;<code>"all"</code>&nbsp;ã€‚</li>
<li><code>@Adaptive({Constants.DISPATCHER_KEY, "dispather", "channel.handler"})</code>&nbsp;æ³¨è§£ï¼ŒåŸºäº Dubbo SPI Adaptive æœºåˆ¶ï¼ŒåŠ è½½å¯¹åº”çš„ ChanelHander å®ç°ï¼Œä½¿ç”¨&nbsp;<code>URL.dispatcher</code>&nbsp;å±æ€§ã€‚</li>
<li>ä¸ºä»€ä¹ˆä¼ å…¥çš„&nbsp;<code>handler</code>&nbsp;å‚æ•°ï¼Œåˆ›å»ºè¿”å›çš„è¿˜æ˜¯ ChannelHandler å¯¹è±¡å‘¢ï¼Ÿæ„Ÿå…´è¶£çš„èƒ–å‹ï¼Œå¯ä»¥æå‰çœ‹ä¸‹&nbsp;<a href="https://github.com/apache/incubator-dubbo/blob/bb8884e04433677d6abc6f05c6ad9d39e3dcf236/dubbo-remoting/dubbo-remoting-api/src/main/java/com/alibaba/dubbo/remoting/transport/dispatcher/all/AllChannelHandler.java" target="_blank" rel="external nofollow noopener noreferrer">AllChannelHandler</a>&nbsp;å’Œ&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/thread-model.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; çº¿ç¨‹æ¨¡å‹ã€‹</a>&nbsp;ã€‚ğŸ™‚ æ–‡ç« ï¼Œåé¢è§ã€‚</li>
</ul>
<h1 id="9-RemotingException">9. RemotingException</h1>
<p><code>com.alibaba.dubbo.remoting.RemotingException</code>&nbsp;ï¼Œå®ç° Exception ç±»ï¼Œ<code>dubbo-remoting-api</code>&nbsp;çš„<strong>åŸºç¡€</strong>å¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RemotingException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * æœ¬åœ°åœ°å€</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> InetSocketAddress localAddress;</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * è¿œç¨‹åœ°å€</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> InetSocketAddress remoteAddress;</span><br />    <br /><span class="line">    <span class="comment">// ... çœç•¥æ–¹æ³•</span></span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="9-1-ExecutionException">9.1 ExecutionException</h2>
<p><code>com.alibaba.dubbo.remoting.ExecutionException</code>&nbsp;ï¼Œå®ç° RemotingException ç±»ï¼Œæ‰§è¡Œå¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExecutionException</span> <span class="keyword">extends</span> <span class="title">RemotingException</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * è¯·æ±‚</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object request;</span><br /><br /><span class="line">    <span class="comment">// ... çœç•¥æ–¹æ³•</span></span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h2 id="9-2-TimeoutException">9.2 TimeoutException</h2>
<p><code>com.alibaba.dubbo.remoting.TimeoutException</code>&nbsp;ï¼Œå®ç° RemotingException ç±»ï¼Œè¶…æ—¶å¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TimeoutException</span> <span class="keyword">extends</span> <span class="title">RemotingException</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * å®¢æˆ·ç«¯</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CLIENT_SIDE = <span class="number">0</span>;</span><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * æœåŠ¡ç«¯</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SERVER_SIDE = <span class="number">1</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * é˜¶æ®µ</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> phase;</span><br />    <br /><span class="line">    <span class="comment">// ... çœç•¥æ–¹æ³•</span></span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</div>