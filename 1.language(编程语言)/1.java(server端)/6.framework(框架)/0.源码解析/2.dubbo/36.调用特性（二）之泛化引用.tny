<header class="article-header">
<h1 class="article-title">è°ƒç”¨ç‰¹æ€§ï¼ˆäºŒï¼‰ä¹‹æ³›åŒ–å¼•ç”¨</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>æœ¬æ–‡åˆ†äº«<strong>æ³›åŒ–å¼•ç”¨</strong>ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/generic-reference.html" target="_blank" rel="external nofollow noopener noreferrer">ã€Šç”¨æˆ·æŒ‡å— &mdash;&mdash; æ³›åŒ–å¼•ç”¨ã€‹</a>&nbsp;çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>æ³›åŒ–æ¥å£è°ƒç”¨æ–¹å¼ä¸»è¦ç”¨äºå®¢æˆ·ç«¯æ²¡æœ‰ API æ¥å£åŠæ¨¡å‹ç±»å…ƒçš„æƒ…å†µï¼Œå‚æ•°åŠè¿”å›å€¼ä¸­çš„æ‰€æœ‰ POJO å‡ç”¨ Map è¡¨ç¤ºï¼Œé€šå¸¸ç”¨äºæ¡†æ¶é›†æˆï¼Œæ¯”å¦‚ï¼šå®ç°ä¸€ä¸ªé€šç”¨çš„æœåŠ¡æµ‹è¯•æ¡†æ¶ï¼Œå¯é€šè¿‡ GenericService è°ƒç”¨æ‰€æœ‰æœåŠ¡å®ç°ã€‚</p>
</blockquote>
<p>è¯·æ³¨æ„ï¼Œæ¶ˆè´¹<strong>æ¶ˆè´¹è€…</strong>æ²¡æœ‰&nbsp;<strong>API æ¥å£</strong>&nbsp;åŠ&nbsp;<strong>æ¨¡å‹ç±»å…ƒ</strong>ã€‚é‚£å°±æ˜¯è¯´ï¼ŒDubbo åœ¨æ³›åŒ–å¼•ç”¨ä¸­ï¼Œéœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>
<p>æ²¡æœ‰&nbsp;<strong>API æ¥å£</strong>ï¼Œæ‰€ä»¥æä¾›ä¸€ä¸ªæ³›åŒ–æœåŠ¡æ¥å£ï¼Œç›®å‰æ˜¯&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/service/GenericService.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.service.GenericService</code></a>&nbsp;ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GenericService</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * Generic invocation</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * æ³›åŒ–è°ƒç”¨</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> method         Method name, e.g. findPerson. If there are overridden methods, parameter info is</span></span><br /><span class="line"><span class="comment">     *                       required, e.g. findPerson(java.lang.String)</span></span><br /><span class="line"><span class="comment">     *                       æ–¹æ³•å</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes Parameter types</span></span><br /><span class="line"><span class="comment">     *                       å‚æ•°ç±»å‹æ•°ç»„</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> args           Arguments</span></span><br /><span class="line"><span class="comment">     *                       å‚æ•°æ•°ç»„</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> invocation return value è°ƒç”¨ç»“æœ</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Throwable potential exception thrown from the invocation</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    Object $invoke(String method, String[] parameterTypes, Object[] args) <span class="keyword">throws</span> GenericException;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><strong>ä¸€ä¸ª</strong>æ³›åŒ–å¼•ç”¨ï¼Œåªå¯¹åº”<strong>ä¸€ä¸ª</strong>æœåŠ¡å®ç°ã€‚</li>
<li>é€šè¿‡&nbsp;<code>$invoke(method, parameterTypes, args)</code>&nbsp;æ–¹æ³•ï¼Œå¯ä»¥å®ç°æœåŠ¡çš„æ³›åŒ–è°ƒç”¨ã€‚</li>
<li>å…·ä½“çš„ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/rpc-feature-generic-reference/">ã€Œ2. ç¤ºä¾‹ã€</a>&nbsp;ä¸­çœ‹ã€‚</li>
</ul>
</li>
<li>
<p>æ²¡æœ‰&nbsp;<strong>æ¨¡å‹ç±»å…ƒ</strong>ï¼Œæ‰€ä»¥æ–¹æ³•å‚æ•°å’Œæ–¹æ³•è¿”å›è‹¥æ˜¯ POJO ( ä¾‹å¦‚ User å’Œ Order ç­‰ ) ï¼Œéœ€è¦<strong>è½¬æ¢å¤„ç†</strong>ï¼š</p>
<ul>
<li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œå°† POJO è½¬æˆ Map ï¼Œç„¶åå†è°ƒç”¨æœåŠ¡æä¾›è€…ã€‚</li>
<li>æœåŠ¡æä¾›è€…ï¼Œæ¥æ”¶åˆ° Map ï¼Œè½¬æ¢æˆ POJO ï¼Œå†è°ƒç”¨ Service æ–¹æ³•ã€‚è‹¥è¿”å›å€¼æœ‰ POJO ï¼Œåˆ™è½¬æ¢æˆ Map å†è¿”å›ã€‚</li>
<li>ğŸ™‚ æ­¤å¤„çš„ Map åªæ˜¯ä¸¾ä¾‹å­ï¼Œå®é™…åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿˜æœ‰<strong>ä¸¤ç§</strong>è½¬æ¢æ–¹å¼ã€‚</li>
</ul>
</li>
</ul>
<p>æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_11_06/01.png" alt="æµç¨‹" /></p>
<h1 id="2-ç¤ºä¾‹">2. ç¤ºä¾‹</h1>
<p><strong>æœåŠ¡æä¾›è€…</strong></p>
<p>åœ¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/3766a47c5e97ee86c29d765dc88ee11ab5225604/dubbo-demo/dubbo-generic-reference-demo-provider" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-generic-reference-demo-provider</code></a>&nbsp;ï¼Œæˆ‘ä»¬æä¾›äº†ä¾‹å­ã€‚æ™®é€šçš„æœåŠ¡æä¾›è€…ï¼Œä¸éœ€è¦åšä»»ä½•å¤„ç†ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ã€‚</p>
<p><strong>æœåŠ¡æ¶ˆè´¹è€…</strong></p>
<p>åœ¨&nbsp;<a href="https://github.com/YunaiV/dubbo/tree/3766a47c5e97ee86c29d765dc88ee11ab5225604/dubbo-demo/dubbo-generic-reference-demo-consumer" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-generic-reference-demo-consumer</code></a>&nbsp;ï¼Œæˆ‘ä»¬æä¾›äº†ä¾‹å­ã€‚æˆ‘ä»¬æŒ‘<strong>é‡ç‚¹</strong>çš„åœ°æ–¹è¯´ã€‚</p>
<p>â‘  åœ¨ Spring é…ç½®ç”³æ˜&nbsp;<code>generic="true"</code>ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">&lt;dubbo:reference id=<span class="string">"demoService"</span>  <span class="class"><span class="keyword">interface</span></span>=<span class="string">"com.alibaba.dubbo.demo.DemoService"</span> generic=<span class="string">"true"</span> /&gt;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>interface</code>&nbsp;é…ç½®é¡¹ï¼Œæ³›åŒ–å¼•ç”¨çš„æœåŠ¡æ¥å£ã€‚é€šè¿‡è¯¥é…ç½®ï¼Œå¯ä»¥ä»æ³¨å†Œä¸­å¿ƒï¼Œè·å–åˆ°æ‰€æœ‰<strong>è¯¥æœåŠ¡</strong>çš„æä¾›æ–¹çš„åœ°å€ã€‚</li>
<li><code>generic</code>&nbsp;é…ç½®é¡¹ï¼Œé»˜è®¤ä¸º&nbsp;<code>false</code>&nbsp;ï¼Œä¸ä½¿ç”¨é…ç½®é¡¹ã€‚ç›®å‰æœ‰<strong>ä¸‰ç§é…ç½®é¡¹çš„å€¼</strong>ï¼Œå¼€å¯æ³›åŒ–å¼•ç”¨çš„åŠŸèƒ½ï¼š
<ul>
<li><code>generic=true</code>&nbsp;ï¼Œä½¿ç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/PojoUtils.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.utils.PojoUtils</code></a>&nbsp;ï¼Œå®ç°&nbsp;<code>POJO &lt;=&gt; Map</code>&nbsp;çš„äº’è½¬ã€‚</li>
<li><code>generic=nativejava</code>&nbsp;ï¼Œä½¿ç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/nativejava/NativeJavaSerialization.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.nativejava.NativeJavaSerialization</code></a>&nbsp;ï¼Œå®ç°&nbsp;<code>POJO &lt;=&gt; byte[]</code>&nbsp;çš„äº’è½¬ã€‚</li>
<li><code>generic=bean</code>&nbsp;ï¼Œä½¿ç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/beanutil/JavaBeanSerializeUtil.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.beanutil.JavaBeanSerializeUtil</code></a>&nbsp;ï¼Œå®ç°&nbsp;<code>POJO &lt;=&gt; JavaBeanDescriptor</code>&nbsp;çš„äº’è½¬ã€‚</li>
<li>æ€»çš„æ¥è¯´ï¼Œä¸‰ç§æ–¹å¼çš„å·®å¼‚ï¼Œåœ¨äºä½¿ç”¨äº’è½¬(&nbsp;<strong>åºåˆ—åŒ–å’Œååºåˆ—åŒ–</strong>&nbsp;)çš„æ–¹å¼ä¸åŒã€‚æœªæ¥å¦‚æœæˆ‘ä»¬æœ‰éœ€è¦ï¼Œå®Œæˆå¯ä»¥å®ç°&nbsp;<code>generic=json</code>&nbsp;ï¼Œä½¿ç”¨ FastJSON æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</li>
</ul>
</li>
</ul>
<p>â‘¡ åœ¨ Java ä»£ç è·å– barService å¹¶å¼€å§‹æ³›åŒ–è°ƒç”¨ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">ClassPathXmlApplicationContext context = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="keyword">new</span> String[]{<span class="string">"META-INF/spring/dubbo-demo-consumer.xml"</span>});</span><br /><br /><span class="line">GenericService genericService = (GenericService) context.getBean(<span class="string">"demoService"</span>);</span><br /><span class="line">Object result = genericService.$invoke(<span class="string">"say01"</span>, <span class="keyword">new</span> String[]{<span class="string">"java.lang.String"</span>}, <span class="keyword">new</span> Object[]{<span class="string">"123"</span>});</span><br /><span class="line">System.out.println(<span class="string">"result: "</span> + result);</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p>é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼Œä¸ºä»€ä¹ˆå¯ä»¥ä½¿ç”¨ GenericService è½¬æ¢ï¼Ÿç­”æ¡ˆåœ¨&nbsp;<code>ReferenceConfig#init()</code>&nbsp;æ–¹æ³•ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// ReferenceConfig.java</span></span><br /><span class="line"><span class="keyword">if</span> (ProtocolUtils.isGeneric(getGeneric())) {</span><br /><span class="line">    interfaceClass = GenericService.class;</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="comment">// ProtocolUtils.java</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isGeneric</span><span class="params">(String generic)</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> generic != <span class="keyword">null</span></span><br /><span class="line">            &amp;&amp; !<span class="string">""</span>.equals(generic)</span><br /><span class="line">            &amp;&amp; (Constants.GENERIC_SERIALIZATION_DEFAULT.equalsIgnoreCase(generic)  <span class="comment">/* Normal generalization cal */</span></span><br /><span class="line">            || Constants.GENERIC_SERIALIZATION_NATIVE_JAVA.equalsIgnoreCase(generic) <span class="comment">/* Streaming generalization call supporting jdk serialization */</span></span><br /><span class="line">            || Constants.GENERIC_SERIALIZATION_BEAN.equalsIgnoreCase(generic));</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<h2 id="2-1-æœ‰å…³æ³›åŒ–ç±»å‹çš„è¿›ä¸€æ­¥è§£é‡Š">2.1 æœ‰å…³æ³›åŒ–ç±»å‹çš„è¿›ä¸€æ­¥è§£é‡Š</h2>
<blockquote>
<p>æœ¬å°èŠ‚ä¸ºå¼•ç”¨&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/generic-reference.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; æ³›åŒ–å¼•ç”¨ã€‹</a>&nbsp;ã€‚</p>
</blockquote>
<p>å‡è®¾å­˜åœ¨ POJO å¦‚ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">package</span> com.xxx;</span><br /><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonImpl</span> <span class="keyword">implements</span> <span class="title">Person</span> </span>{</span><br /><span class="line">    <span class="keyword">private</span> String name;</span><br /><span class="line">    <span class="keyword">private</span> String password;</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> name;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>{</span><br /><span class="line">        <span class="keyword">this</span>.name = name;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> password;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>{</span><br /><span class="line">        <span class="keyword">this</span>.password = password;</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>åˆ™ POJO æ•°æ®ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">Person person = <span class="keyword">new</span> PersonImpl(); </span><br /><span class="line">person.setName(<span class="string">"xxx"</span>); </span><br /><span class="line">person.setPassword(<span class="string">"yyy"</span>);</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>ã€æœåŠ¡æ¶ˆè´¹è€…ã€‘å¯ç”¨ä¸‹é¢ Map è¡¨ç¤ºï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;(); </span><br /><span class="line"><span class="comment">// æ³¨æ„ï¼šå¦‚æœå‚æ•°ç±»å‹æ˜¯æ¥å£ï¼Œæˆ–è€…Listç­‰ä¸¢å¤±æ³›å‹ï¼Œå¯é€šè¿‡classå±æ€§æŒ‡å®šç±»å‹ã€‚</span></span><br /><span class="line">map.put(<span class="string">"class"</span>, <span class="string">"com.xxx.PersonImpl"</span>); </span><br /><span class="line">map.put(<span class="string">"name"</span>, <span class="string">"xxx"</span>); </span><br /><span class="line">map.put(<span class="string">"password"</span>, <span class="string">"yyy"</span>);</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>Map ä¸­çš„&nbsp;<code>class</code>&nbsp;å±æ€§ï¼Œåœ¨ PojoUtils ä¸­ï¼Œä¼šæ ¹æ®è¯¥å±æ€§ï¼Œå°† Map è½¬æ¢æˆ POJO å¯¹è±¡ã€‚</li>
</ul>
<h1 id="3-æœåŠ¡æ¶ˆè´¹è€…-GenericImplFilter">3. æœåŠ¡æ¶ˆè´¹è€… GenericImplFilter</h1>
<p><a href="https://github.com/YunaiV/dubbo/blob/3766a47c5e97ee86c29d765dc88ee11ab5225604/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/filter/GenericImplFilter.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.filter.GenericImplFilter</code></a>&nbsp;ï¼Œå®ç° Filter æ¥å£ï¼ŒæœåŠ¡æ¶ˆè´¹è€…çš„æ³›åŒ–è°ƒç”¨è¿‡æ»¤å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="meta">@Activate</span>(group = Constants.CONSUMER, value = Constants.GENERIC_KEY, order = <span class="number">20000</span>)</span><br /><span class="line"> <span class="number">2</span>: <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericImplFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</span><br /><span class="line"> <span class="number">3</span>: </span><br /><span class="line"> <span class="number">4</span>:     <span class="comment">// ... çœç•¥æ— å…³å±æ€§</span></span><br /><span class="line"> <span class="number">5</span>: </span><br /><span class="line"> <span class="number">6</span>:     <span class="meta">@Override</span></span><br /><span class="line"> <span class="number">7</span>:     <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"> <span class="number">8</span>:         <span class="comment">// è·å¾— `generic` é…ç½®é¡¹</span></span><br /><span class="line"> <span class="number">9</span>:         String generic = invoker.getUrl().getParameter(Constants.GENERIC_KEY);</span><br /><span class="line"><span class="number">10</span>: </span><br /><span class="line"><span class="number">11</span>:         <span class="comment">// çœç•¥ä»£ç ...æ³›åŒ–å®ç°çš„è°ƒç”¨</span></span><br /><span class="line"><span class="number">12</span>: </span><br /><span class="line"><span class="number">13</span>:         <span class="comment">// æ³›åŒ–å¼•ç”¨çš„è°ƒç”¨</span></span><br /><span class="line"><span class="number">14</span>:         <span class="keyword">if</span> (invocation.getMethodName().equals(Constants.$INVOKE) <span class="comment">// æ–¹æ³•åä¸º `$invoke`</span></span><br /><span class="line"><span class="number">15</span>:                 &amp;&amp; invocation.getArguments() != <span class="keyword">null</span></span><br /><span class="line"><span class="number">16</span>:                 &amp;&amp; invocation.getArguments().length == <span class="number">3</span></span><br /><span class="line"><span class="number">17</span>:                 &amp;&amp; ProtocolUtils.isGeneric(generic)) {</span><br /><span class="line"><span class="number">18</span>:             Object[] args = (Object[]) invocation.getArguments()[<span class="number">2</span>];</span><br /><span class="line"><span class="number">19</span>:             <span class="comment">// `nativejava` ï¼Œæ ¡éªŒæ–¹æ³•å‚æ•°éƒ½ä¸º byte[]</span></span><br /><span class="line"><span class="number">20</span>:             <span class="keyword">if</span> (ProtocolUtils.isJavaGenericSerialization(generic)) {</span><br /><span class="line"><span class="number">21</span>:                 <span class="keyword">for</span> (Object arg : args) {</span><br /><span class="line"><span class="number">22</span>:                     <span class="keyword">if</span> (!(<span class="keyword">byte</span>[].class == arg.getClass())) {</span><br /><span class="line"><span class="number">23</span>:                         error(<span class="keyword">byte</span>[].class.getName(), arg.getClass().getName());</span><br /><span class="line"><span class="number">24</span>:                     }</span><br /><span class="line"><span class="number">25</span>:                 }</span><br /><span class="line"><span class="number">26</span>:             <span class="comment">// `bean` ï¼Œæ ¡éªŒæ–¹æ³•å‚æ•°ä¸º JavaBeanDescriptor</span></span><br /><span class="line"><span class="number">27</span>:             } <span class="keyword">else</span> <span class="keyword">if</span> (ProtocolUtils.isBeanGenericSerialization(generic)) {</span><br /><span class="line"><span class="number">28</span>:                 <span class="keyword">for</span> (Object arg : args) {</span><br /><span class="line"><span class="number">29</span>:                     <span class="keyword">if</span> (!(arg <span class="keyword">instanceof</span> JavaBeanDescriptor)) {</span><br /><span class="line"><span class="number">30</span>:                         error(JavaBeanDescriptor.class.getName(), arg.getClass().getName());</span><br /><span class="line"><span class="number">31</span>:                     }</span><br /><span class="line"><span class="number">32</span>:                 }</span><br /><span class="line"><span class="number">33</span>:             }</span><br /><span class="line"><span class="number">34</span>: </span><br /><span class="line"><span class="number">35</span>:             <span class="comment">// é€šè¿‡éšå¼å‚æ•°ï¼Œä¼ é€’ `generic` é…ç½®é¡¹</span></span><br /><span class="line"><span class="number">36</span>:             ((RpcInvocation) invocation).setAttachment(Constants.GENERIC_KEY, generic);</span><br /><span class="line"><span class="number">37</span>:         }</span><br /><span class="line"><span class="number">38</span>:         <span class="keyword">return</span> invoker.invoke(invocation);</span><br /><span class="line"><span class="number">39</span>:     }</span><br /><span class="line"><span class="number">40</span>: </span><br /><span class="line"><span class="number">41</span>:     <span class="comment">// çœç•¥ `#error(...)` æ–¹æ³•</span></span><br /><span class="line"><span class="number">42</span>: </span><br /><span class="line"><span class="number">43</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ä½¿ç”¨ Dubbo SPI Adaptive æœºåˆ¶ï¼Œ<strong>è‡ªåŠ¨åŠ è½½</strong>ï¼Œä»…é™<strong>æœåŠ¡æ¶ˆè´¹è€…</strong>ï¼Œå¹¶ä¸”æœ‰&nbsp;<code>generic</code>&nbsp;é…ç½®é¡¹ã€‚
<ul>
<li>æ­¤å¤„ç¬”è€…å°±äº§ç”Ÿäº†ä¸€ä¸ªç–‘é—®ï¼Œä»æ³¨å†Œä¸­å¿ƒï¼Œè·å¾—åˆ°çš„æœåŠ¡ URL ï¼Œå¹¶æ²¡æœ‰è®¾ç½®&nbsp;<code>generic</code>&nbsp;çš„é…ç½®é¡¹ï¼Œé‚£å²‚ä¸æ˜¯åœ¨ ProtocolFilterWrapper ä¸­ï¼Œä½¿ç”¨ Dubbo SPI Adaptive åŠ è½½ä¸åˆ° GenericImplFilter è¿™ä¸ªè¿‡æ»¤å™¨ï¼Ÿ</li>
<li>äºæ˜¯ï¼Œç¬”è€…å°±å¼€å§‹æ…¢æ…¢è°ƒè¯•ï¼Œç›´åˆ°å‘ç°&nbsp;<code>RegistryDirectory#mergeUrl(providerUrl)</code>&nbsp;æ–¹æ³•ï¼Œå®ƒä¼šå°†æœåŠ¡æ¶ˆè´¹è€…çš„é…ç½®( URL )é¡¹ï¼Œ<strong>è¦†ç›–</strong>åˆ°æœåŠ¡æä¾›è€…çš„ URL ã€‚</li>
<li>åˆå› ä¸ºæ³›åŒ–å¼•ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨æœåŠ¡æ¶ˆè´¹è€…çš„é…ç½®&nbsp;<code>generic = true</code>&nbsp;ï¼Œé‚£ä¹ˆæœåŠ¡æä¾›è€… URL è‡ªç„¶å°±æœ‰äº†è¯¥é…ç½®é¡¹ï¼Œæ‰€ä»¥ä¾¿æœ‰äº† GenericImplFilter è¿‡æ»¤å™¨ã€‚</li>
</ul>
</li>
<li>ç¬¬ 9 è¡Œï¼šè·å¾—&nbsp;<code>generic</code>&nbsp;é…ç½®é¡¹ã€‚</li>
<li>ç¬¬ 11 è¡Œï¼šçœç•¥ç”¨äºè°ƒç”¨<strong>æ³›åŒ–å®ç°æœåŠ¡</strong>çš„ä»£ç ï¼Œå¯¹åº”æ–‡æ¡£ä¸º&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/generic-service.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo ç”¨æˆ·æŒ‡å— &mdash;&mdash; æ³›åŒ–å®ç°ã€‹</a>&nbsp;ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬è¯¦ç»†åˆ†äº«ã€‚</li>
<li>
<p>ç¬¬ 13 è‡³ 37 è¡Œï¼š<strong>æ³›åŒ–å¼•ç”¨</strong>çš„è°ƒç”¨ï¼Œé€šè¿‡æ–¹æ³•( åŒ…æ‹¬æ–¹æ³•åã€å‚æ•° ) +&nbsp;<code>generic</code>&nbsp;é…ç½®é¡¹ï¼Œè¿›è¡Œåˆ¤æ–­ã€‚</p>
<ul>
<li>
<p>ç¬¬ 19 è‡³ 33 è¡Œï¼šæ ¹æ®ä¸åŒçš„&nbsp;<code>generic</code>&nbsp;é…ç½®é¡¹ï¼Œæ ¡éªŒæ–¹æ³•å‚æ•°æ˜¯å¦å·²ç»æ­£ç¡®<strong>åºåˆ—åŒ–</strong>ã€‚è‹¥ä¸åˆæ³•ï¼Œè°ƒç”¨&nbsp;<code>#error(expected, actual)</code>&nbsp;æ–¹æ³•ï¼ŒæŠ›å‡º RpcException å¼‚å¸¸ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">error</span><span class="params">(String expected, String actual)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(</span><br /><span class="line">            <span class="keyword">new</span> StringBuilder(<span class="number">32</span>)</span><br /><span class="line">                    .append(<span class="string">"Generic serialization ["</span>)</span><br /><span class="line">                    .append(Constants.GENERIC_SERIALIZATION_NATIVE_JAVA)</span><br /><span class="line">                    .append(<span class="string">"] only support message type "</span>)</span><br /><span class="line">                    .append(expected)</span><br /><span class="line">                    .append(<span class="string">" and your message type is "</span>)</span><br /><span class="line">                    .append(actual).toString());</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>x</li>
</ul>
</li>
<li>ç¬¬ 36 è¡Œï¼šè°ƒç”¨&nbsp;<code>RpcInvocation#setAttachment(key, value)</code>&nbsp;é€šè¿‡éšå¼å‚æ•°ï¼Œä¼ é€’&nbsp;<code>generic</code>&nbsp;é…ç½®é¡¹ã€‚</li>
</ul>
</li>
<li>
<p>ç¬¬ 38 è¡Œï¼šè°ƒç”¨&nbsp;<code>Invoker#invoke(invocation)</code>&nbsp;æ–¹æ³•ï¼Œç»§ç»­è¿‡æ»¤é“¾çš„è°ƒç”¨ï¼Œæœ€ç»ˆ RPC è°ƒç”¨ã€‚</p>
</li>
</ul>
<h1 id="4-æœåŠ¡æä¾›è€…-GenericFilter">4. æœåŠ¡æä¾›è€… GenericFilter</h1>
<p><a href="https://github.com/YunaiV/dubbo/blob/3766a47c5e97ee86c29d765dc88ee11ab5225604/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/filter/GenericFilter.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.filter.GenericFilter</code></a>&nbsp;ï¼Œå®ç° Filter æ¥å£ï¼ŒæœåŠ¡æ¶ˆè´¹è€…çš„æ³›åŒ–è°ƒç”¨è¿‡æ»¤å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="meta">@Activate</span>(group = Constants.PROVIDER, order = -<span class="number">20000</span>)</span><br /><span class="line"> <span class="number">2</span>: <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</span><br /><span class="line"> <span class="number">3</span>: </span><br /><span class="line"> <span class="number">4</span>:     <span class="meta">@Override</span></span><br /><span class="line"> <span class="number">5</span>:     <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation inv)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"> <span class="number">6</span>:         <span class="comment">// æ³›åŒ–å¼•ç”¨çš„è°ƒç”¨</span></span><br /><span class="line"> <span class="number">7</span>:         <span class="keyword">if</span> (inv.getMethodName().equals(Constants.$INVOKE)</span><br /><span class="line"> <span class="number">8</span>:                 &amp;&amp; inv.getArguments() != <span class="keyword">null</span></span><br /><span class="line"> <span class="number">9</span>:                 &amp;&amp; inv.getArguments().length == <span class="number">3</span></span><br /><span class="line"><span class="number">10</span>:                 &amp;&amp; !ProtocolUtils.isGeneric(invoker.getUrl().getParameter(Constants.GENERIC_KEY))) { <span class="comment">// éæ³›åŒ–å®ç°çš„è°ƒç”¨</span></span><br /><span class="line"><span class="number">11</span>:             String name = ((String) inv.getArguments()[<span class="number">0</span>]).trim();</span><br /><span class="line"><span class="number">12</span>:             String[] types = (String[]) inv.getArguments()[<span class="number">1</span>];</span><br /><span class="line"><span class="number">13</span>:             Object[] args = (Object[]) inv.getArguments()[<span class="number">2</span>];</span><br /><span class="line"><span class="number">14</span>:             <span class="keyword">try</span> {</span><br /><span class="line"><span class="number">15</span>:                 <span class="comment">// è·å¾—å¯¹åº”çš„æ–¹æ³• Method å¯¹è±¡</span></span><br /><span class="line"><span class="number">16</span>:                 Method method = ReflectUtils.findMethodByMethodSignature(invoker.getInterface(), name, types);</span><br /><span class="line"><span class="number">17</span>:                 <span class="comment">// è·å¾—æ–¹æ³•å‚æ•°ç±»å‹å’Œæ–¹æ³•å‚æ•°æ•°ç»„</span></span><br /><span class="line"><span class="number">18</span>:                 Class&lt;?&gt;[] params = method.getParameterTypes();</span><br /><span class="line"><span class="number">19</span>:                 <span class="keyword">if</span> (args == <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">20</span>:                     args = <span class="keyword">new</span> Object[params.length];</span><br /><span class="line"><span class="number">21</span>:                 }</span><br /><span class="line"><span class="number">22</span>:                 <span class="comment">// è·å¾— `generic` é…ç½®é¡¹</span></span><br /><span class="line"><span class="number">23</span>:                 String generic = inv.getAttachment(Constants.GENERIC_KEY);</span><br /><span class="line"><span class="number">24</span>:                 <span class="comment">// ã€ç¬¬ä¸€æ­¥ã€‘`true` ï¼Œååºåˆ—åŒ–å‚æ•°ï¼Œä»…æœ‰ Map =&gt; POJO</span></span><br /><span class="line"><span class="number">25</span>:                 <span class="keyword">if</span> (StringUtils.isEmpty(generic) || ProtocolUtils.isDefaultGenericSerialization(generic)) {</span><br /><span class="line"><span class="number">26</span>:                     args = PojoUtils.realize(args, params, method.getGenericParameterTypes());</span><br /><span class="line"><span class="number">27</span>:                 <span class="comment">// ã€ç¬¬ä¸€æ­¥ã€‘`nativejava` ï¼Œååºåˆ—åŒ–å‚æ•°ï¼Œbyte[] =&gt; æ–¹æ³•å‚æ•°</span></span><br /><span class="line"><span class="number">28</span>:                 } <span class="keyword">else</span> <span class="keyword">if</span> (ProtocolUtils.isJavaGenericSerialization(generic)) {</span><br /><span class="line"><span class="number">29</span>:                     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) {</span><br /><span class="line"><span class="number">30</span>:                         <span class="keyword">if</span> (<span class="keyword">byte</span>[].class == args[i].getClass()) {</span><br /><span class="line"><span class="number">31</span>:                             <span class="keyword">try</span> {</span><br /><span class="line"><span class="number">32</span>:                                 UnsafeByteArrayInputStream is = <span class="keyword">new</span> UnsafeByteArrayInputStream((<span class="keyword">byte</span>[]) args[i]);</span><br /><span class="line"><span class="number">33</span>:                                 args[i] = ExtensionLoader.getExtensionLoader(Serialization.class).getExtension(Constants.GENERIC_SERIALIZATION_NATIVE_JAVA)</span><br /><span class="line"><span class="number">34</span>:                                         .deserialize(<span class="keyword">null</span>, is).readObject();</span><br /><span class="line"><span class="number">35</span>:                             } <span class="keyword">catch</span> (Exception e) {</span><br /><span class="line"><span class="number">36</span>:                                 <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Deserialize argument ["</span> + (i + <span class="number">1</span>) + <span class="string">"] failed."</span>, e);</span><br /><span class="line"><span class="number">37</span>:                             }</span><br /><span class="line"><span class="number">38</span>:                         } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">39</span>:                             <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(</span><br /><span class="line"><span class="number">40</span>:                                     <span class="keyword">new</span> StringBuilder(<span class="number">32</span>).append(<span class="string">"Generic serialization ["</span>)</span><br /><span class="line"><span class="number">41</span>:                                             .append(Constants.GENERIC_SERIALIZATION_NATIVE_JAVA)</span><br /><span class="line"><span class="number">42</span>:                                             .append(<span class="string">"] only support message type "</span>)</span><br /><span class="line"><span class="number">43</span>:                                             .append(<span class="keyword">byte</span>[].class)</span><br /><span class="line"><span class="number">44</span>:                                             .append(<span class="string">" and your message type is "</span>)</span><br /><span class="line"><span class="number">45</span>:                                             .append(args[i].getClass()).toString());</span><br /><span class="line"><span class="number">46</span>:                         }</span><br /><span class="line"><span class="number">47</span>:                     }</span><br /><span class="line"><span class="number">48</span>:                 <span class="comment">// ã€ç¬¬ä¸€æ­¥ã€‘`bean` ï¼Œååºåˆ—åŒ–å‚æ•°ï¼ŒJavaBeanDescriptor =&gt; æ–¹æ³•å‚æ•°</span></span><br /><span class="line"><span class="number">49</span>:                 } <span class="keyword">else</span> <span class="keyword">if</span> (ProtocolUtils.isBeanGenericSerialization(generic)) {</span><br /><span class="line"><span class="number">50</span>:                     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) {</span><br /><span class="line"><span class="number">51</span>:                         <span class="keyword">if</span> (args[i] <span class="keyword">instanceof</span> JavaBeanDescriptor) {</span><br /><span class="line"><span class="number">52</span>:                             args[i] = JavaBeanSerializeUtil.deserialize((JavaBeanDescriptor) args[i]);</span><br /><span class="line"><span class="number">53</span>:                         } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">54</span>:                             <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(</span><br /><span class="line"><span class="number">55</span>:                                     <span class="keyword">new</span> StringBuilder(<span class="number">32</span>)</span><br /><span class="line"><span class="number">56</span>:                                             .append(<span class="string">"Generic serialization ["</span>)</span><br /><span class="line"><span class="number">57</span>:                                             .append(Constants.GENERIC_SERIALIZATION_BEAN)</span><br /><span class="line"><span class="number">58</span>:                                             .append(<span class="string">"] only support message type "</span>)</span><br /><span class="line"><span class="number">59</span>:                                             .append(JavaBeanDescriptor.class.getName())</span><br /><span class="line"><span class="number">60</span>:                                             .append(<span class="string">" and your message type is "</span>)</span><br /><span class="line"><span class="number">61</span>:                                             .append(args[i].getClass().getName()).toString());</span><br /><span class="line"><span class="number">62</span>:                         }</span><br /><span class="line"><span class="number">63</span>:                     }</span><br /><span class="line"><span class="number">64</span>:                 }</span><br /><span class="line"><span class="number">65</span>:                 <span class="comment">// ã€ç¬¬äºŒæ­¥ã€‘æ–¹æ³•è°ƒç”¨</span></span><br /><span class="line"><span class="number">66</span>:                 Result result = invoker.invoke(<span class="keyword">new</span> RpcInvocation(method, args, inv.getAttachments()));</span><br /><span class="line"><span class="number">67</span>:                 <span class="comment">// ã€ç¬¬ä¸‰æ­¥ã€‘è‹¥æ˜¯å¼‚å¸¸ç»“æœï¼Œå¹¶ä¸”é GenericException å¼‚å¸¸ï¼Œåˆ™ä½¿ç”¨ GenericException åŒ…è£…</span></span><br /><span class="line"><span class="number">68</span>:                 <span class="keyword">if</span> (result.hasException()</span><br /><span class="line"><span class="number">69</span>:                         &amp;&amp; !(result.getException() <span class="keyword">instanceof</span> GenericException)) {</span><br /><span class="line"><span class="number">70</span>:                     <span class="keyword">return</span> <span class="keyword">new</span> RpcResult(<span class="keyword">new</span> GenericException(result.getException()));</span><br /><span class="line"><span class="number">71</span>:                 }</span><br /><span class="line"><span class="number">72</span>:                 <span class="comment">// ã€ç¬¬ä¸‰æ­¥ã€‘`nativejava` ï¼Œåºåˆ—åŒ–ç»“æœï¼Œç»“æœ =&gt; byte[]</span></span><br /><span class="line"><span class="number">73</span>:                 <span class="keyword">if</span> (ProtocolUtils.isJavaGenericSerialization(generic)) {</span><br /><span class="line"><span class="number">74</span>:                     <span class="keyword">try</span> {</span><br /><span class="line"><span class="number">75</span>:                         UnsafeByteArrayOutputStream os = <span class="keyword">new</span> UnsafeByteArrayOutputStream(<span class="number">512</span>);</span><br /><span class="line"><span class="number">76</span>:                         ExtensionLoader.getExtensionLoader(Serialization.class).getExtension(Constants.GENERIC_SERIALIZATION_NATIVE_JAVA)</span><br /><span class="line"><span class="number">77</span>:                                 .serialize(<span class="keyword">null</span>, os).writeObject(result.getValue());</span><br /><span class="line"><span class="number">78</span>:                         <span class="keyword">return</span> <span class="keyword">new</span> RpcResult(os.toByteArray());</span><br /><span class="line"><span class="number">79</span>:                     } <span class="keyword">catch</span> (IOException e) {</span><br /><span class="line"><span class="number">80</span>:                         <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Serialize result failed."</span>, e);</span><br /><span class="line"><span class="number">81</span>:                     }</span><br /><span class="line"><span class="number">82</span>:                 <span class="comment">// ã€ç¬¬ä¸‰æ­¥ã€‘`bean` ï¼Œåºåˆ—åŒ–ç»“æœï¼Œç»“æœ =&gt; JavaBeanDescriptor</span></span><br /><span class="line"><span class="number">83</span>:                 } <span class="keyword">else</span> <span class="keyword">if</span> (ProtocolUtils.isBeanGenericSerialization(generic)) {</span><br /><span class="line"><span class="number">84</span>:                     <span class="keyword">return</span> <span class="keyword">new</span> RpcResult(JavaBeanSerializeUtil.serialize(result.getValue(), JavaBeanAccessor.METHOD));</span><br /><span class="line"><span class="number">85</span>:                 <span class="comment">// ã€ç¬¬ä¸‰æ­¥ã€‘`true` ï¼Œåºåˆ—åŒ–ç»“æœï¼Œä»…æœ‰ POJO =&gt; Map</span></span><br /><span class="line"><span class="number">86</span>:                 } <span class="keyword">else</span> {</span><br /><span class="line"><span class="number">87</span>:                     <span class="keyword">return</span> <span class="keyword">new</span> RpcResult(PojoUtils.generalize(result.getValue()));</span><br /><span class="line"><span class="number">88</span>:                 }</span><br /><span class="line"><span class="number">89</span>:             } <span class="keyword">catch</span> (NoSuchMethodException e) {</span><br /><span class="line"><span class="number">90</span>:                 <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(e.getMessage(), e);</span><br /><span class="line"><span class="number">91</span>:             } <span class="keyword">catch</span> (ClassNotFoundException e) {</span><br /><span class="line"><span class="number">92</span>:                 <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(e.getMessage(), e);</span><br /><span class="line"><span class="number">93</span>:             }</span><br /><span class="line"><span class="number">94</span>:         }</span><br /><span class="line"><span class="number">95</span>:         <span class="comment">// æ™®é€šè°ƒç”¨</span></span><br /><span class="line"><span class="number">96</span>:         <span class="keyword">return</span> invoker.invoke(inv);</span><br /><span class="line"><span class="number">97</span>:     }</span><br /><span class="line"><span class="number">98</span>: </span><br /><span class="line"><span class="number">99</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ä½¿ç”¨ Dubbo SPI Adaptive æœºåˆ¶ï¼Œ<strong>è‡ªåŠ¨åŠ è½½</strong>ï¼Œä»…é™<strong>æœåŠ¡æä¾›è€…</strong>ã€‚</li>
<li>ç¬¬ 96 è¡Œï¼šè‹¥æ˜¯æ™®é€šè°ƒç”¨(&nbsp;<strong>éæ³›åŒ–å¼•ç”¨çš„è°ƒç”¨</strong>&nbsp;)ï¼Œè°ƒç”¨&nbsp;<code>Invoker#invoke(invocation)</code>&nbsp;æ–¹æ³•ï¼Œç»§ç»­è¿‡æ»¤é“¾çš„è°ƒç”¨ï¼Œæœ€ç»ˆè°ƒç”¨ Service æœåŠ¡ã€‚</li>
<li>ç¬¬ 6 è‡³ 95 è¡Œï¼š è‹¥æ˜¯<strong>æ³›åŒ–å¼•ç”¨çš„è°ƒç”¨</strong>ï¼Œé€šè¿‡æ–¹æ³•( åŒ…æ‹¬æ–¹æ³•åã€å‚æ•° )åˆ¤æ–­ã€‚<strong>æ³¨æ„</strong>ï¼Œã€ç¬¬ 10 è¡Œã€‘é<strong>æ³›åŒ–å®ç°</strong>çš„è°ƒç”¨ã€‚</li>
<li>ç¬¬ 16 è¡Œï¼šè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/ReflectUtils.java#L768-L814" target="_blank" rel="external nofollow noopener noreferrer"><code>ReflectUtils#findMethodByMethodSignature(Class&lt;?&gt; clazz, String methodName, String[] parameterTypes)</code></a>&nbsp;æ–¹æ³•ï¼Œé€šè¿‡åå°„ï¼Œè·å¾—å¯¹åº”çš„æ–¹æ³•&nbsp;<strong>Method</strong>&nbsp;å¯¹è±¡ã€‚å…·ä½“çš„ä»£ç å®ç°ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹å“ˆã€‚</li>
<li>ç¬¬ 17 è‡³ 21 è¡Œï¼šè·å¾—<strong>æ–¹æ³•å‚æ•°ç±»å‹å’Œæ–¹æ³•å‚æ•°</strong>æ•°ç»„ã€‚</li>
<li>ç¬¬ 23 è¡Œï¼šè·å¾—&nbsp;<code>generic</code>&nbsp;é…ç½®é¡¹ã€‚</li>
<li>========== ã€ç¬¬ä¸€æ­¥ï¼šååºåˆ—åŒ–å‚æ•°ã€‘ ==========</li>
<li>ç¬¬ 24 è‡³ 26 è¡Œï¼š<code>generic = true</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/PojoUtils.java#L81-L89" target="_blank" rel="external nofollow noopener noreferrer"><code>PojoUtils#realize(Object[] objs, Class&lt;?&gt;[] types, Type[] gtypes)</code></a>&nbsp;æ–¹æ³•ï¼Œååºåˆ—åŒ–å‚æ•°ã€‚<strong>æ³¨æ„</strong>ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œåªæœ‰å¸¦æœ‰&nbsp;<code>class</code>&nbsp;å±æ€§çš„ Map ï¼Œéœ€è¦<strong>ååºåˆ—åŒ–</strong>æˆå¯¹åº”çš„ POJO å¯¹è±¡ã€‚</li>
<li>ç¬¬ 27 è‡³ 47 è¡Œï¼š<code>generic = nativejava</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>NativeJavaSerialization#deserialize(url, input)</code>&nbsp;æ–¹æ³•ï¼Œååºåˆ—åŒ–å‚æ•°ï¼Œå³&nbsp;<code>byte[] =&gt; æ–¹æ³•å‚æ•°</code>&nbsp;ã€‚</li>
<li>ç¬¬ 48 è‡³ 64 è¡Œï¼š<code>generic = bean</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>JavaBeanSerializeUtil#deserialize(JavaBeanDescriptor)</code>&nbsp;æ–¹æ³•ï¼Œååºåˆ—åŒ–å‚æ•°ï¼Œå³&nbsp;<code>JavaBeanDescriptor =&gt; æ–¹æ³•å‚æ•°</code>&nbsp;ã€‚</li>
<li>========== ã€ç¬¬äºŒæ­¥ï¼šæ–¹æ³•è°ƒç”¨ã€‘ ==========</li>
<li>ç¬¬ 66 è¡Œï¼šåˆ›å»º<strong>æ–°çš„</strong>&nbsp;RpcInvocation å¯¹è±¡ã€‚è¿™æ˜¯<strong>éå¸¸å…³é”®</strong>çš„ä¸€æ­¥ï¼Œ<code>$invoke</code>&nbsp;çš„æ³›åŒ–è°ƒç”¨ï¼Œè¢«è½¬æ¢æˆ<strong>å…·ä½“</strong>çš„æ™®é€šè°ƒç”¨ã€‚</li>
<li>ç¬¬ 66 è¡Œï¼šè°ƒç”¨&nbsp;<code>Invoker#invoke(invocation)</code>&nbsp;æ–¹æ³•ï¼Œç»§ç»­è¿‡æ»¤é“¾çš„è°ƒç”¨ï¼Œæœ€ç»ˆè°ƒç”¨ Service æœåŠ¡ã€‚</li>
<li>========== ã€ç¬¬ä¸‰æ­¥ï¼šåºåˆ—åŒ–ç»“æœã€‘ ==========</li>
<li>
<p>ç¬¬ 68 è‡³ 71 è¡Œï¼šè‹¥æ˜¯å¼‚å¸¸ç»“æœï¼Œå¹¶ä¸”é GenericException å¼‚å¸¸ï¼Œå¯èƒ½è¿™ä¸ªå¼‚å¸¸åœ¨æœåŠ¡æ¶ˆè´¹ç«¯æ˜¯<strong>æ²¡æœ‰</strong>çš„ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/service/GenericException.java" target="_blank" rel="external nofollow noopener noreferrer">GenericException</a>&nbsp;<strong>åŒ…è£…åè¿”å›</strong>ã€‚GenericException çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>{</span><br />    <br /><span class="line">        <span class="keyword">private</span> String exceptionClass;</span><br />    <br /><span class="line">    <span class="keyword">private</span> String exceptionMessage;</span><br />    <br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericException</span><span class="params">()</span> </span>{</span><br /><span class="line">    }</span><br />    <br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericException</span><span class="params">(String exceptionClass, String exceptionMessage)</span> </span>{</span><br /><span class="line">        <span class="keyword">super</span>(exceptionMessage);</span><br /><span class="line">        <span class="keyword">this</span>.exceptionClass = exceptionClass;</span><br /><span class="line">        <span class="keyword">this</span>.exceptionMessage = exceptionMessage;</span><br /><span class="line">    }</span><br />    <br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GenericException</span><span class="params">(Throwable cause)</span> </span>{</span><br /><span class="line">        <span class="keyword">super</span>(StringUtils.toString(cause));</span><br /><span class="line">        <span class="keyword">this</span>.exceptionClass = cause.getClass().getName();</span><br /><span class="line">        <span class="keyword">this</span>.exceptionMessage = cause.getMessage();</span><br /><span class="line">    }</span><br />    <br /><span class="line">    <span class="comment">// ... çœç•¥ getting/setting çš„æ–¹æ³•</span></span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p>ç¬¬ 72 è‡³ 81 è¡Œï¼š<code>generic = nativejava</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>NativeJavaSerialization#serialize(url, output)</code>æ–¹æ³•ï¼Œåºåˆ—åŒ–ç»“æœï¼Œå³&nbsp;<code>ç»“æœ =&gt; byte[]</code>&nbsp;ã€‚</p>
</li>
<li>ç¬¬ 82 è‡³ 84 è¡Œï¼š<code>generic = bean</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>JavaBeanSerializeUtil#serialize(Object, JavaBeanAccessor)</code>&nbsp;æ–¹æ³•ï¼Œåºåˆ—åŒ–ç»“æœï¼Œå³&nbsp;<code>ç»“æœ =&gt; JavaBeanDescriptor</code>&nbsp;ã€‚</li>
<li>ç¬¬ 85 è‡³ 88 è¡Œï¼š<code>generic = true</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>PojoUtils#generalize(Object)</code>&nbsp;æ–¹æ³•ï¼Œåºåˆ—åŒ–ç»“æœï¼Œä»…æœ‰&nbsp;<code>POJO =&gt; Map</code>&nbsp;ã€‚</li>
</ul>
</div>