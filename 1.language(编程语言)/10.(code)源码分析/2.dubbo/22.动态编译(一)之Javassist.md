# åŠ¨æ€ç¼–è¯‘ï¼ˆä¸€ï¼‰ä¹‹ Javassist

æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚

# 1. æ¦‚è¿°

åœ¨ Java è¯­è¨€ä¸­ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å·²ç»ç¼–å†™å¥½ Java ç±»ï¼Œå¹¶ç¼–è¯‘æˆ Class æ–‡ä»¶è¿›è¡Œè¿è¡Œã€‚ä½†æ˜¯åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œä¾‹å¦‚åŠ¨æ€ä»£ç†ï¼Œéœ€è¦è¿ç”¨åˆ°**åŠ¨æ€ç¼–è¯‘**çš„æŠ€æœ¯ã€‚è™½ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åå°„çš„æŠ€æœ¯å®ç°ï¼Œä½†æ˜¯ç›¸æ¯”æ¥è¯´ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šçš„æ€§èƒ½å·®è·ã€‚

ä¾‹å¦‚ï¼Œåœ¨ [ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” æ‹“å±•æœºåˆ¶ SPIã€‹](http://svip.iocoder.cn/Dubbo/spi/?self) çš„ [ã€Œ4.5.4 createAdaptiveExtensionClassCodeã€](http://svip.iocoder.cn/Dubbo/compiler-javassist/)å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š
```
1: //*/*
2: /* è‡ªåŠ¨ç”Ÿæˆè‡ªé€‚åº”æ‹“å±•çš„ä»£ç å®ç°ï¼Œå¹¶ç¼–è¯‘åè¿”å›è¯¥ç±»ã€‚
3: /*
4: /* @return ç±»
5: /*/
6: private Class<?> createAdaptiveExtensionClass() {
7: // è‡ªåŠ¨ç”Ÿæˆè‡ªé€‚åº”æ‹“å±•çš„ä»£ç å®ç°çš„å­—ç¬¦ä¸²
8: String code = createAdaptiveExtensionClassCode();
9: // ç¼–è¯‘ä»£ç ï¼Œå¹¶è¿”å›è¯¥ç±»
10: ClassLoader classLoader = findClassLoader();
11: com.alibaba.dubbo.common.compiler.Compiler compiler = ExtensionLoader.getExtensionLoader(com.alibaba.dubbo.common.compiler.Compiler.class).getAdaptiveExtension();
12: return compiler.compile(code, classLoader);
13: }
```

è°ƒç”¨

Compiler/#compile(code, classLoader)
æ–¹æ³•ï¼Œç¼–è¯‘ä»£ç ï¼Œå¹¶è¿”å›è¯¥ç±»ã€‚Compiler åŸºäº Dubbo SPI æœºåˆ¶è¿›è¡ŒåŠ è½½ï¼Œç›®å‰æœ‰ä¸¤ç§å®ç°ï¼š

* JdkCompiler
```
<dubbo:application compiler="jdk" />
```
* JavassistCompiler
```
<dubbo:application compiler="javassist" />
```

**ç¼ºçœ**ä½¿ç”¨ JavassistCompiler ã€‚

ğŸ™‚ æœ¬æ–‡ä»…åˆ†äº« JavassistCompiler çš„å®ç°ã€‚

åŠ¨æ€ç¼–è¯‘ï¼Œåœ¨

dubbo-common
æ¨¡å—çš„ [
compiler
](https://github.com/YunaiV/dubbo/tree/ded892cb2f31e2847c18f773e16b16a6fbaf53d2/dubbo-common/src/main/java/com/alibaba/dubbo/common/compiler) åŒ…ä¸‹å®ç°ï¼Œæ•´ä½“ç±»ç»“æ„å¦‚ä¸‹å›¾ï¼š

![ç±»å›¾](http://static2.iocoder.cn/images/Dubbo/2018_09_01/01.png)

# 2. Compiler

com.alibaba.dubbo.common.compiler.Compiler
ï¼Œç¼–è¾‘å™¨æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
@SPI("javassist")
public interface Compiler{
//*/*
/* Compile java source code.
/*
/* ç¼–è¯‘ Java ä»£ç å­—ç¬¦ä¸²
/*
/* @param code Java source code
/* Java ä»£ç å­—ç¬¦ä¸²
/* @param classLoader classloader
/* ç±»åŠ è½½å™¨
/* @return Compiled class
/* ç¼–è¯‘åçš„ç±»
/*/
Class<?> compile(String code, ClassLoader classLoader);
}
```

* @SPI("javassist")
æ³¨è§£ï¼Œä½¿ç”¨ Dubbo SPI æœºåˆ¶ï¼Œé»˜è®¤æ‹“å±•ä¸º Javassist ã€‚
* code
å‚æ•°ï¼ŒJava ä»£ç å­—ç¬¦ä¸²ã€‚å¦‚ä¸‹æ˜¯ ProxyFactory$Adaptive çš„è‡ªé€‚åº”æ‹“å±•çš„ä»£ç å®ç°çš„å­—ç¬¦ä¸²ç”Ÿæˆ**ä¾‹å­**ï¼š![è‡ªé€‚åº”æ‹“å±•çš„ä»£ç å®ç°çš„å­—ç¬¦ä¸²ç”Ÿæˆä¾‹å­](http://static2.iocoder.cn/images/Dubbo/2018_03_04/05.png)

# 3. AdaptiveCompiler

com.alibaba.dubbo.common.compiler.support.AdaptiveCompiler
ï¼Œå®ç° Compiler æ¥å£ï¼Œè‡ªé€‚åº” Compiler å®ç°ç±»ã€‚
```
1: @Adaptive
2: public class AdaptiveCompiler implements Compiler{
3:
4: //*/*
5: /* é»˜è®¤ç¼–è¾‘å™¨çš„æ‹“å±•å
6: /*/
7: private static volatile String DEFAULT_COMPILER;
8:
9: public static void setDefaultCompiler(String compiler){
10: DEFAULT_COMPILER = compiler;
11: }
12:
13: @Override public Class<?> compile(String code, ClassLoader classLoader) {
14: Compiler compiler;
15: // è·å¾— Compiler çš„ ExtensionLoader å¯¹è±¡ã€‚
16: ExtensionLoader<Compiler> loader = ExtensionLoader.getExtensionLoader(Compiler.class);
17: String name = DEFAULT_COMPILER; // copy reference
18: // ä½¿ç”¨è®¾ç½®çš„æ‹“å±•åï¼Œè·å¾— Compiler æ‹“å±•å¯¹è±¡
19: if (name != null && name.length() > 0) {
20: compiler = loader.getExtension(name);
21: // è·å¾—é»˜è®¤çš„ Compiler æ‹“å±•å¯¹è±¡
22: } else {
23: compiler = loader.getDefaultExtension();
24: }
25: //
26: return compiler.compile(code, classLoader);
27: }
28:
29: }
```

* /#setDefaultCompiler(compiler)
**é™æ€**æ–¹æ³•ï¼Œè®¾ç½®é»˜è®¤ç¼–è¾‘å™¨çš„æ‹“å±•å(

DEFAULT_COMPILER
)ã€‚è¯¥æ–¹æ³•è¢«

ApplicationConfig/#setCompiler(compiler)
æ–¹æ³•è°ƒç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š
```
// ApplicationConfig.java
public void setCompiler(String compiler){
this.compiler = compiler;
AdaptiveCompiler.setDefaultCompiler(compiler);
}
```

* åœ¨

<dubbo:application compiler="" />
é…ç½®ä¸‹ï¼Œå¯è§¦å‘è¯¥æ–¹æ³•ã€‚
* /#compile(code, classLoader)
**å®ç°**æ–¹æ³•ï¼š

* ç¬¬ 16 è¡Œï¼šè°ƒç”¨

ExtensionLoader/#getExtensionLoader(Class<?> type)
æ–¹æ³•ï¼Œè·å¾— Compiler çš„ ExtensionLoader å¯¹è±¡ã€‚
* ç¬¬ 17 è¡Œï¼šå£°æ˜

name
å˜é‡ï¼Œå¼•ç”¨

DEFAULT_COMPILER
çš„å€¼ã€‚é¿å…åœ¨ã€ç¬¬ 19 è‡³ 20 è¡Œã€‘çš„ä»£ç è¿‡ç¨‹ä¸­ï¼Œå€¼å˜äº†ã€‚
* ç¬¬ 19 è‡³ 20 è¡Œï¼šä½¿ç”¨**è®¾ç½®**çš„æ‹“å±•åï¼Œè·å¾— Compiler æ‹“å±•å¯¹è±¡ã€‚
* ç¬¬ 22 è‡³ 24 è¡Œï¼šè·å¾—é»˜è®¤çš„ Compiler æ‹“å±•å¯¹è±¡ã€‚
* ç¬¬ 26 è¡Œï¼šè°ƒç”¨çœŸæ­£çš„ Compiler å¯¹è±¡ï¼ŒåŠ¨æ€ç¼–è¯‘ä»£ç ã€‚

# 4. AbstractCompiler

com.alibaba.dubbo.common.compiler.support.AbstractCompiler
ï¼Œå®ç° Compiler æ¥å£ï¼ŒCompiler **æŠ½è±¡ç±»**ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
public abstract class AbstractCompiler implements Compiler{
//*/*
/* æ­£åˆ™ - åŒ…å
/*/
private static final Pattern PACKAGE_PATTERN = Pattern.compile("package\\s+([$_a-zA-Z][$_a-zA-Z0-9\\.]/*);");
//*/*
/* æ­£åˆ™ - ç±»å
/*/
private static final Pattern CLASS_PATTERN = Pattern.compile("class\\s+([$_a-zA-Z][$_a-zA-Z0-9]/*)\\s+");
public Class<?> compile(String code, ClassLoader classLoader) {
// è·å¾—åŒ…å
code = code.trim();
Matcher matcher = PACKAGE_PATTERN.matcher(code);
String pkg;
if (matcher.find()) {
pkg = matcher.group(1);
} else {
pkg = "";
}
// è·å¾—ç±»å
matcher = CLASS_PATTERN.matcher(code);
String cls;
if (matcher.find()) {
cls = matcher.group(1);
} else {
throw new IllegalArgumentException("No such class name in " + code);
}
// è·å¾—å®Œæ•´ç±»å
String className = pkg != null && pkg.length() > 0 ? pkg + "." + cls : cls;
// åŠ è½½ç±»ï¼Œè‹¥å·²ç»å­˜åœ¨
try {
// åŠ è½½æˆåŠŸï¼Œè¯´æ˜å·²å­˜åœ¨
return Class.forName(className, true, ClassHelper.getCallerClassLoader(getClass())); // classloader ä¸ºè°ƒç”¨æ–¹çš„
} catch (ClassNotFoundException e) { // ç±»ä¸å­˜åœ¨ï¼Œè¯´æ˜å¯èƒ½æœªç¼–è¯‘è¿‡ï¼Œè¿›è¡Œç¼–è¯‘
// ä»£ç æ ¼å¼ä¸æ­£ç¡®
if (!code.endsWith("}")) {
throw new IllegalStateException("The java code not endsWith \"}\", code: \n" + code + "\n");
}
// ç¼–è¯‘ä»£ç 
try {
return doCompile(className, code);
} catch (RuntimeException t) {
throw t;
} catch (Throwable t) {
throw new IllegalStateException("Failed to compile class, cause: " + t.getMessage() + ", class: " + className + ", code: \n" + code + "\n, stack: " + ClassUtils.toString(t));
}
}
}
//*/*
/* ç¼–è¯‘ä»£ç 
/*
/* @param name ç±»å
/* @param source ä»£ç 
/* @return ç¼–è¯‘åçš„ç±»
/* @throws Throwable å‘ç”Ÿå¼‚å¸¸
/*/
protected abstract Class<?> doCompile(String name, String source) throws Throwable;
}
```

* é¦–å…ˆè·å¾—å®Œæ•´ç±»åï¼Œåä½¿ç”¨ç±»åŠ è½½å™¨åŠ è½½è¯¥ç±»ï¼š

* è‹¥æˆåŠŸï¼Œè¯´æ˜å·²ç»å­˜åœ¨ï¼ˆå¯èƒ½å·²ç»ç¼–è¯‘è¿‡ï¼‰ã€‚
* è‹¥å¤±è´¥ï¼Œè¿›è¡Œç¼–è¯‘ã€‚
* ğŸ™‚ ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹å¯ä»¥åœ¨çœ‹ä¸‹æ³¨é‡Šã€‚

# 5. JavassistCompiler

Javassist æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†æã€ç¼–è¾‘å’Œåˆ›å»º Java å­—èŠ‚ç çš„ç±»åº“ã€‚é€šè¿‡ä½¿ç”¨Javassist å¯¹å­—èŠ‚ç æ“ä½œå¯ä»¥å®ç°åŠ¨æ€ â€AOPâ€ æ¡†æ¶ã€‚

å…³äº Java å­—èŠ‚ç çš„å¤„ç†ï¼Œç›®å‰æœ‰å¾ˆå¤šå·¥å…·ï¼Œå¦‚ bcelï¼Œasm( cglibåªæ˜¯å¯¹asmåˆå°è£…äº†ä¸€å±‚ )ã€‚ä¸è¿‡è¿™äº›éƒ½éœ€è¦ç›´æ¥è·Ÿè™šæ‹ŸæœºæŒ‡ä»¤æ‰“äº¤é“ã€‚

Javassist çš„ä¸»è¦çš„ä¼˜ç‚¹ï¼Œåœ¨äºç®€å•ï¼Œè€Œä¸”å¿«é€Ÿï¼Œç›´æ¥ä½¿ç”¨ Java ç¼–ç çš„å½¢å¼ï¼Œè€Œä¸éœ€è¦äº†è§£è™šæ‹ŸæœºæŒ‡ä»¤ï¼Œå°±èƒ½åŠ¨æ€æ”¹å˜ç±»çš„ç»“æ„ï¼Œæˆ–è€…åŠ¨æ€ç”Ÿæˆç±»ã€‚

* ç²—ç•¥ä¸€çœ‹ï¼Œå¯èƒ½ä¸å¤Ÿå½¢è±¡ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡çœ‹ JavassistCompiler å¦‚ä½•ä½¿ç”¨æ¥ç†è§£ç†è§£ã€‚
* [ã€ŠJavaå­¦ä¹ ä¹‹javassistã€‹](http://www.cnblogs.com/sunfie/p/5154246.html)
* [ã€ŠJavassist å­—èŠ‚ç æ“ä½œã€‹](http://blog.csdn.net/qbg19881206/article/details/8993562)

com.alibaba.dubbo.common.compiler.support.JavassistCompiler
ï¼Œå®ç° AbstractCompiler æŠ½è±¡ç±»ï¼ŒåŸºäº Javassist å®ç°çš„ Compiler ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
1: public class JavassistCompiler extends AbstractCompiler{
2:
3: //*/*
4: /* æ­£åˆ™ - åŒ¹é… import
5: /*/
6: private static final Pattern IMPORT_PATTERN = Pattern.compile("import\\s+([\\w\\.\\/*]+);\n");
7: //*/*
8: /* æ­£åˆ™ - åŒ¹é… extends
9: /*/
10: private static final Pattern EXTENDS_PATTERN = Pattern.compile("\\s+extends\\s+([\\w\\.]+)[^\\{]/*\\{\n");
11: //*/*
12: /* æ­£åˆ™ - åŒ¹é… implements
13: /*/
14: private static final Pattern IMPLEMENTS_PATTERN = Pattern.compile("\\s+implements\\s+([\\w\\.]+)\\s/*\\{\n");
15: //*/*
16: /* æ­£åˆ™ - åŒ¹é…æ–¹æ³•
17: /*/
18: private static final Pattern METHODS_PATTERN = Pattern.compile("\n(private|public|protected)\\s+");
19: //*/*
20: /* æ­£åˆ™ - åŒ¹é…å˜é‡
21: /*/
22: private static final Pattern FIELD_PATTERN = Pattern.compile("[^\n]+=[^\n]+;");
23:
24: @Override
25: public Class<?> doCompile(String name, String source) throws Throwable {
26: // è·å¾—ç±»å
27: int i = name.lastIndexOf('.');
28: String className = i < 0 ? name : name.substring(i + 1);
29: // åˆ›å»º ClassPool å¯¹è±¡
30: ClassPool pool = new ClassPool(true);
31: // è®¾ç½®ç±»æœç´¢è·¯å¾„
32: pool.appendClassPath(new LoaderClassPath(ClassHelper.getCallerClassLoader(getClass())));
33: // åŒ¹é… import
34: Matcher matcher = IMPORT_PATTERN.matcher(source);
35: List<String> importPackages = new ArrayList<String>(); // å¼•ç”¨çš„åŒ…å
36: Map<String, String> fullNames = new HashMap<String, String>(); // å¼•ç”¨çš„ç±»å
37: while (matcher.find()) {
38: String pkg = matcher.group(1);
39: if (pkg.endsWith("./*")) { // å¼•ç”¨æ•´ä¸ªåŒ…ä¸‹çš„ç±»/æ¥å£
40: String pkgName = pkg.substring(0, pkg.length() - 2);
41: pool.importPackage(pkgName);
42: importPackages.add(pkgName);
43: } else { // å¼•ç”¨æŒ‡å®šç±»/æ¥å£
44: int pi = pkg.lastIndexOf('.');
45: if (pi > 0) {
46: String pkgName = pkg.substring(0, pi);
47: pool.importPackage(pkgName);
48: importPackages.add(pkgName);
49: fullNames.put(pkg.substring(pi + 1), pkg); // ç±»å
50: }
51: }
52: }
53: String[] packages = importPackages.toArray(new String[0]);
54: // åŒ¹é… extends
55: matcher = EXTENDS_PATTERN.matcher(source);
56: CtClass cls;
57: if (matcher.find()) {
58: String extend = matcher.group(1).trim();
59: String extendClass;
60: if (extend.contains(".")) { // å†…åµŒçš„ç±»ï¼Œä¾‹å¦‚ï¼šextends A.B
61: extendClass = extend;
62: } else if (fullNames.containsKey(extend)) { // æŒ‡å®šå¼•ç”¨çš„ç±»
63: extendClass = fullNames.get(extend);
64: } else { // å¼•ç”¨æ•´ä¸ªåŒ…ä¸‹çš„ç±»
65: extendClass = ClassUtils.forName(packages, extend).getName();
66: }
67: // åˆ›å»º CtClass å¯¹è±¡
68: cls = pool.makeClass(name, pool.get(extendClass));
69: } else {
70: // åˆ›å»º CtClass å¯¹è±¡
71: cls = pool.makeClass(name);
72: }
73: // åŒ¹é… implements
74: matcher = IMPLEMENTS_PATTERN.matcher(source);
75: if (matcher.find()) {
76: String[] ifaces = matcher.group(1).trim().split("\\,");
77: for (String iface : ifaces) {
78: iface = iface.trim();
79: String ifaceClass;
80: if (iface.contains(".")) { // å†…åµŒçš„æ¥å£ï¼Œä¾‹å¦‚ï¼šextends A.B
81: ifaceClass = iface;
82: } else if (fullNames.containsKey(iface)) { // æŒ‡å®šå¼•ç”¨çš„æ¥å£
83: ifaceClass = fullNames.get(iface);
84: } else { // å¼•ç”¨æ•´ä¸ªåŒ…ä¸‹çš„æ¥å£
85: ifaceClass = ClassUtils.forName(packages, iface).getName();
86: }
87: // æ·»åŠ æ¥å£
88: cls.addInterface(pool.get(ifaceClass));
89: }
90: }
91: // è·å¾—ç±»ä¸­çš„å†…å®¹ï¼Œå³é¦–æœ« {} çš„å†…å®¹ã€‚
92: String body = source.substring(source.indexOf("{") + 1, source.length() - 1);
93: // åŒ¹é… method ã€‚ä½¿ç”¨åˆ†éš”çš„æ–¹å¼ï¼Œå®é™…ä¸Šï¼Œåˆ†éš”å‡ºæ¥çš„ä¸ä»…ä»…æœ‰æ–¹æ³•ã€‚
94: String[] methods = METHODS_PATTERN.split(body);
95: for (String method : methods) {
96: method = method.trim();
97: if (method.length() > 0) {
98: if (method.startsWith(className)) { // æ„é€ æ–¹æ³•
99: cls.addConstructor(CtNewConstructor.make("public " + method, cls));
100: } else if (FIELD_PATTERN.matcher(method).matches()) { // å˜é‡
101: cls.addField(CtField.make("private " + method, cls));
102: } else { // æ–¹æ³•
103: cls.addMethod(CtNewMethod.make("public " + method, cls));
104: }
105: }
106: }
107: // ç”Ÿæˆç±»
108: // JavassistCompiler.class.getProtectionDomain() =ã€‹ è®¾ç½®ä¿æŠ¤åŸŸå’Œ JavassistCompiler ä¸€è‡´ï¼Œå³ `/#getClass()` æ–¹æ³•ã€‚æ·±å…¥è§ ã€ŠJavaå®‰å…¨â€”â€”å®‰å…¨ç®¡ç†å™¨ã€è®¿é—®æ§åˆ¶å™¨å’Œç±»è£…è½½å™¨ã€‹https://www.zybuluo.com/changedi/note/417132
109: return cls.toClass(ClassHelper.getCallerClassLoader(getClass()), JavassistCompiler.class.getProtectionDomain());
110: }
111:
112: }
```

* å› ä¸ºä¼ å…¥çš„æ˜¯ Java æºä»£ç 

source
ï¼Œéœ€è¦é€šè¿‡æ­£åˆ™åŒ¹é…å‡º

import
ã€

extends
ã€

implements
ã€æ–¹æ³•ã€å˜é‡ï¼Œä¼ é€’ç»™ Javassist API ï¼Œè¿›è¡Œç±»ç”Ÿæˆã€‚ğŸ™‚ å¦‚æœèƒ–å‹å¯¹ Javassist çš„ API ä¸æ˜¯å¾ˆäº†è§£ï¼Œå¯ä»¥çœ‹å®Œæ•´ä½“é€»è¾‘ï¼Œå›çœ‹ä¸‹ä¸Šé¢æä¾›çš„æ–‡æ¡£ã€‚æŒºæœ‰è¶£çš„ã€‚
* ç¬¬ 27 è‡³ 28 è¡Œï¼šè·å¾—ç±»åã€‚
* ç¬¬ 30 è¡Œï¼šåˆ›å»º ClassPool å¯¹è±¡ã€‚**ClassPool** æ˜¯ä¸€ä¸ª CtClass å¯¹è±¡çš„ hash è¡¨ï¼Œç±»ååšä¸º key ã€‚ClassPool çš„

/#get(key)
æœç´¢ hash è¡¨æ‰¾åˆ°ä¸æŒ‡å®š key å…³è”çš„ CtClass å¯¹è±¡ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ° CtClass å¯¹è±¡ï¼Œ

/#get(key)
è¯»ä¸€ä¸ªç±»æ–‡ä»¶æ„å»ºæ–°çš„ CtClass å¯¹è±¡ï¼Œå®ƒæ˜¯è¢«è®°å½•åœ¨ hash è¡¨ä¸­ç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡ã€‚
* ç¬¬ 32 è¡Œï¼šè°ƒç”¨

ClassPool/#appendClassPath(ClassPath)
æ–¹æ³•ï¼Œè®¾ç½®ç±»æœç´¢è·¯å¾„ã€‚
* ç¬¬ 33 è‡³ 52 è¡Œï¼šåŒ¹é…

import
ã€‚

* ClassPool/#importPackage(packageName)
æ–¹æ³•ï¼Œå¼•ç”¨åŒ…ã€‚
* ç¬¬ 54 è‡³ 72 è¡Œï¼šåŒ¹é…

extends
ã€‚

* ClassPool/#makeClass(name, extendClass)
æ–¹æ³•ï¼Œåˆ›å»º**å¸¦ç»§æ‰¿çš„**ç±»ã€‚
* ClassPool/#makeClass(name)
æ–¹æ³•ï¼Œåˆ›å»ºç±»ã€‚
* ç¬¬ 74 è‡³ 90 è¡Œï¼šåŒ¹é…

implements
ï¼Œæ•´ä½“é€»è¾‘å’Œ

extends
ç±»ä¼¼ã€‚

* CtClass/#addInterface(anInterface)
æ–¹æ³•ï¼Œæ·»åŠ ç±»çš„æ¥å£ã€‚
* ç¬¬ 92 è¡Œï¼šè·å¾—ç±»ä¸­çš„å†…å®¹ï¼Œå³é¦–æœ«

{

}
ä¸­çš„å†…å®¹ä½“ã€‚
* ç¬¬ 94 è‡³ 106 è¡Œï¼šåŒ¹é…æ–¹æ³•å’Œå˜é‡ã€‚ä½¿ç”¨

METHODS_PATTERN
åˆ†éš”çš„æ–¹å¼ã€‚

* CtClass/#addConstructor(CtConstructor)
æ–¹æ³•ï¼Œæ·»åŠ ç±»çš„æ„é€ æ–¹æ³•ã€‚
* CtClass/#addMethod(CtMethod)
æ–¹æ³•ï¼Œæ·»åŠ ç±»çš„æ–¹æ³•ã€‚
* CtClass/#addField(CtField)
æ–¹æ³•ï¼Œæ·»åŠ ç±»çš„å±æ€§ã€‚
* ç¬¬ 109 è¡Œï¼šè°ƒç”¨

CtClass/#toClass(ClassLoader, ProtectionDomain)
æ–¹æ³•ï¼Œç”Ÿæˆç±»ã€‚