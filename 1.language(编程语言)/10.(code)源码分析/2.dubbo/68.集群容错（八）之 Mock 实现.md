# é›†ç¾¤å®¹é”™ï¼ˆå…«ï¼‰ä¹‹ Mock å®ç°

æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚

# 1. æ¦‚è¿°

æœ¬æ–‡æ¥ [ã€Šç²¾å°½ Dubbo æºç è§£æ â€”â€” é›†ç¾¤å®¹é”™ï¼ˆä¸ƒï¼‰ä¹‹ Router å®ç°ã€‹](http://svip.iocoder.cn/Dubbo/cluster-7-impl-router/?self) ä¸€æ–‡ï¼Œåˆ†äº«

dubbo-cluster
æ¨¡å—ï¼Œ

mock
åŒ…ï¼Œå®ç° Dubbo å¦‚ä¸‹åŠŸèƒ½ï¼š

* **æœ¬åœ°ä¼ªè£…**ï¼šé€šå¸¸ç”¨äºæœåŠ¡é™çº§ï¼Œæ¯”å¦‚æŸéªŒæƒæœåŠ¡ï¼Œå½“æœåŠ¡æä¾›æ–¹å…¨éƒ¨æŒ‚æ‰åï¼Œå®¢æˆ·ç«¯ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œæ˜¯é€šè¿‡ Mock æ•°æ®è¿”å›æˆæƒå¤±è´¥ã€‚
* **æœåŠ¡é™çº§**ï¼šå¯ä»¥é€šè¿‡æœåŠ¡é™çº§åŠŸèƒ½ï¼Œä¸´æ—¶å±è”½æŸä¸ªå‡ºé”™çš„éå…³é”®æœåŠ¡ï¼Œå¹¶å®šä¹‰é™çº§åçš„è¿”å›ç­–ç•¥ã€‚
è€è‰¿è‰¿ï¼šå¦‚æœä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œæ¨èç»“åˆç€ [ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœ¬åœ°ä¼ªè£…ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/local-mock.html) å’Œ [ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœåŠ¡é™çº§ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/service-downgrade.html) ä¸€èµ·å­¦ä¹ ã€‚

* **æ³¨æ„**ï¼Œ[ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœ¬åœ°ä¼ªè£…ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/local-mock.html) çš„æ–‡æ¡£æœ‰ç‚¹é—®é¢˜ï¼šSpring XML æ˜¯é€šè¿‡

<dubbo:reference />
é…ç½®ï¼Œè€Œä¸æ˜¯

<dubbo:service />
ã€‚

æœ¬æ–‡æ¶‰åŠç±»å¦‚ä¸‹å›¾ï¼š

![Mock ç›¸å…³ç±»](http://static2.iocoder.cn/images/Dubbo/2019_05_05/01.png)

* åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š

* MockClusterWrapper + MockClusterInvoker + MockClusterSelector
* MockProtocol + MockInvoker

# 2. MockClusterWrapper

com.alibaba.dubbo.rpc.cluster.support.wrapper.MockClusterWrapper
ï¼Œå®ç° Cluster æ¥å£ï¼ŒMock Cluster **Wrapper** å®ç°ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
public class MockClusterWrapper implements Cluster{
//*/*
/* çœŸæ­£çš„ Cluster å¯¹è±¡
/*/
private Cluster cluster;
public MockClusterWrapper(Cluster cluster){
this.cluster = cluster;
}
@Override
public <T> Invoker<T> join(Directory<T> directory) throws RpcException{
return new MockClusterInvoker<T>(directory, // <2>
this.cluster.join(directory)); // <1>
}
}
```

* cluster
å­—æ®µï¼Œ**çœŸæ­£**çš„ Cluster å¯¹è±¡ã€‚å› ä¸º MockClusterWrapper æ˜¯ Dubbo SPI Wrapper ç±»ï¼Œ**æ‰€ä»¥å¯¹åº”çš„ Cluster å¯¹è±¡ï¼Œéƒ½ä¼šè¢«å®ƒæ‰€åŒ…è£…**ã€‚ä¸ç†è§£çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹ä¸‹ [ã€Šç²¾å°½ Dubbo æºç åˆ†æ â€”â€” æ‹“å±•æœºåˆ¶ SPIã€‹](http://svip.iocoder.cn/Dubbo/spi/?self) çš„ [ã€Œ4.4.2 createExtensionã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) çš„ã€ç¬¬ 24 è‡³ 30 è¡Œã€‘ã€‚
* <1>
å¤„ï¼šè°ƒç”¨

Cluster/#join(directory)
æ–¹æ³•ï¼Œåˆ›å»º**çœŸæ­£**çš„ Cluster Invoker å¯¹è±¡ã€‚
* <2>
å¤„ï¼šåˆ›å»º MockClusterInvoker å¯¹è±¡ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ3. MockClusterInvokerã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚

# 3. MockClusterInvoker

com.alibaba.dubbo.rpc.cluster.support.wrapper.MockClusterInvoker
ï¼Œå®ç° Invoker æ¥å£ï¼Œ**MockClusterWrapper** å¯¹åº”çš„ Invoker å®ç°ç±»ã€‚

## 3.1 æ„é€ æ–¹æ³•

```
private final Directory<T> directory;
//*/*
/* çœŸæ­£çš„ Invoker å¯¹è±¡
/*/
private final Invoker<T> invoker;
public MockClusterInvoker(Directory<T> directory, Invoker<T> invoker){
this.directory = directory;
this.invoker = invoker;
}
```

## 3.2 invoke

```
1: @Override
2: public Result invoke(Invocation invocation) throws RpcException{
3: Result result;
4: // è·å¾— "mock" é…ç½®é¡¹ï¼Œæœ‰å¤šç§é…ç½®æ–¹å¼
5: String value = directory.getUrl().getMethodParameter(invocation.getMethodName(), Constants.MOCK_KEY, Boolean.FALSE.toString()).trim();
6: //ã€ç¬¬ä¸€ç§ã€‘æ—  mock
7: if (value.length() == 0 || value.equalsIgnoreCase("false")) {
8: // no mock
9: // è°ƒç”¨åŸ Invoker ï¼Œå‘èµ· RPC è°ƒç”¨
10: result = this.invoker.invoke(invocation);
11: //ã€ç¬¬äºŒç§ã€‘å¼ºåˆ¶æœåŠ¡é™çº§ http://dubbo.apache.org/zh-cn/docs/user/demos/service-downgrade.html
12: } else if (value.startsWith("force")) {
13: if (logger.isWarnEnabled()) {
14: logger.info("force-mock: " + invocation.getMethodName() + " force-mock enabled , url : " + directory.getUrl());
15: }
16: // force:direct mock
17: // ç›´æ¥è°ƒç”¨ Mock Invoker ï¼Œæ‰§è¡Œæœ¬åœ° Mock é€»è¾‘
18: result = doMockInvoke(invocation, null);
19: // ã€ç¬¬ä¸‰ç§ã€‘å¤±è´¥æœåŠ¡é™çº§ http://dubbo.apache.org/zh-cn/docs/user/demos/service-downgrade.html
20: } else {
21: // fail-mock
22: try {
23: // è°ƒç”¨åŸ Invoker ï¼Œå‘èµ· RPC è°ƒç”¨
24: result = this.invoker.invoke(invocation);
25: } catch (RpcException e) {
26: // ä¸šåŠ¡æ€§å¼‚å¸¸ï¼Œç›´æ¥æŠ›å‡º
27: if (e.isBiz()) {
28: throw e;
29: } else {
30: if (logger.isWarnEnabled()) {
31: logger.info("fail-mock: " + invocation.getMethodName() + " fail-mock enabled , url : " + directory.getUrl(), e);
32: }
33: // å¤±è´¥åï¼Œè°ƒç”¨ Mock Invoker ï¼Œæ‰§è¡Œæœ¬åœ° Mock é€»è¾‘
34: result = doMockInvoke(invocation, e);
35: }
36: }
37: }
38: return result;
39: }
```

* ç¬¬ 5 è¡Œï¼šè·å¾—

"mock"
é…ç½®é¡¹ã€‚æ ¹æ®ä¸åŒçš„é…ç½®ï¼Œåˆ†æˆ**ä¸‰ç§**æƒ…å†µã€‚
* ========== ç¬¬ä¸€ç§ï¼š**æ—  Mock** ==========
* ç¬¬ 10 è¡Œï¼šåªè°ƒç”¨**çœŸæ­£çš„**

invoker
çš„

/#invoke(invocation)
æ–¹æ³•ï¼Œå‘èµ· RPC è°ƒç”¨ï¼Œ**å³ä¸è¿›è¡Œ Mock é€»è¾‘**ã€‚
* ========== ç¬¬äºŒç§ï¼š**å¼ºåˆ¶æœåŠ¡é™çº§** ==========
* ç¬¬ 12 è¡Œï¼š

"mock"
é…ç½®é¡¹ä»¥

"force"
**å¼€å¤´**ï¼Œ**å¼ºåˆ¶**æœåŠ¡é™çº§ï¼Œå³ [ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœåŠ¡é™çº§ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/service-downgrade.html) ã€‚
* ç¬¬ 18 è¡Œï¼š**ç›´æ¥**è°ƒç”¨

/#doMockInvoke(invocation, null)
æ–¹æ³•ï¼Œè°ƒç”¨ **Mock Invoker** ï¼Œæ‰§è¡Œæœ¬åœ° Mock é€»è¾‘ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ3.3 doMockInvokeã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚
* ========== ç¬¬ä¸‰ç§ï¼š**å¤±è´¥æœåŠ¡é™çº§** ==========
* ç¬¬ 24 è¡Œï¼š**ä¼˜å…ˆ**ï¼Œè°ƒç”¨**çœŸæ­£çš„**

invoker
çš„

/#invoke(invocation)
æ–¹æ³•ï¼Œå‘èµ· RPC è°ƒç”¨ï¼Œ**å³ä¸è¿›è¡Œ Mock é€»è¾‘**ã€‚
* ç¬¬ 25 è‡³ 36 è¡Œï¼šå¤„ç† RpcException å¼‚å¸¸ã€‚**ä¹Ÿä»…ä»…å¤„ç†è¿™ç§ç±»å‹çš„å¼‚å¸¸**ã€‚

* ç¬¬ 26 è‡³ 28 è¡Œï¼šè‹¥å‘ç”Ÿ**ä¸šåŠ¡æ€§**å¼‚å¸¸ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚
* ç¬¬ 29 è‡³ 35 è¡Œï¼š**å¤±è´¥å**ï¼Œè°ƒç”¨

/#doMockInvoke(invocation, null)
æ–¹æ³•ï¼Œè°ƒç”¨ **Mock Invoker** ï¼Œæ‰§è¡Œæœ¬åœ° Mock é€»è¾‘ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ3.3 doMockInvokeã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚

ğŸ˜ˆ æ€»çš„æ¥è¯´ï¼ŒMockClusterInvoker çš„

/#invoke(Invocation)
æ–¹æ³•çš„è¿‡ç¨‹ï¼Œæ ¹æ®ä¸åŒçš„

"mock"
é…ç½®ï¼Œâ€œç»„åˆâ€è°ƒç”¨**çœŸæ­£çš„**å’Œ **Mock** çš„ Invoker ã€‚

## 3.3 doMockInvoke

```
1: private Result doMockInvoke(Invocation invocation, RpcException e){
2: Result result;
3: // ç¬¬ä¸€æ­¥ï¼Œè·å¾— Mock Invoker å¯¹è±¡
4: Invoker<T> mInvoker;
5: // è·¯ç”±åŒ¹é… Mock Invoker é›†åˆ
6: List<Invoker<T>> mockInvokers = selectMockInvoker(invocation);
7: // å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»º MockInvoker å¯¹è±¡
8: if (mockInvokers == null || mockInvokers.isEmpty()) {
9: mInvoker = (Invoker<T>) new MockInvoker(directory.getUrl());
10: // å¦‚æœå­˜åœ¨ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
11: } else {
12: mInvoker = mockInvokers.get(0);
13: }
14: // ç¬¬äºŒæ­¥ï¼Œè°ƒç”¨ï¼Œæ‰§è¡Œæœ¬åœ° Mock é€»è¾‘
15: try {
16: result = mInvoker.invoke(invocation);
17: } catch (RpcException me) {
18: if (me.isBiz()) {
19: result = new RpcResult(me.getCause());
20: } else {
21: throw new RpcException(me.getCode(), getMockExceptionMessage(e, me), me.getCause());
22: }
23: } catch (Throwable me) {
24: throw new RpcException(getMockExceptionMessage(e, me), me.getCause());
25: }
26: return result;
27: }
```

* ç¬¬ 3 è‡³ 13 è¡Œï¼š**ç¬¬ä¸€æ­¥**ï¼Œè·å¾— **MockInvoker** å¯¹è±¡ã€‚

* ç¬¬ 6 è¡Œï¼šè°ƒç”¨

/#selectMockInvoker(invocation)
æ–¹æ³•ï¼Œ**è·¯ç”±åŒ¹é…** Mock Invoker é›†åˆã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ3.4 selectMockInvokerã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚
* ç¬¬ 7 è‡³ 9 è¡Œï¼šè‹¥**ä¸**å­˜åœ¨ï¼Œ**åˆ›å»º** MockInvoker å¯¹è±¡ã€‚
* ç¬¬ 10 è‡³ 13 è¡Œï¼šè‹¥**å·²**ä¸èƒ½å†ï¼Œ**é€‰æ‹©**ç¬¬ä¸€ä¸ª Mock Invoker å¯¹è±¡ã€‚
* ç¬¬ 14 è‡³ 16 è¡Œï¼šè°ƒç”¨

MockInvoker/#invoke(invocation)
æ–¹æ³•ï¼Œæ‰§è¡Œæœ¬åœ° Mock é€»è¾‘ã€‚
* ç¬¬ 17 è‡³ 25 è¡Œï¼šå¤„ç†**å¼‚å¸¸**ã€‚

## 3.4 selectMockInvoker

```
1: private List<Invoker<T>> selectMockInvoker(Invocation invocation) {
2: List<Invoker<T>> invokers = null;
3: if (invocation instanceof RpcInvocation) {
4: // å­˜åœ¨éšå«å¥‘çº¦(è™½ç„¶åœ¨æ¥å£å£°æ˜ä¸­å¢åŠ æè¿°ï¼Œä½†æ‰©å±•æ€§ä¼šå­˜åœ¨é—®é¢˜.åŒæ—¶æ”¾åœ¨ attachment ä¸­çš„åšæ³•éœ€è¦æ”¹è¿›
5: ((RpcInvocation) invocation).setAttachment(Constants.INVOCATION_NEED_MOCK, Boolean.TRUE.toString());
6: // directory æ ¹æ® invocation ä¸­ attachment æ˜¯å¦æœ‰ Constants.INVOCATION_NEED_MOCKï¼Œæ¥åˆ¤æ–­è·å–çš„æ˜¯ normal invokers or mock invokers
7: try {
8: invokers = directory.list(invocation);
9: } catch (RpcException e) {
10: if (logger.isInfoEnabled()) {
11: logger.info("Exception when try to invoke mock. Get mock invokers error for service:" + directory.getUrl().getServiceInterface() + ", method:" + invocation.getMethodName() + ", will contruct a new mock with 'new MockInvoker()'.", e);
12: }
13: }
14: }
15: return invokers;
16: }
```

* ç¬¬ 5 è¡Œï¼šè®¾ç½® RpcInvocation çš„

"invocation.need.mock"
ä¸º **true** ã€‚
* ç¬¬ 8 è¡Œï¼šè°ƒç”¨

Directory/#list(invocation)
æ–¹æ³•ï¼Œè·å¾—**æ‰€æœ‰** Invoker é›†åˆã€‚å› ä¸ºã€ç¬¬ 5 è¡Œã€‘è®¾ç½®äº†

"invocation.need.mock"
ä¸º **true** ï¼Œæ‰€ä»¥å®é™…è·å¾—çš„æ˜¯ MockInvoker é›†åˆã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ3.4.1 MockInvokersSelectorã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚

### 3.4.1 MockInvokersSelector

com.alibaba.dubbo.rpc.cluster.router.MockInvokersSelector
ï¼Œå®ç° Router æ¥å£ï¼ŒMockInvoker è·¯ç”±**é€‰æ‹©å™¨**å®ç°ç±»ã€‚

å› ä¸º AbstractDirectory çš„

/#setRouters(List<Router> routers)
æ–¹æ³•ä¸­ï¼Œéƒ½ä¼šæ·»åŠ  **MockInvokersSelector** ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![setRouters](http://static2.iocoder.cn/images/Dubbo/2019_05_05/02.png)

* æ‰€ä»¥ï¼Œæ¯æ¬¡

Directory/#list(invocation)
çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šæ‰§è¡Œ MockInvokersSelector çš„è·¯ç”±é€»è¾‘ã€‚

/#route(List<Invoker<T>> invokers, URL url, Invocation invocation)
æ–¹æ³•ï¼Œæ ¹æ®

"invocation.need.mock"
è·¯ç”±åŒ¹é…**å¯¹åº”ç±»å‹**çš„ Invoker é›†åˆï¼š

* 1ã€è‹¥ä¸º **true** ï¼Œ**Mock**Invoker é›†åˆã€‚
* 2ã€è‹¥ä¸º **false** ï¼Œ**æ™®é€š** Invoker é›†åˆã€‚

ä»£ç å¦‚ä¸‹ï¼š
```
1: @Override
2: public <T> List<Invoker<T>> route(final List<Invoker<T>> invokers, URL url, final Invocation invocation) throws RpcException {
3: // è·å¾—æ™®é€š Invoker é›†åˆ
4: if (invocation.getAttachments() == null) {
5: return getNormalInvokers(invokers);
6: } else {
7: // è·å¾— "invocation.need.mock" é…ç½®é¡¹
8: String value = invocation.getAttachments().get(Constants.INVOCATION_NEED_MOCK);
9: // è·å¾—æ™®é€š Invoker é›†åˆ
10: if (value == null) {
11: return getNormalInvokers(invokers);
12: // è·å¾— MockInvoker é›†åˆ
13: } else if (Boolean.TRUE.toString().equalsIgnoreCase(value)) {
14: return getMockedInvokers(invokers);
15: }
16: }
17: // å…¶å®ƒï¼Œä¸åŒ¹é…ï¼Œç›´æ¥è¿”å› `invokers` é›†åˆ
18: return invokers;
19: }
```

* åˆ†æˆ**ä¸‰ç§**æƒ…å†µï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªæ¥çœ‹ã€‚åœ¨çœ‹å…·ä½“æƒ…å†µä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹

/#hasMockProviders(invokers)
æ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ MockInvoker ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
private <T> boolean hasMockProviders(final List<Invoker<T>> invokers){
boolean hasMockProvider = false;
for (Invoker<T> invoker : invokers) {
if (invoker.getUrl().getProtocol().equals(Constants.MOCK_PROTOCOL)) { // åè®®ä¸º "mock"
hasMockProvider = true;
break;
}
}
return hasMockProvider;
}
```

* é€šè¿‡

protocol = "mock"
æ¥åˆ¤æ–­ï¼Œæ˜¯å¦ä¸º **Mock**Invoker ã€‚æ‰€ä»¥åªè¦**ä¸ä¸º** MockInvoker ï¼Œå°±æ˜¯**æ™®é€š** Invoker ã€‚å…³äº

"mock"
åè®®ï¼Œæˆ‘ä»¬ç¨ååœ¨ [ã€Œ4. MockProtocolã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ä¸­ï¼Œè¯¦ç»†è§£æã€‚
* ã€ç¬¬**ä¸€**ç§ã€‘ç¬¬ 3 è‡³ 5 è¡Œ || ç¬¬ 9 è‡³ 11 è¡Œï¼šè‹¥**æœªè®¾ç½®**

"invocation.need.mock"
é…ç½®é¡¹ï¼Œè°ƒç”¨

/#getNormalInvokers(invokers)
æ–¹æ³•ï¼Œè·å¾—**æ™®é€š** Invoker é›†åˆã€‚ä»£ç å¦‚ä¸‹ï¼š
```
1: private <T> List<Invoker<T>> getNormalInvokers(final List<Invoker<T>> invokers) {
2: // ä¸åŒ…å« MockInvoker çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è¿”å› `invokers` é›†åˆ
3: if (!hasMockProviders(invokers)) {
4: return invokers;
5: } else {
6: // è‹¥åŒ…å« MockInvoker çš„æƒ…å†µä¸‹ï¼Œè¿‡æ»¤æ‰ MockInvoker ï¼Œåˆ›å»ºæ™®é€š Invoker é›†åˆ
7: List<Invoker<T>> sInvokers = new ArrayList<Invoker<T>>(invokers.size());
8: for (Invoker<T> invoker : invokers) {
9: if (!invoker.getUrl().getProtocol().equals(Constants.MOCK_PROTOCOL)) {
10: sInvokers.add(invoker);
11: }
12: }
13: return sInvokers;
14: }
15: }
```

* ç¬¬ 2 è‡³ 4 è¡Œï¼šè°ƒç”¨

/#hasMockProviders(invokers)
æ–¹æ³•ï¼Œåˆ¤æ–­**ä¸åŒ…å«** MockInvoker çš„æƒ…å†µï¼Œç›´æ¥è¿”å›

invokers
é›†åˆã€‚
* ç¬¬ 6 è‡³ 13 è¡Œï¼šè‹¥**åŒ…å«** MockInvoker çš„æƒ…å†µï¼Œ**è¿‡æ»¤**æ‰ MockInvoker ï¼Œåˆ›å»º**æ™®é€š** Invoker é›†åˆã€‚
* ã€ç¬¬**äºŒ**ç§ã€‘ç¬¬ 12 è‡³ 15 è¡Œï¼šè‹¥è®¾ç½®

"invocation.need.mock"
é…ç½®é¡¹ä¸º **true** ï¼Œè°ƒç”¨

/#getMockedInvokers(invokers)
æ–¹æ³•ï¼Œè·å¾— **Mock**Invoker é›†åˆã€‚ä»£ç å¦‚ä¸‹ï¼š
```
private <T> List<Invoker<T>> getMockedInvokers(final List<Invoker<T>> invokers) {
// ä¸åŒ…å« MockInvoker çš„æƒ…å†µä¸‹ï¼Œç›´æ¥è¿”å› null
if (!hasMockProviders(invokers)) {
return null;
}
// è¿‡æ»¤æ‰æ™®é€š kInvoker ï¼Œåˆ›å»º MockInvoker é›†åˆ
List<Invoker<T>> sInvokers = new ArrayList<Invoker<T>>(1); // ä¸€èˆ¬æƒ…å†µå°±ä¸€ä¸ªï¼Œæ‰€ä»¥è®¾ç½®äº†é»˜è®¤æ•°ç»„å¤§å°ä¸º 1 ã€‚
for (Invoker<T> invoker : invokers) {
if (invoker.getUrl().getProtocol().equals(Constants.MOCK_PROTOCOL)) {
sInvokers.add(invoker);
}
}
return sInvokers;
}
```

* å’Œ

/#getNormalInvokers(invokers)
æ–¹æ³•ï¼Œ**ç›¸å**ã€‚æ¯”è¾ƒæ˜“æ‡‚ï¼Œèƒ–å‹çœ‹ä»£ç æ³¨é‡Šã€‚
* ã€ç¬¬**ä¸‰**ç§ã€‘ç¬¬ 18 è¡Œï¼šå…¶å®ƒï¼Œ**ä¸åŒ¹é…**ï¼Œç›´æ¥è¿”å›

invokers
é›†åˆã€‚ç†è®ºä¸Šï¼Œåº”è¯¥è°ƒç”¨å’Œã€ç¬¬**ä¸€**ç§ã€‘ä¸€æ ·ï¼Œè°ƒç”¨

/#getNormalInvokers(invokers)
æ–¹æ³•ã€‚ä¸è¿‡æ²¡å…³ç³»ï¼ŒğŸ˜ˆ ä»ç›®å‰ä»£ç æ¥çœ‹ï¼Œè¿™å—æ˜¯èµ°ä¸åˆ°çš„ã€‚

# 4. MockProtocol

com.alibaba.dubbo.rpc.support.MockProtocol
ï¼Œå®ç° AbstractProtocol æŠ½è±¡ç±»ï¼Œç”¨äºåœ¨æœåŠ¡**æ¶ˆè´¹è€…**ï¼Œé€šè¿‡ç±»å‹ä¸º

"mock"
çš„ URL ï¼Œå¼•ç”¨åˆ›å»º MockInvoker å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
public final class MockProtocol extends AbstractProtocol{
@Override
public <T> Exporter<T> export(Invoker<T> invoker) throws RpcException{
throw new UnsupportedOperationException();
}
@Override
public <T> Invoker<T> refer(Class<T> type, URL url) throws RpcException{
return new MockInvoker<T>(url);
}
@Override
public int getDefaultPort(){
return 0;
}
}
```

* /#export(Invoker)
**å®ç°**æ–¹æ³•ï¼Œä¸å…è®¸è°ƒç”¨ï¼Œç›´æ¥æŠ›å‡º UnsupportedOperationException å¼‚å¸¸ã€‚
* /#refer(Class<T> type, Url)
**å®ç°**æ–¹æ³•ï¼Œå¼•ç”¨åˆ›å»º **MockInvoker** å¯¹è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡

dubbo-admin
**è¿ç»´å¹³å°**æˆ–è€…ç›´æ¥å‘ Zookeeper å†™å…¥**é™æ€** URL ï¼Œä¾‹å¦‚ï¼š
```
// å®é™…å†™å…¥çš„ URL
/dubbo/com.alibaba.dubbo.demo.DemoService/providers/mock%3A%2F%2F10.20.153.11%2Fcom.alibaba.dubbo.demo.DemoService%3Fdynamic%3Dtrue%26application%3Dfoo
// decode URL
/dubbo/com.alibaba.dubbo.demo.DemoService/providers/mock://10.20.153.11/com.alibaba.dubbo.demo.DemoService?dynamic=true&application=foo
```

* ä¸ºä»€ä¹ˆè¦æ˜¯**é™æ€** URL å‘¢ï¼Ÿå› ä¸ºéé™æ€ URL ï¼Œå¯èƒ½è¢«æ³¨å†Œä¸­å¿ƒåˆ é™¤ã€‚

ğŸ˜ˆ å½“ç„¶ï¼Œæˆ‘ä»¬åœ¨ [ã€Œ3.3 doMockInvokeã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ä¸­ä¹Ÿçœ‹åˆ°ï¼Œå³ä½¿ä¸**æ‰‹åŠ¨**æ·»åŠ 

"mock"
URL ï¼Œåœ¨ã€ç¬¬ 9 è¡Œã€‘ä»£ç ä¸­ä¹Ÿä¼š**è‡ªåŠ¨**åˆ›å»º MockInvoker å¯¹è±¡ã€‚

# 5. MockInvoker

com.alibaba.dubbo.rpc.support.MockInvoker
ï¼Œå®ç° Invoker æ¥å£ï¼Œ**Mock** Invoker å®ç°ç±»ã€‚

## 5.1 æ„é€ æ–¹æ³•

```
//*/*
/* ProxyFactory$Adaptive å¯¹è±¡
/*/
private final static ProxyFactory proxyFactory = ExtensionLoader.getExtensionLoader(ProxyFactory.class).getAdaptiveExtension();
//*/*
/* mock ä¸ Invoker å¯¹è±¡çš„æ˜ å°„ç¼“å­˜
/*
/* @see /#getInvoker(String)
/*/
private final static Map<String, Invoker<?>> mocks = new ConcurrentHashMap<String, Invoker<?>>();
//*/*
/* mock ä¸ Throwable å¯¹è±¡çš„æ˜ å°„ç¼“å­˜
/*
/* @see /#getThrowable(String)
/*/
private final static Map<String, Throwable> throwables = new ConcurrentHashMap<String, Throwable>();
//*/*
/* URL å¯¹è±¡
/*/
private final URL url;
public MockInvoker(URL url){
this.url = url;
}
```

## 5.2 invoke

/#invoke(Invocation)
**å®ç°**æ–¹æ³•ï¼Œæ‰§è¡Œ Mock é€»è¾‘ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
1: @Override
2: public Result invoke(Invocation invocation) throws RpcException{
3: if (invocation instanceof RpcInvocation) {
4: ((RpcInvocation) invocation).setInvoker(this);
5: }
6: // è·å¾— `"mock"` é…ç½®é¡¹ï¼Œæ–¹æ³•çº§ > ç±»çº§
7: String mock = getUrl().getParameter(invocation.getMethodName() + "." + Constants.MOCK_KEY);
8: if (StringUtils.isBlank(mock)) {
9: mock = getUrl().getParameter(Constants.MOCK_KEY);
10: }
11: if (StringUtils.isBlank(mock)) { // ä¸å…è®¸ä¸ºç©º
12: throw new RpcException(new IllegalAccessException("mock can not be null. url :" + url));
13: }
14: // æ ‡å‡†åŒ– `"mock"` é…ç½®é¡¹
15: mock = normalizedMock(URL.decode(mock));
16: // ç­‰äº "return " ï¼Œè¿”å›å€¼ä¸ºç©ºçš„ RpcResult å¯¹è±¡
17: if (Constants.RETURN_PREFIX.trim().equalsIgnoreCase(mock.trim())) {
18: RpcResult result = new RpcResult();
19: result.setValue(null);
20: return result;
21: // ä»¥ "return " å¼€å¤´ï¼Œè¿”å›å¯¹åº”å€¼çš„ RpcResult å¯¹è±¡
22: } else if (mock.startsWith(Constants.RETURN_PREFIX)) {
23: mock = mock.substring(Constants.RETURN_PREFIX.length()).trim();
24: mock = mock.replace('`', '"');
25: try {
26: // è§£æè¿”å›ç±»å‹
27: Type[] returnTypes = RpcUtils.getReturnTypes(invocation);
28: // è§£æè¿”å›å€¼
29: Object value = parseMockValue(mock, returnTypes);
30: // åˆ›å»ºå¯¹åº”å€¼çš„ RpcResult å¯¹è±¡ï¼Œå¹¶è¿”å›
31: return new RpcResult(value);
32: } catch (Exception ew) {
33: throw new RpcException("mock return invoke error. method :" + invocation.getMethodName() + ", mock:" + mock + ", url: " + url, ew);
34: }
35: // ä»¥ "throw" å¼€å¤´ï¼ŒæŠ›å‡º RpcException å¼‚å¸¸
36: } else if (mock.startsWith(Constants.THROW_PREFIX)) {
37: mock = mock.substring(Constants.THROW_PREFIX.length()).trim();
38: mock = mock.replace('`', '"');
39: if (StringUtils.isBlank(mock)) { // ç¦æ­¢ä¸ºç©º
40: throw new RpcException(" mocked exception for Service degradation. ");
41: } else { // user customized class
42: // åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸
43: Throwable t = getThrowable(mock);
44: // æŠ›å‡ºä¸šåŠ¡ç±»å‹çš„ RpcException å¼‚å¸¸
45: throw new RpcException(RpcException.BIZ_EXCEPTION, t);
46: }
47: // è‡ªå®šä¹‰ Mock ç±»ï¼Œæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘
48: } else {
49: try {
50: // åˆ›å»º Invoker å¯¹è±¡
51: Invoker<T> invoker = getInvoker(mock);
52: // æ‰§è¡Œ Invoker å¯¹è±¡çš„è°ƒç”¨é€»è¾‘
53: return invoker.invoke(invocation);
54: } catch (Throwable t) {
55: throw new RpcException("Failed to create mock implemention class " + mock, t);
56: }
57: }
58: }
```

* ç¬¬ 6 è‡³ 13 è¡Œï¼šè·å¾—

"mock"
é…ç½®é¡¹ï¼Œä¼˜å…ˆä»**æ–¹æ³•çº§**çš„å‚æ•°ï¼Œå†ä»**ç±»çº§**çš„å‚æ•°ã€‚
* ç¬¬ 15 è¡Œï¼šè°ƒç”¨

/#normalizedMock(mock)
æ–¹æ³•ï¼Œæ ‡å‡†åŒ–

"mock"
é…ç½®é¡¹ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ5.3 normalizedMockã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚
* ä¸‹é¢æ ¹æ®

mock
ï¼Œåˆ†æˆ**ä¸‰ç§**æƒ…å†µã€‚
* ã€ç¬¬ **1.1** ç§ã€‘ç¬¬ 16 è‡³ 20 è¡Œï¼šç­‰äº

"return "
ï¼Œè¿”å›å€¼ä¸º**ç©º** çš„ RpcResult å¯¹è±¡ã€‚
* ã€ç¬¬ **1.2** ç§ã€‘ç¬¬ 21 è‡³ 34 è¡Œï¼šä»¥

"return"
å¼€å¤´ï¼Œè¿”å›**å¯¹åº”å€¼** çš„ RpcResult å¯¹è±¡ã€‚

* ç¬¬29 è¡Œï¼šè°ƒç”¨

/#parseMockValue(mock, returnTypes)
æ–¹æ³•ï¼Œè§£æ**è¿”å›å€¼**ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ5.4 parseMockValueã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚
* ã€ç¬¬ **2** ç§ã€‘ç¬¬ 35 è‡³ 46 è¡Œï¼šä»¥

"throw"
å¼€å¤´ï¼ŒæŠ›å‡º**å¯¹åº”çš„** RpcException å¼‚å¸¸ã€‚

* ç¬¬ 43 è¡Œï¼šè°ƒç”¨

/#getThrowable(mock)
å¯¹è±¡ï¼Œåˆ›å»º**è‡ªå®šä¹‰**å¼‚å¸¸ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ5.5 getThrowableã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚
* ã€ç¬¬ **3** ç§ã€‘ç¬¬ 47 è‡³ 57 è¡Œï¼š**è‡ªå®šä¹‰** Mock ç±»ï¼Œæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚

* ç¬¬ 51 è¡Œï¼šè°ƒç”¨

/#getInvoker(mock)
æ–¹æ³•ï¼Œè·å¾— Invoker å¯¹è±¡ã€‚è¯¦ç»†è§£æï¼Œè§ [ã€Œ5.6 getInvokerã€](http://svip.iocoder.cn/Dubbo/cluster-8-impl-mock/) ã€‚
* ç¬¬ 53 è¡Œï¼šè°ƒç”¨

Invoker/#invoke(invocation)
æ–¹æ³•ï¼Œæ‰§è¡Œ**è‡ªå®šä¹‰** Mock é€»è¾‘ã€‚

## 5.3 normalizedMock

```
1: private String normalizedMock(String mock){
2: // è‹¥ä¸ºç©ºï¼Œç›´æ¥è¿”å›
3: if (mock == null || mock.trim().length() == 0) {
4: return mock;
5: // è‹¥æœä¸º "true" "default" "fail" "force" å››ç§å­—ç¬¦ä¸²ï¼Œä¿®æ”¹ä¸ºå¯¹åº”æ¥å£ + "Mock" ç±»
6: } else if (ConfigUtils.isDefault(mock) || "fail".equalsIgnoreCase(mock.trim()) || "force".equalsIgnoreCase(mock.trim())) {
7: mock = url.getServiceInterface() + "Mock";
8: }
9: // è‹¥ä»¥ "fail:" å¼€å¤´ï¼Œå»æ‰è¯¥å¼€å¤´
10: if (mock.startsWith(Constants.FAIL_PREFIX)) {
11: mock = mock.substring(Constants.FAIL_PREFIX.length()).trim();
12: // è‹¥ä»¥ "force:" å¼€å¤´ï¼Œå»æ‰è¯¥å¼€å¤´
13: } else if (mock.startsWith(Constants.FORCE_PREFIX)) {
14: mock = mock.substring(Constants.FORCE_PREFIX.length()).trim();
15: }
16: return mock;
17: }
```

* ã€ç¬¬**ä¸€**ç§ã€‘ç¬¬ 2 è‡³ 4 è¡Œï¼šè‹¥ä¸º**ç©º**ï¼Œç›´æ¥è¿”å›ã€‚
* ã€ç¬¬**äºŒ**ç§ã€‘ç¬¬ 5 è‡³ 8 è¡Œï¼šè‹¥ä¸º **
true

default

fail

force
** ï¼Œä¿®æ”¹ä¸ºå¯¹åº”æ¥å£ +

"Mock"
ã€‚
* ã€ç¬¬**ä¸‰**ç§ã€‘ç¬¬ 9 è‡³ 15 è¡Œï¼šè‹¥ä»¥

"fail:"
æˆ–

"force:"
**å¼€å¤´** ï¼Œå»æ‰**å¼€å¤´**ã€‚è¯¥å¼€å¤´ï¼Œä»…ç”¨äº MockClusterInvoker è¡¨ç¤º**å¼ºåˆ¶** Mock è¿˜æ˜¯**å¤±è´¥** Mock ã€‚

## 5.4 parseMockValue

```
public static Object parseMockValue(String mock){
return parseMockValue(mock, null);
}
public static Object parseMockValue(String mock, Type[] returnTypes){
// è§£æå€¼ï¼ˆä¸è€ƒè™‘è¿”å›ç±»å‹ï¼‰
Object value;
if ("empty".equals(mock)) { // æœªèµ‹å€¼çš„å¯¹è±¡ï¼Œå³ new XXX() å¯¹è±¡
value = ReflectUtils.getEmptyObject(returnTypes != null && returnTypes.length > 0 ? (Class<?>) returnTypes[0] : null);
} else if ("null".equals(mock)) { // null
value = null;
} else if ("true".equals(mock)) { // true
value = true;
} else if ("false".equals(mock)) { // false
value = false;
} else if (mock.length() >= 2 && (mock.startsWith("\"") && mock.endsWith("\"")
|| mock.startsWith("\'") && mock.endsWith("\'"))) { // ä½¿ç”¨ '' æˆ– "" çš„å­—ç¬¦ä¸²ï¼Œæˆªå–æ‰å¤´å°¾
value = mock.subSequence(1, mock.length() - 1);
} else if (returnTypes != null && returnTypes.length > 0 && returnTypes[0] == String.class) { // å­—ç¬¦ä¸²
value = mock;
} else if (StringUtils.isNumeric(mock)) { // æ•°å­—
value = JSON.parse(mock);
} else if (mock.startsWith("{")) { // Map
value = JSON.parseObject(mock, Map.class);
} else if (mock.startsWith("[")) { // List
value = JSON.parseObject(mock, List.class);
} else {
value = mock;
}
// è½¬æ¢æˆå¯¹åº”çš„è¿”å›ç±»å‹
if (returnTypes != null && returnTypes.length > 0) {
value = PojoUtils.realize(value, (Class<?>) returnTypes[0], returnTypes.length > 1 ? returnTypes[1] //* æ³›å‹ /*/: null);
}
return value;
}
```

* è§£æ**å€¼**ï¼Œå¹¶**è½¬æ¢**æˆå¯¹åº”çš„è¿”å›**ç±»å‹**ã€‚

## 5.5 getThrowable

```
private Throwable getThrowable(String throwStr){
// ä»ç¼“å­˜ä¸­ï¼Œè·å¾— Throwable å¯¹è±¡
Throwable throwable = throwables.get(throwStr);
if (throwable != null) {
return throwable;
}
// ä¸å­˜åœ¨ï¼Œåˆ›å»º Throwable å¯¹è±¡
Throwable t;
try {
// è·å¾—å¼‚å¸¸ç±»
Class<?> bizException = ReflectUtils.forName(throwStr);
// è·å¾—æ„é€ æ–¹æ³•
Constructor<?> constructor = ReflectUtils.findConstructor(bizException, String.class);
// åˆ›å»º Throwable å¯¹è±¡
t = (Throwable) constructor.newInstance(new Object[]{" mocked exception for Service degradation. "});
// æ·»åŠ åˆ°ç¼“å­˜ä¸­
if (throwables.size() < 1000) {
throwables.put(throwStr, t);
}
} catch (Exception e) {
throw new RpcException("mock throw error :" + throwStr + " argument error.", e);
}
return t;
}
```

* ä»£ç æ¯”è¾ƒæ˜“æ‡‚ï¼Œèƒ–å‹çœ‹ä»£ç æ³¨é‡Šã€‚

## 5.6 getInvoker

```
private Invoker<T> getInvoker(String mockService){
// ä»ç¼“å­˜ä¸­ï¼Œè·å¾— Invoker å¯¹è±¡
Invoker<T> invoker = (Invoker<T>) mocks.get(mockService);
if (invoker != null) {
return invoker;
}
// ä¸å­˜åœ¨ï¼Œåˆ›å»º Invoker å¯¹è±¡
// 1. è·å¾—æ¥å£ç±»
Class<T> serviceType = (Class<T>) ReflectUtils.forName(url.getServiceInterface());
// 2. è‹¥ä¸º `true` `default` ï¼Œä¿®æ”¹ä¿®æ”¹ä¸ºå¯¹åº”æ¥å£ + "Mock" ç±»ã€‚è¿™ç§æƒ…å†µå‡ºç°åœ¨åŸå§‹ `mock = fail:true` æˆ– `mock = force:true` ç­‰æƒ…å†µ
if (ConfigUtils.isDefault(mockService)) {
mockService = serviceType.getName() + "Mock";
}
// 3. è·å¾— Mock ç±»
Class<?> mockClass = ReflectUtils.forName(mockService);
// 4. æ ¡éªŒ Mock ç±»ï¼Œå®ç°äº†æ¥å£ç±»
if (!serviceType.isAssignableFrom(mockClass)) {
throw new IllegalArgumentException("The mock implemention class " + mockClass.getName() + " not implement interface " + serviceType.getName());
}
try {
// 5. åˆ›å»º Mock å¯¹è±¡
T mockObject = (T) mockClass.newInstance();
// 6. åˆ›å»º Mock å¯¹åº”ï¼Œå¯¹åº”çš„ Invoker å¯¹è±¡
invoker = proxyFactory.getInvoker(mockObject, serviceType, url);
// 7. æ·»åŠ åˆ°ç¼“å­˜
if (mocks.size() < 10000) {
mocks.put(mockService, invoker);
}
return invoker;
} catch (InstantiationException e) {
throw new IllegalStateException("No such empty constructor \"public " + mockClass.getSimpleName() + "()\" in mock implemention class " + mockClass.getName(), e);
} catch (IllegalAccessException e) {
throw new IllegalStateException(e);
}
}
```

* ä»£ç æ¯”è¾ƒæ˜“æ‡‚ï¼Œèƒ–å‹çœ‹ä»£ç æ³¨é‡Šã€‚

# 6. AbstractInterfaceConfig

/#checkStubAndMock(Class<?> interfaceClass)
æ–¹æ³•ï¼Œæ ¡éªŒ Stub å’Œ **Mock ç›¸å…³çš„é…ç½®**ã€‚ä»£ç å¦‚ä¸‹ï¼š
```
protected void checkStubAndMock(Class<?> interfaceClass){
// ã€çœç•¥ä»£ç ã€‘`local` é…ç½®é¡¹çš„æ ¡éªŒï¼Œå’Œ `stub` ä¸€æ ·ã€‚
// ã€çœç•¥ä»£ç ã€‘`stub` é…ç½®é¡¹çš„æ ¡éªŒ
// mock é…ç½®æ ¡éªŒ
if (ConfigUtils.isNotEmpty(mock)) {
if (mock.startsWith(Constants.RETURN_PREFIX)) { // å¤„ç† "return " å¼€å¤´çš„æƒ…å†µ
String value = mock.substring(Constants.RETURN_PREFIX.length());
// æ ¡éªŒ Mock å€¼ï¼Œé…ç½®æ­£ç¡®
try {
MockInvoker.parseMockValue(value);
} catch (Exception e) {
throw new IllegalStateException("Illegal mock json value in <dubbo:service ... mock=\"" + mock + "\" />");
}
} else {
// è·å¾— Mock ç±»
Class<?> mockClass = ConfigUtils.isDefault(mock) ? ReflectUtils.forName(interfaceClass.getName() + "Mock") : ReflectUtils.forName(mock);
// æ ¡éªŒæ˜¯å¦å®ç°æ¥å£ç±»
if (!interfaceClass.isAssignableFrom(mockClass)) {
throw new IllegalStateException("The mock implementation class " + mockClass.getName() + " not implement interface " + interfaceClass.getName());
}
// æ ¡éªŒæ˜¯å¦æœ‰é»˜è®¤æ„é€ æ–¹æ³•
try {
mockClass.getConstructor();
} catch (NoSuchMethodException e) {
throw new IllegalStateException("No such empty constructor \"public " + mockClass.getSimpleName() + "()\" in mock implementation class " + mockClass.getName());
}
}
}
}
```

* ä»£ç æ¯”è¾ƒæ˜“æ‡‚ï¼Œèƒ–å‹çœ‹ä»£ç æ³¨é‡Šã€‚
* ä» Mock é…ç½®æ ¡éªŒçš„é€»è¾‘æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸å…è®¸é…ç½®

"force:"
å’Œ

"fail:"
ä¸ºå¼€å¤´ã€‚ğŸ˜ˆ æ‰€ä»¥ï¼Œ**ä¸èƒ½é€šè¿‡** Java API æˆ–è€… XML ï¼Œåˆæˆ–è€…æ³¨è§£æ¥é…ç½® Mock è§„åˆ™ï¼Œåªèƒ½é€šè¿‡**é…ç½®è§„åˆ™**æ¥å¼€å¯**æœåŠ¡é™çº§**ã€‚å…·ä½“çš„é…ç½®æ–¹å¼ï¼Œå‚è§ [ã€ŠDubbo ç”¨æˆ·æŒ‡å— â€”â€” æœåŠ¡é™çº§ã€‹](http://dubbo.apache.org/zh-cn/docs/user/demos/service-downgrade.html)ã€‚

* åŒæ ·ï¼Œä¹Ÿä¸å…è®¸é…ç½®

"throws "
å¼€å¤´ã€‚