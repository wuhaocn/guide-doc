<header class="article-header">
<h1 class="article-title">è°ƒç”¨ç‰¹æ€§ï¼ˆä¸‰ï¼‰ä¹‹æ³›åŒ–å®ç°</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>æœ¬æ–‡åˆ†äº«<strong>æ³›åŒ–å®ç°</strong>ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/user/demos/generic-service.html" target="_blank" rel="external nofollow noopener noreferrer">ã€Šç”¨æˆ·æŒ‡å— &mdash;&mdash; æ³›åŒ–å®ç°ã€‹</a>&nbsp;çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>æ³›æ¥å£å®ç°æ–¹å¼ä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯æ²¡æœ‰APIæ¥å£åŠæ¨¡å‹ç±»å…ƒçš„æƒ…å†µï¼Œå‚æ•°åŠè¿”å›å€¼ä¸­çš„æ‰€æœ‰ POJO å‡ç”¨ Map è¡¨ç¤ºï¼Œé€šå¸¸ç”¨äºæ¡†æ¶é›†æˆï¼Œæ¯”å¦‚ï¼šå®ç°ä¸€ä¸ªé€šç”¨çš„è¿œç¨‹æœåŠ¡ Mock æ¡†æ¶ï¼Œå¯é€šè¿‡å®ç° GenericService æ¥å£å¤„ç†æ‰€æœ‰æœåŠ¡è¯·æ±‚ã€‚</p>
</blockquote>
<p>è¯·æ³¨æ„ï¼Œæ¶ˆè´¹<strong>æä¾›è€…</strong>æ²¡æœ‰&nbsp;<strong>API æ¥å£</strong>&nbsp;åŠ&nbsp;<strong>æ¨¡å‹ç±»å…ƒ</strong>ã€‚é‚£å°±æ˜¯è¯´ï¼ŒDubbo åœ¨æ³›åŒ–å®ç°ä¸­ï¼Œéœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼š</p>
<blockquote>
<p><strong>æ³›åŒ–å®ç°</strong>é€‚ç”¨äºæœåŠ¡æä¾›è€…ï¼Œå’Œ<strong>æ³›åŒ–å¼•ç”¨</strong>é€‚ç”¨äºæœåŠ¡æ¶ˆè´¹è€…ï¼Œæ°æ°&ldquo;ç›¸å&rdquo;ã€‚</p>
</blockquote>
<ul>
<li>æ²¡æœ‰&nbsp;<strong>API æ¥å£</strong>ï¼Œæ‰€ä»¥æä¾›ä¸€ä¸ªæ³›åŒ–æœåŠ¡æ¥å£ï¼Œç›®å‰æ˜¯&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/service/GenericService.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.service.GenericService</code></a>&nbsp;ã€‚
<ul>
<li><strong>ä¸€ä¸ª</strong>æ³›åŒ–å®ç°ï¼Œåªå®ç°<strong>ä¸€ä¸ª</strong>æœåŠ¡ã€‚</li>
<li>é€šè¿‡å®ç°&nbsp;<code>$invoke(method, parameterTypes, args)</code>&nbsp;æ–¹æ³•ï¼Œ<strong>å¤„ç†æ‰€æœ‰è¯¥æœåŠ¡çš„è¯·æ±‚</strong>ã€‚</li>
<li>å…·ä½“çš„ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/rpc-feature-generic-service/">ã€Œ2. ç¤ºä¾‹ã€</a>&nbsp;ä¸­çœ‹ã€‚</li>
</ul>
</li>
<li>æ²¡æœ‰&nbsp;<strong>æ¨¡å‹ç±»å…ƒ</strong>ï¼Œæ‰€ä»¥æ–¹æ³•å‚æ•°å’Œæ–¹æ³•è¿”å›è‹¥æ˜¯ POJO ( ä¾‹å¦‚ User å’Œ Order ç­‰ ) ï¼Œéœ€è¦<strong>è½¬æ¢å¤„ç†</strong>ï¼š
<ul>
<li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œå°† POJO è½¬æˆ Map ï¼Œç„¶åå†è°ƒç”¨æœåŠ¡æä¾›è€…ã€‚ï¼ˆ<strong>é€æ˜</strong>ï¼‰</li>
<li>æœåŠ¡æä¾›è€…ï¼Œè¿”å› Map ã€‚</li>
<li>æœåŠ¡æ¶ˆè´¹è€…ï¼Œè‹¥<strong>æ”¶åˆ°</strong>è¿”å›å€¼æ˜¯ Map ï¼Œåˆ™è½¬æ¢æˆ POJO å†è¿”å›ã€‚</li>
<li>ğŸ™‚ æ­¤å¤„çš„ Map åªæ˜¯ä¸¾ä¾‹å­ï¼Œå®é™…åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿˜æœ‰<strong>ä¸€ç§</strong>è½¬æ¢æ–¹å¼ã€‚ ï¼ˆ<strong>é€æ˜</strong>ï¼‰</li>
</ul>
</li>
</ul>
<p>æ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2018_11_07/01.png" alt="æµç¨‹" /></p>
<h1 id="2-ç¤ºä¾‹">2. ç¤ºä¾‹</h1>
<p><strong>æœåŠ¡æä¾›è€…</strong></p>
<p>åœ¨&nbsp;<a href="https://github.com/YunaiV/dubbo/tree/3766a47c5e97ee86c29d765dc88ee11ab5225604/dubbo-demo/dubbo-generic-reference-demo-provider" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-generic-service-demo-provider</code></a>&nbsp;ï¼Œæˆ‘ä»¬æä¾›äº†ä¾‹å­ã€‚æˆ‘ä»¬æŒ‘<strong>é‡ç‚¹</strong>çš„åœ°æ–¹è¯´ã€‚</p>
<p>â‘  åœ¨ Java ä»£ç ä¸­å®ç° GenericService æ¥å£ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoServiceImpl</span> <span class="keyword">implements</span> <span class="title">GenericService</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="keyword">public</span> Object $invoke(String method, String[] parameterTypes, Object[] args) <span class="keyword">throws</span> GenericException {</span><br /><span class="line">        <span class="keyword">if</span> (<span class="string">"sayHello"</span>.equals(method)) {</span><br /><span class="line">            <span class="keyword">return</span> <span class="string">"Welcome "</span> + args[<span class="number">0</span>];</span><br /><span class="line">        }</span><br /><span class="line">        <span class="keyword">return</span> <span class="string">"unknown method"</span>;</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>â‘¡ åœ¨ Spring é…ç½®ç”³æ˜æœåŠ¡çš„å®ç°ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">&lt;bean id=<span class="string">"demoService"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"com.alibaba.dubbo.demo.provider.DemoServiceImpl"</span> /&gt;</span><br /><br /><span class="line">&lt;dubbo:service <span class="class"><span class="keyword">interface</span></span>=<span class="string">"com.alibaba.dubbo.demo.DemoService"</span> ref=<span class="string">"demoService"</span> generic=<span class="string">"true"</span> /&gt;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>interface</code>&nbsp;é…ç½®é¡¹ï¼Œæ³›åŒ–å®ç°çš„æœåŠ¡æ¥å£ã€‚é€šè¿‡è¯¥é…ç½®ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ï¼Œå¯ä»¥ä»æ³¨å†Œä¸­å¿ƒï¼Œè·å–åˆ°æ‰€æœ‰<strong>è¯¥æœåŠ¡</strong>çš„æä¾›æ–¹çš„åœ°å€ï¼ŒåŒ…æ‹¬æ³›åŒ–å®ç°çš„è¯¥æœåŠ¡çš„åœ°å€ã€‚</li>
<li><code>generic</code>&nbsp;é…ç½®é¡¹ï¼Œé»˜è®¤ä¸º&nbsp;<code>false</code>&nbsp;ï¼Œä¸ä½¿ç”¨é…ç½®é¡¹ã€‚ç›®å‰æœ‰<strong>ä¸¤ç§é…ç½®é¡¹çš„å€¼</strong>ï¼Œå¼€å¯æ³›åŒ–å®ç°çš„åŠŸèƒ½ï¼š
<ul>
<li><code>generic=true</code>&nbsp;ï¼Œä½¿ç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/PojoUtils.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.utils.PojoUtils</code></a>&nbsp;ï¼Œå®ç°&nbsp;<code>POJO &lt;=&gt; Map</code>&nbsp;çš„äº’è½¬ã€‚</li>
<li><code>generic=bean</code>&nbsp;ï¼Œä½¿ç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/beanutil/JavaBeanSerializeUtil.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.beanutil.JavaBeanSerializeUtil</code></a>&nbsp;ï¼Œå®ç°&nbsp;<code>POJO &lt;=&gt; JavaBeanDescriptor</code>&nbsp;çš„äº’è½¬ã€‚</li>
<li>ä¸å­˜åœ¨&nbsp;<code>generic=nativejava</code>&nbsp;é…ç½®é¡¹ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æœåŠ¡æ¶ˆè´¹è€…</strong></p>
<p>åœ¨&nbsp;<a href="https://github.com/YunaiV/dubbo/tree/3766a47c5e97ee86c29d765dc88ee11ab5225604/dubbo-demo/dubbo-generic-service-demo-consumer" target="_blank" rel="external nofollow noopener noreferrer"><code>dubbo-generic-service-demo-consumer</code></a>&nbsp;ï¼Œæˆ‘ä»¬æä¾›äº†ä¾‹å­ã€‚æˆ‘ä»¬æŒ‘<strong>é‡ç‚¹</strong>çš„åœ°æ–¹è¯´ã€‚</p>
<p>è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">DemoService demoService = (DemoService) context.getBean(<span class="string">"demoService"</span>); <span class="comment">// get remote service proxy</span></span><br /><span class="line">Object result = demoService.say01(<span class="string">"NIHAO"</span>);</span><br /><span class="line">System.out.println(<span class="string">"result: "</span> + result);</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å’Œæˆ‘ä»¬æ™®é€šçš„æœåŠ¡æ¶ˆè´¹è€…ï¼Œè°ƒç”¨æœåŠ¡æä¾›è€…ï¼Œ<strong>ä¸€æ¨¡ä¸€æ ·</strong>ï¼Œæ³¨æ„ï¼Œæ˜¯<strong>ä¸€æ¨¡ä¸€æ ·</strong>ã€‚</li>
</ul>
<h1 id="3-æœåŠ¡æ¶ˆè´¹è€…-GenericImplFilter">3. æœåŠ¡æ¶ˆè´¹è€… GenericImplFilter</h1>
<p><a href="https://github.com/YunaiV/dubbo/blob/3766a47c5e97ee86c29d765dc88ee11ab5225604/dubbo-rpc/dubbo-rpc-api/src/main/java/com/alibaba/dubbo/rpc/filter/GenericImplFilter.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.rpc.filter.GenericImplFilter</code></a>&nbsp;ï¼Œå®ç° Filter æ¥å£ï¼ŒæœåŠ¡æ¶ˆè´¹è€…çš„æ³›åŒ–è°ƒç”¨è¿‡æ»¤å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">  <span class="number">1</span>: <span class="meta">@Activate</span>(group = Constants.CONSUMER, value = Constants.GENERIC_KEY, order = <span class="number">20000</span>)</span><br /><span class="line">  <span class="number">2</span>: <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericImplFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>{</span><br /><span class="line">  <span class="number">3</span>: </span><br /><span class="line">  <span class="number">4</span>:     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(GenericImplFilter.class);</span><br /><span class="line">  <span class="number">5</span>: </span><br /><span class="line">  <span class="number">6</span>:     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Class&lt;?&gt;[] GENERIC_PARAMETER_TYPES = <span class="keyword">new</span> Class&lt;?&gt;[]{String.class, String[].class, Object[].class};</span><br /><span class="line">  <span class="number">7</span>: </span><br /><span class="line">  <span class="number">8</span>:     <span class="meta">@Override</span></span><br /><span class="line">  <span class="number">9</span>:     <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line"> <span class="number">10</span>:         <span class="comment">// è·å¾— `generic` é…ç½®é¡¹</span></span><br /><span class="line"> <span class="number">11</span>:         String generic = invoker.getUrl().getParameter(Constants.GENERIC_KEY);</span><br /><span class="line"> <span class="number">12</span>: </span><br /><span class="line"> <span class="number">13</span>:         <span class="comment">// æ³›åŒ–å®ç°çš„è°ƒç”¨</span></span><br /><span class="line"> <span class="number">14</span>:         <span class="keyword">if</span> (ProtocolUtils.isGeneric(generic)</span><br /><span class="line"> <span class="number">15</span>:                 &amp;&amp; !Constants.$INVOKE.equals(invocation.getMethodName())</span><br /><span class="line"> <span class="number">16</span>:                 &amp;&amp; invocation <span class="keyword">instanceof</span> RpcInvocation) {</span><br /><span class="line"> <span class="number">17</span>:             RpcInvocation invocation2 = (RpcInvocation) invocation;</span><br /><span class="line"> <span class="number">18</span>:             String methodName = invocation2.getMethodName();</span><br /><span class="line"> <span class="number">19</span>:             Class&lt;?&gt;[] parameterTypes = invocation2.getParameterTypes();</span><br /><span class="line"> <span class="number">20</span>:             Object[] arguments = invocation2.getArguments();</span><br /><span class="line"> <span class="number">21</span>: </span><br /><span class="line"> <span class="number">22</span>:             <span class="comment">// è·å¾—å‚æ•°ç±»å‹æ•°ç»„</span></span><br /><span class="line"> <span class="number">23</span>:             String[] types = <span class="keyword">new</span> String[parameterTypes.length];</span><br /><span class="line"> <span class="number">24</span>:             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameterTypes.length; i++) {</span><br /><span class="line"> <span class="number">25</span>:                 types[i] = ReflectUtils.getName(parameterTypes[i]);</span><br /><span class="line"> <span class="number">26</span>:             }</span><br /><span class="line"> <span class="number">27</span>: </span><br /><span class="line"> <span class="number">28</span>:             Object[] args;</span><br /><span class="line"> <span class="number">29</span>:             <span class="comment">// ã€ç¬¬ä¸€æ­¥ã€‘`bean` ï¼Œåºåˆ—åŒ–å‚æ•°ï¼Œæ–¹æ³•å‚æ•° =&gt; JavaBeanDescriptor</span></span><br /><span class="line"> <span class="number">30</span>:             <span class="keyword">if</span> (ProtocolUtils.isBeanGenericSerialization(generic)) {</span><br /><span class="line"> <span class="number">31</span>:                 args = <span class="keyword">new</span> Object[arguments.length];</span><br /><span class="line"> <span class="number">32</span>:                 <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arguments.length; i++) {</span><br /><span class="line"> <span class="number">33</span>:                     args[i] = JavaBeanSerializeUtil.serialize(arguments[i], JavaBeanAccessor.METHOD);</span><br /><span class="line"> <span class="number">34</span>:                 }</span><br /><span class="line"> <span class="number">35</span>:             <span class="comment">// ã€ç¬¬ä¸€æ­¥ã€‘`true` ï¼Œåºåˆ—åŒ–å‚æ•°ï¼Œä»…æœ‰ Map =&gt; POJO</span></span><br /><span class="line"> <span class="number">36</span>:             } <span class="keyword">else</span> {</span><br /><span class="line"> <span class="number">37</span>:                 args = PojoUtils.generalize(arguments);</span><br /><span class="line"> <span class="number">38</span>:             }</span><br /><span class="line"> <span class="number">39</span>: </span><br /><span class="line"> <span class="number">40</span>:             <span class="comment">// ä¿®æ”¹è°ƒç”¨æ–¹æ³•çš„åå­—ä¸º `$invoke`</span></span><br /><span class="line"> <span class="number">41</span>:             invocation2.setMethodName(Constants.$INVOKE);</span><br /><span class="line"> <span class="number">42</span>:             <span class="comment">// è®¾ç½®è°ƒç”¨æ–¹æ³•çš„å‚æ•°ç±»å‹ä¸º `GENERIC_PARAMETER_TYPES`</span></span><br /><span class="line"> <span class="number">43</span>:             invocation2.setParameterTypes(GENERIC_PARAMETER_TYPES);</span><br /><span class="line"> <span class="number">44</span>:             <span class="comment">// è®¾ç½®è°ƒç”¨æ–¹æ³•çš„å‚æ•°æ•°ç»„ï¼Œåˆ†åˆ«ä¸ºæ–¹æ³•åã€å‚æ•°ç±»å‹æ•°ç»„ã€å‚æ•°æ•°ç»„</span></span><br /><span class="line"> <span class="number">45</span>:             invocation2.setArguments(<span class="keyword">new</span> Object[]{methodName, types, args});</span><br /><span class="line"> <span class="number">46</span>: </span><br /><span class="line"> <span class="number">47</span>:             <span class="comment">// ã€ç¬¬äºŒæ­¥ã€‘RPC è°ƒç”¨</span></span><br /><span class="line"> <span class="number">48</span>:             Result result = invoker.invoke(invocation2);</span><br /><span class="line"> <span class="number">49</span>: </span><br /><span class="line"> <span class="number">50</span>:             <span class="comment">// ã€ç¬¬ä¸‰æ­¥ã€‘ååºåˆ—åŒ–æ­£å¸¸ç»“æœ</span></span><br /><span class="line"> <span class="number">51</span>:             <span class="keyword">if</span> (!result.hasException()) {</span><br /><span class="line"> <span class="number">52</span>:                 Object value = result.getValue();</span><br /><span class="line"> <span class="number">53</span>:                 <span class="keyword">try</span> {</span><br /><span class="line"> <span class="number">54</span>:                     <span class="comment">// ã€ç¬¬ä¸‰æ­¥ã€‘`bean` ï¼Œååºåˆ—åŒ–ç»“æœï¼ŒJavaBeanDescriptor =&gt; ç»“æœ</span></span><br /><span class="line"> <span class="number">55</span>:                     <span class="keyword">if</span> (ProtocolUtils.isBeanGenericSerialization(generic)) {</span><br /><span class="line"> <span class="number">56</span>:                         <span class="keyword">if</span> (value == <span class="keyword">null</span>) {</span><br /><span class="line"> <span class="number">57</span>:                             <span class="keyword">return</span> <span class="keyword">new</span> RpcResult(<span class="keyword">null</span>);</span><br /><span class="line"> <span class="number">58</span>:                         } <span class="keyword">else</span> <span class="keyword">if</span> (value <span class="keyword">instanceof</span> JavaBeanDescriptor) {</span><br /><span class="line"> <span class="number">59</span>:                             <span class="keyword">return</span> <span class="keyword">new</span> RpcResult(JavaBeanSerializeUtil.deserialize((JavaBeanDescriptor) value));</span><br /><span class="line"> <span class="number">60</span>:                         } <span class="keyword">else</span> { <span class="comment">// å¿…é¡»æ˜¯ JavaBeanDescriptor è¿”å›</span></span><br /><span class="line"> <span class="number">61</span>:                             <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(</span><br /><span class="line"> <span class="number">62</span>:                                     <span class="keyword">new</span> StringBuilder(<span class="number">64</span>)</span><br /><span class="line"> <span class="number">63</span>:                                             .append(<span class="string">"The type of result value is "</span>)</span><br /><span class="line"> <span class="number">64</span>:                                             .append(value.getClass().getName())</span><br /><span class="line"> <span class="number">65</span>:                                             .append(<span class="string">" other than "</span>)</span><br /><span class="line"> <span class="number">66</span>:                                             .append(JavaBeanDescriptor.class.getName())</span><br /><span class="line"> <span class="number">67</span>:                                             .append(<span class="string">", and the result is "</span>)</span><br /><span class="line"> <span class="number">68</span>:                                             .append(value).toString());</span><br /><span class="line"> <span class="number">69</span>:                         }</span><br /><span class="line"> <span class="number">70</span>:                     } <span class="keyword">else</span> {</span><br /><span class="line"> <span class="number">71</span>:                         <span class="comment">// è·å¾—å¯¹åº”çš„æ–¹æ³• Method å¯¹è±¡</span></span><br /><span class="line"> <span class="number">72</span>:                         Method method = invoker.getInterface().getMethod(methodName, parameterTypes);</span><br /><span class="line"> <span class="number">73</span>:                         <span class="comment">//ã€ç¬¬ä¸‰æ­¥ã€‘`true` ï¼Œååºåˆ—åŒ–ç»“æœï¼Œä»…æœ‰ Map =&gt; POJO</span></span><br /><span class="line"> <span class="number">74</span>:                         <span class="keyword">return</span> <span class="keyword">new</span> RpcResult(PojoUtils.realize(value, method.getReturnType(), method.getGenericReturnType()));</span><br /><span class="line"> <span class="number">75</span>:                     }</span><br /><span class="line"> <span class="number">76</span>:                 } <span class="keyword">catch</span> (NoSuchMethodException e) {</span><br /><span class="line"> <span class="number">77</span>:                     <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(e.getMessage(), e);</span><br /><span class="line"> <span class="number">78</span>:                 }</span><br /><span class="line"> <span class="number">79</span>:             <span class="comment">// ã€ç¬¬ä¸‰æ­¥ã€‘ååºåˆ—åŒ–å¼‚å¸¸ç»“æœ</span></span><br /><span class="line"> <span class="number">80</span>:             } <span class="keyword">else</span> <span class="keyword">if</span> (result.getException() <span class="keyword">instanceof</span> GenericException) {</span><br /><span class="line"> <span class="number">81</span>:                 GenericException exception = (GenericException) result.getException();</span><br /><span class="line"> <span class="number">82</span>:                 <span class="keyword">try</span> {</span><br /><span class="line"> <span class="number">83</span>:                     String className = exception.getExceptionClass();</span><br /><span class="line"> <span class="number">84</span>:                     Class&lt;?&gt; clazz = ReflectUtils.forName(className);</span><br /><span class="line"> <span class="number">85</span>:                     Throwable targetException = <span class="keyword">null</span>;</span><br /><span class="line"> <span class="number">86</span>:                     Throwable lastException = <span class="keyword">null</span>;</span><br /><span class="line"> <span class="number">87</span>:                     <span class="comment">// åˆ›å»ºåŸå§‹å¼‚å¸¸</span></span><br /><span class="line"> <span class="number">88</span>:                     <span class="keyword">try</span> {</span><br /><span class="line"> <span class="number">89</span>:                         targetException = (Throwable) clazz.newInstance();</span><br /><span class="line"> <span class="number">90</span>:                     } <span class="keyword">catch</span> (Throwable e) {</span><br /><span class="line"> <span class="number">91</span>:                         lastException = e;</span><br /><span class="line"> <span class="number">92</span>:                         <span class="keyword">for</span> (Constructor&lt;?&gt; constructor : clazz.getConstructors()) {</span><br /><span class="line"> <span class="number">93</span>:                             <span class="keyword">try</span> {</span><br /><span class="line"> <span class="number">94</span>:                                 targetException = (Throwable) constructor.newInstance(<span class="keyword">new</span> Object[constructor.getParameterTypes().length]);</span><br /><span class="line"> <span class="number">95</span>:                                 <span class="keyword">break</span>;</span><br /><span class="line"> <span class="number">96</span>:                             } <span class="keyword">catch</span> (Throwable e1) {</span><br /><span class="line"> <span class="number">97</span>:                                 lastException = e1;</span><br /><span class="line"> <span class="number">98</span>:                             }</span><br /><span class="line"> <span class="number">99</span>:                         }</span><br /><span class="line"><span class="number">100</span>:                     }</span><br /><span class="line"><span class="number">101</span>:                     <span class="comment">// è®¾ç½®å¼‚å¸¸çš„æ˜ç»†</span></span><br /><span class="line"><span class="number">102</span>:                     <span class="keyword">if</span> (targetException != <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">103</span>:                         <span class="keyword">try</span> {</span><br /><span class="line"><span class="number">104</span>:                             Field field = Throwable.class.getDeclaredField(<span class="string">"detailMessage"</span>);</span><br /><span class="line"><span class="number">105</span>:                             <span class="keyword">if</span> (!field.isAccessible()) {</span><br /><span class="line"><span class="number">106</span>:                                 field.setAccessible(<span class="keyword">true</span>);</span><br /><span class="line"><span class="number">107</span>:                             }</span><br /><span class="line"><span class="number">108</span>:                             field.set(targetException, exception.getExceptionMessage());</span><br /><span class="line"><span class="number">109</span>:                         } <span class="keyword">catch</span> (Throwable e) {</span><br /><span class="line"><span class="number">110</span>:                             logger.warn(e.getMessage(), e);</span><br /><span class="line"><span class="number">111</span>:                         }</span><br /><span class="line"><span class="number">112</span>:                         <span class="comment">// åˆ›å»ºæ–°çš„å¼‚å¸¸ RpcResult å¯¹è±¡</span></span><br /><span class="line"><span class="number">113</span>:                         result = <span class="keyword">new</span> RpcResult(targetException);</span><br /><span class="line"><span class="number">114</span>:                     <span class="comment">// åˆ›å»ºåŸå§‹å¼‚å¸¸å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br /><span class="line"><span class="number">115</span>:                     } <span class="keyword">else</span> <span class="keyword">if</span> (lastException != <span class="keyword">null</span>) {</span><br /><span class="line"><span class="number">116</span>:                         <span class="keyword">throw</span> lastException;</span><br /><span class="line"><span class="number">117</span>:                     }</span><br /><span class="line"><span class="number">118</span>:                 } <span class="keyword">catch</span> (Throwable e) { <span class="comment">// è‹¥å‘ç”Ÿå¼‚å¸¸ï¼ŒåŒ…è£…æˆ RpcException å¼‚å¸¸ï¼ŒæŠ›å‡ºã€‚</span></span><br /><span class="line"><span class="number">119</span>:                     <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Can not deserialize exception "</span> + exception.getExceptionClass() + <span class="string">", message: "</span> + exception.getExceptionMessage(), e);</span><br /><span class="line"><span class="number">120</span>:                 }</span><br /><span class="line"><span class="number">121</span>:             }</span><br /><span class="line"><span class="number">122</span>:             <span class="comment">// è¿”å› RpcResult ç»“æœ</span></span><br /><span class="line"><span class="number">123</span>:             <span class="keyword">return</span> result;</span><br /><span class="line"><span class="number">124</span>:         }</span><br /><span class="line"><span class="number">125</span>: </span><br /><span class="line"><span class="number">126</span>:         <span class="comment">// çœç•¥ä»£ç ....æ³›åŒ–å¼•ç”¨çš„è°ƒç”¨</span></span><br /><span class="line"><span class="number">127</span>: </span><br /><span class="line"><span class="number">128</span>:          <span class="comment">// æ™®é€šè°ƒç”¨</span></span><br /><span class="line"><span class="number">129</span>:         <span class="keyword">return</span> invoker.invoke(invocation);</span><br /><span class="line"><span class="number">130</span>:     }</span><br /><span class="line"><span class="number">131</span>: </span><br /><span class="line"><span class="number">132</span>:     <span class="comment">// ... çœç•¥ getting/setting çš„æ–¹æ³•</span></span><br /><span class="line"><span class="number">133</span>: </span><br /><span class="line"><span class="number">134</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>æ•´ä½“ï¼Œå’Œ<strong>æœåŠ¡æä¾›è€…</strong>çš„ GenericFilter æœ‰ä¸€äº›<strong>ç±»ä¼¼</strong>ã€‚</li>
<li>ä½¿ç”¨ Dubbo SPI Adaptive æœºåˆ¶ï¼Œ<strong>è‡ªåŠ¨åŠ è½½</strong>ï¼Œä»…é™<strong>æœåŠ¡æ¶ˆè´¹è€…</strong>ï¼Œå¹¶ä¸”æœ‰&nbsp;<code>generic</code>&nbsp;é…ç½®é¡¹ã€‚</li>
<li>ç¬¬ 126 è¡Œï¼šçœç•¥<strong>æ³›åŒ–å¼•ç”¨</strong>çš„è°ƒç”¨ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/rpc-feature-generic-reference">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; è°ƒç”¨ç‰¹æ€§ï¼ˆäºŒï¼‰ä¹‹æ³›åŒ–å¼•ç”¨ã€‹</a>&nbsp;ä¸­ï¼Œè¯¦ç»†è§£æã€‚</li>
<li>ç¬¬ 129 è¡Œï¼šè‹¥æ˜¯æ™®é€šè°ƒç”¨(&nbsp;<strong>éæ³›åŒ–å¼•ç”¨çš„è°ƒç”¨</strong>&nbsp;)ï¼Œè°ƒç”¨&nbsp;<code>Invoker#invoke(invocation)</code>&nbsp;æ–¹æ³•ï¼Œç»§ç»­è¿‡æ»¤é“¾çš„è°ƒç”¨ï¼Œæœ€ç»ˆè°ƒç”¨ Service æœåŠ¡ã€‚</li>
<li>ğŸ‘‡ğŸ‘‡ğŸ‘‡ æ­£æˆ ğŸ‘‡ğŸ‘‡ğŸ‘‡</li>
<li>ç¬¬ 14 è‡³ 16 è¡Œï¼šåˆ¤æ–­æ˜¯<strong>æ³›åŒ–å®ç°</strong>çš„è°ƒç”¨</li>
<li>ç¬¬ 22 è‡³ 26 è¡Œï¼šè·å¾—<strong>å‚æ•°ç±»å‹</strong>æ•°ç»„ã€‚</li>
<li>========== ã€ç¬¬ä¸€æ­¥ï¼šåºåˆ—åŒ–å‚æ•°ã€‘ ==========</li>
<li>ç¬¬ 29 è‡³ 34 è¡Œï¼š<code>generic = bean</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>JavaBeanSerializeUtil#serialize(JavaBeanDescriptor)</code>æ–¹æ³•ï¼Œåºåˆ—åŒ–å‚æ•°ï¼Œå³&nbsp;<code>æ–¹æ³•å‚æ•° =&gt; JavaBeanDescriptor</code>&nbsp;ã€‚</li>
<li>ç¬¬ 35 è‡³ 38 è¡Œï¼š<code>generic = true</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<a href="https://github.com/YunaiV/dubbo/blob/f83e70b53389a064e49babe32e61a5648002a44a/dubbo-common/src/main/java/com/alibaba/dubbo/common/utils/PojoUtils.java#L63-L69" target="_blank" rel="external nofollow noopener noreferrer"><code>PojoUtils#generalize(Object[] objs</code></a>&nbsp;æ–¹æ³•ï¼Œåºåˆ—åŒ–å‚æ•°ï¼Œä»…æœ‰&nbsp;<code>POJO =&gt; Map</code>&nbsp;ã€‚</li>
<li>========== ã€ç¬¬äºŒæ­¥ï¼šRPC è°ƒç”¨ã€‘ ==========</li>
<li>ç¬¬ 41 è¡Œï¼šè®¾ç½® RpcInvocation çš„æ–¹æ³•åä¸º&nbsp;<code>$invoke</code>&nbsp;ã€‚</li>
<li>ç¬¬ 42 è¡Œï¼šè®¾ç½® RpcInvocation çš„æ–¹æ³•å‚æ•°ç±»å‹ä¸º&nbsp;<code>GENERIC_PARAMETER_TYPES</code>&nbsp;ã€‚</li>
<li>ç¬¬ 43 è¡Œï¼šè®¾ç½® RpcInvocation çš„å‚æ•°æ•°ç»„ä¸º&nbsp;<code>methodName</code>&nbsp;<code>types</code>&nbsp;<code>types</code>&nbsp;ã€‚</li>
<li>ç¬¬ 48 è¡Œï¼šé€šè¿‡å¦‚ä¸Šçš„&nbsp;<strong>RpcInvocation</strong>&nbsp;çš„è®¾ç½®ï¼Œæˆ‘ä»¬è°ƒç”¨&nbsp;<code>Invoker#invoke(invocation)</code>&nbsp;æ–¹æ³•ï¼Œå°±èƒ½ RPC è°ƒç”¨åˆ°<strong>æ³›åŒ–å®ç°</strong>çš„æœåŠ¡ã€‚</li>
<li>========== ã€ç¬¬ä¸‰æ­¥ï¼šååºåˆ—åŒ–<strong>æ­£å¸¸</strong>ç»“æœã€‘ ==========</li>
<li>ç¬¬ 55 è‡³ 69 è¡Œï¼š<code>generic = bean</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>JavaBeanSerializeUtil#serialize(JavaBeanDescriptor)</code>æ–¹æ³•ï¼Œååºåˆ—åŒ–ç»“æœï¼Œå³&nbsp;<code>JavaBeanDescriptor =&gt; POJO</code>&nbsp;ã€‚</li>
<li>ç¬¬ 71 è‡³ 74 è¡Œï¼š<code>generic = true</code>&nbsp;ï¼Œè°ƒç”¨&nbsp;<code>PojoUtils#realize(pojo, type, genericType)</code>&nbsp;æ–¹æ³•ï¼Œååºåˆ—åŒ–ç»“æœï¼Œä»…æœ‰&nbsp;<code>Map =&gt; POJO</code>&nbsp;ã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼Œååºåˆ—å®Œï¼Œæ˜¯ä¼šåˆ›å»º<strong>æ–°çš„</strong>&nbsp;RpcResult ã€‚</li>
<li>========== ã€ç¬¬ä¸‰æ­¥ï¼šååºåˆ—åŒ–<strong>å¼‚å¸¸</strong>ç»“æœã€‘ ==========</li>
<li>ç¬¬ 87 è‡³ 100 è¡Œï¼šæ ¹æ® GenericException å¼‚å¸¸ï¼Œåˆ›å»º<strong>åŸå§‹</strong>å¼‚å¸¸&nbsp;<code>targetException</code>&nbsp;ã€‚</li>
<li>ç¬¬ 101 è‡³ 111 è¡Œï¼šè®¾ç½®å¼‚å¸¸æ˜ç»†åˆ°&nbsp;<code>targetException</code>&nbsp;ã€‚</li>
<li>ç¬¬ 113 è¡Œï¼šåˆ›å»º<strong>æ–°çš„</strong>å¼‚å¸¸ RpcResult å¯¹è±¡ã€‚</li>
<li>ç¬¬ 114 è‡³ 117 è¡Œï¼šåˆ›å»ºåŸå§‹å¼‚å¸¸å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸&nbsp;<code>lastException</code>&nbsp;ã€‚</li>
</ul>
</div>