<header class="article-header">
<h1 class="article-title">åºåˆ—åŒ–ï¼ˆä¸€ï¼‰ä¹‹æ€»ä½“å®ç°</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>ä»æœ¬æ–‡å¼€å§‹ï¼Œæˆ‘ä»¬æ¥åˆ†äº« Dubbo çš„åºåˆ—åŒ–çš„å®ç°ã€‚åœ¨&nbsp;<a href="http://dubbo.apache.org/zh-cn/docs/dev/impls/serialize.html" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠDubbo å¼€å‘æŒ‡å— &mdash;&mdash; åºåˆ—åŒ–æ‰©å±•ã€‹</a>&nbsp;ï¼Œå¯¹åºåˆ—åŒ–å®šä¹‰å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>å°†å¯¹è±¡è½¬æˆå­—èŠ‚æµï¼Œç”¨äºç½‘ç»œä¼ è¾“ï¼Œä»¥åŠå°†å­—èŠ‚æµè½¬ä¸ºå¯¹è±¡ï¼Œç”¨äºåœ¨æ”¶åˆ°å­—èŠ‚æµæ•°æ®åè¿˜åŸæˆå¯¹è±¡ã€‚</p>
</blockquote>
<ul>
<li>æ‰€ä»¥ï¼Œåºåˆ—åŒ–å®é™…ä¸ŠåŒ…å«<strong>ä¸¤éƒ¨åˆ†</strong>ã€‚</li>
<li>æœ‰ä¸€ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬éœ€è¦<strong>å¼ºè°ƒ</strong>ä¸€ä¸‹ï¼šåè®®å’Œåºåˆ—åŒ–ï¼Œæ˜¯ä¸¤ä»¶äº‹æƒ…ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒHTTP æ˜¯ä¸€ç§åè®®ï¼Œå¯ä»¥æœ‰ XML å’Œ JSON&nbsp;<strong>ç­‰ç­‰</strong>åºåˆ—åŒ–( æ•°æ®äº¤æ¢ )çš„æ–¹å¼ã€‚åŒæ—¶ï¼ŒXML å’Œ JSON ä¸ä»…ä»…å¯ä»¥ç”¨åœ¨ HTTP åè®®ï¼Œä¹Ÿå¯ä»¥ç”¨åœ¨ HTTPS ç­‰ç­‰åè®®ä¸­ã€‚<strong>æ‰€ä»¥ï¼Œåè®®å’Œåºåˆ—åŒ–ä¸æ˜¯åŒ…å«çš„å…³ç³»ï¼Œè€Œæ˜¯ç»„åˆçš„å…³ç³»</strong>ã€‚</li>
</ul>
<p>åºåˆ—åŒ–åœ¨&nbsp;<code>dubbo-common</code>&nbsp;é¡¹ç›®çš„&nbsp;<code>serialize</code>&nbsp;æ¨¡å—å®ç°ã€‚ä»£ç ç»“æ„å¦‚ä¸‹å›¾ï¼š</p>
<blockquote>
<p>ğŸ™‚ åœ¨æœ€æ–°ç‰ˆæœ¬çš„ Dubbo é¡¹ç›®ä¸­ï¼Œ<code>serialize</code>&nbsp;æ¨¡å—ï¼Œå·²ç»<strong>ç‹¬ç«‹</strong>æˆ&nbsp;<code>dubbo-serialize</code>&nbsp;é¡¹ç›®ã€‚</p>
</blockquote>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2019_02_15/01.png" alt="ä»£ç ç»“æ„" /></p>
<ul>
<li>æœ€å¤–å±‚ï¼Œå®šä¹‰äº† API&nbsp;<strong>æ¥å£</strong>ã€‚</li>
<li><code>support</code>&nbsp;åŒ…ï¼Œæä¾›äº†å¤šç§åºåˆ—åŒ–çš„<strong>å®ç°</strong>ã€‚</li>
</ul>
<h1 id="2-API-å®šä¹‰">2. API å®šä¹‰</h1>
<p>API æ¥å£ï¼Œç±»å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="http://static2.iocoder.cn/images/Dubbo/2019_02_15/02.png" alt="ç±»å›¾" /></p>
<h2 id="2-1-Serialization">2.1 Serialization</h2>
<p><code>com.alibaba.dubbo.common.serialize.Serialization</code>&nbsp;ï¼Œ<strong>åºåˆ—åŒ–</strong>æ¥å£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@SPI</span>(<span class="string">"hessian2"</span>)</span><br /><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Serialization</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get content type id</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * è·å¾—å†…å®¹ç±»å‹ç¼–å·</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> content type id</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">byte</span> <span class="title">getContentTypeId</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * get content type</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * è·å¾—å†…å®¹ç±»å‹å</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> content type</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * create serializer</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * åˆ›å»º ObjectOutput å¯¹è±¡ï¼Œåºåˆ—åŒ–è¾“å‡ºåˆ° OutputStream</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> url URL</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> output è¾“å‡ºæµ</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> serializer</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException å½“å‘ç”Ÿ IO å¼‚å¸¸æ—¶</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span></span><br /><span class="line">    <span class="function">ObjectOutput <span class="title">serialize</span><span class="params">(URL url, OutputStream output)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * create deserializer</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * åˆ›å»º ObjectInput å¯¹è±¡ï¼Œä» InputStream ååºåˆ—åŒ–</span></span><br /><span class="line"><span class="comment">     *</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> url URL</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@param</span> input è¾“å…¥æµ</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> deserializer</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException å½“å‘ç”Ÿ IO å¼‚å¸¸æ—¶</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="meta">@Adaptive</span></span><br /><span class="line">    <span class="function">ObjectInput <span class="title">deserialize</span><span class="params">(URL url, InputStream input)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>@SPI("hessian2")</code>&nbsp;æ³¨è§£ï¼ŒDubbo SPI&nbsp;<strong>æ‹“å±•ç‚¹</strong>ï¼Œé»˜è®¤ä¸º&nbsp;<code>"hessian2"</code>&nbsp;ï¼Œå³æœªé…ç½®æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Hessian è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ– ã€‚</li>
<li><code>#getContentTypeId()</code>,<code>#getContentType()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—å†…å®¹ç±»å‹ç¼–å·å’Œåå­—ã€‚</li>
<li>
<p><code>#serialize(...)</code>,<code>#deserialize(...)</code>&nbsp;æ–¹æ³•ï¼ŒğŸ™‚ å…·ä½“çœ‹æ³¨é‡Šã€‚</p>
<ul>
<li>
<p>è™½ç„¶æ·»åŠ äº†&nbsp;<code>@Adaptive</code>&nbsp;æ³¨è§£ï¼Œ ä½†æ˜¯å®é™…ä¸Šï¼Œä¸ä½¿ç”¨ Dubbo SPI Adaptive æœºåˆ¶ï¼Œè€Œæ˜¯ä»£ç ä¸­ï¼Œç›´æ¥è·å–ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// CodecSupport.java</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Serialization <span class="title">getSerialization</span><span class="params">(URL url)</span> </span>{</span><br /><span class="line">    <span class="keyword">return</span> ExtensionLoader.getExtensionLoader(Serialization.class).getExtension(</span><br /><span class="line">            url.getParameter(Constants.SERIALIZATION_KEY, Constants.DEFAULT_REMOTING_SERIALIZATION));</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>x</li>
</ul>
</li>
<li>Serialization å®ç°ç±»ï¼Œå®ç°è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ›å»ºå¯¹åº”çš„ ObjectOutput å’Œ ObjectInput&nbsp;<strong>å®ç°ç±»</strong>çš„å¯¹è±¡ã€‚</li>
</ul>
</li>
</ul>
<h2 id="2-2-DataInput">2.2 DataInput</h2>
<p><code>com.alibaba.dubbo.common.serialize.DataInput</code>&nbsp;ï¼Œæ•°æ®<strong>è¾“å…¥</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">readBool</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">byte</span> <span class="title">readByte</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">short</span> <span class="title">readShort</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">readInt</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">readLong</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">float</span> <span class="title">readFloat</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">readDouble</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line"><span class="function">String <span class="title">readUTF</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line"><span class="keyword">byte</span>[] readBytes() <span class="keyword">throws</span> IOException;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ä» InputStream ä¸­ï¼Œè¯»å–<strong>åŸºæœ¬ç±»å‹</strong>çš„æ•°æ®ã€‚</li>
</ul>
<h3 id="2-2-1-ObjectInput">2.2.1 ObjectInput</h3>
<p><code>com.alibaba.dubbo.common.serialize.ObjectInput</code>&nbsp;ï¼Œå®ç° DataInput æ¥å£ï¼Œå¯¹è±¡<strong>è¾“å…¥</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function">Object <span class="title">readObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException</span>;</span><br /><span class="line">&lt;T&gt; <span class="function">T <span class="title">readObject</span><span class="params">(Class&lt;T&gt; cls)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException</span>;</span><br /><span class="line">&lt;T&gt; <span class="function">T <span class="title">readObject</span><span class="params">(Class&lt;T&gt; cls, Type type)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>åœ¨ DataInput çš„åŸºç¡€ä¸Šï¼Œå¢åŠ è¯»å–å¯¹è±¡çš„æ•°æ®ã€‚</li>
</ul>
<h2 id="2-3-DataOutput">2.3 DataOutput</h2>
<blockquote>
<p>DataOutput å’Œ DataInput ç›¸åã€‚</p>
</blockquote>
<p><code>com.alibaba.dubbo.common.serialize.DataOutput</code>&nbsp;ï¼Œæ•°æ®<strong>è¾“å‡º</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeBool</span><span class="params">(<span class="keyword">boolean</span> v)</span> <span class="keyword">throws</span> IOException</span>;</span><br />    <br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeByte</span><span class="params">(<span class="keyword">byte</span> v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeShort</span><span class="params">(<span class="keyword">short</span> v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeInt</span><span class="params">(<span class="keyword">int</span> v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeLong</span><span class="params">(<span class="keyword">long</span> v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeFloat</span><span class="params">(<span class="keyword">float</span> v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeDouble</span><span class="params">(<span class="keyword">double</span> v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeUTF</span><span class="params">(String v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeBytes</span><span class="params">(<span class="keyword">byte</span>[] v)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeBytes</span><span class="params">(<span class="keyword">byte</span>[] v, <span class="keyword">int</span> off, <span class="keyword">int</span> len)</span> <span class="keyword">throws</span> IOException</span>;</span><br /><br /><span class="line"><span class="comment">// Flush buffer.</span></span><br /><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">flushBuffer</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>å‘ InputStream ä¸­ï¼Œå†™å…¥<strong>åŸºæœ¬ç±»å‹</strong>çš„æ•°æ®ã€‚</li>
</ul>
<h3 id="2-3-1-ObjectOutput">2.3.1 ObjectOutput</h3>
<p><code>com.alibaba.dubbo.common.serialize.ObjectOutput</code>&nbsp;ï¼Œå®ç° DataOutput æ¥å£ï¼Œå¯¹è±¡<strong>è¾“å‡º</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException</span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>åœ¨ DataOutput çš„åŸºç¡€ä¸Šï¼Œå¢åŠ å†™å…¥å¯¹è±¡çš„æ•°æ®ã€‚</li>
</ul>
<h2 id="2-4-Cleanable">2.4 Cleanable</h2>
<p><code>com.alibaba.dubbo.common.serialize.Cleanable</code>&nbsp;ï¼Œ<strong>æ¸…ç†</strong>æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cleanup</span><span class="params">()</span></span>;</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>éƒ¨åˆ† Serialize å®ç°ç±»ï¼Œå®Œæˆåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ï¼Œéœ€è¦åšæ¸…ç†ã€‚é€šè¿‡å®ç°è¯¥æ¥å£ï¼Œæ‰§è¡Œæ¸…ç†çš„é€»è¾‘ã€‚</li>
</ul>
<h2 id="2-5-Optimizer-ç›¸å…³">2.5 Optimizer ç›¸å…³</h2>
<h3 id="2-5-1-SerializationOptimizer">2.5.1 SerializationOptimizer</h3>
<p><code>com.alibaba.dubbo.common.serialize.support.SerializationOptimizer</code>&nbsp;ï¼Œåºåˆ—åŒ–ä¼˜åŒ–å™¨æ¥å£ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SerializationOptimizer</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * <span class="doctag">@return</span> éœ€è¦ä½¿ç”¨ä¼˜åŒ–çš„ç±»çš„é›†åˆ</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function">Collection&lt;Class&gt; <span class="title">getSerializableClasses</span><span class="params">()</span></span>;</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>åœ¨ Kryo ã€FST ä¸­ï¼Œæ”¯æŒ<strong>é…ç½®</strong>éœ€è¦ä¼˜åŒ–çš„ç±»ã€‚ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œå¯ä»¥å®ç°è‡ªå®šä¹‰çš„ SerializationOptimizer å­ç±»ï¼Œè¿›è¡Œé…ç½®ã€‚å½“ç„¶ï¼Œä½¿ç”¨æ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªé€‰æ‹©ï¼ŒDubbo åœ¨å®ç°è€ƒè™‘å–èˆçš„åŸå› å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>FROM ç±»æ³¨é‡Š</p>
<p>This class can be replaced with the contents in config file, but for now I think the class is easier to write</p>
<p>è¿™ä¸ªç±»å¯ä»¥æ›¿æ¢ä¸ºé…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œä½†æ˜¯ç°åœ¨æˆ‘è®¤ä¸ºè¿™ä¸ªç±»æ›´å®¹æ˜“ç¼–å†™ã€‚</p>
</blockquote>
<h3 id="2-5-2-SerializableClassRegistry">2.5.2 SerializableClassRegistry</h3>
<p><code>com.alibaba.dubbo.common.serialize.support.SerializableClassRegistry</code>&nbsp;ï¼Œåºåˆ—åŒ–ä¼˜åŒ–ç±»çš„æ³¨å†Œè¡¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializableClassRegistry</span> </span>{</span><br /><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Set&lt;Class&gt; registrations = <span class="keyword">new</span> LinkedHashSet&lt;Class&gt;();</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * only supposed to be called at startup time</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerClass</span><span class="params">(Class clazz)</span> </span>{</span><br /><span class="line">        registrations.add(clazz);</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Set&lt;Class&gt; <span class="title">getRegisteredClasses</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> registrations;</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>#registerClass(clazz)</code>&nbsp;<strong>é™æ€</strong>æ–¹æ³•ï¼Œæ³¨å†Œã€‚åœ¨&nbsp;<code>SerializationOptimizer#getSerializableClasses()</code>æ–¹æ³•ï¼Œè·å¾—çš„ç±»çš„é›†åˆï¼Œä¼šæ³¨å†Œåˆ° SerializableClassRegistry ä¸­ã€‚</li>
<li><code>#getRegisteredClasses()</code>&nbsp;<strong>é™æ€</strong>æ–¹æ³•ï¼Œè·å¾—ã€‚åœ¨ Kryo ã€FST ä¸­ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ï¼Œè·å¾—éœ€è¦ä½¿ç”¨ä¼˜åŒ–çš„ç±»çš„é›†åˆã€‚</li>
</ul>
<h3 id="2-5-3-åˆå§‹åŒ–åºåˆ—åŒ–ä¼˜åŒ–å™¨">2.5.3 åˆå§‹åŒ–åºåˆ—åŒ–ä¼˜åŒ–å™¨</h3>
<p>åœ¨&nbsp;<code>DubboProtocol#optimizeSerialization()</code>&nbsp;æ–¹æ³•ä¸­ï¼Œåˆå§‹åŒ–åºåˆ—åŒ–ä¼˜åŒ–å™¨ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> * å·²åˆå§‹åŒ–çš„ SerializationOptimizer å®ç°ç±»åçš„é›†åˆ</span></span><br /><span class="line"><span class="comment"> */</span></span><br /><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Set&lt;String&gt; optimizers = <span class="keyword">new</span> ConcurrentHashSet&lt;String&gt;();</span><br /><br /><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">optimizeSerialization</span><span class="params">(URL url)</span> <span class="keyword">throws</span> RpcException </span>{</span><br /><span class="line">    <span class="comment">// è·å¾— `"optimizer"` é…ç½®é¡¹</span></span><br /><span class="line">    String className = url.getParameter(Constants.OPTIMIZER_KEY, <span class="string">""</span>);</span><br /><span class="line">    <span class="keyword">if</span> (StringUtils.isEmpty(className) || optimizers.contains(className)) { <span class="comment">// å·²æ³¨å†Œ</span></span><br /><span class="line">        <span class="keyword">return</span>;</span><br /><span class="line">    }</span><br /><br /><span class="line">    logger.info(<span class="string">"Optimizing the serialization process for Kryo, FST, etc..."</span>);</span><br /><br /><span class="line">    <span class="keyword">try</span> {</span><br /><span class="line">        <span class="comment">// åŠ è½½ SerializationOptimizer å®ç°ç±»</span></span><br /><span class="line">        Class clazz = Thread.currentThread().getContextClassLoader().loadClass(className);</span><br /><span class="line">        <span class="keyword">if</span> (!SerializationOptimizer.class.isAssignableFrom(clazz)) {</span><br /><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"The serialization optimizer "</span> + className + <span class="string">" isn't an instance of "</span> + SerializationOptimizer.class.getName());</span><br /><span class="line">        }</span><br /><br /><span class="line">        <span class="comment">// åˆ›å»º SerializationOptimizer å¯¹è±¡</span></span><br /><span class="line">        SerializationOptimizer optimizer = (SerializationOptimizer) clazz.newInstance();</span><br /><span class="line">        <span class="keyword">if</span> (optimizer.getSerializableClasses() == <span class="keyword">null</span>) {</span><br /><span class="line">            <span class="keyword">return</span>;</span><br /><span class="line">        }</span><br /><br /><span class="line">        <span class="comment">// æ³¨å†Œåˆ° SerializableClassRegistry ä¸­</span></span><br /><span class="line">        <span class="keyword">for</span> (Class c : optimizer.getSerializableClasses()) {</span><br /><span class="line">            SerializableClassRegistry.registerClass(c);</span><br /><span class="line">        }</span><br /><br /><span class="line">        <span class="comment">// æ·»åŠ åˆ° optimizers ä¸­</span></span><br /><span class="line">        optimizers.add(className);</span><br /><span class="line">    } <span class="keyword">catch</span> (ClassNotFoundException e) {</span><br /><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Cannot find the serialization optimizer class: "</span> + className, e);</span><br /><span class="line">    } <span class="keyword">catch</span> (InstantiationException e) {</span><br /><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Cannot instantiate the serialization optimizer class: "</span> + className, e);</span><br /><span class="line">    } <span class="keyword">catch</span> (IllegalAccessException e) {</span><br /><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Cannot instantiate the serialization optimizer class: "</span> + className, e);</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>ğŸ™‚ èƒ–å‹ï¼Œç›´æ¥çœ‹ä»£ç æ³¨é‡Šã€‚</li>
</ul>
<h1 id="3-Dubbo-å®ç°">3. Dubbo å®ç°</h1>
<p>åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-2-dubbo?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; åºåˆ—åŒ–ï¼ˆäºŒï¼‰ä¹‹ Dubbo å®ç°ã€‹</a>&nbsp;ä¸­ï¼Œè¯¦ç»†è§£æã€‚</p>
<h1 id="4-Kryo-å®ç°">4. Kryo å®ç°</h1>
<p>åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-3-kryo?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; åºåˆ—åŒ–ï¼ˆä¸‰ï¼‰ä¹‹ Kryo å®ç°ã€‹</a>&nbsp;ä¸­ï¼Œè¯¦ç»†è§£æã€‚</p>
<h1 id="5-FST-å®ç°">5. FST å®ç°</h1>
<blockquote>
<p>FST fast-serialization æ˜¯é‡æ–°å®ç°çš„ Java å¿«é€Ÿå¯¹è±¡åºåˆ—åŒ–çš„å¼€å‘åŒ…ã€‚åºåˆ—åŒ–é€Ÿåº¦æ›´å¿«ï¼ˆ2-10å€ï¼‰ã€ä½“ç§¯æ›´å°ï¼Œè€Œä¸”å…¼å®¹ JDK åŸç”Ÿçš„åºåˆ—åŒ–ã€‚è¦æ±‚ JDK 1.7 æ”¯æŒã€‚</p>
</blockquote>
<p>ğŸ™‚ æ–‡æœ«ï¼Œæœ‰<strong>æ€§èƒ½</strong>ç›¸å…³æµ‹è¯•çš„åˆ†äº«ã€‚</p>
<h2 id="4-1-FstFactory">4.1 FstFactory</h2>
<p><code>com.alibaba.dubbo.common.serialize.support.fst.FstFactory</code>&nbsp;ï¼ŒFST å·¥å‚ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FstFactory</span> </span>{</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * å•ä¾‹</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> FstFactory factory = <span class="keyword">new</span> FstFactory();</span><br /><br /><span class="line">    <span class="comment">/**</span></span><br /><span class="line"><span class="comment">     * é…ç½®å¯¹è±¡</span></span><br /><span class="line"><span class="comment">     */</span></span><br /><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> FSTConfiguration conf = FSTConfiguration.createDefaultConfiguration();</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FstFactory <span class="title">getDefaultFactory</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> factory;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FstFactory</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="comment">// æ³¨å†Œ</span></span><br /><span class="line">        <span class="keyword">for</span> (Class clazz : SerializableClassRegistry.getRegisteredClasses()) {</span><br /><span class="line">            conf.registerClass(clazz);</span><br /><span class="line">        }</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> FSTObjectOutput <span class="title">getObjectOutput</span><span class="params">(OutputStream outputStream)</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> conf.getObjectOutput(outputStream);</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="function"><span class="keyword">public</span> FSTObjectInput <span class="title">getObjectInput</span><span class="params">(InputStream inputStream)</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> conf.getObjectInput(inputStream);</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>factory</code>&nbsp;<strong>é™æ€</strong>å±æ€§ï¼Œå•ä¾‹ã€‚</li>
<li>
<p><code>conf</code>&nbsp;å±æ€§ï¼ŒFST é…ç½®å¯¹è±¡ã€‚åœ¨<strong>æ„é€ æ–¹æ³•</strong>ä¸­ï¼Œå°† SerializableClassRegistry æ³¨å†Œè¡¨éœ€è¦ä½¿ç”¨<strong>ä¼˜åŒ–</strong>çš„ç±»ï¼Œæ³¨å†Œåˆ° FSTConfiguration ä¸­ã€‚<code>SerializableClassRegistry#registerClass(Class ... c)</code>&nbsp;æ–¹æ³•ï¼Œæ³¨é‡Šå¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">/**</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * Preregister a class (use at init time). This avoids having to write class names.</span></span><br /><span class="line"><span class="comment"> * Its a very simple and effective optimization (frequently &gt; 2 times faster for small objects).</span></span><br /><span class="line"><span class="comment"> * é¢„æ³¨å†Œä¸€ä¸ªç±»(åœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨)ã€‚è¿™æ ·å¯ä»¥é¿å…ç¼–å†™ç±»åã€‚</span></span><br /><span class="line"><span class="comment"> * å®ƒæ˜¯ä¸€ç§éå¸¸ç®€å•æœ‰æ•ˆçš„ä¼˜åŒ–(å¯¹äºå°å¯¹è±¡æ¥è¯´ï¼Œé€šå¸¸æ˜¯&gt;çš„2å€)ã€‚</span></span><br /><span class="line"><span class="comment"> *  </span></span><br /><span class="line"><span class="comment"> * Read and write side need to have classes preregistered in the exact same order.</span></span><br /><span class="line"><span class="comment"> * å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éœ€è¦é¢„å…ˆä»¥å®Œå…¨ç›¸åŒçš„é¡ºåºæ³¨å†Œã€‚</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * </span></span><br /><span class="line"><span class="comment"> * The list does not have to be complete. Just add your most frequently serialized classes here</span></span><br /><span class="line"><span class="comment"> * to get significant gains in speed and smaller serialized representation size.</span></span><br /><span class="line"><span class="comment"> *</span></span><br /><span class="line"><span class="comment"> * è¿™ä¸ªåˆ—è¡¨å¹¶ä¸ä¸€å®šè¦å®Œæ•´ã€‚åªéœ€åœ¨è¿™é‡Œæ·»åŠ æœ€å¸¸è§çš„åºåˆ—åŒ–ç±»ï¼Œä»¥è·å¾—é€Ÿåº¦å’Œè¾ƒå°çš„åºåˆ—åŒ–è¡¨ç¤ºå¤§å°çš„æ˜¾è‘—æé«˜ã€‚</span></span><br /><span class="line"><span class="comment"> */</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
<li>
<p><code>#getObjectOutput()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—&nbsp;<code>org.nustaq.serialization.FSTObjectOutput</code>&nbsp;å¯¹è±¡ï¼Œè¢« FstObjectOutput è°ƒç”¨ã€‚</p>
</li>
<li><code>#getObjectInput()</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—&nbsp;<code>org.nustaq.serialization.FSTObjectInput</code>&nbsp;å¯¹è±¡ï¼Œè¢« FstObjectInput è°ƒç”¨ã€‚</li>
</ul>
<h2 id="4-2-FstSerialization">4.2 FstSerialization</h2>
<p><code>com.alibaba.dubbo.common.serialize.support.fst.FstSerialization</code>&nbsp;ï¼Œå®ç° Serialization æ¥å£ï¼ŒFST&nbsp;<strong>åºåˆ—åŒ–</strong>å®ç°ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FstSerialization</span> <span class="keyword">implements</span> <span class="title">Serialization</span> </span>{</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">byte</span> <span class="title">getContentTypeId</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="number">9</span>;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContentType</span><span class="params">()</span> </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="string">"x-application/fst"</span>;</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> ObjectOutput <span class="title">serialize</span><span class="params">(URL url, OutputStream out)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FstObjectOutput(out);</span><br /><span class="line">    }</span><br /><br /><span class="line">    <span class="meta">@Override</span></span><br /><span class="line">    <span class="function"><span class="keyword">public</span> ObjectInput <span class="title">deserialize</span><span class="params">(URL url, InputStream is)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FstObjectInput(is);</span><br /><span class="line">    }</span><br /><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>"x-application/fst"</code>&nbsp;ï¼Œç±»ä¼¼ HTTP åè®® çš„&nbsp;<strong>Content-Types</strong>&nbsp;çš„ Header ã€‚åœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-1-all/">ã€6. JSON å®ç°ã€</a>&nbsp;ç±»ä¸­ï¼Œè¿”å›çš„æ˜¯&nbsp;<code>"text/json"</code>&nbsp;ã€‚</li>
</ul>
<h2 id="4-3-FstObjectInput">4.3 FstObjectInput</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/fst/FstObjectInput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.fst.FstObjectInput</code></a>&nbsp;ï¼Œå®ç° ObjectInput æ¥å£ï¼ŒFST å¯¹è±¡<strong>è¾“å…¥</strong>å®ç°ç±»ã€‚</p>
<p><strong>æ„é€ æ–¹æ³•</strong></p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">private</span> FSTObjectInput input;</span><br /><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FstObjectInput</span><span class="params">(InputStream inputStream)</span> </span>{</span><br /><span class="line">    input = FstFactory.getDefaultFactory().getObjectInput(inputStream);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>input</code>&nbsp;å±æ€§ï¼Œè°ƒç”¨&nbsp;<code>FstFactory#getObjectInput(inputStream)</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—ã€‚</li>
</ul>
<p><strong>å®ç°æ–¹æ³•</strong></p>
<p>æ¯ä¸ªå®ç°æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨ FSTObjectInput å¯¹åº”çš„æ–¹æ³•ã€‚æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œ<code>#readBytes()</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] readBytes() <span class="keyword">throws</span> IOException {</span><br /><span class="line">    <span class="keyword">int</span> len = input.readInt();</span><br /><span class="line">    <span class="comment">// æ•°ç»„ä¸ºç©º</span></span><br /><span class="line">    <span class="keyword">if</span> (len &lt; <span class="number">0</span>) {</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br /><span class="line">    <span class="comment">// æ•°ç»„ä¸ºé›¶</span></span><br /><span class="line">    } <span class="keyword">else</span> <span class="keyword">if</span> (len == <span class="number">0</span>) {</span><br /><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">byte</span>[]{};</span><br /><span class="line">    <span class="comment">// æ•°ç»„ &gt; 0</span></span><br /><span class="line">    } <span class="keyword">else</span> {</span><br /><span class="line">        <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[len];</span><br /><span class="line">        input.readFully(b);</span><br /><span class="line">        <span class="keyword">return</span> b;</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>[ å­—èŠ‚æ•°ç»„é•¿åº¦, å­—èŠ‚æ•°ç»„å†…å®¹ ]</li>
</ul>
<h2 id="4-4-FstObjectOutput">4.4 FstObjectOutput</h2>
<p><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/fst/FstObjectOutput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.fst.FstObjectOutput</code></a>&nbsp;ï¼Œå®ç° ObjectOutput æ¥å£ï¼ŒFST å¯¹è±¡<strong>è¾“å‡º</strong>å®ç°ç±»ã€‚</p>
<p><strong>æ„é€ æ–¹æ³•</strong></p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="keyword">private</span> FSTObjectOutput output;</span><br /><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">FstObjectOutput</span><span class="params">(OutputStream outputStream)</span> </span>{</span><br /><span class="line">    output = FstFactory.getDefaultFactory().getObjectOutput(outputStream);</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>output</code>&nbsp;å±æ€§ï¼Œè°ƒç”¨&nbsp;<code>FstFactory#getObjectInput(outputStream)</code>&nbsp;æ–¹æ³•ï¼Œè·å¾—ã€‚</li>
</ul>
<p><strong>å®ç°æ–¹æ³•</strong></p>
<p>æ¯ä¸ªå®ç°æ–¹æ³•ï¼Œç›´æ¥è°ƒç”¨ FSTObjectInput å¯¹åº”çš„æ–¹æ³•ã€‚æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯ï¼Œ<code>#writeBytes(byte[] v)</code>&nbsp;æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeBytes</span><span class="params">(<span class="keyword">byte</span>[] v)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">    <span class="comment">// ç©ºï¼Œå†™å…¥ -1</span></span><br /><span class="line">    <span class="keyword">if</span> (v == <span class="keyword">null</span>) {</span><br /><span class="line">        output.writeInt(-<span class="number">1</span>);</span><br /><span class="line">    <span class="comment">// æœ‰æ•°ç»„</span></span><br /><span class="line">    } <span class="keyword">else</span> {</span><br /><span class="line">        writeBytes(v, <span class="number">0</span>, v.length);</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>[ å­—èŠ‚æ•°ç»„é•¿åº¦, å­—èŠ‚æ•°ç»„å†…å®¹ ]</li>
</ul>
<h1 id="6-JSON-å®ç°">6. JSON å®ç°</h1>
<p>åŸºäº FastJSON å®ç°ã€‚</p>
<blockquote>
<p>fastjson æ˜¯ä¸€ä¸ªæ€§èƒ½å¾ˆå¥½çš„ Java è¯­è¨€å®ç°çš„ JSON è§£æå™¨å’Œç”Ÿæˆå™¨ï¼Œæ¥è‡ªé˜¿é‡Œå·´å·´çš„å·¥ç¨‹å¸ˆå¼€å‘ã€‚</p>
<p>ä¸»è¦ç‰¹ç‚¹ï¼š</p>
<ul>
<li>å¿«é€ŸFAST (æ¯”å…¶å®ƒä»»ä½•åŸºäºJavaçš„è§£æå™¨å’Œç”Ÿæˆå™¨æ›´å¿«ï¼ŒåŒ…æ‹¬&nbsp;<a href="https://www.oschina.net/p/jackson" target="_blank" rel="external nofollow noopener noreferrer">jackson</a>ï¼‰</li>
<li>å¼ºå¤§ï¼ˆæ”¯æŒæ™®é€šJDKç±»åŒ…æ‹¬ä»»æ„Java Bean Classã€Collectionã€Mapã€Date æˆ– enumï¼‰</li>
<li>é›¶ä¾èµ–ï¼ˆæ²¡æœ‰ä¾èµ–å…¶å®ƒä»»ä½•ç±»åº“é™¤äº†JDKï¼‰</li>
</ul>
</blockquote>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå’Œ&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-1-all/">ã€5. FST å®ç°ã€</a>&nbsp;ç±»ä¼¼ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ï¼š</p>
<ul>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/json/FastJsonSerialization.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.json.FastJsonSerialization</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/json/FastJsonObjectInput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.json.FastJsonObjectInput</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/json/FastJsonObjectOutput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.json.FastJsonObjectOutput</code></a></li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>FastJsonObjectOutput#writeObject(Object)</code>&nbsp;æ–¹æ³•çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">    SerializeWriter out = <span class="keyword">new</span> SerializeWriter();</span><br /><span class="line">    <span class="comment">// åºåˆ—åŒ–ï¼Œå†™å…¥å¯¹è±¡</span></span><br /><span class="line">    JSONSerializer serializer = <span class="keyword">new</span> JSONSerializer(out);</span><br /><span class="line">    serializer.config(SerializerFeature.WriteEnumUsingToString, <span class="keyword">true</span>); <span class="comment">// æšä¸¾è½¬å­—ç¬¦ä¸²</span></span><br /><span class="line">    serializer.write(obj);</span><br /><span class="line">    <span class="comment">// å†™åˆ°ï¼Œè¾“å‡ºæµ</span></span><br /><span class="line">    out.writeTo(writer);</span><br /><span class="line">    out.close(); <span class="comment">// for reuse SerializeWriter buf</span></span><br /><span class="line">    writer.println(); <span class="comment">// æ¢è¡Œ</span></span><br /><span class="line">    writer.flush();</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h1 id="7-Hessian2-å®ç°">7. Hessian2 å®ç°</h1>
<blockquote>
<p>å’Œå…¶ä»– Web æœåŠ¡çš„å®ç°æ¡†æ¶ä¸åŒçš„æ˜¯ï¼ŒHessian æ˜¯ä¸€ä¸ªä½¿ç”¨äºŒè¿›åˆ¶ Web æœåŠ¡åè®®çš„æ¡†æ¶ï¼Œå®ƒçš„å¥½å¤„åœ¨äºå…é™¤äº†ä¸€å¤§å †é™„åŠ çš„APIåŒ…ï¼Œä¾‹å¦‚ XML çš„å¤„ç†ä¹‹ç±»çš„ jar åŒ…ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¯´å®ƒæ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Web æœåŠ¡å®ç°æ¡†æ¶çš„åŸå› ï¼Œè¿™ä¸ªåŸå› è¿˜åœ¨äºæ‰‹æœºä¸Šçš„åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ Hessian æä¾›çš„ API å¾ˆæ–¹ä¾¿çš„è®¿é—® Hessian çš„ Web æœåŠ¡ã€‚</p>
</blockquote>
<p>ä»ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒHessian è‡ªå·±æœ‰è‡ªå·±çš„<strong>åºåˆ—åŒ–</strong>çš„å®ç°ã€‚ä½†æ˜¯ï¼ŒHessian åœ¨å®ç°ä¸Šï¼Œå­˜åœ¨ä¸€äº› Bug å’Œéœ€è¦æ€§èƒ½ä¼˜åŒ–çš„ç‚¹ã€‚ä¾‹å¦‚ï¼š</p>
<blockquote>
<p><strong>BigDecimal çš„ååºåˆ—åŒ–</strong></p>
<p>ä½¿ç”¨ Hessian åºåˆ—åŒ–åŒ…å« BigDecimal å­—æ®µçš„å¯¹è±¡æ—¶ä¼šå¯¼è‡´å…¶å€¼ä¸€ç›´ä¸º0ï¼Œä¸æ³¨æ„è¿™ä¸ªbugä¼šå¯¼è‡´å¾ˆå¤§çš„é—®é¢˜ï¼Œåœ¨æœ€æ–°çš„4.0.51ç‰ˆæœ¬ä»ç„¶å¯ä»¥å¤ç°ã€‚è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼ŒæŒ‡å®š BigDecimal çš„åºåˆ—åŒ–å™¨å³å¯ã€‚</p>
</blockquote>
<p>æ‰€ä»¥ Dubbo ç»´æŠ¤äº†è‡ªå·±çš„&nbsp;<a href="https://github.com/alibaba/dubbo/tree/4bbc0ddddacc915ddc8ff292dd28745bbc0031fd/hessian-lite" target="_blank" rel="external nofollow noopener noreferrer"><code>hessian-lite</code></a>&nbsp;ï¼Œå¯¹&nbsp;<a href="http://hessian.caucho.com/" target="_blank" rel="external nofollow noopener noreferrer">Hessian 2</a>&nbsp;çš„&nbsp;<strong>åºåˆ—åŒ–</strong>&nbsp;éƒ¨åˆ†çš„ç²¾ç®€ã€æ”¹è¿›ã€BugFix ã€‚<br />æäº¤å†å²å¦‚ä¸‹ï¼š<br /><img src="http://static2.iocoder.cn/images/Dubbo/2018_01_04/23.png" alt="hessian-lite æäº¤å†å²" /></p>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå’Œ&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-1-all/">ã€5. FST å®ç°ã€</a>&nbsp;ç±»ä¼¼ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ï¼š</p>
<ul>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/hessian/Hessian2SerializerFactory.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.hessian.Hessian2SerializerFactory</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/hessian/Hessian2Serialization.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.hessian.Hessian2Serialization</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/hessian/Hessian2ObjectInput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.hessian.Hessian2ObjectInput</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/hessian/Hessian2ObjectOutput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.hessian.Hessian2ObjectOutput</code></a></li>
</ul>
<h1 id="8-NativeJava-å®ç°">8. NativeJava å®ç°</h1>
<blockquote>
<p>æ—ç™½å›ï¼šç”±äºè‰¿è‰¿å¯¹ Java åŸç”Ÿçš„åºåˆ—åŒ–ï¼Œäº†è§£çš„æ¯”è¾ƒç²—æµ…ï¼Œæœ¬å°èŠ‚æ›´å¤šçš„æ˜¯æŠŠä»£ç æ¢³ç†å¹²å‡€ã€‚</p>
</blockquote>
<p><code>nativejava</code>&nbsp;ï¼ŒåŸºäº Java&nbsp;<strong>åŸç”Ÿ</strong>( è‡ªå¸¦ )çš„ Java åºåˆ—åŒ–å®ç°ï¼Œå³ä½¿ç”¨&nbsp;<code>java.io.ObjectInputStream</code>&nbsp;å’Œ&nbsp;<code>java.io.ObjectOutputStream</code>&nbsp;è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</p>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå’Œ&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-1-all/">ã€5. FST å®ç°ã€</a>&nbsp;ç±»ä¼¼ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ï¼š</p>
<ul>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/nativejava/NativeJavaSerialization.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.nativejava.NativeJavaSerialization</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/nativejava/NativeJavaObjectInput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.nativejava.NativeJavaObjectInput</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/nativejava/NativeJavaObjectOutput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.nativejava.NativeJavaObjectOutput</code></a></li>
</ul>
<h2 id="8-1-Java-å®ç°">8.1 Java å®ç°</h2>
<p><code>java</code>&nbsp;ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-1-all/">ã€8. NativeJava å®ç°ã€</a>&nbsp;çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†å¯¹ç©ºå­—ç¬¦ä¸²å’Œç©ºå¯¹è±¡çš„å¤„ç†ã€‚å¦‚ä¸‹æ˜¯ JavaObjectOutput å¯¹ç©ºå­—ç¬¦ä¸²å’Œç©ºå¯¹è±¡çš„åºåˆ—åŒ–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// ã€æ³¨æ„ã€‘JavaObjectOutput extends NativeJavaObjectOutput ï¼ï¼ï¼</span></span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeUTF</span><span class="params">(String v)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">    <span class="keyword">if</span> (v == <span class="keyword">null</span>) { <span class="comment">// ç©ºå­—ç¬¦ä¸²</span></span><br /><span class="line">        getObjectOutputStream().writeInt(-<span class="number">1</span>);</span><br /><span class="line">    } <span class="keyword">else</span> {</span><br /><span class="line">        getObjectOutputStream().writeInt(v.length()); <span class="comment">// é•¿åº¦</span></span><br /><span class="line">        getObjectOutputStream().writeUTF(v); <span class="comment">// å­—ç¬¦ä¸²</span></span><br /><span class="line">    }</span><br /><span class="line">}</span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(Object obj)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">    <span class="keyword">if</span> (obj == <span class="keyword">null</span>) { <span class="comment">// ç©º</span></span><br /><span class="line">        getObjectOutputStream().writeByte(<span class="number">0</span>); <span class="comment">// ç©º</span></span><br /><span class="line">    } <span class="keyword">else</span> {</span><br /><span class="line">        getObjectOutputStream().writeByte(<span class="number">1</span>); <span class="comment">// éç©º</span></span><br /><span class="line">        getObjectOutputStream().writeObject(obj); <span class="comment">// å¯¹è±¡</span></span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå’Œ&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-1-all/">ã€NativeJava å®ç°ã€</a>&nbsp;ç±»ä¼¼ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ï¼š</p>
<ul>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/java/JavaSerialization.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.java.JavaSerialization</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/java/JavaObjectInput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.java.JavaObjectInput</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/java/JavaObjectOutput.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.java.JavaObjectOutput</code></a></li>
</ul>
<h2 id="8-2-CompactedJava">8.2 CompactedJava</h2>
<p><code>compactedjava</code>&nbsp;ï¼Œåœ¨&nbsp;<a href="http://svip.iocoder.cn/Dubbo/serialize-1-all/">ã€8.1 Java å®ç°ã€</a>&nbsp;çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†å¯¹&nbsp;<strong>ClassDescriptor</strong>&nbsp;çš„å¤„ç†ã€‚å¦‚ä¸‹æ˜¯ CompactedObjectOutputStream å¯¹&nbsp;<strong>ClassDescriptor</strong>&nbsp;çš„å†™å…¥ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="comment">// ã€æ³¨æ„ã€‘CompactedObjectOutputStream extends ObjectOutputStream ï¼ï¼ï¼</span></span><br /><br /><span class="line"><span class="meta">@Override</span></span><br /><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">writeClassDescriptor</span><span class="params">(ObjectStreamClass desc)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">    Class&lt;?&gt; clazz = desc.forClass();</span><br /><span class="line">    <span class="keyword">if</span> (clazz.isPrimitive() || clazz.isArray()) {</span><br /><span class="line">        write(<span class="number">0</span>);</span><br /><span class="line">        <span class="keyword">super</span>.writeClassDescriptor(desc);</span><br /><span class="line">    } <span class="keyword">else</span> {</span><br /><span class="line">        write(<span class="number">1</span>);</span><br /><span class="line">        writeUTF(desc.getName());</span><br /><span class="line">    }</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li>
<p>åœ¨ JavaObjectOutput çš„åˆ›å»ºæ—¶ï¼Œæ ¹æ®&nbsp;<code>compact = true</code>&nbsp;æ—¶ï¼Œä½¿ç”¨ CompactedObjectOutputStream è¾“å‡ºæµã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">JavaObjectOutput</span><span class="params">(OutputStream os, <span class="keyword">boolean</span> compact)</span> <span class="keyword">throws</span> IOException </span>{</span><br /><span class="line">    <span class="keyword">super</span>(compact ? <span class="keyword">new</span> CompactedObjectOutputStream(os) : <span class="keyword">new</span> ObjectOutputStream(os));</span><br /><span class="line">}</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
</li>
</ul>
<p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œèƒ–å‹è‡ªå·±æŸ¥çœ‹ï¼š</p>
<ul>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/java/CompactedJavaSerialization.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.java.CompactedJavaSerialization</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/java/CompactedObjectInputStream.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.java.CompactedObjectInputStream</code></a></li>
<li><a href="https://github.com/YunaiV/dubbo/blob/master/dubbo-common/src/main/java/com/alibaba/dubbo/common/serialize/support/java/CompactedObjectOutputStream.java" target="_blank" rel="external nofollow noopener noreferrer"><code>com.alibaba.dubbo.common.serialize.support.java.CompactedObjectOutputStream</code></a></li>
</ul>
</div>