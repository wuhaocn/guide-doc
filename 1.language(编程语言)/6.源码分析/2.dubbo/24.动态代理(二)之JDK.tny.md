<header class="article-header">
<h1 class="article-title">åŠ¨æ€ä»£ç†ï¼ˆäºŒï¼‰ä¹‹ JDK</h1>
</header>
<div class="article-entry">
<blockquote>
<p>æœ¬æ–‡åŸºäº Dubbo 2.6.1 ç‰ˆæœ¬ï¼Œæœ›çŸ¥æ‚‰ã€‚</p>
</blockquote>
<h1 id="1-æ¦‚è¿°">1. æ¦‚è¿°</h1>
<p>æœ¬æ–‡æ¥&nbsp;<a href="http://svip.iocoder.cn/Dubbo/proxy-javassist/?self">ã€Šç²¾å°½ Dubbo æºç åˆ†æ &mdash;&mdash; åŠ¨æ€ä»£ç†ï¼ˆä¸€ï¼‰ä¹‹ Javassistã€‹</a>&nbsp;ä¸€æ–‡ï¼Œåˆ†äº«ä½¿ç”¨&nbsp;<strong>JDK</strong>&nbsp;ç”ŸæˆåŠ¨æ€ä»£ç†çš„ä»£ç å®ç°ã€‚</p>
<p>å¦‚æœ JDK Proxy ä¸ç†Ÿæ‚‰çš„èƒ–å‹ï¼Œå¯ä»¥çœ‹ä¸‹&nbsp;<a href="http://blog.csdn.net/jiankunking/article/details/52143504" target="_blank" rel="external nofollow noopener noreferrer">ã€Š Java JDK åŠ¨æ€ä»£ç†ï¼ˆAOPï¼‰ä½¿ç”¨åŠå®ç°åŸç†åˆ†æã€‹</a>&nbsp;å­¦ä¹ ä¸‹ã€‚ğŸ™‚ å­¦æ— æ­¢å¢ƒå‘€ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœä½¿ç”¨ JDK ç”Ÿæˆä»£ç†ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight xml">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line">// æœåŠ¡å¼•ç”¨</span><br /><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">proxy</span>=<span class="string">"jdk"</span> /&gt;</span></span><br /><br /><span class="line">// æœåŠ¡æš´éœ²</span><br /><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">proxy</span>=<span class="string">"jdk"</span> /&gt;</span></span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<h1 id="2-JdkProxyFactory">2. JdkProxyFactory</h1>
<p><code>com.alibaba.dubbo.rpc.proxy.jdk.JdkProxyFactory</code>&nbsp;ï¼Œå®ç° AbstractProxyInvoker æŠ½è±¡ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java">
<table>
<tbody>
<tr>
<td class="code">
<pre><span class="line"> <span class="number">1</span>: <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JdkProxyFactory</span> <span class="keyword">extends</span> <span class="title">AbstractProxyFactory</span> </span>{</span><br /><span class="line"> <span class="number">2</span>: </span><br /><span class="line"> <span class="number">3</span>:     <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br /><span class="line"> <span class="number">4</span>:     <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">getProxy</span><span class="params">(Invoker&lt;T&gt; invoker, Class&lt;?&gt;[] interfaces)</span> </span>{</span><br /><span class="line"> <span class="number">5</span>:         <span class="keyword">return</span> (T) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), interfaces, <span class="keyword">new</span> InvokerInvocationHandler(invoker));</span><br /><span class="line"> <span class="number">6</span>:     }</span><br /><span class="line"> <span class="number">7</span>: </span><br /><span class="line"> <span class="number">8</span>:     <span class="keyword">public</span> &lt;T&gt; <span class="function">Invoker&lt;T&gt; <span class="title">getInvoker</span><span class="params">(T proxy, Class&lt;T&gt; type, URL url)</span> </span>{</span><br /><span class="line"> <span class="number">9</span>:         <span class="keyword">return</span> <span class="keyword">new</span> AbstractProxyInvoker&lt;T&gt;(proxy, type, url) {</span><br /><span class="line"><span class="number">10</span>:             <span class="meta">@Override</span></span><br /><span class="line"><span class="number">11</span>:             <span class="function"><span class="keyword">protected</span> Object <span class="title">doInvoke</span><span class="params">(T proxy, String methodName,</span></span></span><br /><span class="line"><span class="function"><span class="params"><span class="number">12</span>:                                       Class&lt;?&gt;[] parameterTypes,</span></span></span><br /><span class="line"><span class="function"><span class="params"><span class="number">13</span>:                                       Object[] arguments)</span> <span class="keyword">throws</span> Throwable </span>{</span><br /><span class="line"><span class="number">14</span>:                 <span class="comment">// è·å¾—æ–¹æ³•</span></span><br /><span class="line"><span class="number">15</span>:                 Method method = proxy.getClass().getMethod(methodName, parameterTypes);</span><br /><span class="line"><span class="number">16</span>:                 <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br /><span class="line"><span class="number">17</span>:                 <span class="keyword">return</span> method.invoke(proxy, arguments);</span><br /><span class="line"><span class="number">18</span>:             }</span><br /><span class="line"><span class="number">19</span>:         };</span><br /><span class="line"><span class="number">20</span>:     }</span><br /><span class="line"><span class="number">21</span>: </span><br /><span class="line"><span class="number">22</span>: }</span></pre>
</td>
</tr>
</tbody>
</table>
</figure>
<ul>
<li><code>#getProxy(invoker, interfaces)</code>&nbsp;æ–¹æ³•
<ul>
<li>ç¬¬ 5 è¡Œï¼šåˆ›å»º InvokerInvocationHandler å¯¹è±¡ï¼Œä¼ å…¥&nbsp;<code>invoker</code>&nbsp;å¯¹è±¡ã€‚</li>
<li>ç¬¬ 5 è¡Œï¼šè°ƒç”¨&nbsp;<code>java.lang.reflect.Proxy#getProxy(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h)</code>&nbsp;æ–¹æ³•ï¼Œåˆ›å»º Proxy å¯¹è±¡ã€‚</li>
<li>ğŸ™‚ ç›¸æ¯” Javassist ç²¾ç®€å¾ˆå¤šï¼ŒæœŸå¾… JDK Proxy çš„ä¸æ–­æ€§èƒ½ä¼˜åŒ–ã€‚</li>
</ul>
</li>
<li><code>#getInvoker(proxy, type, url)</code>&nbsp;æ–¹æ³•
<ul>
<li>ç¬¬ 9 è‡³ 19 è¡Œï¼šåˆ›å»º AbstractProxyInvoker å¯¹è±¡ï¼Œå®ç°&nbsp;<code>#doInvoker(...)</code>&nbsp;æ–¹æ³•ã€‚
<ul>
<li>ç¬¬ 15 è¡Œï¼šè°ƒç”¨&nbsp;<code>Class#getMethod(String name, Class&lt;?&gt;... parameterTypes)</code>&nbsp;æ–¹æ³•ï¼Œåå°„è·å¾—æ–¹æ³•ã€‚</li>
<li>ç¬¬ 17 è¡Œï¼šè°ƒç”¨&nbsp;<code>Method#invoke(proxy, arguments)</code>&nbsp;æ–¹æ³•ï¼Œæ‰§è¡Œæ–¹æ³•ã€‚</li>
<li>æ¨èé˜…è¯»ï¼š<a href="http://www.fanyilun.me/2015/10/29/Java%E5%8F%8D%E5%B0%84%E5%8E%9F%E7%90%86/" target="_blank" rel="external nofollow noopener noreferrer">ã€ŠJavaåå°„åŸç†ç®€æã€‹</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>